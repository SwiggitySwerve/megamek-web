# BattleTech Editor - Agent Rules and Guidelines

## üö® **CRITICAL: BattleTech Rules Documentation**

**ALWAYS reference BattleTech construction rules when working on this project.**

### **Primary Rules Documentation**
- **OpenSpec Specs**: `openspec/specs/` (SINGLE SOURCE OF TRUTH)
- **Constants**: `constants/BattleTechConstructionRules.ts`
- **Full Guides**: `docs/battletech/battletech_*.md`

### **Viewing Specs**
```bash
# List all specs
npx openspec list --specs

# View a specific spec
npx openspec show movement-system --type spec
```

### **When to Reference Rules**
- Implementing or modifying construction calculations
- Adding validation logic
- Working with equipment placement
- Calculating weights, structure, or armor
- Implementing tech level restrictions
- Working with critical slots
- Any BattleTech rule-related code

### **Code References**
- **Single Source of Truth**: `constants/BattleTechConstructionRules.ts`
- **Validation**: `services/ConstructionRulesValidator.ts`
- **Validators**: `services/validation/*.ts`

---

## üõ°Ô∏è **Code Standards**

### **Type Safety**
- ALWAYS use concrete types, never `as any`
- Use defined interfaces and types from `types/` directory
- Use base objects from `getAvailable*` utilities for dropdowns
- Prefer full canonical objects over string types

### **Forbidden Patterns**
- **NO `as any` Casting**: Silences compiler errors but causes runtime crashes.
- **NO `as unknown as` Double Casting**: Bypasses type safety entirely. Use type guards or conversion functions.
- **NO Legacy Imports**: Do not import from `types/systemComponents.ts`. Use `types/core`.
- **NO Magic Strings**: Use constants (e.g., `TechBase.INNER_SPHERE`) instead of literals.
- **NO Direct Property Access on `unknown`**: Use `isValid*` type guards first.

### **Architecture**
- Follow SOLID principles
- Single Responsibility Principle - one class, one reason to change
- Services end with `Service`, Managers for orchestration only
- Validators end with `Validator`
- Interfaces start with `I` prefix

### **Naming Conventions**
- NO `ServiceImpl`, `V2`, `V3`, `Refactored` suffixes
- NO `Manager` for business logic (use `Service`)
- Use descriptive, clear names

---

## üèóÔ∏è **BattleTech Rule Implementation**

### **Construction Rules**
All construction calculations MUST match official BattleTech TechManual rules:
- Structure weight: 10% of tonnage (standard) / 5% (Endo Steel)
- Armor maximum: 2x structure points (except head = 9)
- Engine heat sinks: Rating / 25 (no minimum)
- Minimum total heat sinks: MAX(10, heat-generating weapons)

### **Validation Rules**
All validation MUST enforce BattleTech rules:
- Weight limits cannot be exceeded
- Armor maximums per location
- Critical slot capacity (78 total, location-specific)
- Tech base compatibility
- Era restrictions

### **Code Location**
- **Constants**: `constants/BattleTechConstructionRules.ts` - Single source of truth
- **Validation**: `services/validation/*.ts` - Rule enforcement
- **Calculations**: `utils/constructionRules/*.ts` - Rule calculations

---

## üìÇ **Documentation Structure**

### **Rules Documentation**
```
openspec/specs/           # SINGLE SOURCE OF TRUTH
‚îú‚îÄ‚îÄ construction-rules-core/
‚îú‚îÄ‚îÄ engine-system/
‚îú‚îÄ‚îÄ gyro-system/
‚îú‚îÄ‚îÄ armor-system/
‚îú‚îÄ‚îÄ movement-system/
‚îú‚îÄ‚îÄ heat-sink-system/
‚îú‚îÄ‚îÄ weapon-system/
‚îú‚îÄ‚îÄ equipment-database/
‚îî‚îÄ‚îÄ ...

docs/battletech/          # Supplementary guides
‚îú‚îÄ‚îÄ README.md             # Points to OpenSpec
‚îî‚îÄ‚îÄ battletech_*.md       # Comprehensive guides
```

### **Before Making Changes**
1. Read relevant OpenSpec spec (`npx openspec show <spec-name> --type spec`)
2. Check `constants/BattleTechConstructionRules.ts`
3. Review validation services
4. Ensure changes match official rules

---

## ‚ö†Ô∏è **Important Reminders**

1. **BattleTech Rules are IMMUTABLE** - They come from the official TechManual
2. **Single Source of Truth** - OpenSpec specs + `BattleTechConstructionRules.ts`
3. **Always Validate** - Use validation services, don't bypass them
4. **Type Safety First** - No `as any`, use proper types
5. **SOLID Architecture** - Follow established patterns

---

üîç **Quick Lookup**

### **Common Rules**
- **Structure**: 10% of tonnage (standard), 5% (Endo Steel)
- **Armor Max**: Head = 9, Others = 2x structure
- **Critical Slots**: 78 total (6 head, 12 CT, 12x2 torso, 12x2 arms, 6x2 legs)
- **Engine Heat Sinks**: Rating / 25 (no minimum)
- **Min Total Heat Sinks**: MAX(10, heat-generating weapons)

### **Key Files**
- Specs: `openspec/specs/`
- Constants: `constants/BattleTechConstructionRules.ts`
- Validation: `services/ConstructionRulesValidator.ts`

---

**Last Updated**: 2025-11-30
**Version**: 2.0
