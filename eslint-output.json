[{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\next-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\next.config.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .optimization on an `error` typed value.","line":21,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":21,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":24,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":24,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .module on an `error` typed value.","line":24,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":24,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":32,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":32,"endColumn":74},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":32,"column":40,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":32,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":33,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":33,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .plugins on an `error` typed value.","line":33,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":33,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe construction of a(n) `any` typed value.","line":34,"column":9,"nodeType":"NewExpression","messageId":"unsafeNew","endLine":38,"endColumn":11},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":44,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":81,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .optimization on an `error` typed value.","line":44,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":44,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .optimization on an `error` typed value.","line":45,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":45,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":46,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":80,"endColumn":10},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .optimization on an `error` typed value.","line":47,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":47,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":86,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":86,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .plugins on an `error` typed value.","line":86,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":86,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe construction of a(n) `any` typed value.","line":87,"column":9,"nodeType":"NewExpression","messageId":"unsafeNew","endLine":92,"endColumn":11},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .ProgressPlugin on an `any` value.","line":87,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":87,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":97,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":104,"endColumn":6},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .resolve on an `error` typed value.","line":97,"column":12,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":97,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .resolve on an `error` typed value.","line":98,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":98,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type error.","line":106,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":106,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextConfig } from \"next\";\r\nimport type { Configuration } from \"webpack\";\r\n\r\nconst nextConfig: NextConfig = {\r\n  // Enable React strict mode for better development experience\r\n  reactStrictMode: true,\r\n  \r\n  // Turbopack config (empty to silence Next.js 16 warning)\r\n  turbopack: {},\r\n  \r\n  // Optimize for production builds\r\n  experimental: {\r\n    // Enable modern output for better tree-shaking\r\n    esmExternals: true,\r\n  },\r\n\r\n  // Webpack configuration for bundle optimization\r\n  webpack: (config: Configuration, { buildId: _buildId, dev, isServer, defaultLoaders: _defaultLoaders, webpack }) => {\r\n    // Enable tree-shaking for equipment data files\r\n    if (!dev) {\r\n      config.optimization.sideEffects = false;\r\n      \r\n      // Add specific tree-shaking rules for equipment files\r\n      config.module.rules.push({\r\n        test: /src\\/data\\/equipment.*\\.ts$/,\r\n        sideEffects: false,\r\n      });\r\n    }\r\n\r\n    // Add bundle analyzer in development\r\n    if (dev && !isServer) {\r\n      const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer');\r\n      config.plugins.push(\r\n        new BundleAnalyzerPlugin({\r\n          analyzerMode: 'server',\r\n          analyzerPort: 8888,\r\n          openAnalyzer: false,\r\n        })\r\n      );\r\n    }\r\n\r\n    // Optimize chunk splitting for better caching\r\n    if (!dev && !isServer) {\r\n      config.optimization.splitChunks = {\r\n        ...config.optimization.splitChunks,\r\n        cacheGroups: {\r\n          ...config.optimization.splitChunks.cacheGroups,\r\n          \r\n          // Separate chunk for equipment data\r\n          equipment: {\r\n            test: /[\\\\/]src[\\\\/]data[\\\\/]equipment/,\r\n            name: 'equipment',\r\n            chunks: 'all',\r\n            priority: 30,\r\n          },\r\n          \r\n          // Separate chunk for services\r\n          services: {\r\n            test: /[\\\\/]src[\\\\/]services[\\\\/]/,\r\n            name: 'services',\r\n            chunks: 'all',\r\n            priority: 25,\r\n          },\r\n          \r\n          // Separate chunk for utilities\r\n          utils: {\r\n            test: /[\\\\/]src[\\\\/]utils[\\\\/]/,\r\n            name: 'utils',\r\n            chunks: 'all',\r\n            priority: 20,\r\n          },\r\n          \r\n          // Separate chunk for components\r\n          components: {\r\n            test: /[\\\\/]src[\\\\/]components[\\\\/]/,\r\n            name: 'components',\r\n            chunks: 'all',\r\n            priority: 15,\r\n          },\r\n        },\r\n      };\r\n    }\r\n\r\n    // Add progress plugin for build feedback\r\n    if (!dev) {\r\n      config.plugins.push(\r\n        new webpack.ProgressPlugin({\r\n          activeModules: true,\r\n          entries: true,\r\n          modules: true,\r\n          dependencies: true,\r\n        })\r\n      );\r\n    }\r\n\r\n    // Optimize module resolution for faster builds\r\n    config.resolve.alias = {\r\n      ...config.resolve.alias,\r\n      '@/services': './src/services',\r\n      '@/utils': './src/utils',\r\n      '@/components': './src/components',\r\n      '@/data': './src/data',\r\n      '@/types': './src/types',\r\n    };\r\n\r\n    return config;\r\n  },\r\n\r\n  // Enable static optimization\r\n  trailingSlash: false,\r\n  \r\n  // Optimize images\r\n  images: {\r\n    formats: ['image/webp', 'image/avif'],\r\n    minimumCacheTTL: 31536000, // 1 year\r\n  },\r\n\r\n  // Enable compression\r\n  compress: true,\r\n\r\n  // Power-user settings\r\n  poweredByHeader: false,\r\n  \r\n  // Generate build ID for cache busting\r\n  generateBuildId: async () => {\r\n    return `${Date.now()}`;\r\n  },\r\n\r\n  // Environment variables for build optimization\r\n  env: {\r\n    BUNDLE_ANALYZE: process.env.ANALYZE === 'true' ? 'true' : 'false',\r\n    BUILD_TIME: new Date().toISOString(),\r\n  },\r\n};\r\n\r\nexport default nextConfig;\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\catalog.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":32,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":32,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":33,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":33,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":34,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":34,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":64,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":64,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":65,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":65,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":66,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":66,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":67,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":67,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":88,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":88,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":89,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":89,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":90,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":90,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":106,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":106,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":107,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":107,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":125,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":125,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":126,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":126,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":143,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":143,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":144,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":144,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":145,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":145,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":161,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":161,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":162,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":162,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":163,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":163,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":179,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":179,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":180,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":180,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":181,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":181,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":195,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":195,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":196,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":196,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":25,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/catalog endpoint\n */\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/catalog';\nimport { canonicalUnitService } from '@/services/units/CanonicalUnitService';\n\n// Mock the canonical unit service\njest.mock('@/services/units/CanonicalUnitService', () => ({\n  canonicalUnitService: {\n    getIndex: jest.fn(),\n  },\n}));\n\nconst mockGetIndex = canonicalUnitService.getIndex as jest.Mock;\n\ndescribe('/api/catalog', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('GET method validation', () => {\n    it('should reject non-GET requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'POST',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Method not allowed');\n    });\n\n    it('should reject PUT requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'PUT',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n    });\n  });\n\n  describe('GET full catalog', () => {\n    it('should return full unit index', async () => {\n      const mockIndex = [\n        { id: '1', name: 'Atlas AS7-D', chassis: 'Atlas', variant: 'AS7-D' },\n        { id: '2', name: 'Locust LCT-1V', chassis: 'Locust', variant: 'LCT-1V' },\n      ];\n      mockGetIndex.mockResolvedValue(mockIndex);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {},\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockIndex);\n      expect(data.count).toBe(2);\n    });\n  });\n\n  describe('GET with search', () => {\n    it('should filter by name', async () => {\n      const mockIndex = [\n        { id: '1', name: 'Atlas AS7-D', chassis: 'Atlas', variant: 'AS7-D' },\n        { id: '2', name: 'Locust LCT-1V', chassis: 'Locust', variant: 'LCT-1V' },\n        { id: '3', name: 'Marauder MAD-3R', chassis: 'Marauder', variant: 'MAD-3R' },\n      ];\n      mockGetIndex.mockResolvedValue(mockIndex);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'atlas' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.count).toBe(1);\n      expect(data.data[0].chassis).toBe('Atlas');\n    });\n\n    it('should be case-insensitive', async () => {\n      const mockIndex = [\n        { id: '1', name: 'Atlas AS7-D', chassis: 'Atlas', variant: 'AS7-D' },\n      ];\n      mockGetIndex.mockResolvedValue(mockIndex);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'ATLAS' },\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data.count).toBe(1);\n    });\n\n    it('should search by chassis', async () => {\n      const mockIndex = [\n        { id: '1', name: 'Atlas AS7-D', chassis: 'Atlas', variant: 'AS7-D' },\n        { id: '2', name: 'Atlas AS7-K', chassis: 'Atlas', variant: 'AS7-K' },\n        { id: '3', name: 'Marauder MAD-3R', chassis: 'Marauder', variant: 'MAD-3R' },\n      ];\n      mockGetIndex.mockResolvedValue(mockIndex);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'atlas' },\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data.count).toBe(2);\n    });\n\n    it('should search by variant', async () => {\n      const mockIndex = [\n        { id: '1', name: 'Atlas AS7-D', chassis: 'Atlas', variant: 'AS7-D' },\n        { id: '2', name: 'Marauder MAD-3R', chassis: 'Marauder', variant: 'MAD-3R' },\n      ];\n      mockGetIndex.mockResolvedValue(mockIndex);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'MAD' },\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data.count).toBe(1);\n      expect(data.data[0].variant).toBe('MAD-3R');\n    });\n\n    it('should return empty array when no matches', async () => {\n      const mockIndex = [\n        { id: '1', name: 'Atlas AS7-D', chassis: 'Atlas', variant: 'AS7-D' },\n      ];\n      mockGetIndex.mockResolvedValue(mockIndex);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'nonexistent' },\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data.count).toBe(0);\n      expect(data.data).toHaveLength(0);\n    });\n  });\n\n  describe('Error handling', () => {\n    it('should return 500 on service error', async () => {\n      mockGetIndex.mockRejectedValue(new Error('Service unavailable'));\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {},\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(500);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Service unavailable');\n    });\n\n    it('should handle non-Error exceptions', async () => {\n      mockGetIndex.mockRejectedValue('Unknown error');\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {},\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(500);\n      const data = JSON.parse(res._getData());\n      expect(data.error).toBe('Internal server error');\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\custom-variants.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":21,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":21,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":22,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":22,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .deprecated on an `any` value.","line":23,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":23,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":24,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":24,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":25,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":25,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":36,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":36,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .deprecated on an `any` value.","line":37,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":37,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":69,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":69,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":70,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":70,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":71,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":71,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":81,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":81,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":82,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":82,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":83,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":83,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":84,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":84,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":85,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":85,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":86,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":86,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":87,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":87,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":97,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":97,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":98,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":98,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":99,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":99,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":100,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":100,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .newApi on an `any` value.","line":101,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":101,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for /api/custom-variants endpoint\r\n * \r\n * NOTE: This endpoint is DEPRECATED and returns 410 (Gone) for all requests.\r\n * New code should use /api/units/custom/* endpoints instead.\r\n */\r\nimport { createMocks } from 'node-mocks-http';\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport handler from '@/pages/api/custom-variants';\r\n\r\ndescribe('/api/custom-variants (DEPRECATED)', () => {\r\n  describe('Deprecation Response', () => {\r\n    it('should return 410 Gone for GET requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.deprecated).toBe(true);\r\n      expect(data.message).toContain('deprecated');\r\n      expect(data.message).toContain('/api/units/custom');\r\n    });\r\n\r\n    it('should return 410 Gone for POST requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.deprecated).toBe(true);\r\n    });\r\n\r\n    it('should return 410 Gone for PUT requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PUT',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n    });\r\n\r\n    it('should return 410 Gone for DELETE requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'DELETE',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n    });\r\n  });\r\n\r\n  describe('New API Information', () => {\r\n    it('should provide new API base URL', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.newApi).toBeDefined();\r\n      expect(data.newApi.baseUrl).toBe('/api/units/custom');\r\n    });\r\n\r\n    it('should provide list of new endpoints', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.newApi.endpoints).toBeDefined();\r\n      expect(data.newApi.endpoints.list).toBe('GET /api/units/custom');\r\n      expect(data.newApi.endpoints.create).toBe('POST /api/units/custom');\r\n      expect(data.newApi.endpoints.get).toBe('GET /api/units/custom/[id]');\r\n      expect(data.newApi.endpoints.update).toBe('PUT /api/units/custom/[id]');\r\n      expect(data.newApi.endpoints.delete).toBe('DELETE /api/units/custom/[id]');\r\n    });\r\n\r\n    it('should provide version and export endpoints', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.newApi.endpoints.versions).toBe('GET /api/units/custom/[id]/versions');\r\n      expect(data.newApi.endpoints.revert).toBe('POST /api/units/custom/[id]/revert/[version]');\r\n      expect(data.newApi.endpoints.export).toBe('GET /api/units/custom/[id]/export');\r\n      expect(data.newApi.endpoints.import).toBe('POST /api/units/import');\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\custom-variants\\variantId.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":22,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":22,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":23,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":23,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .deprecated on an `any` value.","line":24,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":24,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":25,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":25,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":26,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":26,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":38,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":38,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .deprecated on an `any` value.","line":39,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":39,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":73,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":73,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .deprecated on an `any` value.","line":74,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":74,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":86,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":86,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .deprecated on an `any` value.","line":87,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":87,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":101,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":101,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .redirect on an `any` value.","line":102,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":102,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":113,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":113,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .redirect on an `any` value.","line":114,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":114,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":127,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":127,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .redirect on an `any` value.","line":128,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":128,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for /api/custom-variants/[variantId] endpoint\r\n * \r\n * NOTE: This endpoint is DEPRECATED and returns 410 (Gone) for all requests.\r\n * New code should use /api/units/custom/[id] endpoints instead.\r\n */\r\nimport { createMocks } from 'node-mocks-http';\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport handler from '@/pages/api/custom-variants/[variantId]';\r\n\r\ndescribe('/api/custom-variants/[variantId] (DEPRECATED)', () => {\r\n  describe('Deprecation Response', () => {\r\n    it('should return 410 Gone for GET requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { variantId: 'test-variant-123' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.deprecated).toBe(true);\r\n      expect(data.message).toContain('deprecated');\r\n      expect(data.message).toContain('/api/units/custom');\r\n    });\r\n\r\n    it('should return 410 Gone for POST requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        query: { variantId: 'test-variant-123' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.deprecated).toBe(true);\r\n    });\r\n\r\n    it('should return 410 Gone for PUT requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PUT',\r\n        query: { variantId: 'test-variant-123' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n    });\r\n\r\n    it('should return 410 Gone for DELETE requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'DELETE',\r\n        query: { variantId: 'test-variant-123' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n    });\r\n\r\n    it('should return 410 even without variantId', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: {},\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.deprecated).toBe(true);\r\n    });\r\n\r\n    it('should return 410 for array variantId', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { variantId: ['id1', 'id2'] },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.deprecated).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Redirect Information', () => {\r\n    it('should provide redirect URL with variantId', async () => {\r\n      const variantId = 'atlas-custom-1';\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { variantId },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.redirect).toBe(`/api/units/custom/${variantId}`);\r\n    });\r\n\r\n    it('should handle empty variantId in redirect', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { variantId: '' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.redirect).toBe('/api/units/custom/');\r\n    });\r\n\r\n    it('should handle special characters in variantId', async () => {\r\n      const variantId = 'test-variant_123';\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { variantId },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(410);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.redirect).toBe(`/api/units/custom/${variantId}`);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\equipment.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":37,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":37,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":38,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":38,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":39,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":39,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":80,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":80,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":81,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":81,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":82,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":82,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":96,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":96,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":97,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":97,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":98,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":98,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":118,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":118,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":119,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":119,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":120,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":120,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":121,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":121,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":345,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":345,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":346,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":346,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":347,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":347,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":363,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":363,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":364,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":364,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":365,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":365,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/equipment endpoint\n */\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/equipment';\nimport { equipmentLookupService } from '@/services/equipment/EquipmentLookupService';\nimport { TechBase } from '@/types/enums/TechBase';\nimport { RulesLevel } from '@/types/enums/RulesLevel';\nimport { EquipmentCategory } from '@/types/equipment';\n\n// Mock the equipment lookup service\njest.mock('@/services/equipment/EquipmentLookupService', () => ({\n  equipmentLookupService: {\n    getById: jest.fn(),\n    query: jest.fn(),\n  },\n}));\n\nconst mockGetById = equipmentLookupService.getById as jest.Mock;\nconst mockQuery = equipmentLookupService.query as jest.Mock;\n\ndescribe('/api/equipment', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('GET method validation', () => {\n    it('should reject non-GET requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'POST',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Method not allowed');\n    });\n\n    it('should reject PUT requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'PUT',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n    });\n\n    it('should reject DELETE requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'DELETE',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n    });\n  });\n\n  describe('GET by ID', () => {\n    it('should return equipment when found by ID', async () => {\n      const mockEquipment = {\n        id: 'medium-laser',\n        name: 'Medium Laser',\n        category: EquipmentCategory.ENERGY_WEAPON,\n      };\n      mockGetById.mockReturnValue(mockEquipment);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { id: 'medium-laser' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockEquipment);\n    });\n\n    it('should return 404 when equipment not found', async () => {\n      mockGetById.mockReturnValue(null);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { id: 'non-existent' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(404);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Equipment not found');\n    });\n  });\n\n  describe('GET with query parameters', () => {\n    it('should query equipment without filters', async () => {\n      const mockEquipment = [\n        { id: 'medium-laser', name: 'Medium Laser' },\n        { id: 'ppc', name: 'PPC' },\n      ];\n      mockQuery.mockReturnValue(mockEquipment);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {},\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockEquipment);\n      expect(data.count).toBe(2);\n    });\n\n    it('should filter by category', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { category: EquipmentCategory.ENERGY_WEAPON },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith(\n        expect.objectContaining({\n          category: EquipmentCategory.ENERGY_WEAPON,\n        })\n      );\n    });\n\n    it('should filter by tech base', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { techBase: TechBase.CLAN },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith(\n        expect.objectContaining({\n          techBase: TechBase.CLAN,\n        })\n      );\n    });\n\n    it('should filter by rules level', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { rulesLevel: RulesLevel.STANDARD },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith(\n        expect.objectContaining({\n          rulesLevel: RulesLevel.STANDARD,\n        })\n      );\n    });\n\n    it('should filter by year', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { year: '3025' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith(\n        expect.objectContaining({\n          year: 3025,\n        })\n      );\n    });\n\n    it('should filter by search term', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'laser' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith(\n        expect.objectContaining({\n          nameQuery: 'laser',\n        })\n      );\n    });\n\n    it('should filter by maxWeight', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { maxWeight: '5.5' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith(\n        expect.objectContaining({\n          maxWeight: 5.5,\n        })\n      );\n    });\n\n    it('should filter by maxSlots', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { maxSlots: '3' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith(\n        expect.objectContaining({\n          maxSlots: 3,\n        })\n      );\n    });\n\n    it('should combine multiple filters', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {\n          category: EquipmentCategory.BALLISTIC_WEAPON,\n          techBase: TechBase.INNER_SPHERE,\n          year: '3050',\n        },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith({\n        category: EquipmentCategory.BALLISTIC_WEAPON,\n        techBase: TechBase.INNER_SPHERE,\n        year: 3050,\n      });\n    });\n\n    it('should ignore invalid category values', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { category: 'INVALID_CATEGORY' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith({});\n    });\n\n    it('should ignore invalid techBase values', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { techBase: 'INVALID_TECH' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith({});\n    });\n\n    it('should ignore invalid rulesLevel values', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { rulesLevel: 'INVALID_LEVEL' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith({});\n    });\n\n    it('should handle invalid year values', async () => {\n      mockQuery.mockReturnValue([]);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { year: 'not-a-number' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      expect(mockQuery).toHaveBeenCalledWith({\n        year: undefined,\n      });\n    });\n  });\n\n  describe('Error handling', () => {\n    it('should return 500 on service error', async () => {\n      mockQuery.mockImplementation(() => {\n        throw new Error('Database connection failed');\n      });\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {},\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(500);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Database connection failed');\n    });\n\n    it('should handle non-Error exceptions', async () => {\n      mockQuery.mockImplementation(() => {\n        throw 'Unknown error';\n      });\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {},\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(500);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Internal server error');\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\equipment\\catalog.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":36,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":36,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":37,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":37,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":38,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":38,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":69,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":69,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":70,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":70,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":71,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":71,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":72,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":72,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":93,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":93,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":94,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":94,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":95,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":95,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":96,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":96,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":118,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":118,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":119,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":119,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":120,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":120,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":121,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":121,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":144,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":144,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":145,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":145,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":146,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":146,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":147,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":147,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":151,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":151,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":169,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":169,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":170,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":170,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":171,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":171,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":188,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":188,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":189,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":189,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":190,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":190,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":209,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":209,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":210,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":210,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":229,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":229,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":230,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":230,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":231,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":231,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":249,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":249,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":250,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":250,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":251,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":251,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":267,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":267,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":268,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":268,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":269,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":269,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":37,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/equipment/catalog endpoint\n */\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/equipment/catalog';\nimport { equipmentLookupService } from '@/services/equipment/EquipmentLookupService';\n\n// Mock the equipment lookup service\njest.mock('@/services/equipment/EquipmentLookupService', () => ({\n  equipmentLookupService: {\n    getAllEquipment: jest.fn(),\n    getAllWeapons: jest.fn(),\n    getAllAmmunition: jest.fn(),\n  },\n}));\n\nconst mockGetAllEquipment = equipmentLookupService.getAllEquipment as jest.Mock;\nconst mockGetAllWeapons = equipmentLookupService.getAllWeapons as jest.Mock;\nconst mockGetAllAmmunition = equipmentLookupService.getAllAmmunition as jest.Mock;\n\ndescribe('/api/equipment/catalog', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('GET method validation', () => {\n    it('should reject non-GET requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'POST',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Method not allowed');\n    });\n\n    it('should reject PUT requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'PUT',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n    });\n  });\n\n  describe('GET all equipment', () => {\n    it('should return all equipment when no type specified', async () => {\n      const mockEquipment = [\n        { id: 'medium-laser', name: 'Medium Laser', category: 'weapon' },\n        { id: 'srm-ammo', name: 'SRM Ammo', category: 'ammunition' },\n        { id: 'heat-sink', name: 'Heat Sink', category: 'equipment' },\n      ];\n      mockGetAllEquipment.mockReturnValue(mockEquipment);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {},\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockEquipment);\n      expect(data.count).toBe(3);\n      expect(mockGetAllEquipment).toHaveBeenCalled();\n    });\n  });\n\n  describe('GET weapons only', () => {\n    it('should return only weapons when type=weapons', async () => {\n      const mockWeapons = [\n        { id: 'medium-laser', name: 'Medium Laser' },\n        { id: 'ppc', name: 'PPC' },\n      ];\n      mockGetAllWeapons.mockReturnValue(mockWeapons);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { type: 'weapons' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockWeapons);\n      expect(data.count).toBe(2);\n      expect(mockGetAllWeapons).toHaveBeenCalled();\n      expect(mockGetAllEquipment).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('GET ammunition only', () => {\n    it('should return only ammunition when type=ammunition', async () => {\n      const mockAmmunition = [\n        { id: 'srm-ammo', name: 'SRM Ammo' },\n        { id: 'lrm-ammo', name: 'LRM Ammo' },\n      ];\n      mockGetAllAmmunition.mockReturnValue(mockAmmunition);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { type: 'ammunition' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(true);\n      expect(data.data).toEqual(mockAmmunition);\n      expect(data.count).toBe(2);\n      expect(mockGetAllAmmunition).toHaveBeenCalled();\n      expect(mockGetAllEquipment).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Search filtering', () => {\n    it('should filter by search term', async () => {\n      const mockEquipment = [\n        { id: 'medium-laser', name: 'Medium Laser' },\n        { id: 'large-laser', name: 'Large Laser' },\n        { id: 'ppc', name: 'PPC' },\n      ];\n      mockGetAllEquipment.mockReturnValue(mockEquipment);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'laser' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(true);\n      expect(data.data).toHaveLength(2);\n      expect(data.data).toEqual([\n        { id: 'medium-laser', name: 'Medium Laser' },\n        { id: 'large-laser', name: 'Large Laser' },\n      ]);\n      expect(data.count).toBe(2);\n    });\n\n    it('should be case-insensitive in search', async () => {\n      const mockEquipment = [\n        { id: 'medium-laser', name: 'Medium Laser' },\n        { id: 'ppc', name: 'PPC' },\n      ];\n      mockGetAllEquipment.mockReturnValue(mockEquipment);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'LASER' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.data).toHaveLength(1);\n      expect(data.data[0].name).toBe('Medium Laser');\n    });\n\n    it('should return empty array when no matches found', async () => {\n      const mockEquipment = [\n        { id: 'medium-laser', name: 'Medium Laser' },\n      ];\n      mockGetAllEquipment.mockReturnValue(mockEquipment);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'gauss' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.data).toHaveLength(0);\n      expect(data.count).toBe(0);\n    });\n\n    it('should combine type and search filters', async () => {\n      const mockWeapons = [\n        { id: 'medium-laser', name: 'Medium Laser' },\n        { id: 'large-laser', name: 'Large Laser' },\n        { id: 'ppc', name: 'PPC' },\n      ];\n      mockGetAllWeapons.mockReturnValue(mockWeapons);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { type: 'weapons', search: 'laser' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.data).toHaveLength(2);\n      expect(mockGetAllWeapons).toHaveBeenCalled();\n    });\n\n    it('should handle items without name property', async () => {\n      const mockEquipment = [\n        { id: 'medium-laser', name: 'Medium Laser' },\n        { id: 'no-name' }, // No name property\n      ];\n      mockGetAllEquipment.mockReturnValue(mockEquipment);\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: { search: 'laser' },\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.data).toHaveLength(1);\n      expect(data.data[0].id).toBe('medium-laser');\n    });\n  });\n\n  describe('Error handling', () => {\n    it('should return 500 on service error', async () => {\n      mockGetAllEquipment.mockImplementation(() => {\n        throw new Error('Service unavailable');\n      });\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {},\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(500);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Service unavailable');\n    });\n\n    it('should handle non-Error exceptions', async () => {\n      mockGetAllEquipment.mockImplementation(() => {\n        throw 'Unknown error';\n      });\n\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n        query: {},\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(500);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toBe('Internal server error');\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\equipment\\filters.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":21,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":21,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":22,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":22,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":23,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":23,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":46,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":46,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":47,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":47,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":48,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":48,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":49,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":49,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":50,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":50,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":51,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":51,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":61,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":61,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":62,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":62,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":62,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":62,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":66,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":66,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":69,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":69,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .forEach on an `any` value.","line":69,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":69,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":77,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":77,"endColumn":79},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":77,"column":30,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":77,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .map on an `any` value.","line":77,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":77,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":90,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":90,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":91,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":91,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":91,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":91,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":95,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":95,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":98,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":98,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .forEach on an `any` value.","line":98,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":98,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":104,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":104,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":104,"column":30,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":104,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .map on an `any` value.","line":104,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":104,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":117,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":117,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":118,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":118,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":118,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":118,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":122,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":122,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":125,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":125,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .forEach on an `any` value.","line":125,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":125,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":131,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":131,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":131,"column":32,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":131,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .map on an `any` value.","line":131,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":131,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":144,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":144,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":145,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":145,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":145,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":145,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":149,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":151,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":149,"column":27,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":149,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .find on an `any` value.","line":149,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":149,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .label on an `any` value.","line":153,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":153,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":156,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":158,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":156,"column":20,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":156,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .find on an `any` value.","line":156,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":156,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .label on an `any` value.","line":160,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":160,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":47,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/equipment/filters endpoint\n */\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/equipment/filters';\nimport { TechBase } from '@/types/enums/TechBase';\nimport { RulesLevel } from '@/types/enums/RulesLevel';\nimport { EquipmentCategory } from '@/types/equipment';\n\ndescribe('/api/equipment/filters', () => {\n  describe('GET method validation', () => {\n    it('should reject non-GET requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'POST',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(false);\n      expect(data.error).toContain('Method not allowed');\n    });\n\n    it('should reject PUT requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'PUT',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n    });\n  });\n\n  describe('GET filter options', () => {\n    it('should return all filter options', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(data.success).toBe(true);\n      expect(data.data).toBeDefined();\n      expect(data.data.categories).toBeDefined();\n      expect(data.data.techBases).toBeDefined();\n      expect(data.data.rulesLevels).toBeDefined();\n    });\n\n    it('should include all equipment categories', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      const categories = data.data.categories;\n\n      // Verify structure\n      expect(categories).toBeInstanceOf(Array);\n      expect(categories.length).toBeGreaterThan(0);\n\n      // Each category should have value and label\n      categories.forEach((cat: { value: string; label: string }) => {\n        expect(cat).toHaveProperty('value');\n        expect(cat).toHaveProperty('label');\n        expect(typeof cat.value).toBe('string');\n        expect(typeof cat.label).toBe('string');\n      });\n\n      // Verify all enum values are included\n      const categoryValues = categories.map((c: { value: string }) => c.value);\n      Object.values(EquipmentCategory).forEach((category) => {\n        expect(categoryValues).toContain(category);\n      });\n    });\n\n    it('should include all tech bases', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      const techBases = data.data.techBases;\n\n      // Verify structure\n      expect(techBases).toBeInstanceOf(Array);\n      expect(techBases.length).toBeGreaterThan(0);\n\n      // Each tech base should have value and label\n      techBases.forEach((tb: { value: string; label: string }) => {\n        expect(tb).toHaveProperty('value');\n        expect(tb).toHaveProperty('label');\n      });\n\n      // Verify all enum values are included\n      const techBaseValues = techBases.map((t: { value: string }) => t.value);\n      Object.values(TechBase).forEach((techBase) => {\n        expect(techBaseValues).toContain(techBase);\n      });\n    });\n\n    it('should include all rules levels', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      const rulesLevels = data.data.rulesLevels;\n\n      // Verify structure\n      expect(rulesLevels).toBeInstanceOf(Array);\n      expect(rulesLevels.length).toBeGreaterThan(0);\n\n      // Each rules level should have value and label\n      rulesLevels.forEach((rl: { value: string; label: string }) => {\n        expect(rl).toHaveProperty('value');\n        expect(rl).toHaveProperty('label');\n      });\n\n      // Verify all enum values are included\n      const rulesLevelValues = rulesLevels.map((r: { value: string }) => r.value);\n      Object.values(RulesLevel).forEach((rulesLevel) => {\n        expect(rulesLevelValues).toContain(rulesLevel);\n      });\n    });\n\n    it('should format labels properly', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      const techBases = data.data.techBases;\n\n      // Find INNER_SPHERE and check label formatting\n      // Note: TechBase.INNER_SPHERE = 'Inner Sphere', formatLabel converts to 'Inner sphere'\n      const innerSphere = techBases.find(\n        (t: { value: string }) => t.value === TechBase.INNER_SPHERE\n      );\n      expect(innerSphere).toBeDefined();\n      expect(innerSphere.label).toBe('Inner sphere');\n\n      // Find CLAN and check label formatting\n      const clan = techBases.find(\n        (t: { value: string }) => t.value === TechBase.CLAN\n      );\n      expect(clan).toBeDefined();\n      expect(clan.label).toBe('Clan');\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\meta\\categories.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":18,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":18,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":19,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":19,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":42,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":42,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":53,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":53,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":64,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":64,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":75,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":75,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":86,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":86,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":97,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":97,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":111,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":111,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":130,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":130,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/meta/categories endpoint\n */\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/meta/categories';\n\ndescribe('/api/meta/categories', () => {\n  describe('GET method validation', () => {\n    it('should reject non-GET requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'POST',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n      const data = JSON.parse(res._getData());\n      expect(data.message).toBe('Method not allowed');\n    });\n\n    it('should reject PUT requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'PUT',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n    });\n  });\n\n  describe('GET unit categories', () => {\n    it('should return an array of categories', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(Array.isArray(data)).toBe(true);\n    });\n\n    it('should include meks category', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data).toContain('meks');\n    });\n\n    it('should include vehicles category', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data).toContain('vehicles');\n    });\n\n    it('should include infantry category', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data).toContain('infantry');\n    });\n\n    it('should include battlearmor category', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data).toContain('battlearmor');\n    });\n\n    it('should include aerospace categories', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data).toContain('fighters');\n      expect(data).toContain('dropships');\n      expect(data).toContain('warship');\n      expect(data).toContain('jumpships');\n    });\n\n    it('should include all expected categories', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      const expectedCategories = [\n        'meks',\n        'vehicles',\n        'infantry',\n        'battlearmor',\n        'ge',\n        'fighters',\n        'dropships',\n        'warship',\n        'protomeks',\n        'convfighter',\n        'smallcraft',\n        'spacestation',\n        'jumpships',\n        'handheld',\n      ];\n\n      expect(data).toEqual(expect.arrayContaining(expectedCategories));\n      expect(data.length).toBe(expectedCategories.length);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\meta\\equipment_categories.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":19,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":19,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":20,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":20,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":43,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":43,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":54,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":54,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":67,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":67,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":68,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":68,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/meta/equipment_categories endpoint\n */\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/meta/equipment_categories';\nimport { EquipmentCategory } from '@/types/equipment';\n\ndescribe('/api/meta/equipment_categories', () => {\n  describe('GET method validation', () => {\n    it('should reject non-GET requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'POST',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n      const data = JSON.parse(res._getData());\n      expect(data.message).toBe('Method not allowed');\n    });\n\n    it('should reject PUT requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'PUT',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n    });\n  });\n\n  describe('GET equipment categories', () => {\n    it('should return an array of categories', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(Array.isArray(data)).toBe(true);\n    });\n\n    it('should include all EquipmentCategory enum values', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      Object.values(EquipmentCategory).forEach((category) => {\n        expect(data).toContain(category);\n      });\n    });\n\n    it('should have correct number of categories', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data.length).toBe(Object.values(EquipmentCategory).length);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\meta\\equipment_eras.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":40,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":40,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":42,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":42,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/meta/equipment_eras endpoint\n */\n\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/meta/equipment_eras';\nimport { ALL_ERAS } from '@/types/enums/Era';\n\ndescribe('/api/meta/equipment_eras', () => {\n  it('should return 405 for non-GET requests', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'POST',\n    });\n\n    await handler(req, res);\n\n    expect(res._getStatusCode()).toBe(405);\n    expect(res._getJSONData()).toEqual({ message: 'Method not allowed' });\n  });\n\n  it('should return all eras for GET requests', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'GET',\n    });\n\n    await handler(req, res);\n\n    expect(res._getStatusCode()).toBe(200);\n    expect(res._getJSONData()).toEqual(ALL_ERAS);\n  });\n\n  it('should return an array of era values', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'GET',\n    });\n\n    await handler(req, res);\n\n    const data = res._getJSONData();\n    expect(Array.isArray(data)).toBe(true);\n    expect(data.length).toBeGreaterThan(0);\n  });\n\n  it('should reject PUT requests', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'PUT',\n    });\n\n    await handler(req, res);\n\n    expect(res._getStatusCode()).toBe(405);\n  });\n\n  it('should reject DELETE requests', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'DELETE',\n    });\n\n    await handler(req, res);\n\n    expect(res._getStatusCode()).toBe(405);\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\meta\\equipment_tech_bases.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":40,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":40,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":42,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":42,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/meta/equipment_tech_bases endpoint\n */\n\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/meta/equipment_tech_bases';\nimport { ALL_TECH_BASES } from '@/types/enums/TechBase';\n\ndescribe('/api/meta/equipment_tech_bases', () => {\n  it('should return 405 for non-GET requests', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'POST',\n    });\n\n    await handler(req, res);\n\n    expect(res._getStatusCode()).toBe(405);\n    expect(res._getJSONData()).toEqual({ message: 'Method not allowed' });\n  });\n\n  it('should return all tech bases for GET requests', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'GET',\n    });\n\n    await handler(req, res);\n\n    expect(res._getStatusCode()).toBe(200);\n    expect(res._getJSONData()).toEqual(ALL_TECH_BASES);\n  });\n\n  it('should return an array of tech base values', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'GET',\n    });\n\n    await handler(req, res);\n\n    const data = res._getJSONData();\n    expect(Array.isArray(data)).toBe(true);\n    expect(data.length).toBeGreaterThan(0);\n  });\n\n  it('should reject PUT requests', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'PUT',\n    });\n\n    await handler(req, res);\n\n    expect(res._getStatusCode()).toBe(405);\n  });\n\n  it('should reject DELETE requests', async () => {\n    const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n      method: 'DELETE',\n    });\n\n    await handler(req, res);\n\n    expect(res._getStatusCode()).toBe(405);\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\meta\\unit_eras.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":19,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":19,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":20,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":20,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":43,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":43,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":54,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":54,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":65,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":65,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":78,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":78,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":79,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":79,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/meta/unit_eras endpoint\n */\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/meta/unit_eras';\nimport { ALL_ERAS, Era } from '@/types/enums/Era';\n\ndescribe('/api/meta/unit_eras', () => {\n  describe('GET method validation', () => {\n    it('should reject non-GET requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'POST',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n      const data = JSON.parse(res._getData());\n      expect(data.message).toBe('Method not allowed');\n    });\n\n    it('should reject PUT requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'PUT',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n    });\n  });\n\n  describe('GET unit eras', () => {\n    it('should return an array of eras', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(Array.isArray(data)).toBe(true);\n    });\n\n    it('should return ALL_ERAS from the enum', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data).toEqual(ALL_ERAS);\n    });\n\n    it('should include all Era enum values', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      Object.values(Era).forEach((era) => {\n        expect(data).toContain(era);\n      });\n    });\n\n    it('should have correct number of eras', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data.length).toBe(Object.values(Era).length);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\meta\\unit_tech_bases.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":19,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":19,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":20,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":20,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":43,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":43,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":54,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":54,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":65,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":65,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":76,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":76,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":88,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":88,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":91,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":91,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":101,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":101,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":102,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":102,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for /api/meta/unit_tech_bases endpoint\r\n */\r\nimport { createMocks } from 'node-mocks-http';\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport handler from '@/pages/api/meta/unit_tech_bases';\r\nimport { ALL_TECH_BASES, TechBase } from '@/types/enums/TechBase';\r\n\r\ndescribe('/api/meta/unit_tech_bases', () => {\r\n  describe('GET method validation', () => {\r\n    it('should reject non-GET requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(405);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.message).toBe('Method not allowed');\r\n    });\r\n\r\n    it('should reject PUT requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PUT',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(405);\r\n    });\r\n  });\r\n\r\n  describe('GET unit tech bases', () => {\r\n    it('should return an array of tech bases', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      const data = JSON.parse(res._getData());\r\n      expect(Array.isArray(data)).toBe(true);\r\n    });\r\n\r\n    it('should return ALL_TECH_BASES from the enum', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data).toEqual(ALL_TECH_BASES);\r\n    });\r\n\r\n    it('should include INNER_SPHERE tech base', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data).toContain(TechBase.INNER_SPHERE);\r\n    });\r\n\r\n    it('should include CLAN tech base', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data).toContain(TechBase.CLAN);\r\n    });\r\n\r\n    it('should only include binary tech bases (per spec VAL-ENUM-001)', async () => {\r\n      // Per spec: Valid TechBase values are INNER_SPHERE and CLAN only\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data).toContain(TechBase.INNER_SPHERE);\r\n      expect(data).toContain(TechBase.CLAN);\r\n      expect(data.length).toBe(2); // Only IS and Clan\r\n    });\r\n\r\n    it('should have correct number of tech bases', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.length).toBe(Object.values(TechBase).length); // Should be 2\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\meta\\unit_weight_classes.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":19,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":19,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":20,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":20,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":43,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":43,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":54,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":54,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":65,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":65,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":79,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":79,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":80,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":80,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for /api/meta/unit_weight_classes endpoint\n */\nimport { createMocks } from 'node-mocks-http';\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport handler from '@/pages/api/meta/unit_weight_classes';\nimport { STANDARD_WEIGHT_CLASSES, WeightClass } from '@/types/enums/WeightClass';\n\ndescribe('/api/meta/unit_weight_classes', () => {\n  describe('GET method validation', () => {\n    it('should reject non-GET requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'POST',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n      const data = JSON.parse(res._getData());\n      expect(data.message).toBe('Method not allowed');\n    });\n\n    it('should reject PUT requests', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'PUT',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(405);\n    });\n  });\n\n  describe('GET weight classes', () => {\n    it('should return an array of weight classes', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      expect(res._getStatusCode()).toBe(200);\n      const data = JSON.parse(res._getData());\n      expect(Array.isArray(data)).toBe(true);\n    });\n\n    it('should return STANDARD_WEIGHT_CLASSES', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data).toEqual(STANDARD_WEIGHT_CLASSES);\n    });\n\n    it('should include LIGHT, MEDIUM, HEAVY, ASSAULT', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data).toContain(WeightClass.LIGHT);\n      expect(data).toContain(WeightClass.MEDIUM);\n      expect(data).toContain(WeightClass.HEAVY);\n      expect(data).toContain(WeightClass.ASSAULT);\n    });\n\n    it('should have 4 weight classes', async () => {\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\n        method: 'GET',\n      });\n\n      await handler(req, res);\n\n      const data = JSON.parse(res._getData());\n      expect(data.length).toBe(4);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\units.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":37,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":37,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":38,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":38,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":39,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":39,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":81,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":81,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":82,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":82,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":83,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":83,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":97,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":97,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":98,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":98,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":99,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":99,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":119,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":119,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":120,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":120,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":121,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":121,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":122,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":122,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":342,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":342,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":343,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":343,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":344,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":344,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":358,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":358,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":359,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":359,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":360,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":360,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for /api/units endpoint\r\n */\r\nimport { createMocks } from 'node-mocks-http';\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport handler from '@/pages/api/units';\r\nimport { canonicalUnitService } from '@/services/units/CanonicalUnitService';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { Era } from '@/types/enums/Era';\r\nimport { WeightClass } from '@/types/enums/WeightClass';\r\n\r\n// Mock the canonical unit service\r\njest.mock('@/services/units/CanonicalUnitService', () => ({\r\n  canonicalUnitService: {\r\n    getById: jest.fn(),\r\n    query: jest.fn(),\r\n  },\r\n}));\r\n\r\nconst mockGetById = canonicalUnitService.getById as jest.Mock;\r\nconst mockQuery = canonicalUnitService.query as jest.Mock;\r\n\r\ndescribe('/api/units', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('GET method validation', () => {\r\n    it('should reject non-GET requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(405);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.error).toContain('Method not allowed');\r\n    });\r\n\r\n    it('should reject PUT requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PUT',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(405);\r\n    });\r\n\r\n    it('should reject DELETE requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'DELETE',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(405);\r\n    });\r\n  });\r\n\r\n  describe('GET by ID', () => {\r\n    it('should return unit when found by ID', async () => {\r\n      const mockUnit = {\r\n        id: 'atlas-as7-d',\r\n        name: 'Atlas AS7-D',\r\n        tonnage: 100,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      };\r\n      mockGetById.mockResolvedValue(mockUnit);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { id: 'atlas-as7-d' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(true);\r\n      expect(data.data).toEqual(mockUnit);\r\n    });\r\n\r\n    it('should return 404 when unit not found', async () => {\r\n      mockGetById.mockResolvedValue(null);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { id: 'non-existent' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(404);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.error).toContain('Unit not found');\r\n    });\r\n  });\r\n\r\n  describe('GET with query parameters', () => {\r\n    it('should query units without filters', async () => {\r\n      const mockUnits = [\r\n        { id: 'atlas-as7-d', name: 'Atlas AS7-D' },\r\n        { id: 'locust-lct-1v', name: 'Locust LCT-1V' },\r\n      ];\r\n      mockQuery.mockResolvedValue(mockUnits);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: {},\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(true);\r\n      expect(data.data).toEqual(mockUnits);\r\n      expect(data.count).toBe(2);\r\n    });\r\n\r\n    it('should filter by tech base', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { techBase: TechBase.CLAN },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          techBase: TechBase.CLAN,\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should filter by era', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { era: Era.LATE_SUCCESSION_WARS },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          era: Era.LATE_SUCCESSION_WARS,\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should filter by weight class', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { weightClass: WeightClass.ASSAULT },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          weightClass: WeightClass.ASSAULT,\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should filter by unit type', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { unitType: 'BattleMech' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          unitType: 'BattleMech',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should filter by minTonnage', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { minTonnage: '50' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          minTonnage: 50,\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should filter by maxTonnage', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { maxTonnage: '75' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          maxTonnage: 75,\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should combine multiple filters', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: {\r\n          techBase: TechBase.INNER_SPHERE,\r\n          weightClass: WeightClass.HEAVY,\r\n          minTonnage: '60',\r\n          maxTonnage: '75',\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith({\r\n        techBase: TechBase.INNER_SPHERE,\r\n        weightClass: WeightClass.HEAVY,\r\n        minTonnage: 60,\r\n        maxTonnage: 75,\r\n      });\r\n    });\r\n\r\n    it('should ignore invalid techBase values', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { techBase: 'INVALID_TECH' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith({});\r\n    });\r\n\r\n    it('should ignore invalid era values', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { era: 'INVALID_ERA' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith({});\r\n    });\r\n\r\n    it('should ignore invalid weightClass values', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { weightClass: 'INVALID_CLASS' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith({});\r\n    });\r\n\r\n    it('should ignore invalid unitType values', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { unitType: 'InvalidType' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith({});\r\n    });\r\n\r\n    it('should handle invalid tonnage values', async () => {\r\n      mockQuery.mockResolvedValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { minTonnage: 'not-a-number' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      expect(mockQuery).toHaveBeenCalledWith({\r\n        minTonnage: undefined,\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Error handling', () => {\r\n    it('should return 500 on service error', async () => {\r\n      mockQuery.mockRejectedValue(new Error('Database connection failed'));\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: {},\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.error).toBe('Database connection failed');\r\n    });\r\n\r\n    it('should handle non-Error exceptions', async () => {\r\n      mockQuery.mockRejectedValue('Unknown error');\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: {},\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.error).toBe('Internal server error');\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\units\\custom\\[id].test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1093,1096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1093,1096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1170,1173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1170,1173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":50,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":50,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":51,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":51,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":88,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":88,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":89,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":89,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .chassis on an `any` value.","line":90,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":90,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .parsedData on an `any` value.","line":91,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":91,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":105,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":105,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":106,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":106,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":128,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":128,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":129,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":129,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":160,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":160,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":161,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":161,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .version on an `any` value.","line":162,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":162,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":178,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":178,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":179,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":179,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":218,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":218,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":219,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":219,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":238,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":238,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":239,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":239,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":240,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":240,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":258,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":258,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":259,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":259,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":275,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":275,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":276,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":276,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":290,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":290,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":291,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":291,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":301,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8833,8836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8833,8836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":311,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":311,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":312,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":312,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":31,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for /api/units/custom/[id] endpoint\r\n */\r\nimport { createMocks } from 'node-mocks-http';\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport handler from '@/pages/api/units/custom/[id]';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\n\r\n// Mock dependencies\r\njest.mock('@/services/persistence/SQLiteService');\r\njest.mock('@/services/units/UnitRepository');\r\n\r\nconst mockSQLiteService = getSQLiteService as jest.MockedFunction<typeof getSQLiteService>;\r\nconst mockGetUnitRepository = getUnitRepository as jest.MockedFunction<typeof getUnitRepository>;\r\n\r\ndescribe('/api/units/custom/[id]', () => {\r\n  let mockUnitRepository: {\r\n    getById: jest.Mock;\r\n    update: jest.Mock;\r\n    delete: jest.Mock;\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    \r\n    mockUnitRepository = {\r\n      getById: jest.fn(),\r\n      update: jest.fn(),\r\n      delete: jest.fn(),\r\n    };\r\n    \r\n    mockSQLiteService.mockReturnValue({\r\n      initialize: jest.fn(),\r\n    } as any);\r\n    \r\n    mockGetUnitRepository.mockReturnValue(mockUnitRepository as any);\r\n  });\r\n\r\n  describe('ID validation', () => {\r\n    it('should reject missing ID', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: {},\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Missing unit ID');\r\n    });\r\n\r\n    it('should reject non-string ID', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { id: ['array', 'id'] },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n    });\r\n  });\r\n\r\n  describe('GET /api/units/custom/[id]', () => {\r\n    it('should get unit by ID', async () => {\r\n      const mockUnit = {\r\n        id: 'custom-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        data: JSON.stringify({ id: 'custom-1', chassis: 'Atlas', variant: 'AS7-X', tonnage: 100 }),\r\n        currentVersion: 1,\r\n        createdAt: '2024-01-01',\r\n        updatedAt: '2024-01-02',\r\n      };\r\n\r\n      mockUnitRepository.getById.mockReturnValue(mockUnit);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { id: 'custom-1' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.id).toBe('custom-1');\r\n      expect(data.chassis).toBe('Atlas');\r\n      expect(data.parsedData).toEqual({ id: 'custom-1', chassis: 'Atlas', variant: 'AS7-X', tonnage: 100 });\r\n    });\r\n\r\n    it('should return 404 when unit not found', async () => {\r\n      mockUnitRepository.getById.mockReturnValue(null);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { id: 'non-existent' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(404);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toContain('not found');\r\n    });\r\n\r\n    it('should handle JSON parse errors', async () => {\r\n      const mockUnit = {\r\n        id: 'custom-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        data: 'invalid json',\r\n        currentVersion: 1,\r\n      };\r\n\r\n      mockUnitRepository.getById.mockReturnValue(mockUnit);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { id: 'custom-1' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('PUT /api/units/custom/[id]', () => {\r\n    it('should update unit', async () => {\r\n      const requestBody = {\r\n        data: {\r\n          id: 'custom-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-X',\r\n          tonnage: 100,\r\n        },\r\n        notes: 'Updated variant',\r\n      };\r\n\r\n      mockUnitRepository.update.mockReturnValue({\r\n        success: true,\r\n        id: 'custom-1',\r\n        version: 2,\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PUT',\r\n        query: { id: 'custom-1' },\r\n        body: requestBody,\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(true);\r\n      expect(data.version).toBe(2);\r\n      expect(mockUnitRepository.update).toHaveBeenCalledWith('custom-1', requestBody);\r\n    });\r\n\r\n    it('should reject missing data field', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PUT',\r\n        query: { id: 'custom-1' },\r\n        body: {\r\n          notes: 'Update',\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toContain('Missing required field: data');\r\n    });\r\n\r\n    it('should return 404 for not found errors', async () => {\r\n      mockUnitRepository.update.mockReturnValue({\r\n        success: false,\r\n        error: 'Unit not found',\r\n        errorCode: 'NOT_FOUND',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PUT',\r\n        query: { id: 'non-existent' },\r\n        body: {\r\n          data: {},\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(404);\r\n    });\r\n\r\n    it('should handle update errors', async () => {\r\n      mockUnitRepository.update.mockImplementation(() => {\r\n        throw new Error('Database error');\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PUT',\r\n        query: { id: 'custom-1' },\r\n        body: {\r\n          data: {},\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Database error');\r\n    });\r\n  });\r\n\r\n  describe('DELETE /api/units/custom/[id]', () => {\r\n    it('should delete unit', async () => {\r\n      mockUnitRepository.delete.mockReturnValue({\r\n        success: true,\r\n        id: 'custom-1',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'DELETE',\r\n        query: { id: 'custom-1' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(true);\r\n      expect(data.id).toBe('custom-1');\r\n      expect(mockUnitRepository.delete).toHaveBeenCalledWith('custom-1');\r\n    });\r\n\r\n    it('should handle delete failure', async () => {\r\n      mockUnitRepository.delete.mockReturnValue({\r\n        success: false,\r\n        error: 'Delete failed',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'DELETE',\r\n        query: { id: 'custom-1' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n    });\r\n\r\n    it('should handle delete errors', async () => {\r\n      mockUnitRepository.delete.mockImplementation(() => {\r\n        throw new Error('Database error');\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'DELETE',\r\n        query: { id: 'custom-1' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Database error');\r\n    });\r\n  });\r\n\r\n  describe('Method validation', () => {\r\n    it('should reject unsupported methods', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PATCH',\r\n        query: { id: 'custom-1' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(405);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toContain('Not Allowed');\r\n    });\r\n  });\r\n\r\n  describe('Database initialization', () => {\r\n    it('should handle database initialization errors', async () => {\r\n      mockSQLiteService.mockReturnValue({\r\n        initialize: jest.fn(() => {\r\n          throw new Error('Database init failed');\r\n        }),\r\n      } as any);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n        query: { id: 'custom-1' },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Database init failed');\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\units\\custom\\index.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1022,1025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1022,1025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1099,1102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1099,1102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":47,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":47,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":48,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":48,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":78,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":78,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .units on an `any` value.","line":79,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":79,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":80,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":80,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":93,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":93,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .units on an `any` value.","line":94,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":94,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":95,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":95,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":110,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":110,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":111,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":111,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":143,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":143,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":144,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":144,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":145,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":145,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":161,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":161,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":162,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":162,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":177,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":177,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":178,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":178,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":193,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":193,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":194,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":194,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":216,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":216,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":217,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":217,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":218,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":218,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":238,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":238,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":239,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":239,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7109,7112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7109,7112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":258,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":258,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":259,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":259,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":29,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for /api/units/custom endpoint\r\n */\r\nimport { createMocks } from 'node-mocks-http';\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport handler from '@/pages/api/units/custom';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\n\r\n// Mock dependencies\r\njest.mock('@/services/persistence/SQLiteService');\r\njest.mock('@/services/units/UnitRepository');\r\n\r\nconst mockSQLiteService = getSQLiteService as jest.MockedFunction<typeof getSQLiteService>;\r\nconst mockGetUnitRepository = getUnitRepository as jest.MockedFunction<typeof getUnitRepository>;\r\n\r\ndescribe('/api/units/custom', () => {\r\n  let mockUnitRepository: {\r\n    list: jest.Mock;\r\n    create: jest.Mock;\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    \r\n    mockUnitRepository = {\r\n      list: jest.fn(),\r\n      create: jest.fn(),\r\n    };\r\n    \r\n    mockSQLiteService.mockReturnValue({\r\n      initialize: jest.fn(),\r\n    } as any);\r\n    \r\n    mockGetUnitRepository.mockReturnValue(mockUnitRepository as any);\r\n  });\r\n\r\n  describe('Method validation', () => {\r\n    it('should reject unsupported methods', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'PUT',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(405);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toContain('Not Allowed');\r\n    });\r\n  });\r\n\r\n  describe('GET /api/units/custom', () => {\r\n    it('should list all custom units', async () => {\r\n      const mockUnits = [\r\n        {\r\n          id: 'custom-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-X',\r\n          tonnage: 100,\r\n        },\r\n        {\r\n          id: 'custom-2',\r\n          chassis: 'Marauder',\r\n          variant: 'MAD-3R',\r\n          tonnage: 75,\r\n        },\r\n      ];\r\n\r\n      mockUnitRepository.list.mockReturnValue(mockUnits);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.units).toEqual(mockUnits);\r\n      expect(data.count).toBe(2);\r\n    });\r\n\r\n    it('should return empty array when no units exist', async () => {\r\n      mockUnitRepository.list.mockReturnValue([]);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(200);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.units).toEqual([]);\r\n      expect(data.count).toBe(0);\r\n    });\r\n\r\n    it('should handle list errors', async () => {\r\n      mockUnitRepository.list.mockImplementation(() => {\r\n        throw new Error('Database error');\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Database error');\r\n    });\r\n  });\r\n\r\n  describe('POST /api/units/custom', () => {\r\n    it('should create a new unit', async () => {\r\n      const requestBody = {\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        data: {\r\n          id: 'temp',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-X',\r\n          tonnage: 100,\r\n        },\r\n        notes: 'Custom variant',\r\n      };\r\n\r\n      mockUnitRepository.create.mockReturnValue({\r\n        success: true,\r\n        id: 'custom-1',\r\n        version: 1,\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: requestBody,\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(201);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(true);\r\n      expect(data.id).toBe('custom-1');\r\n      expect(mockUnitRepository.create).toHaveBeenCalledWith(requestBody);\r\n    });\r\n\r\n    it('should reject missing chassis', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          variant: 'AS7-X',\r\n          data: {},\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toContain('Missing required fields');\r\n    });\r\n\r\n    it('should reject missing variant', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          data: {},\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toContain('Missing required fields');\r\n    });\r\n\r\n    it('should reject missing data', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-X',\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toContain('Missing required fields');\r\n    });\r\n\r\n    it('should handle creation failure', async () => {\r\n      mockUnitRepository.create.mockReturnValue({\r\n        success: false,\r\n        error: 'Name conflict',\r\n        errorCode: 'DUPLICATE_NAME',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          data: { chassis: 'Atlas', variant: 'AS7-D' },\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.error).toBe('Name conflict');\r\n    });\r\n\r\n    it('should handle creation errors', async () => {\r\n      mockUnitRepository.create.mockImplementation(() => {\r\n        throw new Error('Database error');\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-X',\r\n          data: {},\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Database error');\r\n    });\r\n  });\r\n\r\n  describe('Database initialization', () => {\r\n    it('should handle database initialization errors', async () => {\r\n      mockSQLiteService.mockReturnValue({\r\n        initialize: jest.fn(() => {\r\n          throw new Error('Database init failed');\r\n        }),\r\n      } as any);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Database init failed');\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\api\\units\\import.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1104,1107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1104,1107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1181,1184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1181,1184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":49,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":49,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":50,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":50,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1878,1881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1878,1881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .body on an `any` value.","line":60,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":60,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":61,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":61,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1915,1918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1915,1918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":66,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":66,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":67,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":67,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":81,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":81,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":82,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":82,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .validationErrors on an `any` value.","line":83,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":83,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":97,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":97,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .validationErrors on an `any` value.","line":98,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":98,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":120,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":120,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":121,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":121,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":192,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":192,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":193,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":193,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":194,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":194,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":218,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":218,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":219,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":219,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":220,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":220,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .suggestedName on an `any` value.","line":221,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":221,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":246,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":246,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":247,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":247,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .unitId on an `any` value.","line":248,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":248,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":277,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":277,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":278,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":278,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":279,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":279,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8467,8470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8467,8470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":302,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":302,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":303,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":303,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":323,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":323,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":324,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":324,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":35,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for /api/units/import endpoint\r\n */\r\nimport { createMocks } from 'node-mocks-http';\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport handler from '@/pages/api/units/import';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\n\r\n// Mock dependencies\r\njest.mock('@/services/persistence/SQLiteService');\r\njest.mock('@/services/units/UnitRepository');\r\n\r\nconst mockSQLiteService = getSQLiteService as jest.MockedFunction<typeof getSQLiteService>;\r\nconst mockGetUnitRepository = getUnitRepository as jest.MockedFunction<typeof getUnitRepository>;\r\n\r\ndescribe('/api/units/import', () => {\r\n  let mockUnitRepository: {\r\n    nameExists: jest.Mock;\r\n    suggestCloneName: jest.Mock;\r\n    create: jest.Mock;\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    \r\n    mockUnitRepository = {\r\n      nameExists: jest.fn(),\r\n      suggestCloneName: jest.fn(),\r\n      create: jest.fn(),\r\n    };\r\n    \r\n    mockSQLiteService.mockReturnValue({\r\n      initialize: jest.fn(),\r\n    } as any);\r\n    \r\n    mockGetUnitRepository.mockReturnValue(mockUnitRepository as any);\r\n  });\r\n\r\n  describe('Method validation', () => {\r\n    it('should reject non-POST requests', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'GET',\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(405);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toContain('Not Allowed');\r\n    });\r\n  });\r\n\r\n  describe('Request validation', () => {\r\n    it('should reject missing request body', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n      });\r\n      // Explicitly set body to null\r\n      delete (req as any).body;\r\n      req.body = null as any;\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Missing request body');\r\n    });\r\n\r\n    it('should reject missing chassis', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          variant: 'AS7-D',\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.validationErrors).toContain('Missing or invalid field: chassis');\r\n    });\r\n\r\n    it('should reject missing variant and model', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.validationErrors).toContain('Missing field: variant or model');\r\n    });\r\n\r\n    it('should accept variant field', async () => {\r\n      mockUnitRepository.nameExists.mockReturnValue(false);\r\n      mockUnitRepository.create.mockReturnValue({\r\n        success: true,\r\n        id: 'custom-1',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(201);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(true);\r\n    });\r\n\r\n    it('should accept model field', async () => {\r\n      mockUnitRepository.nameExists.mockReturnValue(false);\r\n      mockUnitRepository.create.mockReturnValue({\r\n        success: true,\r\n        id: 'custom-1',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          model: 'AS7-D',\r\n          tonnage: 100,\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(201);\r\n    });\r\n  });\r\n\r\n  describe('Envelope format', () => {\r\n    it('should handle envelope format with formatVersion', async () => {\r\n      mockUnitRepository.nameExists.mockReturnValue(false);\r\n      mockUnitRepository.create.mockReturnValue({\r\n        success: true,\r\n        id: 'custom-1',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          formatVersion: '1.0.0',\r\n          unit: {\r\n            chassis: 'Atlas',\r\n            variant: 'AS7-D',\r\n            tonnage: 100,\r\n          },\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(201);\r\n      expect(mockUnitRepository.create).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should reject unsupported format version', async () => {\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          formatVersion: '2.0.0',\r\n          unit: {\r\n            chassis: 'Atlas',\r\n            variant: 'AS7-D',\r\n          },\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.error).toContain('Unsupported format version');\r\n    });\r\n  });\r\n\r\n  describe('Name conflict handling', () => {\r\n    it('should reject duplicate names', async () => {\r\n      mockUnitRepository.nameExists.mockReturnValue(true);\r\n      mockUnitRepository.suggestCloneName.mockReturnValue({\r\n        chassis: 'Atlas',\r\n        suggestedVariant: 'AS7-D-Custom-1',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(409);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.error).toContain('already exists');\r\n      expect(data.suggestedName).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('Unit creation', () => {\r\n    it('should create unit successfully', async () => {\r\n      mockUnitRepository.nameExists.mockReturnValue(false);\r\n      mockUnitRepository.create.mockReturnValue({\r\n        success: true,\r\n        id: 'custom-1',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n          techBase: 'Inner Sphere',\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(201);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(true);\r\n      expect(data.unitId).toBe('custom-1');\r\n      expect(mockUnitRepository.create).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          notes: 'Imported from JSON file',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should handle creation failure', async () => {\r\n      mockUnitRepository.nameExists.mockReturnValue(false);\r\n      mockUnitRepository.create.mockReturnValue({\r\n        success: false,\r\n        error: 'Database error',\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(400);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.success).toBe(false);\r\n      expect(data.error).toBe('Database error');\r\n    });\r\n  });\r\n\r\n  describe('Error handling', () => {\r\n    it('should handle database initialization errors', async () => {\r\n      mockSQLiteService.mockReturnValue({\r\n        initialize: jest.fn(() => {\r\n          throw new Error('Database init failed');\r\n        }),\r\n      } as any);\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Database init failed');\r\n    });\r\n\r\n    it('should handle unexpected errors', async () => {\r\n      mockUnitRepository.nameExists.mockImplementation(() => {\r\n        throw new Error('Unexpected error');\r\n      });\r\n\r\n      const { req, res } = createMocks<NextApiRequest, NextApiResponse>({\r\n        method: 'POST',\r\n        body: {\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        },\r\n      });\r\n\r\n      await handler(req, res);\r\n\r\n      expect(res._getStatusCode()).toBe(500);\r\n      const data = JSON.parse(res._getData());\r\n      expect(data.error).toBe('Unexpected error');\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\common\\CategoryNavigation.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\common\\ControlledInput.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used.","line":6,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validationResult' is assigned a value but never used.","line":290,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":290,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for ControlledInput component\n */\nimport '@testing-library/jest-dom';\nimport React from 'react';\nimport { render, screen, fireEvent, waitFor, act } from '@testing-library/react';\nimport { ControlledInput, useControlledInput, ValidationResult } from '@/components/common/ControlledInput';\n\n// Mock timers for debounce testing\njest.useFakeTimers();\n\ndescribe('ControlledInput', () => {\n  const defaultProps = {\n    value: '',\n    onChange: jest.fn(),\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    jest.clearAllTimers();\n  });\n\n  describe('Rendering', () => {\n    it('should render input element', () => {\n      render(<ControlledInput {...defaultProps} />);\n\n      expect(screen.getByRole('textbox')).toBeInTheDocument();\n    });\n\n    it('should display label when provided', () => {\n      render(<ControlledInput {...defaultProps} label=\"Username\" />);\n\n      expect(screen.getByText('Username')).toBeInTheDocument();\n    });\n\n    it('should show required indicator', () => {\n      render(<ControlledInput {...defaultProps} label=\"Username\" required />);\n\n      expect(screen.getByText('*')).toBeInTheDocument();\n    });\n\n    it('should display placeholder', () => {\n      render(<ControlledInput {...defaultProps} placeholder=\"Enter username\" />);\n\n      expect(screen.getByPlaceholderText('Enter username')).toBeInTheDocument();\n    });\n\n    it('should render with initial value', () => {\n      render(<ControlledInput {...defaultProps} value=\"Initial value\" />);\n\n      expect(screen.getByRole('textbox')).toHaveValue('Initial value');\n    });\n  });\n\n  describe('Input types', () => {\n    it('should render text input by default', () => {\n      render(<ControlledInput {...defaultProps} />);\n\n      expect(screen.getByRole('textbox')).toHaveAttribute('type', 'text');\n    });\n\n    it('should render number input when type is number', () => {\n      render(<ControlledInput {...defaultProps} type=\"number\" />);\n\n      expect(screen.getByRole('spinbutton')).toHaveAttribute('type', 'number');\n    });\n\n    it('should render password input', () => {\n      render(<ControlledInput {...defaultProps} type=\"password\" />);\n\n      const input = document.querySelector('input[type=\"password\"]');\n      expect(input).toBeInTheDocument();\n    });\n  });\n\n  describe('Value changes', () => {\n    it('should update local value on change', () => {\n      render(<ControlledInput {...defaultProps} />);\n      const input = screen.getByRole('textbox');\n\n      fireEvent.change(input, { target: { value: 'New value' } });\n\n      expect(input).toHaveValue('New value');\n    });\n\n    it('should debounce onChange callback', () => {\n      const onChange = jest.fn();\n      render(<ControlledInput {...defaultProps} onChange={onChange} debounceMs={300} />);\n      const input = screen.getByRole('textbox');\n\n      fireEvent.change(input, { target: { value: 'Test' } });\n\n      expect(onChange).not.toHaveBeenCalled();\n\n      act(() => {\n        jest.advanceTimersByTime(300);\n      });\n\n      expect(onChange).toHaveBeenCalledWith('Test');\n    });\n\n    it('should sync with external value changes', () => {\n      const { rerender } = render(<ControlledInput {...defaultProps} value=\"Initial\" />);\n\n      expect(screen.getByRole('textbox')).toHaveValue('Initial');\n\n      rerender(<ControlledInput {...defaultProps} value=\"Updated\" />);\n\n      expect(screen.getByRole('textbox')).toHaveValue('Updated');\n    });\n  });\n\n  describe('Validation', () => {\n    const requiredValidation = (value: string): ValidationResult => ({\n      isValid: value.length > 0,\n      error: value.length === 0 ? 'Field is required' : undefined,\n    });\n\n    const warningValidation = (value: string): ValidationResult => ({\n      isValid: true,\n      warning: value.length < 5 ? 'Value is short' : undefined,\n    });\n\n    it('should show validation error after change', () => {\n      render(\n        <ControlledInput \n          {...defaultProps} \n          value=\"test\"\n          validation={requiredValidation}\n        />\n      );\n      const input = screen.getByRole('textbox');\n\n      fireEvent.change(input, { target: { value: '' } });\n\n      expect(screen.getByText('Field is required')).toBeInTheDocument();\n    });\n\n    it('should show warning message', () => {\n      render(\n        <ControlledInput \n          {...defaultProps}\n          validation={warningValidation}\n        />\n      );\n      const input = screen.getByRole('textbox');\n\n      fireEvent.change(input, { target: { value: 'Hi' } });\n\n      expect(screen.getByText('Value is short')).toBeInTheDocument();\n    });\n\n    it('should call onValidationChange when validation changes', () => {\n      const onValidationChange = jest.fn();\n      render(\n        <ControlledInput \n          {...defaultProps}\n          validation={requiredValidation}\n          onValidationChange={onValidationChange}\n        />\n      );\n      const input = screen.getByRole('textbox');\n\n      fireEvent.change(input, { target: { value: 'test' } });\n\n      expect(onValidationChange).toHaveBeenCalled();\n    });\n\n    it('should not call onChange when validation fails', () => {\n      const onChange = jest.fn();\n      render(\n        <ControlledInput \n          {...defaultProps}\n          value=\"valid\"\n          onChange={onChange}\n          validation={requiredValidation}\n        />\n      );\n      const input = screen.getByRole('textbox');\n\n      fireEvent.change(input, { target: { value: '' } });\n\n      act(() => {\n        jest.advanceTimersByTime(300);\n      });\n\n      expect(onChange).not.toHaveBeenCalled();\n    });\n\n    it('should not show validation until dirty', () => {\n      render(\n        <ControlledInput \n          {...defaultProps}\n          value=\"\"\n          validation={requiredValidation}\n        />\n      );\n\n      expect(screen.queryByText('Field is required')).not.toBeInTheDocument();\n    });\n  });\n\n  describe('Disabled state', () => {\n    it('should be disabled when disabled prop is true', () => {\n      render(<ControlledInput {...defaultProps} disabled />);\n\n      expect(screen.getByRole('textbox')).toBeDisabled();\n    });\n\n    it('should have disabled styling', () => {\n      render(<ControlledInput {...defaultProps} disabled />);\n\n      expect(screen.getByRole('textbox')).toHaveClass('cursor-not-allowed');\n    });\n  });\n\n  describe('Focus and blur', () => {\n    it('should call onFocus when focused', () => {\n      const onFocus = jest.fn();\n      render(<ControlledInput {...defaultProps} onFocus={onFocus} />);\n\n      fireEvent.focus(screen.getByRole('textbox'));\n\n      expect(onFocus).toHaveBeenCalled();\n    });\n\n    it('should call onBlur when blurred', () => {\n      const onBlur = jest.fn();\n      render(<ControlledInput {...defaultProps} onBlur={onBlur} />);\n\n      fireEvent.blur(screen.getByRole('textbox'));\n\n      expect(onBlur).toHaveBeenCalled();\n    });\n\n    it('should validate and call onChange on blur', () => {\n      const onChange = jest.fn();\n      render(<ControlledInput {...defaultProps} onChange={onChange} />);\n      const input = screen.getByRole('textbox');\n\n      fireEvent.change(input, { target: { value: 'Test' } });\n      fireEvent.blur(input);\n\n      expect(onChange).toHaveBeenCalledWith('Test');\n    });\n  });\n\n  describe('Keyboard events', () => {\n    it('should call onKeyDown', () => {\n      const onKeyDown = jest.fn();\n      render(<ControlledInput {...defaultProps} onKeyDown={onKeyDown} />);\n\n      fireEvent.keyDown(screen.getByRole('textbox'), { key: 'Enter' });\n\n      expect(onKeyDown).toHaveBeenCalled();\n    });\n\n    it('should call onKeyUp', () => {\n      const onKeyUp = jest.fn();\n      render(<ControlledInput {...defaultProps} onKeyUp={onKeyUp} />);\n\n      fireEvent.keyUp(screen.getByRole('textbox'), { key: 'Enter' });\n\n      expect(onKeyUp).toHaveBeenCalled();\n    });\n  });\n\n  describe('AutoFocus', () => {\n    it('should autofocus when autoFocus is true', () => {\n      render(<ControlledInput {...defaultProps} autoFocus />);\n\n      expect(screen.getByRole('textbox')).toHaveFocus();\n    });\n  });\n});\n\ndescribe('useControlledInput hook', () => {\n  const TestComponent = ({ \n    initialValue = '', \n    validation \n  }: { \n    initialValue?: string; \n    validation?: (value: string) => ValidationResult;\n  }) => {\n    const {\n      value,\n      validationResult,\n      isDirty,\n      handleChange,\n      reset,\n      isValid,\n      error,\n    } = useControlledInput(initialValue, validation);\n\n    return (\n      <div>\n        <input\n          data-testid=\"input\"\n          value={value}\n          onChange={(e) => handleChange(e.target.value)}\n        />\n        <span data-testid=\"is-dirty\">{isDirty.toString()}</span>\n        <span data-testid=\"is-valid\">{isValid.toString()}</span>\n        <span data-testid=\"error\">{error || 'No error'}</span>\n        <button onClick={reset}>Reset</button>\n      </div>\n    );\n  };\n\n  it('should initialize with initial value', () => {\n    render(<TestComponent initialValue=\"Initial\" />);\n\n    expect(screen.getByTestId('input')).toHaveValue('Initial');\n  });\n\n  it('should mark as dirty after change', () => {\n    render(<TestComponent />);\n\n    expect(screen.getByTestId('is-dirty').textContent).toBe('false');\n\n    fireEvent.change(screen.getByTestId('input'), { target: { value: 'Changed' } });\n\n    expect(screen.getByTestId('is-dirty').textContent).toBe('true');\n  });\n\n  it('should validate on change', () => {\n    const validation = (value: string): ValidationResult => ({\n      isValid: value.length >= 3,\n      error: value.length < 3 ? 'Too short' : undefined,\n    });\n\n    render(<TestComponent validation={validation} />);\n\n    fireEvent.change(screen.getByTestId('input'), { target: { value: 'ab' } });\n\n    expect(screen.getByTestId('is-valid').textContent).toBe('false');\n    expect(screen.getByTestId('error').textContent).toBe('Too short');\n  });\n\n  it('should reset to initial state', () => {\n    render(<TestComponent initialValue=\"Initial\" />);\n\n    fireEvent.change(screen.getByTestId('input'), { target: { value: 'Changed' } });\n    expect(screen.getByTestId('input')).toHaveValue('Changed');\n    expect(screen.getByTestId('is-dirty').textContent).toBe('true');\n\n    fireEvent.click(screen.getByRole('button', { name: 'Reset' }));\n\n    expect(screen.getByTestId('input')).toHaveValue('Initial');\n    expect(screen.getByTestId('is-dirty').textContent).toBe('false');\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\common\\CustomDropdown.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\common\\ErrorBoundary.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NonRecoverableComponent' is assigned a value but never used.","line":42,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access [0] on an `any` value.","line":120,"column":36,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":120,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access [0] on an `any` value.","line":121,"column":36,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":121,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":183,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":183,"endColumn":84},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access [0] on an `any` value.","line":183,"column":81,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":183,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .componentName on an `any` value.","line":184,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":184,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .errorMessage on an `any` value.","line":185,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":185,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":197,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":197,"endColumn":83},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":198,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":198,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access [storedLogs.length - 1] on an `any` value.","line":199,"column":25,"nodeType":"BinaryExpression","messageId":"unsafeMemberExpression","endLine":199,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":199,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":199,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for ErrorBoundary component\n */\nimport '@testing-library/jest-dom';\nimport React from 'react';\nimport { render, screen, fireEvent } from '@testing-library/react';\nimport { ErrorBoundary, withErrorBoundary, useErrorBoundary } from '@/components/common/ErrorBoundary';\n\n// Mock navigator.clipboard\nconst mockClipboard = {\n  writeText: jest.fn().mockResolvedValue(undefined),\n};\nObject.assign(navigator, { clipboard: mockClipboard });\n\n// Mock localStorage\nconst mockLocalStorage = (() => {\n  let store: Record<string, string> = {};\n  return {\n    getItem: (key: string) => store[key] || null,\n    setItem: (key: string, value: string) => {\n      store[key] = value;\n    },\n    removeItem: (key: string) => {\n      delete store[key];\n    },\n    clear: () => {\n      store = {};\n    },\n  };\n})();\nObject.defineProperty(window, 'localStorage', { value: mockLocalStorage });\n\n// Component that throws an error\nconst ThrowingComponent = ({ shouldThrow = true }: { shouldThrow?: boolean }) => {\n  if (shouldThrow) {\n    throw new Error('Test error');\n  }\n  return <div>No error</div>;\n};\n\n// Component that throws non-recoverable error\nconst NonRecoverableComponent = () => {\n  const error = new SyntaxError('Invalid JSON');\n  throw error;\n};\n\ndescribe('ErrorBoundary', () => {\n  // Suppress console.error for expected errors\n  const originalError = console.error;\n  \n  beforeAll(() => {\n    console.error = jest.fn();\n  });\n  \n  afterAll(() => {\n    console.error = originalError;\n  });\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockLocalStorage.clear();\n  });\n\n  describe('Basic functionality', () => {\n    it('should render children when there is no error', () => {\n      render(\n        <ErrorBoundary>\n          <div>Child content</div>\n        </ErrorBoundary>\n      );\n\n      expect(screen.getByText('Child content')).toBeInTheDocument();\n    });\n\n    it('should render error UI when child throws', () => {\n      render(\n        <ErrorBoundary componentName=\"TestComponent\">\n          <ThrowingComponent />\n        </ErrorBoundary>\n      );\n\n      expect(screen.getByText('Something went wrong')).toBeInTheDocument();\n      expect(screen.getByText('Test error')).toBeInTheDocument();\n      expect(screen.getByText('Component: TestComponent')).toBeInTheDocument();\n    });\n\n    it('should display error ID', () => {\n      render(\n        <ErrorBoundary>\n          <ThrowingComponent />\n        </ErrorBoundary>\n      );\n\n      const errorIdElement = screen.getByText(/Error ID:/);\n      expect(errorIdElement).toBeInTheDocument();\n      expect(errorIdElement.textContent).toMatch(/error_\\d+_\\w+/);\n    });\n\n    it('should use custom fallback when provided', () => {\n      render(\n        <ErrorBoundary fallback={<div>Custom fallback</div>}>\n          <ThrowingComponent />\n        </ErrorBoundary>\n      );\n\n      expect(screen.getByText('Custom fallback')).toBeInTheDocument();\n      expect(screen.queryByText('Something went wrong')).not.toBeInTheDocument();\n    });\n\n    it('should call onError callback when error occurs', () => {\n      const onError = jest.fn();\n\n      render(\n        <ErrorBoundary onError={onError}>\n          <ThrowingComponent />\n        </ErrorBoundary>\n      );\n\n      expect(onError).toHaveBeenCalled();\n      expect(onError.mock.calls[0][0]).toBeInstanceOf(Error);\n      expect(onError.mock.calls[0][0].message).toBe('Test error');\n    });\n  });\n\n  describe('Recovery', () => {\n    it('should show Try Again button for recoverable errors', () => {\n      render(\n        <ErrorBoundary>\n          <ThrowingComponent />\n        </ErrorBoundary>\n      );\n\n      expect(screen.getByRole('button', { name: /Try Again/i })).toBeInTheDocument();\n    });\n\n    it('should track recovery attempts', () => {\n      render(\n        <ErrorBoundary maxRecoveryAttempts={3}>\n          <ThrowingComponent />\n        </ErrorBoundary>\n      );\n\n      const tryAgainButton = screen.getByRole('button', { name: /Try Again/i });\n      expect(tryAgainButton.textContent).toContain('1/3');\n    });\n\n    it('should provide Reset button for user', () => {\n      render(\n        <ErrorBoundary>\n          <ThrowingComponent shouldThrow={true} />\n        </ErrorBoundary>\n      );\n\n      expect(screen.getByText('Something went wrong')).toBeInTheDocument();\n\n      // Reset button should be available\n      const resetButton = screen.getByRole('button', { name: /Reset/i });\n      expect(resetButton).toBeInTheDocument();\n\n      // Clicking reset should attempt to clear error (will throw again in this test)\n      // This verifies the button is functional\n      fireEvent.click(resetButton);\n      \n      // Since the component still throws, we'll be back in error state\n      // The important thing is that handleReset was called (console.log verifies this)\n    });\n  });\n\n  describe('Error reporting', () => {\n    it('should copy error report to clipboard when Report Error is clicked', async () => {\n      window.alert = jest.fn();\n      \n      render(\n        <ErrorBoundary componentName=\"TestComponent\">\n          <ThrowingComponent />\n        </ErrorBoundary>\n      );\n\n      const reportButton = screen.getByRole('button', { name: /Report Error/i });\n      fireEvent.click(reportButton);\n\n      expect(mockClipboard.writeText).toHaveBeenCalled();\n      const clipboardContent = JSON.parse(mockClipboard.writeText.mock.calls[0][0]);\n      expect(clipboardContent.componentName).toBe('TestComponent');\n      expect(clipboardContent.errorMessage).toBe('Test error');\n    });\n  });\n\n  describe('Error logging', () => {\n    it('should store errors in localStorage', () => {\n      render(\n        <ErrorBoundary componentName=\"TestComponent\">\n          <ThrowingComponent />\n        </ErrorBoundary>\n      );\n\n      const storedLogs = JSON.parse(mockLocalStorage.getItem('errorLogs') || '[]');\n      expect(storedLogs.length).toBeGreaterThan(0);\n      expect(storedLogs[storedLogs.length - 1].componentName).toBe('TestComponent');\n    });\n  });\n\n  describe('Recoverability detection', () => {\n    it('should identify TypeError as recoverable', () => {\n      const ThrowTypeError = () => {\n        throw new TypeError('Type error');\n      };\n\n      render(\n        <ErrorBoundary>\n          <ThrowTypeError />\n        </ErrorBoundary>\n      );\n\n      expect(screen.getByRole('button', { name: /Try Again/i })).toBeInTheDocument();\n    });\n  });\n});\n\ndescribe('withErrorBoundary HOC', () => {\n  const originalError = console.error;\n  \n  beforeAll(() => {\n    console.error = jest.fn();\n  });\n  \n  afterAll(() => {\n    console.error = originalError;\n  });\n\n  it('should wrap component with error boundary', () => {\n    const SimpleComponent = () => <div>Simple content</div>;\n    const WrappedComponent = withErrorBoundary(SimpleComponent);\n\n    render(<WrappedComponent />);\n\n    expect(screen.getByText('Simple content')).toBeInTheDocument();\n  });\n\n  it('should catch errors from wrapped component', () => {\n    const ErrorComponent = () => {\n      throw new Error('Wrapped component error');\n    };\n    const WrappedComponent = withErrorBoundary(ErrorComponent);\n\n    render(<WrappedComponent />);\n\n    expect(screen.getByText('Something went wrong')).toBeInTheDocument();\n  });\n\n  it('should pass error boundary props', () => {\n    const ErrorComponent = () => {\n      throw new Error('Wrapped component error');\n    };\n    const WrappedComponent = withErrorBoundary(ErrorComponent, {\n      fallback: <div>HOC Fallback</div>,\n    });\n\n    render(<WrappedComponent />);\n\n    expect(screen.getByText('HOC Fallback')).toBeInTheDocument();\n  });\n});\n\ndescribe('useErrorBoundary hook', () => {\n  const TestHookComponent = () => {\n    const { error, handleError, clearError, hasError } = useErrorBoundary();\n\n    return (\n      <div>\n        <span data-testid=\"has-error\">{hasError.toString()}</span>\n        <span data-testid=\"error-message\">{error?.message || 'No error'}</span>\n        <button onClick={() => handleError(new Error('Hook error'), { componentStack: '' })}>\n          Trigger Error\n        </button>\n        <button onClick={clearError}>Clear Error</button>\n      </div>\n    );\n  };\n\n  it('should initialize with no error', () => {\n    render(<TestHookComponent />);\n\n    expect(screen.getByTestId('has-error').textContent).toBe('false');\n    expect(screen.getByTestId('error-message').textContent).toBe('No error');\n  });\n\n  it('should set error when handleError is called', () => {\n    render(<TestHookComponent />);\n\n    fireEvent.click(screen.getByRole('button', { name: 'Trigger Error' }));\n\n    expect(screen.getByTestId('has-error').textContent).toBe('true');\n    expect(screen.getByTestId('error-message').textContent).toBe('Hook error');\n  });\n\n  it('should clear error when clearError is called', () => {\n    render(<TestHookComponent />);\n\n    fireEvent.click(screen.getByRole('button', { name: 'Trigger Error' }));\n    expect(screen.getByTestId('has-error').textContent).toBe('true');\n\n    fireEvent.click(screen.getByRole('button', { name: 'Clear Error' }));\n    expect(screen.getByTestId('has-error').textContent).toBe('false');\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\common\\Layout.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\common\\Pagination.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\common\\Sidebar.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[968,971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[968,971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for Sidebar component\r\n */\r\nimport '@testing-library/jest-dom';\r\nimport React from 'react';\r\nimport { render, screen, fireEvent } from '@testing-library/react';\r\nimport Sidebar from '@/components/common/Sidebar';\r\n\r\n// Mock Next.js Link component with legacyBehavior support\r\njest.mock('next/link', () => {\r\n  return {\r\n    __esModule: true,\r\n    default: ({ children, href, legacyBehavior }: { children: React.ReactNode | ((props: { href: string }) => React.ReactNode); href: string; legacyBehavior?: boolean }) => {\r\n      if (legacyBehavior) {\r\n        // For legacyBehavior, children can be a function or React element\r\n        // If it's a function, call it with href prop\r\n        if (typeof children === 'function') {\r\n          return children({ href });\r\n        }\r\n        // If it's an element (like <a>), clone it and add href\r\n        if (React.isValidElement(children)) {\r\n          return React.cloneElement(children as React.ReactElement<any>, { href });\r\n        }\r\n        return children;\r\n      }\r\n      // For non-legacy, wrap children in anchor\r\n      return <a href={href}>{children}</a>;\r\n    },\r\n  };\r\n});\r\n\r\ndescribe('Sidebar', () => {\r\n  const defaultProps = {\r\n    isCollapsed: false,\r\n    setIsCollapsed: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('Rendering', () => {\r\n    it('should render sidebar', () => {\r\n      render(<Sidebar {...defaultProps} />);\r\n\r\n      expect(screen.getByText('BattleTech')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should render navigation items', () => {\r\n      render(<Sidebar {...defaultProps} />);\r\n\r\n      expect(screen.getByText('Dashboard')).toBeInTheDocument();\r\n      expect(screen.getByText('Units')).toBeInTheDocument();\r\n      expect(screen.getByText('Equipment')).toBeInTheDocument();\r\n      expect(screen.getByText('Compendium')).toBeInTheDocument();\r\n      expect(screen.getByText('Customizer')).toBeInTheDocument();\r\n      expect(screen.getByText('Compare')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should display version when expanded', () => {\r\n      render(<Sidebar {...defaultProps} isCollapsed={false} />);\r\n\r\n      expect(screen.getByText('v0.1.0')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  describe('Collapsed state', () => {\r\n    it('should hide title when collapsed', () => {\r\n      render(<Sidebar {...defaultProps} isCollapsed={true} />);\r\n\r\n      expect(screen.queryByText('BattleTech')).not.toBeInTheDocument();\r\n    });\r\n\r\n    it('should hide nav labels when collapsed', () => {\r\n      render(<Sidebar {...defaultProps} isCollapsed={true} />);\r\n\r\n      expect(screen.queryByText('Dashboard')).not.toBeInTheDocument();\r\n      expect(screen.queryByText('Units')).not.toBeInTheDocument();\r\n    });\r\n\r\n    it('should hide version when collapsed', () => {\r\n      render(<Sidebar {...defaultProps} isCollapsed={true} />);\r\n\r\n      expect(screen.queryByText('v0.1.0')).not.toBeInTheDocument();\r\n    });\r\n\r\n    it('should have narrow width when collapsed', () => {\r\n      const { container } = render(<Sidebar {...defaultProps} isCollapsed={true} />);\r\n\r\n      const sidebar = container.firstChild as HTMLElement;\r\n      expect(sidebar).toHaveClass('w-12');\r\n    });\r\n\r\n    it('should have wide width when expanded', () => {\r\n      const { container } = render(<Sidebar {...defaultProps} isCollapsed={false} />);\r\n\r\n      const sidebar = container.firstChild as HTMLElement;\r\n      expect(sidebar).toHaveClass('w-40');\r\n    });\r\n  });\r\n\r\n  describe('Toggle functionality', () => {\r\n    it('should call setIsCollapsed when toggle button clicked', () => {\r\n      const setIsCollapsed = jest.fn();\r\n      render(<Sidebar {...defaultProps} isCollapsed={false} setIsCollapsed={setIsCollapsed} />);\r\n\r\n      const toggleButton = screen.getByRole('button', { name: /collapse sidebar/i });\r\n      fireEvent.click(toggleButton);\r\n\r\n      expect(setIsCollapsed).toHaveBeenCalledWith(true);\r\n    });\r\n\r\n    it('should expand when toggle clicked while collapsed', () => {\r\n      const setIsCollapsed = jest.fn();\r\n      render(<Sidebar {...defaultProps} isCollapsed={true} setIsCollapsed={setIsCollapsed} />);\r\n\r\n      const toggleButton = screen.getByRole('button', { name: /expand sidebar/i });\r\n      fireEvent.click(toggleButton);\r\n\r\n      expect(setIsCollapsed).toHaveBeenCalledWith(false);\r\n    });\r\n  });\r\n\r\n  describe('Navigation links', () => {\r\n    it('should have correct href for Dashboard', () => {\r\n      render(<Sidebar {...defaultProps} />);\r\n\r\n      const dashboardLink = screen.getByText('Dashboard').closest('a');\r\n      expect(dashboardLink).toHaveAttribute('href', '/');\r\n    });\r\n\r\n    it('should have correct href for Units', () => {\r\n      render(<Sidebar {...defaultProps} />);\r\n\r\n      const unitsLink = screen.getByText('Units').closest('a');\r\n      expect(unitsLink).toHaveAttribute('href', '/units');\r\n    });\r\n\r\n    it('should have correct href for Equipment', () => {\r\n      render(<Sidebar {...defaultProps} />);\r\n\r\n      const equipmentLink = screen.getByText('Equipment').closest('a');\r\n      expect(equipmentLink).toHaveAttribute('href', '/equipment');\r\n    });\r\n\r\n    it('should have correct href for Compendium', () => {\r\n      render(<Sidebar {...defaultProps} />);\r\n\r\n      const compendiumLink = screen.getByText('Compendium').closest('a');\r\n      expect(compendiumLink).toHaveAttribute('href', '/compendium');\r\n    });\r\n\r\n    it('should have correct href for Customizer', () => {\r\n      render(<Sidebar {...defaultProps} />);\r\n\r\n      const customizerLink = screen.getByText('Customizer').closest('a');\r\n      expect(customizerLink).toHaveAttribute('href', '/customizer');\r\n    });\r\n\r\n    it('should have correct href for Compare', () => {\r\n      render(<Sidebar {...defaultProps} />);\r\n\r\n      const compareLink = screen.getByText('Compare').closest('a');\r\n      expect(compareLink).toHaveAttribute('href', '/compare');\r\n    });\r\n  });\r\n\r\n  describe('Accessibility', () => {\r\n    it('should have accessible toggle button label when expanded', () => {\r\n      render(<Sidebar {...defaultProps} isCollapsed={false} />);\r\n\r\n      expect(screen.getByRole('button', { name: /collapse sidebar/i })).toBeInTheDocument();\r\n    });\r\n\r\n    it('should have accessible toggle button label when collapsed', () => {\r\n      render(<Sidebar {...defaultProps} isCollapsed={true} />);\r\n\r\n      expect(screen.getByRole('button', { name: /expand sidebar/i })).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  describe('Styling', () => {\r\n    it('should have dark background', () => {\r\n      const { container } = render(<Sidebar {...defaultProps} />);\r\n\r\n      const sidebar = container.firstChild as HTMLElement;\r\n      expect(sidebar).toHaveClass('bg-gray-800');\r\n    });\r\n\r\n    it('should be fixed positioned', () => {\r\n      const { container } = render(<Sidebar {...defaultProps} />);\r\n\r\n      const sidebar = container.firstChild as HTMLElement;\r\n      expect(sidebar).toHaveClass('fixed');\r\n    });\r\n\r\n    it('should have transition classes', () => {\r\n      const { container } = render(<Sidebar {...defaultProps} />);\r\n\r\n      const sidebar = container.firstChild as HTMLElement;\r\n      expect(sidebar).toHaveClass('transition-all');\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\common\\SkeletonLoader.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\armor\\ArmorDiagram.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[403,406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[403,406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":10,"column":62,"nodeType":"Identifier","messageId":"anyAssignment","endLine":10,"endColumn":69}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { ArmorDiagram } from '@/components/customizer/armor/ArmorDiagram';\r\nimport { MechLocation } from '@/types/construction';\r\n\r\n// Mock ArmorLocation\r\njest.mock('@/components/customizer/armor/ArmorLocation', () => ({\r\n  ArmorLocation: ({ location, onClick }: any) => (\r\n    <div data-testid={`armor-location-${location}`} onClick={onClick}>\r\n      {location}\r\n    </div>\r\n  ),\r\n}));\r\n\r\n// Mock ArmorLegend\r\njest.mock('@/components/customizer/armor/ArmorLegend', () => ({\r\n  ArmorLegend: () => <div data-testid=\"armor-legend\" />,\r\n}));\r\n\r\ndescribe('ArmorDiagram', () => {\r\n  const defaultProps = {\r\n    armorData: [\r\n      {\r\n        location: MechLocation.HEAD,\r\n        current: 9,\r\n        maximum: 9,\r\n      },\r\n      {\r\n        location: MechLocation.CENTER_TORSO,\r\n        current: 16,\r\n        maximum: 20,\r\n        rear: 5,\r\n        rearMaximum: 4,\r\n      },\r\n    ],\r\n    selectedLocation: null,\r\n    unallocatedPoints: 0,\r\n    onLocationClick: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  it('should render armor diagram', () => {\r\n    render(<ArmorDiagram {...defaultProps} />);\r\n    \r\n    expect(screen.getByText('Armor Allocation')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render armor locations', () => {\r\n    render(<ArmorDiagram {...defaultProps} />);\r\n    \r\n    expect(screen.getByTestId('armor-location-HEAD')).toBeInTheDocument();\r\n    expect(screen.getByTestId('armor-location-CENTER_TORSO')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call onLocationClick when location is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    render(<ArmorDiagram {...defaultProps} />);\r\n    \r\n    const headLocation = screen.getByTestId('armor-location-HEAD');\r\n    await user.click(headLocation);\r\n    \r\n    expect(defaultProps.onLocationClick).toHaveBeenCalledWith(MechLocation.HEAD);\r\n  });\r\n\r\n  it('should display auto-allocate button when onAutoAllocate is provided', () => {\r\n    render(<ArmorDiagram {...defaultProps} onAutoAllocate={jest.fn()} />);\r\n    \r\n    expect(screen.getByText(/Auto-Allocate/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call onAutoAllocate when button is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    const onAutoAllocate = jest.fn();\r\n    render(<ArmorDiagram {...defaultProps} onAutoAllocate={onAutoAllocate} />);\r\n    \r\n    const autoAllocateButton = screen.getByText(/Auto-Allocate/i);\r\n    await user.click(autoAllocateButton);\r\n    \r\n    expect(onAutoAllocate).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should display unallocated points in button', () => {\r\n    render(<ArmorDiagram {...defaultProps} unallocatedPoints={10} onAutoAllocate={jest.fn()} />);\r\n    \r\n    expect(screen.getByText(/10 pts/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<ArmorDiagram {...defaultProps} className=\"custom-class\" />);\r\n    \r\n    const diagram = container.firstChild;\r\n    expect(diagram).toHaveClass('custom-class');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\armor\\ArmorLegend.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\armor\\ArmorLocation.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'screen' is defined but never used.","line":2,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":105,"column":5,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":105,"endColumn":17},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":120,"column":5,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":120,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { ArmorLocation } from '@/components/customizer/armor/ArmorLocation';\r\nimport { MechLocation } from '@/types/construction';\r\n\r\ndescribe('ArmorLocation', () => {\r\n  const defaultProps = {\r\n    location: MechLocation.HEAD,\r\n    x: 10,\r\n    y: 10,\r\n    width: 50,\r\n    height: 40,\r\n    data: { current: 9, max: 9 },\r\n    isSelected: false,\r\n    isHovered: false,\r\n    onClick: jest.fn(),\r\n    onHover: jest.fn(),\r\n    locationType: 'head' as const,\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  it('should render location label', () => {\r\n    const { container } = render(\r\n      <svg>\r\n        <ArmorLocation {...defaultProps} />\r\n      </svg>\r\n    );\r\n    \r\n    expect(container.querySelector('text')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render armor value', () => {\r\n    const { container } = render(\r\n      <svg>\r\n        <ArmorLocation {...defaultProps} data={{ current: 9, max: 9 }} />\r\n      </svg>\r\n    );\r\n    \r\n    const texts = container.querySelectorAll('text');\r\n    expect(texts.length).toBeGreaterThan(0);\r\n    // One text should contain the armor value\r\n    const hasValue = Array.from(texts).some(el => el.textContent === '9');\r\n    expect(hasValue).toBe(true);\r\n  });\r\n\r\n  it('should render rear armor when showRear is true', () => {\r\n    const { container } = render(\r\n      <svg>\r\n        <ArmorLocation\r\n          {...defaultProps}\r\n          location={MechLocation.CENTER_TORSO}\r\n          locationType=\"torso\"\r\n          showRear={true}\r\n          data={{ current: 30, max: 46, rear: 10 }}\r\n        />\r\n      </svg>\r\n    );\r\n    \r\n    const rects = container.querySelectorAll('rect');\r\n    expect(rects.length).toBeGreaterThan(1); // Main + rear\r\n  });\r\n\r\n  it('should call onClick when clicked', async () => {\r\n    const user = userEvent.setup();\r\n    const { container } = render(\r\n      <svg>\r\n        <ArmorLocation {...defaultProps} />\r\n      </svg>\r\n    );\r\n    \r\n    const group = container.querySelector('g[role=\"button\"]');\r\n    expect(group).toBeInTheDocument();\r\n    \r\n    await user.click(group!);\r\n    expect(defaultProps.onClick).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should call onHover when hovered', async () => {\r\n    const user = userEvent.setup();\r\n    const { container } = render(\r\n      <svg>\r\n        <ArmorLocation {...defaultProps} />\r\n      </svg>\r\n    );\r\n    \r\n    const group = container.querySelector('g[role=\"button\"]');\r\n    await user.hover(group!);\r\n    \r\n    expect(defaultProps.onHover).toHaveBeenCalledWith(true);\r\n  });\r\n\r\n  it('should call onClick when Enter key is pressed', async () => {\r\n    const user = userEvent.setup();\r\n    const { container } = render(\r\n      <svg>\r\n        <ArmorLocation {...defaultProps} />\r\n      </svg>\r\n    );\r\n    \r\n    const group = container.querySelector('g[role=\"button\"]');\r\n    group?.focus();\r\n    await user.keyboard('{Enter}');\r\n    \r\n    expect(defaultProps.onClick).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should call onClick when Space key is pressed', async () => {\r\n    const user = userEvent.setup();\r\n    const { container } = render(\r\n      <svg>\r\n        <ArmorLocation {...defaultProps} />\r\n      </svg>\r\n    );\r\n    \r\n    const group = container.querySelector('g[role=\"button\"]');\r\n    group?.focus();\r\n    await user.keyboard(' ');\r\n    \r\n    expect(defaultProps.onClick).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should have correct aria-label', () => {\r\n    const { container } = render(\r\n      <svg>\r\n        <ArmorLocation\r\n          {...defaultProps}\r\n          location={MechLocation.CENTER_TORSO}\r\n          data={{ current: 30, rear: 10 }}\r\n          showRear={true}\r\n        />\r\n      </svg>\r\n    );\r\n    \r\n    const group = container.querySelector('g[role=\"button\"]');\r\n    expect(group).toHaveAttribute('aria-label');\r\n    expect(group?.getAttribute('aria-label')).toContain('30');\r\n    expect(group?.getAttribute('aria-label')).toContain('10');\r\n  });\r\n\r\n  it('should set aria-pressed when selected', () => {\r\n    const { container } = render(\r\n      <svg>\r\n        <ArmorLocation {...defaultProps} isSelected={true} />\r\n      </svg>\r\n    );\r\n    \r\n    const group = container.querySelector('g[role=\"button\"]');\r\n    expect(group).toHaveAttribute('aria-pressed', 'true');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\armor\\LocationArmorEditor.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\critical-slots\\CriticalSlotToolbar.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\critical-slots\\CriticalSlotsDisplay.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[438,441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[438,441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":11,"column":30,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":11,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":11,"column":30,"nodeType":"Identifier","messageId":"unsafeCall","endLine":11,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[774,777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[774,777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":20,"column":24,"nodeType":"Identifier","messageId":"anyAssignment","endLine":20,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":21,"column":24,"nodeType":"Identifier","messageId":"anyAssignment","endLine":21,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { CriticalSlotsDisplay } from '@/components/customizer/critical-slots/CriticalSlotsDisplay';\r\nimport { MechLocation } from '@/types/construction';\r\n\r\n// Mock LocationGrid\r\njest.mock('@/components/customizer/critical-slots/LocationGrid', () => ({\r\n  LocationGrid: ({ location, onSlotClick }: any) => (\r\n    <div data-testid={`location-grid-${location}`}>\r\n      <button onClick={() => onSlotClick(location, 0)}>Slot 0</button>\r\n    </div>\r\n  ),\r\n}));\r\n\r\n// Mock CriticalSlotToolbar\r\njest.mock('@/components/customizer/critical-slots/CriticalSlotToolbar', () => ({\r\n  CriticalSlotToolbar: ({ onAutoFillToggle, onPreviewToggle }: any) => (\r\n    <div data-testid=\"toolbar\">\r\n      <button onClick={onAutoFillToggle}>Toggle Auto-Fill</button>\r\n      <button onClick={onPreviewToggle}>Toggle Preview</button>\r\n    </div>\r\n  ),\r\n}));\r\n\r\ndescribe('CriticalSlotsDisplay', () => {\r\n  const defaultProps = {\r\n    locations: [\r\n      {\r\n        location: MechLocation.HEAD,\r\n        slots: [\r\n          { index: 0, type: 'empty' as const },\r\n          { index: 1, type: 'empty' as const },\r\n        ],\r\n      },\r\n    ],\r\n    autoFillUnhittables: false,\r\n    showPlacementPreview: false,\r\n    onSlotClick: jest.fn(),\r\n    onEquipmentDrop: jest.fn(),\r\n    onEquipmentRemove: jest.fn(),\r\n    onAutoFillToggle: jest.fn(),\r\n    onPreviewToggle: jest.fn(),\r\n    onToolbarAction: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  it('should render location grids', () => {\r\n    render(<CriticalSlotsDisplay {...defaultProps} />);\r\n    \r\n    expect(screen.getByTestId('location-grid-HEAD')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render toolbar', () => {\r\n    render(<CriticalSlotsDisplay {...defaultProps} />);\r\n    \r\n    expect(screen.getByTestId('toolbar')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render location grids with slots', () => {\r\n    render(<CriticalSlotsDisplay {...defaultProps} />);\r\n    \r\n    expect(screen.getByTestId('location-grid-HEAD')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call onAutoFillToggle when toggle is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    render(<CriticalSlotsDisplay {...defaultProps} />);\r\n    \r\n    const toggleButton = screen.getByText('Toggle Auto-Fill');\r\n    await user.click(toggleButton);\r\n    \r\n    expect(defaultProps.onAutoFillToggle).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should call onPreviewToggle when preview toggle is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    render(<CriticalSlotsDisplay {...defaultProps} />);\r\n    \r\n    const previewButton = screen.getByText('Toggle Preview');\r\n    await user.click(previewButton);\r\n    \r\n    expect(defaultProps.onPreviewToggle).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<CriticalSlotsDisplay {...defaultProps} className=\"custom-class\" />);\r\n    \r\n    const display = container.firstChild;\r\n    expect(display).toHaveClass('custom-class');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\critical-slots\\DraggableEquipment.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\critical-slots\\LocationGrid.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[399,402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[399,402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .index on an `any` value.","line":10,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":10,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":10,"column":54,"nodeType":"Identifier","messageId":"anyAssignment","endLine":10,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .type on an `any` value.","line":11,"column":13,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":11,"endColumn":17},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .equipmentName on an `any` value.","line":11,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":11,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { LocationGrid } from '@/components/customizer/critical-slots/LocationGrid';\r\nimport { MechLocation } from '@/types/construction';\r\n\r\n// Mock SlotRow\r\njest.mock('@/components/customizer/critical-slots/SlotRow', () => ({\r\n  SlotRow: ({ slot, onClick }: any) => (\r\n    <div data-testid={`slot-${slot.index}`} onClick={onClick}>\r\n      {slot.type === 'empty' ? 'Empty' : slot.equipmentName}\r\n    </div>\r\n  ),\r\n}));\r\n\r\ndescribe('LocationGrid', () => {\r\n  const defaultProps = {\r\n    location: MechLocation.HEAD,\r\n    data: {\r\n      slots: [],\r\n    },\r\n    assignableSlots: [],\r\n    onSlotClick: jest.fn(),\r\n    onEquipmentDrop: jest.fn(),\r\n    onEquipmentRemove: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  it('should render location label', () => {\r\n    render(<LocationGrid {...defaultProps} />);\r\n    \r\n    expect(screen.getByText('Head')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render all slots for location', () => {\r\n    render(<LocationGrid {...defaultProps} location={MechLocation.HEAD} />);\r\n    \r\n    // Head has 6 slots\r\n    expect(screen.getByTestId('slot-0')).toBeInTheDocument();\r\n    expect(screen.getByTestId('slot-5')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render slots with equipment', () => {\r\n    const data = {\r\n      slots: [\r\n        { index: 0, type: 'equipment' as const, equipmentId: 'equip-1', equipmentName: 'Medium Laser' },\r\n      ],\r\n    };\r\n    \r\n    render(<LocationGrid {...defaultProps} data={data} />);\r\n    \r\n    expect(screen.getByText('Medium Laser')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call onSlotClick when slot is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    render(<LocationGrid {...defaultProps} />);\r\n    \r\n    const slot = screen.getByTestId('slot-0');\r\n    await user.click(slot);\r\n    \r\n    expect(defaultProps.onSlotClick).toHaveBeenCalledWith(0);\r\n  });\r\n\r\n  it('should highlight assignable slots', () => {\r\n    render(<LocationGrid {...defaultProps} assignableSlots={[0, 1]} />);\r\n    \r\n    expect(screen.getByTestId('slot-0')).toBeInTheDocument();\r\n    expect(screen.getByTestId('slot-1')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should highlight selected equipment', () => {\r\n    const data = {\r\n      slots: [\r\n        { index: 0, type: 'equipment' as const, equipmentId: 'equip-1', equipmentName: 'Medium Laser' },\r\n      ],\r\n    };\r\n    \r\n    render(\r\n      <LocationGrid\r\n        {...defaultProps}\r\n        data={data}\r\n        selectedEquipmentId=\"equip-1\"\r\n      />\r\n    );\r\n    \r\n    expect(screen.getByText('Medium Laser')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render different location labels', () => {\r\n    const { rerender } = render(<LocationGrid {...defaultProps} location={MechLocation.CENTER_TORSO} />);\r\n    expect(screen.getByText('Center Torso')).toBeInTheDocument();\r\n    \r\n    rerender(<LocationGrid {...defaultProps} location={MechLocation.LEFT_ARM} />);\r\n    expect(screen.getByText('Left Arm')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<LocationGrid {...defaultProps} className=\"custom-class\" />);\r\n    \r\n    const grid = container.firstChild;\r\n    expect(grid).toHaveClass('custom-class');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\critical-slots\\LocationRestrictions.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\critical-slots\\SlotHighlighting.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\critical-slots\\SlotRow.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\dialogs\\ImportUnitDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\dialogs\\ModalOverlay.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\dialogs\\OverwriteConfirmDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\dialogs\\ResetConfirmationDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\dialogs\\SaveUnitDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\dialogs\\UnitLoadDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\dialogs\\UnsavedChangesDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\dialogs\\VersionHistoryDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\equipment\\CategoryToggleBar.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\equipment\\EquipmentBrowser.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type error.","line":19,"column":42,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":19,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":19,"column":42,"nodeType":"Identifier","messageId":"unsafeCall","endLine":19,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":27,"column":24,"nodeType":"Identifier","messageId":"anyAssignment","endLine":27,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1435,1438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1435,1438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `any` value.","line":38,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":38,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":40,"column":26,"nodeType":"Identifier","messageId":"anyAssignment","endLine":40,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1723,1726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1723,1726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":50,"column":30,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":50,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":50,"column":30,"nodeType":"Identifier","messageId":"unsafeCall","endLine":50,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":54,"column":30,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":54,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":54,"column":30,"nodeType":"Identifier","messageId":"unsafeCall","endLine":54,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { EquipmentBrowser } from '@/components/customizer/equipment/EquipmentBrowser';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { CategoryToggleBarProps, HideToggleBarProps } from '@/components/customizer/equipment/CategoryToggleBar';\r\n\r\n// Mock the hook\r\njest.mock('@/hooks/useEquipmentBrowser', () => ({\r\n  useEquipmentBrowser: jest.fn(),\r\n}));\r\n\r\n// Mock CategoryToggleBar and HideToggleBar\r\njest.mock('@/components/customizer/equipment/CategoryToggleBar', () => ({\r\n  CategoryToggleBar: ({ activeCategories, onSelectCategory }: CategoryToggleBarProps) => (\r\n    <div data-testid=\"category-toggle-bar\">\r\n      {Array.from(activeCategories).map((cat: EquipmentCategory) => (\r\n        <button key={cat} onClick={() => onSelectCategory(cat, false)}>\r\n          {cat}\r\n        </button>\r\n      ))}\r\n    </div>\r\n  ),\r\n  HideToggleBar: ({ hidePrototype, onTogglePrototype }: HideToggleBarProps) => (\r\n    <div data-testid=\"hide-toggle-bar\">\r\n      <button onClick={onTogglePrototype}>\r\n        {hidePrototype ? 'Show Prototype' : 'Hide Prototype'}\r\n      </button>\r\n    </div>\r\n  ),\r\n}));\r\n\r\n// Mock EquipmentRow\r\njest.mock('@/components/customizer/equipment/EquipmentRow', () => ({\r\n  EquipmentRow: ({ equipment, onAdd }: any) => (\r\n    <tr>\r\n      <td>{equipment.name}</td>\r\n      <td>\r\n        <button onClick={onAdd}>Add</button>\r\n      </td>\r\n    </tr>\r\n  ),\r\n}));\r\n\r\n// Mock PaginationButtons\r\njest.mock('@/components/ui/Button', () => ({\r\n  PaginationButtons: ({ currentPage, totalPages, onPageChange }: any) => (\r\n    <div data-testid=\"pagination\">\r\n      <button onClick={() => onPageChange(currentPage - 1)} disabled={currentPage === 1}>\r\n        Prev\r\n      </button>\r\n      <span>{currentPage} / {totalPages}</span>\r\n      <button onClick={() => onPageChange(currentPage + 1)} disabled={currentPage === totalPages}>\r\n        Next\r\n      </button>\r\n    </div>\r\n  ),\r\n}));\r\n\r\nimport { useEquipmentBrowser } from '@/hooks/useEquipmentBrowser';\r\n\r\ndescribe('EquipmentBrowser', () => {\r\n  const mockEquipment = [\r\n    {\r\n      id: 'medium-laser',\r\n      name: 'Medium Laser',\r\n      category: EquipmentCategory.ENERGY_WEAPON,\r\n      weight: 1,\r\n      criticalSlots: 1,\r\n      heat: 3,\r\n      techBase: TechBase.INNER_SPHERE,\r\n    },\r\n    {\r\n      id: 'large-laser',\r\n      name: 'Large Laser',\r\n      category: EquipmentCategory.ENERGY_WEAPON,\r\n      weight: 5,\r\n      criticalSlots: 2,\r\n      heat: 8,\r\n      techBase: TechBase.INNER_SPHERE,\r\n    },\r\n  ];\r\n\r\n  const defaultMockHook = {\r\n    paginatedEquipment: mockEquipment,\r\n    isLoading: false,\r\n    error: null,\r\n    unitYear: null,\r\n    unitTechBase: null,\r\n    currentPage: 1,\r\n    totalPages: 1,\r\n    totalItems: 2,\r\n    search: '',\r\n    activeCategories: new Set([EquipmentCategory.ENERGY_WEAPON]),\r\n    showAllCategories: false,\r\n    hidePrototype: false,\r\n    hideOneShot: false,\r\n    hideUnavailable: false,\r\n    sortColumn: 'name' as const,\r\n    sortDirection: 'asc' as const,\r\n    setSearch: jest.fn(),\r\n    selectCategory: jest.fn(),\r\n    showAll: jest.fn(),\r\n    toggleHidePrototype: jest.fn(),\r\n    toggleHideOneShot: jest.fn(),\r\n    toggleHideUnavailable: jest.fn(),\r\n    clearFilters: jest.fn(),\r\n    setPage: jest.fn(),\r\n    setSort: jest.fn(),\r\n    refresh: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (useEquipmentBrowser as jest.Mock).mockReturnValue(defaultMockHook);\r\n  });\r\n\r\n  it('should render equipment browser', () => {\r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    expect(screen.getByText('Equipment Database')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render equipment table', () => {\r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    expect(screen.getByText('Medium Laser')).toBeInTheDocument();\r\n    expect(screen.getByText('Large Laser')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call onAddEquipment when equipment is added', async () => {\r\n    const user = userEvent.setup();\r\n    const onAddEquipment = jest.fn();\r\n    \r\n    render(<EquipmentBrowser onAddEquipment={onAddEquipment} />);\r\n    \r\n    const addButtons = screen.getAllByText('Add');\r\n    await user.click(addButtons[0]);\r\n    \r\n    expect(onAddEquipment).toHaveBeenCalledWith(mockEquipment[0]);\r\n  });\r\n\r\n  it('should display loading state', () => {\r\n    (useEquipmentBrowser as jest.Mock).mockReturnValue({\r\n      ...defaultMockHook,\r\n      isLoading: true,\r\n    });\r\n    \r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    expect(screen.getByText('Loading equipment...')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display error state', () => {\r\n    (useEquipmentBrowser as jest.Mock).mockReturnValue({\r\n      ...defaultMockHook,\r\n      error: 'Failed to load',\r\n    });\r\n    \r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    expect(screen.getByText('Failed to load equipment')).toBeInTheDocument();\r\n    expect(screen.getByText('Failed to load')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call refresh when retry button is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    const refresh = jest.fn();\r\n    \r\n    (useEquipmentBrowser as jest.Mock).mockReturnValue({\r\n      ...defaultMockHook,\r\n      error: 'Failed to load',\r\n      refresh,\r\n    });\r\n    \r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    const retryButton = screen.getByText('Retry');\r\n    await user.click(retryButton);\r\n    \r\n    expect(refresh).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should display empty state when no equipment', () => {\r\n    (useEquipmentBrowser as jest.Mock).mockReturnValue({\r\n      ...defaultMockHook,\r\n      paginatedEquipment: [],\r\n      totalItems: 0,\r\n    });\r\n    \r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    expect(screen.getByText('No equipment found')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display pagination info', () => {\r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    expect(screen.getByText('2 of 2')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call setSearch when search input changes', async () => {\r\n    const user = userEvent.setup();\r\n    const setSearch = jest.fn();\r\n    \r\n    (useEquipmentBrowser as jest.Mock).mockReturnValue({\r\n      ...defaultMockHook,\r\n      setSearch,\r\n    });\r\n    \r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    const searchInput = screen.getByPlaceholderText('Search equipment...');\r\n    await user.type(searchInput, 'laser');\r\n    \r\n    expect(setSearch).toHaveBeenCalled();\r\n  });\r\n\r\n  it('should call clearFilters when clear button is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    const clearFilters = jest.fn();\r\n    \r\n    (useEquipmentBrowser as jest.Mock).mockReturnValue({\r\n      ...defaultMockHook,\r\n      search: 'test',\r\n      clearFilters,\r\n    });\r\n    \r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    const clearButton = screen.getByText('Clear All');\r\n    await user.click(clearButton);\r\n    \r\n    expect(clearFilters).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should call setSort when sortable header is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    const setSort = jest.fn();\r\n    \r\n    (useEquipmentBrowser as jest.Mock).mockReturnValue({\r\n      ...defaultMockHook,\r\n      setSort,\r\n    });\r\n    \r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    const weightHeader = screen.getByText('Weight');\r\n    await user.click(weightHeader);\r\n    \r\n    expect(setSort).toHaveBeenCalled();\r\n  });\r\n\r\n  it('should display unit context when filtering by availability', () => {\r\n    (useEquipmentBrowser as jest.Mock).mockReturnValue({\r\n      ...defaultMockHook,\r\n      hideUnavailable: true,\r\n      unitYear: 3050,\r\n      unitTechBase: TechBase.INNER_SPHERE,\r\n    });\r\n    \r\n    render(<EquipmentBrowser onAddEquipment={jest.fn()} />);\r\n    \r\n    expect(screen.getByText(/Year  3050/i)).toBeInTheDocument();\r\n    expect(screen.getByText(TechBase.INNER_SPHERE)).toBeInTheDocument();\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\equipment\\EquipmentFilters.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\equipment\\EquipmentRow.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[403,406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[403,406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":9,"column":49,"nodeType":"ObjectExpression","messageId":"unsafeReturn","endLine":18,"endColumn":4},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":21,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":21,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":27,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":27,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":36,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":36,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":42,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":42,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":51,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":51,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":57,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":57,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":66,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":66,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":72,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":72,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":81,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":81,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":87,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":87,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":97,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":97,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":103,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":103,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":112,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":112,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":118,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":118,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":128,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":132,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":138,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":138,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":147,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":147,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":153,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":153,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":164,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":164,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":170,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":170,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":182,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":182,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":188,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":188,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":199,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":199,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":205,"column":36,"nodeType":"Identifier","messageId":"anyAssignment","endLine":205,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":26,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { EquipmentRow } from '@/components/customizer/equipment/EquipmentRow';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\n\r\ndescribe('EquipmentRow', () => {\r\n  const createEquipment = (overrides?: any) => ({\r\n    id: 'medium-laser',\r\n    name: 'Medium Laser',\r\n    category: EquipmentCategory.ENERGY_WEAPON,\r\n    weight: 1,\r\n    criticalSlots: 1,\r\n    heat: 3,\r\n    techBase: TechBase.INNER_SPHERE,\r\n    ...overrides,\r\n  });\r\n\r\n  it('should render equipment name', () => {\r\n    const equipment = createEquipment();\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    expect(screen.getByText('Medium Laser')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render weight', () => {\r\n    const equipment = createEquipment({ weight: 2 });\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    expect(screen.getByText('2t')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render critical slots', () => {\r\n    const equipment = createEquipment({ criticalSlots: 2 });\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    expect(screen.getByText('2')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render damage when present', () => {\r\n    const equipment = createEquipment({ damage: 5 });\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    expect(screen.getByText('5')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render dash when damage is missing', () => {\r\n    const equipment = createEquipment();\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    const dashes = screen.getAllByText('-');\r\n    expect(dashes.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('should render heat when present', () => {\r\n    const equipment = createEquipment({ heat: 3 });\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    expect(screen.getByText('3')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render dash when heat is zero or missing', () => {\r\n    const equipment = createEquipment({ heat: 0 });\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    const dashes = screen.getAllByText('-');\r\n    expect(dashes.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('should render range when present', () => {\r\n    const equipment = createEquipment({\r\n      rangeShort: 3,\r\n      rangeMedium: 6,\r\n      rangeLong: 9,\r\n    });\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    expect(screen.getByText('3/6/9')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render dash when range is missing', () => {\r\n    const equipment = createEquipment();\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    const dashes = screen.getAllByText('-');\r\n    expect(dashes.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('should call onAdd when Add button is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    const equipment = createEquipment();\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    const addButton = screen.getByText('Add');\r\n    await user.click(addButton);\r\n    \r\n    expect(onAdd).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should render in compact mode', () => {\r\n    const equipment = createEquipment();\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} compact={true} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    expect(screen.getByText('Medium Laser')).toBeInTheDocument();\r\n    // In compact mode, weight doesn't have 't' suffix\r\n    expect(screen.getByText('1')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display equipment name in compact mode', () => {\r\n    const equipment = createEquipment();\r\n    const onAdd = jest.fn();\r\n    \r\n    render(\r\n      <table>\r\n        <tbody>\r\n          <EquipmentRow equipment={equipment} onAdd={onAdd} compact={true} />\r\n        </tbody>\r\n      </table>\r\n    );\r\n    \r\n    expect(screen.getByText('Medium Laser')).toBeInTheDocument();\r\n    // In compact mode, weight doesn't have 't' suffix\r\n    expect(screen.getByText('1')).toBeInTheDocument();\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\equipment\\GlobalLoadoutTray.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\shared\\ColorLegend.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\shared\\GlobalStatusBar.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\shared\\StatCell.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\shared\\TechBaseBadge.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\shared\\TechBaseConfiguration.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\shared\\UnitInfoBanner.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\shared\\ValidationBadge.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\ArmorTab.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type error.","line":22,"column":30,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":22,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":22,"column":30,"nodeType":"Identifier","messageId":"unsafeCall","endLine":22,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[983,986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[983,986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":30,"column":24,"nodeType":"Identifier","messageId":"anyAssignment","endLine":30,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1829,1832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1829,1832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":65,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":65,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":65,"column":16,"nodeType":"Identifier","messageId":"unsafeCall","endLine":65,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { ArmorTab } from '@/components/customizer/tabs/ArmorTab';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { ArmorDiagramProps } from '@/components/customizer/armor/ArmorDiagram';\r\n\r\n// Mock dependencies\r\njest.mock('@/stores/useUnitStore', () => ({\r\n  useUnitStore: jest.fn(),\r\n}));\r\n\r\njest.mock('@/hooks/useTechBaseSync', () => ({\r\n  useTechBaseSync: jest.fn(() => ({\r\n    filteredOptions: { armor: [] },\r\n  })),\r\n}));\r\n\r\njest.mock('@/components/customizer/armor/ArmorDiagram', () => ({\r\n  ArmorDiagram: ({ onLocationClick }: Pick<ArmorDiagramProps, 'onLocationClick'>) => (\r\n    <div data-testid=\"armor-diagram\">\r\n      <button onClick={() => onLocationClick('HEAD')}>Head</button>\r\n    </div>\r\n  ),\r\n}));\r\n\r\njest.mock('@/components/customizer/armor/LocationArmorEditor', () => ({\r\n  LocationArmorEditor: ({ onClose }: any) => (\r\n    <div data-testid=\"location-armor-editor\">\r\n      <button onClick={onClose}>Close</button>\r\n    </div>\r\n  ),\r\n}));\r\n\r\ndescribe('ArmorTab', () => {\r\n  const mockStoreValues = {\r\n    tonnage: 50,\r\n    componentTechBases: {},\r\n    armorType: 'Standard',\r\n    armorTonnage: 10,\r\n    armorAllocation: {\r\n      head: 9,\r\n      centerTorso: 16,\r\n      centerTorsoRear: 5,\r\n      leftTorso: 12,\r\n      leftTorsoRear: 4,\r\n      rightTorso: 12,\r\n      rightTorsoRear: 4,\r\n      leftArm: 8,\r\n      rightArm: 8,\r\n      leftLeg: 12,\r\n      rightLeg: 12,\r\n    },\r\n    setArmorType: jest.fn(),\r\n    setArmorTonnage: jest.fn(),\r\n    setLocationArmor: jest.fn(),\r\n    autoAllocateArmor: jest.fn(),\r\n    maximizeArmor: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (useUnitStore as jest.Mock).mockImplementation((selector: any) => {\r\n      if (typeof selector === 'function') {\r\n        return selector(mockStoreValues);\r\n      }\r\n      return undefined;\r\n    });\r\n  });\r\n\r\n  it('should render armor tab', () => {\r\n    render(<ArmorTab />);\r\n    \r\n    expect(screen.getByTestId('armor-diagram')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display armor type', () => {\r\n    render(<ArmorTab />);\r\n    \r\n    expect(screen.getByText(/Type:/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display armor tonnage', () => {\r\n    render(<ArmorTab />);\r\n    \r\n    expect(screen.getByText(/Points\\/Ton/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render armor configuration', () => {\r\n    render(<ArmorTab />);\r\n    \r\n    expect(screen.getByText(/Type:/i)).toBeInTheDocument();\r\n    expect(screen.getByText(/Tonnage:/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display location editor when location is selected', async () => {\r\n    const user = userEvent.setup();\r\n    render(<ArmorTab />);\r\n    \r\n    const headButton = screen.getByText('Head');\r\n    await user.click(headButton);\r\n    \r\n    expect(screen.getByTestId('location-armor-editor')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render armor diagram', () => {\r\n    render(<ArmorTab />);\r\n    \r\n    expect(screen.getByTestId('armor-diagram')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display read-only message when in read-only mode', () => {\r\n    render(<ArmorTab readOnly={true} />);\r\n    \r\n    expect(screen.getByText(/read-only mode/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<ArmorTab className=\"custom-class\" />);\r\n    \r\n    const tab = container.firstChild;\r\n    expect(tab).toHaveClass('custom-class');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\CriticalSlotsTab.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":38,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":38,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `Function` typed value.","line":38,"column":16,"nodeType":"Identifier","messageId":"unsafeCall","endLine":38,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":44,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":44,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `Function` typed value.","line":44,"column":16,"nodeType":"Identifier","messageId":"unsafeCall","endLine":44,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport { CriticalSlotsTab } from '@/components/customizer/tabs/CriticalSlotsTab';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { useCustomizerStore } from '@/stores/useCustomizerStore';\r\n\r\n// Mock dependencies\r\njest.mock('@/stores/useUnitStore', () => ({\r\n  useUnitStore: jest.fn(),\r\n}));\r\n\r\njest.mock('@/stores/useCustomizerStore', () => ({\r\n  useCustomizerStore: jest.fn(),\r\n}));\r\n\r\njest.mock('@/components/customizer/critical-slots/CriticalSlotsDisplay', () => ({\r\n  CriticalSlotsDisplay: () => <div data-testid=\"critical-slots-display\" />,\r\n}));\r\n\r\ndescribe('CriticalSlotsTab', () => {\r\n  const mockStoreValues = {\r\n    tonnage: 50,\r\n    engineType: 'Standard Fusion',\r\n    gyroType: 'Standard',\r\n    equipment: [],\r\n    criticalSlots: [],\r\n  };\r\n\r\n  const mockCustomizerStore = {\r\n    selectedEquipmentId: null,\r\n    setSelectedEquipmentId: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (useUnitStore as jest.Mock).mockImplementation((selector: unknown) => {\r\n      if (typeof selector === 'function') {\r\n        return selector(mockStoreValues);\r\n      }\r\n      return undefined;\r\n    });\r\n    (useCustomizerStore as jest.Mock).mockImplementation((selector: unknown) => {\r\n      if (typeof selector === 'function') {\r\n        return selector(mockCustomizerStore);\r\n      }\r\n      return undefined;\r\n    });\r\n  });\r\n\r\n  it('should render critical slots tab', () => {\r\n    render(<CriticalSlotsTab />);\r\n    \r\n    expect(screen.getByTestId('critical-slots-display')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<CriticalSlotsTab className=\"custom-class\" />);\r\n    \r\n    const tab = container.firstChild;\r\n    expect(tab).toHaveClass('custom-class');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\CustomizerTabs.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\EquipmentTab.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type error.","line":12,"column":30,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":12,"endColumn":94},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":12,"column":30,"nodeType":"Identifier","messageId":"unsafeCall","endLine":12,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1054,1057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1054,1057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":30,"column":11,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":30,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":30,"column":11,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":30,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .toString on an `any` value.","line":30,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":30,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .includes on an `any` value.","line":30,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":30,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { EquipmentTab } from '@/components/customizer/tabs/EquipmentTab';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { EquipmentBrowserProps } from '@/components/customizer/equipment/EquipmentBrowser';\r\n\r\n// Mock EquipmentBrowser\r\njest.mock('@/components/customizer/equipment/EquipmentBrowser', () => ({\r\n  EquipmentBrowser: ({ onAddEquipment }: Pick<EquipmentBrowserProps, 'onAddEquipment'>) => (\r\n    <div data-testid=\"equipment-browser\">\r\n      <button onClick={() => onAddEquipment({ id: 'test-equipment', name: 'Test Equipment' })}>\r\n        Add Equipment\r\n      </button>\r\n    </div>\r\n  ),\r\n}));\r\n\r\n// Mock useUnitStore\r\njest.mock('@/stores/useUnitStore', () => ({\r\n  useUnitStore: jest.fn(),\r\n}));\r\n\r\ndescribe('EquipmentTab', () => {\r\n  const mockAddEquipment = jest.fn();\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (useUnitStore as jest.Mock).mockImplementation((selector: any) => {\r\n      if (selector.toString().includes('addEquipment')) {\r\n        return mockAddEquipment;\r\n      }\r\n      return undefined;\r\n    });\r\n  });\r\n\r\n  it('should render equipment browser', () => {\r\n    render(<EquipmentTab />);\r\n    \r\n    expect(screen.getByTestId('equipment-browser')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call addEquipment when equipment is added', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(<EquipmentTab />);\r\n    \r\n    const addButton = screen.getByText('Add Equipment');\r\n    await user.click(addButton);\r\n    \r\n    expect(mockAddEquipment).toHaveBeenCalledWith({\r\n      id: 'test-equipment',\r\n      name: 'Test Equipment',\r\n    });\r\n  });\r\n\r\n  it('should not call addEquipment when in read-only mode', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(<EquipmentTab readOnly={true} />);\r\n    \r\n    const addButton = screen.getByText('Add Equipment');\r\n    await user.click(addButton);\r\n    \r\n    expect(mockAddEquipment).not.toHaveBeenCalled();\r\n  });\r\n\r\n  it('should display read-only message when in read-only mode', () => {\r\n    render(<EquipmentTab readOnly={true} />);\r\n    \r\n    expect(screen.getByText(/read-only mode/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should not display read-only message when not in read-only mode', () => {\r\n    render(<EquipmentTab readOnly={false} />);\r\n    \r\n    expect(screen.queryByText(/read-only mode/i)).not.toBeInTheDocument();\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<EquipmentTab className=\"custom-class\" />);\r\n    \r\n    const tab = container.firstChild;\r\n    expect(tab).toHaveClass('custom-class');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\FluffTab.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\MultiUnitTabs.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1807,1810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1807,1810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":62,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":62,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":62,"column":16,"nodeType":"Identifier","messageId":"unsafeCall","endLine":62,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2451,2454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2451,2454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":83,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":83,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":83,"column":16,"nodeType":"Identifier","messageId":"unsafeCall","endLine":83,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport { MultiUnitTabs } from '@/components/customizer/tabs/MultiUnitTabs';\r\nimport { useTabManagerStore } from '@/stores/useTabManagerStore';\r\nimport { useRouter } from 'next/router';\r\n\r\n// Mock dependencies\r\njest.mock('next/router', () => ({\r\n  useRouter: jest.fn(),\r\n}));\r\n\r\njest.mock('@/stores/useTabManagerStore', () => ({\r\n  useTabManagerStore: jest.fn(),\r\n}));\r\n\r\njest.mock('@/components/customizer/tabs/TabBar', () => ({\r\n  TabBar: () => <div data-testid=\"tab-bar\" />,\r\n}));\r\n\r\njest.mock('@/components/customizer/tabs/NewTabModal', () => ({\r\n  NewTabModal: () => <div data-testid=\"new-tab-modal\" />,\r\n}));\r\n\r\njest.mock('@/components/customizer/dialogs/UnsavedChangesDialog', () => ({\r\n  UnsavedChangesDialog: () => <div data-testid=\"unsaved-changes-dialog\" />,\r\n}));\r\n\r\njest.mock('@/components/customizer/dialogs/SaveUnitDialog', () => ({\r\n  SaveUnitDialog: () => <div data-testid=\"save-unit-dialog\" />,\r\n}));\r\n\r\njest.mock('@/components/customizer/dialogs/UnitLoadDialog', () => ({\r\n  UnitLoadDialog: () => <div data-testid=\"unit-load-dialog\" />,\r\n}));\r\n\r\ndescribe('MultiUnitTabs', () => {\r\n  const mockRouter = {\r\n    push: jest.fn(),\r\n    query: {},\r\n  };\r\n\r\n  const mockTabManager = {\r\n    tabs: [\r\n      { id: 'tab-1', name: 'Atlas AS7-D', isModified: false },\r\n    ],\r\n    activeTabId: 'tab-1',\r\n    isLoading: false,\r\n    isNewTabModalOpen: false,\r\n    selectTab: jest.fn(),\r\n    closeTab: jest.fn(),\r\n    renameTab: jest.fn(),\r\n    createTab: jest.fn(),\r\n    openNewTabModal: jest.fn(),\r\n    closeNewTabModal: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (useRouter as jest.Mock).mockReturnValue(mockRouter);\r\n    (useTabManagerStore as jest.Mock).mockImplementation((selector: any) => {\r\n      if (typeof selector === 'function') {\r\n        return selector(mockTabManager);\r\n      }\r\n      return undefined;\r\n    });\r\n  });\r\n\r\n  it('should render tab bar', () => {\r\n    render(<MultiUnitTabs><div>Content</div></MultiUnitTabs>);\r\n    \r\n    expect(screen.getByTestId('tab-bar')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render children content', () => {\r\n    render(<MultiUnitTabs><div>Content</div></MultiUnitTabs>);\r\n    \r\n    expect(screen.getByText('Content')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render new tab modal when open', () => {\r\n    (useTabManagerStore as jest.Mock).mockImplementation((selector: any) => {\r\n      if (typeof selector === 'function') {\r\n        return selector({ ...mockTabManager, isNewTabModalOpen: true });\r\n      }\r\n      return undefined;\r\n    });\r\n    \r\n    render(<MultiUnitTabs><div>Content</div></MultiUnitTabs>);\r\n    \r\n    expect(screen.getByTestId('new-tab-modal')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<MultiUnitTabs className=\"custom-class\"><div>Content</div></MultiUnitTabs>);\r\n    \r\n    const tabs = container.firstChild;\r\n    expect(tabs).toHaveClass('custom-class');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\NewTabModal.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\OverviewTab.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1641,1644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1641,1644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":59,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":59,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":59,"column":16,"nodeType":"Identifier","messageId":"unsafeCall","endLine":59,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1851,1854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1851,1854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":65,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":65,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":65,"column":16,"nodeType":"Identifier","messageId":"unsafeCall","endLine":65,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { OverviewTab } from '@/components/customizer/tabs/OverviewTab';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { useTabManagerStore } from '@/stores/useTabManagerStore';\r\n\r\n// Mock dependencies\r\njest.mock('@/stores/useUnitStore', () => ({\r\n  useUnitStore: jest.fn(),\r\n}));\r\n\r\njest.mock('@/stores/useTabManagerStore', () => ({\r\n  useTabManagerStore: jest.fn(),\r\n}));\r\n\r\njest.mock('@/components/customizer/shared/TechBaseConfiguration', () => ({\r\n  TechBaseConfiguration: () => <div data-testid=\"tech-base-config\" />,\r\n}));\r\n\r\ndescribe('OverviewTab', () => {\r\n  const mockStoreValues = {\r\n    id: 'unit-1',\r\n    chassis: 'Atlas',\r\n    clanName: '',\r\n    model: 'AS7-D',\r\n    mulId: '-1',\r\n    year: 2750,\r\n    rulesLevel: 'STANDARD',\r\n    techBaseMode: 'INNER_SPHERE',\r\n    componentTechBases: {},\r\n    engineType: 'Standard Fusion',\r\n    engineRating: 300,\r\n    gyroType: 'Standard',\r\n    internalStructureType: 'Standard',\r\n    cockpitType: 'Standard',\r\n    heatSinkType: 'Single',\r\n    heatSinkCount: 10,\r\n    armorType: 'Standard',\r\n    enhancement: null,\r\n    setChassis: jest.fn(),\r\n    setClanName: jest.fn(),\r\n    setModel: jest.fn(),\r\n    setMulId: jest.fn(),\r\n    setYear: jest.fn(),\r\n    setRulesLevel: jest.fn(),\r\n    setTechBaseMode: jest.fn(),\r\n    setComponentTechBase: jest.fn(),\r\n  };\r\n\r\n  const mockTabManager = {\r\n    renameTab: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (useUnitStore as jest.Mock).mockImplementation((selector: any) => {\r\n      if (typeof selector === 'function') {\r\n        return selector(mockStoreValues);\r\n      }\r\n      return undefined;\r\n    });\r\n    (useTabManagerStore as jest.Mock).mockImplementation((selector: any) => {\r\n      if (typeof selector === 'function') {\r\n        return selector(mockTabManager);\r\n      }\r\n      return undefined;\r\n    });\r\n  });\r\n\r\n  it('should render overview tab', () => {\r\n    render(<OverviewTab />);\r\n    \r\n    expect(screen.getByDisplayValue('Atlas')).toBeInTheDocument();\r\n    expect(screen.getByDisplayValue('AS7-D')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display unit information', () => {\r\n    render(<OverviewTab />);\r\n    \r\n    expect(screen.getByDisplayValue('Atlas')).toBeInTheDocument();\r\n    expect(screen.getByDisplayValue('2750')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render tech base configuration', () => {\r\n    render(<OverviewTab />);\r\n    \r\n    expect(screen.getByTestId('tech-base-config')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call setChassis when chassis changes', async () => {\r\n    const user = userEvent.setup();\r\n    render(<OverviewTab />);\r\n    \r\n    const chassisInput = screen.getByDisplayValue('Atlas');\r\n    await user.clear(chassisInput);\r\n    await user.type(chassisInput, 'Marauder');\r\n    \r\n    expect(mockStoreValues.setChassis).toHaveBeenCalled();\r\n  });\r\n\r\n  it('should display read-only message when in read-only mode', () => {\r\n    render(<OverviewTab readOnly={true} />);\r\n    \r\n    expect(screen.getByText(/read-only mode/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<OverviewTab className=\"custom-class\" />);\r\n    \r\n    const tab = container.firstChild;\r\n    expect(tab).toHaveClass('custom-class');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\StructureTab.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1573,1576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1573,1576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":63,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":63,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":63,"column":16,"nodeType":"Identifier","messageId":"unsafeCall","endLine":63,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport { StructureTab } from '@/components/customizer/tabs/StructureTab';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\n\r\n// Mock dependencies\r\njest.mock('@/stores/useUnitStore', () => ({\r\n  useUnitStore: jest.fn(),\r\n}));\r\n\r\njest.mock('@/hooks/useTechBaseSync', () => ({\r\n  useTechBaseSync: jest.fn(() => ({\r\n    filteredOptions: {\r\n      engine: [],\r\n      gyro: [],\r\n      structure: [],\r\n      cockpit: [],\r\n      heatSink: [],\r\n    },\r\n  })),\r\n}));\r\n\r\njest.mock('@/hooks/useUnitCalculations', () => ({\r\n  useUnitCalculations: jest.fn(() => ({\r\n    engineWeight: 10,\r\n    gyroWeight: 3,\r\n    structureWeight: 5,\r\n    cockpitWeight: 3,\r\n    heatSinkWeight: 0,\r\n    totalWeight: 21,\r\n  })),\r\n}));\r\n\r\ndescribe('StructureTab', () => {\r\n  const mockStoreValues = {\r\n    tonnage: 50,\r\n    walkMP: 5,\r\n    runMP: 8,\r\n    jumpMP: 0,\r\n    engineType: 'Standard Fusion',\r\n    engineRating: 250,\r\n    gyroType: 'Standard',\r\n    internalStructureType: 'Standard',\r\n    cockpitType: 'Standard',\r\n    heatSinkType: 'Single',\r\n    heatSinkCount: 10,\r\n    configuration: 'Biped',\r\n    setTonnage: jest.fn(),\r\n    setWalkMP: jest.fn(),\r\n    setEngineType: jest.fn(),\r\n    setGyroType: jest.fn(),\r\n    setInternalStructureType: jest.fn(),\r\n    setCockpitType: jest.fn(),\r\n    setHeatSinkType: jest.fn(),\r\n    setHeatSinkCount: jest.fn(),\r\n    setConfiguration: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    (useUnitStore as jest.Mock).mockImplementation((selector: any) => {\r\n      if (typeof selector === 'function') {\r\n        return selector(mockStoreValues);\r\n      }\r\n      return undefined;\r\n    });\r\n  });\r\n\r\n  it('should render structure tab', () => {\r\n    render(<StructureTab />);\r\n    \r\n    expect(screen.getByText(/Tonnage/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display unit tonnage', () => {\r\n    render(<StructureTab />);\r\n    \r\n    expect(screen.getByDisplayValue('50')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display movement stats', () => {\r\n    render(<StructureTab />);\r\n    \r\n    expect(screen.getByDisplayValue('5')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should display read-only message when in read-only mode', () => {\r\n    render(<StructureTab readOnly={true} />);\r\n    \r\n    expect(screen.getByText(/read-only mode/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<StructureTab className=\"custom-class\" />);\r\n    \r\n    const tab = container.firstChild;\r\n    expect(tab).toHaveClass('custom-class');\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\TabBar.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[368,371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[368,371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":9,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":9,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":9,"column":53,"nodeType":"Identifier","messageId":"anyAssignment","endLine":9,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":10,"column":24,"nodeType":"Identifier","messageId":"anyAssignment","endLine":10,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `any` value.","line":10,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":10,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":11,"column":24,"nodeType":"Identifier","messageId":"anyAssignment","endLine":11,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":12,"column":30,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":12,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":12,"column":30,"nodeType":"Identifier","messageId":"unsafeCall","endLine":12,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { TabBar, TabDisplayInfo } from '@/components/customizer/tabs/TabBar';\r\n\r\n// Mock UnitTab component\r\njest.mock('@/components/customizer/tabs/UnitTab', () => ({\r\n  UnitTab: ({ tab, isActive, onSelect, onClose, onRename }: any) => (\r\n    <div data-testid={`tab-${tab.id}`} data-active={isActive}>\r\n      <button onClick={onSelect}>{tab.name}</button>\r\n      <button onClick={onClose}></button>\r\n      <button onClick={() => onRename('Renamed')}>Rename</button>\r\n    </div>\r\n  ),\r\n}));\r\n\r\ndescribe('TabBar', () => {\r\n  const createTab = (overrides?: Partial<TabDisplayInfo>): TabDisplayInfo => ({\r\n    id: 'tab-1',\r\n    name: 'Unit 1',\r\n    isModified: false,\r\n    ...overrides,\r\n  });\r\n\r\n  const defaultProps = {\r\n    tabs: [createTab()],\r\n    activeTabId: 'tab-1',\r\n    onSelectTab: jest.fn(),\r\n    onCloseTab: jest.fn(),\r\n    onRenameTab: jest.fn(),\r\n    onNewTab: jest.fn(),\r\n    onLoadUnit: jest.fn(),\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  it('should render tabs', () => {\r\n    render(<TabBar {...defaultProps} />);\r\n    \r\n    expect(screen.getByTestId('tab-tab-1')).toBeInTheDocument();\r\n    expect(screen.getByText('Unit 1')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render multiple tabs', () => {\r\n    const tabs = [\r\n      createTab({ id: 'tab-1', name: 'Unit 1' }),\r\n      createTab({ id: 'tab-2', name: 'Unit 2' }),\r\n    ];\r\n    \r\n    render(<TabBar {...defaultProps} tabs={tabs} />);\r\n    \r\n    expect(screen.getByTestId('tab-tab-1')).toBeInTheDocument();\r\n    expect(screen.getByTestId('tab-tab-2')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should highlight active tab', () => {\r\n    render(<TabBar {...defaultProps} />);\r\n    \r\n    const tab = screen.getByTestId('tab-tab-1');\r\n    expect(tab).toHaveAttribute('data-active', 'true');\r\n  });\r\n\r\n  it('should not highlight inactive tab', () => {\r\n    render(<TabBar {...defaultProps} activeTabId=\"tab-2\" />);\r\n    \r\n    const tab = screen.getByTestId('tab-tab-1');\r\n    expect(tab).toHaveAttribute('data-active', 'false');\r\n  });\r\n\r\n  it('should call onSelectTab when tab is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TabBar {...defaultProps} />);\r\n    \r\n    const tabButton = screen.getByText('Unit 1');\r\n    await user.click(tabButton);\r\n    \r\n    expect(defaultProps.onSelectTab).toHaveBeenCalledWith('tab-1');\r\n  });\r\n\r\n  it('should call onCloseTab when close button is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TabBar {...defaultProps} />);\r\n    \r\n    const closeButton = screen.getByText('');\r\n    await user.click(closeButton);\r\n    \r\n    expect(defaultProps.onCloseTab).toHaveBeenCalledWith('tab-1');\r\n  });\r\n\r\n  it('should call onRenameTab when rename is triggered', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TabBar {...defaultProps} />);\r\n    \r\n    const renameButton = screen.getByText('Rename');\r\n    await user.click(renameButton);\r\n    \r\n    expect(defaultProps.onRenameTab).toHaveBeenCalledWith('tab-1', 'Renamed');\r\n  });\r\n\r\n  it('should call onNewTab when new tab button is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TabBar {...defaultProps} />);\r\n    \r\n    const newTabButton = screen.getByTitle(/Create New Unit/i);\r\n    await user.click(newTabButton);\r\n    \r\n    expect(defaultProps.onNewTab).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should call onLoadUnit when load unit button is clicked', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TabBar {...defaultProps} />);\r\n    \r\n    const loadButton = screen.getByTitle(/Load Unit/i);\r\n    await user.click(loadButton);\r\n    \r\n    expect(defaultProps.onLoadUnit).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('should apply custom className', () => {\r\n    const { container } = render(<TabBar {...defaultProps} className=\"custom-class\" />);\r\n    \r\n    const tabBar = container.firstChild;\r\n    expect(tabBar).toHaveClass('custom-class');\r\n  });\r\n\r\n  it('should handle empty tabs array', () => {\r\n    render(<TabBar {...defaultProps} tabs={[]} />);\r\n    \r\n    expect(screen.queryByTestId(/tab-/)).not.toBeInTheDocument();\r\n    expect(screen.getByTitle(/Create New Unit/i)).toBeInTheDocument();\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\customizer\\tabs\\UnitTab.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\ui\\Badge.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\ui\\Button.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\ui\\Card.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\ui\\Input.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\ui\\PageLayout.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\components\\ui\\StatDisplay.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\helpers\\assertions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\helpers\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\helpers\\storeTestHelpers.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateUnitId' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createNewUnitStore' is defined but never used.","line":23,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Store Test Helpers\r\n * \r\n * Utilities for testing Zustand stores, including localStorage mocking\r\n * and test factory functions.\r\n */\r\n\r\nimport { StoreApi } from 'zustand';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType } from '@/types/construction/CockpitType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\r\nimport { \r\n  UnitState, \r\n  UnitStore, \r\n  CreateUnitOptions,\r\n  createDefaultUnitState,\r\n  generateUnitId,\r\n} from '@/stores/unitState';\r\nimport { createUnitStore, createNewUnitStore } from '@/stores/useUnitStore';\r\nimport { IComponentTechBases, TechBaseMode, createDefaultComponentTechBases } from '@/types/construction/TechBaseConfiguration';\r\nimport { IComponentSelections } from '@/stores/useMultiUnitStore';\r\n\r\n// =============================================================================\r\n// LocalStorage Mock\r\n// =============================================================================\r\n\r\n/**\r\n * Mock localStorage implementation for testing\r\n */\r\nexport class MockLocalStorage implements Storage {\r\n  private store: Record<string, string> = {};\r\n  \r\n  get length(): number {\r\n    return Object.keys(this.store).length;\r\n  }\r\n  \r\n  clear(): void {\r\n    this.store = {};\r\n  }\r\n  \r\n  getItem(key: string): string | null {\r\n    return this.store[key] ?? null;\r\n  }\r\n  \r\n  key(index: number): string | null {\r\n    const keys = Object.keys(this.store);\r\n    return keys[index] ?? null;\r\n  }\r\n  \r\n  removeItem(key: string): void {\r\n    delete this.store[key];\r\n  }\r\n  \r\n  setItem(key: string, value: string): void {\r\n    this.store[key] = value;\r\n  }\r\n  \r\n  /**\r\n   * Get all stored keys (for testing)\r\n   */\r\n  getAllKeys(): string[] {\r\n    return Object.keys(this.store);\r\n  }\r\n  \r\n  /**\r\n   * Get raw store (for testing)\r\n   */\r\n  getRawStore(): Record<string, string> {\r\n    return { ...this.store };\r\n  }\r\n}\r\n\r\n/**\r\n * Setup mock localStorage for tests\r\n * Returns cleanup function\r\n */\r\nexport function setupMockLocalStorage(): { \r\n  mockStorage: MockLocalStorage; \r\n  cleanup: () => void;\r\n  originalLocalStorage: Storage;\r\n} {\r\n  const mockStorage = new MockLocalStorage();\r\n  const originalLocalStorage = global.localStorage;\r\n  \r\n  Object.defineProperty(global, 'localStorage', {\r\n    value: mockStorage,\r\n    configurable: true,\r\n    writable: true,\r\n  });\r\n  \r\n  return {\r\n    mockStorage,\r\n    originalLocalStorage,\r\n    cleanup: () => {\r\n      Object.defineProperty(global, 'localStorage', {\r\n        value: originalLocalStorage,\r\n        configurable: true,\r\n        writable: true,\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// Test Unit Factory\r\n// =============================================================================\r\n\r\n/**\r\n * Default test unit options\r\n */\r\nexport const DEFAULT_TEST_UNIT_OPTIONS: CreateUnitOptions = {\r\n  name: 'Test Mech',\r\n  tonnage: 50,\r\n  techBase: TechBase.INNER_SPHERE,\r\n  walkMP: 4,\r\n};\r\n\r\n/**\r\n * Create test unit options with overrides\r\n */\r\nexport function createTestUnitOptions(\r\n  overrides: Partial<CreateUnitOptions> = {}\r\n): CreateUnitOptions {\r\n  return {\r\n    ...DEFAULT_TEST_UNIT_OPTIONS,\r\n    ...overrides,\r\n  };\r\n}\r\n\r\n/**\r\n * Create a test unit state with overrides\r\n */\r\nexport function createTestUnitState(\r\n  overrides: Partial<CreateUnitOptions & Partial<UnitState>> = {}\r\n): UnitState {\r\n  const options = createTestUnitOptions(overrides);\r\n  const defaultState = createDefaultUnitState(options);\r\n  \r\n  // Apply any direct state overrides\r\n  return {\r\n    ...defaultState,\r\n    ...(overrides.engineType !== undefined && { engineType: overrides.engineType }),\r\n    ...(overrides.gyroType !== undefined && { gyroType: overrides.gyroType }),\r\n    ...(overrides.internalStructureType !== undefined && { internalStructureType: overrides.internalStructureType }),\r\n    ...(overrides.cockpitType !== undefined && { cockpitType: overrides.cockpitType }),\r\n    ...(overrides.heatSinkType !== undefined && { heatSinkType: overrides.heatSinkType }),\r\n    ...(overrides.heatSinkCount !== undefined && { heatSinkCount: overrides.heatSinkCount }),\r\n    ...(overrides.armorType !== undefined && { armorType: overrides.armorType }),\r\n  } as UnitState;\r\n}\r\n\r\n/**\r\n * Create a test store with optional overrides\r\n */\r\nexport function createTestStore(\r\n  overrides: Partial<CreateUnitOptions & Partial<UnitState>> = {}\r\n): StoreApi<UnitStore> {\r\n  const state = createTestUnitState(overrides);\r\n  return createUnitStore(state);\r\n}\r\n\r\n/**\r\n * Create an Inner Sphere test store\r\n */\r\nexport function createISTestStore(\r\n  overrides: Partial<CreateUnitOptions & Partial<UnitState>> = {}\r\n): StoreApi<UnitStore> {\r\n  return createTestStore({\r\n    techBase: TechBase.INNER_SPHERE,\r\n    ...overrides,\r\n  });\r\n}\r\n\r\n/**\r\n * Create a Clan test store\r\n */\r\nexport function createClanTestStore(\r\n  overrides: Partial<CreateUnitOptions & Partial<UnitState>> = {}\r\n): StoreApi<UnitStore> {\r\n  return createTestStore({\r\n    techBase: TechBase.CLAN,\r\n    ...overrides,\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Component Tech Bases Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Create Inner Sphere component tech bases\r\n */\r\nexport function createISComponentTechBases(): IComponentTechBases {\r\n  return createDefaultComponentTechBases(TechBase.INNER_SPHERE);\r\n}\r\n\r\n/**\r\n * Create Clan component tech bases\r\n */\r\nexport function createClanComponentTechBases(): IComponentTechBases {\r\n  return createDefaultComponentTechBases(TechBase.CLAN);\r\n}\r\n\r\n/**\r\n * Create mixed component tech bases\r\n */\r\nexport function createMixedComponentTechBases(): IComponentTechBases {\r\n  return {\r\n    chassis: TechBase.INNER_SPHERE,\r\n    gyro: TechBase.INNER_SPHERE,\r\n    engine: TechBase.CLAN,\r\n    heatsink: TechBase.CLAN,\r\n    targeting: TechBase.INNER_SPHERE,\r\n    myomer: TechBase.INNER_SPHERE,\r\n    movement: TechBase.INNER_SPHERE,\r\n    armor: TechBase.CLAN,\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// Component Selections Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Create default IS component selections\r\n */\r\nexport function createISComponentSelections(tonnage: number = 50): IComponentSelections {\r\n  return {\r\n    engineType: EngineType.STANDARD,\r\n    engineRating: tonnage * 4, // Walk 4\r\n    gyroType: GyroType.STANDARD,\r\n    internalStructureType: InternalStructureType.STANDARD,\r\n    cockpitType: CockpitType.STANDARD,\r\n    heatSinkType: HeatSinkType.SINGLE,\r\n    heatSinkCount: 10,\r\n    armorType: ArmorTypeEnum.STANDARD,\r\n  };\r\n}\r\n\r\n/**\r\n * Create IS component selections with XL engine\r\n */\r\nexport function createISXLComponentSelections(tonnage: number = 50): IComponentSelections {\r\n  return {\r\n    ...createISComponentSelections(tonnage),\r\n    engineType: EngineType.XL_IS,\r\n    heatSinkType: HeatSinkType.DOUBLE_IS,\r\n    internalStructureType: InternalStructureType.ENDO_STEEL_IS,\r\n    armorType: ArmorTypeEnum.FERRO_FIBROUS_IS,\r\n  };\r\n}\r\n\r\n/**\r\n * Create Clan component selections\r\n */\r\nexport function createClanComponentSelections(tonnage: number = 50): IComponentSelections {\r\n  return {\r\n    engineType: EngineType.XL_CLAN,\r\n    engineRating: tonnage * 4, // Walk 4\r\n    gyroType: GyroType.STANDARD,\r\n    internalStructureType: InternalStructureType.ENDO_STEEL_CLAN,\r\n    cockpitType: CockpitType.STANDARD,\r\n    heatSinkType: HeatSinkType.DOUBLE_CLAN,\r\n    heatSinkCount: 10,\r\n    armorType: ArmorTypeEnum.FERRO_FIBROUS_CLAN,\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// Assertion Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Assert all component tech bases match expected tech base\r\n */\r\nexport function expectAllComponentTechBases(\r\n  componentTechBases: IComponentTechBases,\r\n  expectedTechBase: TechBase\r\n): void {\r\n  expect(componentTechBases.chassis).toBe(expectedTechBase);\r\n  expect(componentTechBases.gyro).toBe(expectedTechBase);\r\n  expect(componentTechBases.engine).toBe(expectedTechBase);\r\n  expect(componentTechBases.heatsink).toBe(expectedTechBase);\r\n  expect(componentTechBases.targeting).toBe(expectedTechBase);\r\n  expect(componentTechBases.myomer).toBe(expectedTechBase);\r\n  expect(componentTechBases.movement).toBe(expectedTechBase);\r\n  expect(componentTechBases.armor).toBe(expectedTechBase);\r\n}\r\n\r\n/**\r\n * Assert store state has expected tech base mode\r\n */\r\nexport function expectTechBaseMode(\r\n  store: StoreApi<UnitStore>,\r\n  expectedMode: TechBaseMode\r\n): void {\r\n  expect(store.getState().techBaseMode).toBe(expectedMode);\r\n}\r\n\r\n// =============================================================================\r\n// Reset Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Clear the unit store registry\r\n * Import this dynamically to avoid circular dependencies\r\n */\r\nexport async function clearStoreRegistry(): Promise<void> {\r\n  const { clearAllStores } = await import('@/stores/unitStoreRegistry');\r\n  clearAllStores(true);\r\n}\r\n\r\n/**\r\n * Reset all test state\r\n */\r\nexport async function resetTestState(mockStorage?: MockLocalStorage): Promise<void> {\r\n  if (mockStorage) {\r\n    mockStorage.clear();\r\n  }\r\n  await clearStoreRegistry();\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\helpers\\testMechBuilder.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\hooks\\useEquipmentCalculations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\hooks\\useKeyboardNavigation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\hooks\\useTechBaseSync.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\hooks\\useUnitCalculations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\integration\\dataLoading\\EquipmentLoading.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":65,"column":22,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":65,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":92,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":92,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":115,"column":11,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":115,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":179,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":179,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":223,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":223,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":260,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":260,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment Loading Integration Tests\n * \n * Tests that equipment data loads correctly from JSON files.\n * Validates file structure, content integrity, and service integration.\n * \n * @spec openspec/specs/data-loading-architecture/spec.md\n * @spec openspec/specs/equipment-services/spec.md\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nconst DATA_PATH = path.join(__dirname, '../../../../public/data/equipment');\nconst OFFICIAL_PATH = path.join(DATA_PATH, 'official');\nconst SCHEMA_PATH = path.join(DATA_PATH, '_schema');\n\ndescribe('Equipment Data Loading', () => {\n  \n  // ============================================================================\n  // Directory Structure\n  // ============================================================================\n  describe('Directory Structure', () => {\n    it('should have equipment data directory', () => {\n      expect(fs.existsSync(DATA_PATH)).toBe(true);\n    });\n\n    it('should have official equipment directory', () => {\n      expect(fs.existsSync(OFFICIAL_PATH)).toBe(true);\n    });\n\n    it('should have schema directory', () => {\n      expect(fs.existsSync(SCHEMA_PATH)).toBe(true);\n    });\n\n    it('should have weapons subdirectory', () => {\n      expect(fs.existsSync(path.join(OFFICIAL_PATH, 'weapons'))).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // Equipment JSON Files\n  // ============================================================================\n  describe('Equipment JSON Files', () => {\n    const expectedFiles = [\n      'weapons/energy.json',\n      'weapons/ballistic.json',\n      'weapons/missile.json',\n      'weapons/physical.json',\n      'ammunition.json',\n      'electronics.json',\n      'miscellaneous.json',\n      'index.json',\n    ];\n\n    expectedFiles.forEach(file => {\n      it(`should have ${file}`, () => {\n        const filePath = path.join(OFFICIAL_PATH, file);\n        expect(fs.existsSync(filePath)).toBe(true);\n      });\n\n      it(`${file} should be valid JSON`, () => {\n        const filePath = path.join(OFFICIAL_PATH, file);\n        const content = fs.readFileSync(filePath, 'utf-8');\n        expect(() => JSON.parse(content)).not.toThrow();\n      });\n    });\n  });\n\n  // ============================================================================\n  // Schema Files\n  // ============================================================================\n  describe('Schema Files', () => {\n    const expectedSchemas = [\n      'weapon-schema.json',\n      'ammunition-schema.json',\n      'electronics-schema.json',\n      'misc-equipment-schema.json',\n      'physical-weapon-schema.json',\n      'unit-schema.json',\n    ];\n\n    expectedSchemas.forEach(schema => {\n      it(`should have ${schema}`, () => {\n        const schemaPath = path.join(SCHEMA_PATH, schema);\n        expect(fs.existsSync(schemaPath)).toBe(true);\n      });\n\n      it(`${schema} should be valid JSON Schema`, () => {\n        const schemaPath = path.join(SCHEMA_PATH, schema);\n        const content = fs.readFileSync(schemaPath, 'utf-8');\n        const parsed = JSON.parse(content);\n        \n        // Basic JSON Schema requirements\n        expect(parsed).toHaveProperty('$schema');\n        expect(parsed).toHaveProperty('type');\n      });\n    });\n  });\n\n  // ============================================================================\n  // Weapon Data Validation\n  // ============================================================================\n  describe('Weapon Data Validation', () => {\n    const weaponFiles = ['energy.json', 'ballistic.json', 'missile.json'];\n\n    weaponFiles.forEach(file => {\n      describe(file, () => {\n        let fileData: { items: unknown[]; count: number };\n        let weapons: unknown[];\n\n        beforeAll(() => {\n          const filePath = path.join(OFFICIAL_PATH, 'weapons', file);\n          const content = fs.readFileSync(filePath, 'utf-8');\n          fileData = JSON.parse(content);\n          weapons = fileData.items;\n        });\n\n        it('should have items array', () => {\n          expect(fileData).toHaveProperty('items');\n          expect(Array.isArray(weapons)).toBe(true);\n        });\n\n        it('should be a non-empty array', () => {\n          expect(weapons.length).toBeGreaterThan(0);\n        });\n\n        it('count should match items length', () => {\n          expect(fileData.count).toBe(weapons.length);\n        });\n\n        it('each weapon should have required fields', () => {\n          for (const weapon of weapons as Record<string, unknown>[]) {\n            expect(weapon).toHaveProperty('id');\n            expect(weapon).toHaveProperty('name');\n            expect(weapon).toHaveProperty('category');\n            expect(weapon).toHaveProperty('techBase');\n            expect(weapon).toHaveProperty('rulesLevel');\n            expect(weapon).toHaveProperty('damage');\n            expect(weapon).toHaveProperty('heat');\n            expect(weapon).toHaveProperty('weight');\n            expect(weapon).toHaveProperty('criticalSlots');\n          }\n        });\n\n        it('each weapon should have valid techBase', () => {\n          const validTechBases = ['INNER_SPHERE', 'CLAN', 'BOTH'];\n          for (const weapon of weapons as Record<string, unknown>[]) {\n            expect(validTechBases).toContain(weapon.techBase);\n          }\n        });\n\n        it('each weapon should have valid rulesLevel', () => {\n          const validRulesLevels = ['INTRODUCTORY', 'STANDARD', 'ADVANCED', 'EXPERIMENTAL'];\n          for (const weapon of weapons as Record<string, unknown>[]) {\n            expect(validRulesLevels).toContain(weapon.rulesLevel);\n          }\n        });\n\n        it('each weapon ID should be unique', () => {\n          const ids = (weapons as Record<string, unknown>[]).map(w => w.id);\n          const uniqueIds = new Set(ids);\n          expect(uniqueIds.size).toBe(ids.length);\n        });\n      });\n    });\n  });\n\n  // ============================================================================\n  // Ammunition Data Validation\n  // ============================================================================\n  describe('Ammunition Data Validation', () => {\n    let fileData: { items: unknown[]; count: number };\n    let ammunition: unknown[];\n\n    beforeAll(() => {\n      const filePath = path.join(OFFICIAL_PATH, 'ammunition.json');\n      const content = fs.readFileSync(filePath, 'utf-8');\n      fileData = JSON.parse(content);\n      ammunition = fileData.items;\n    });\n\n    it('should have items array', () => {\n      expect(fileData).toHaveProperty('items');\n      expect(Array.isArray(ammunition)).toBe(true);\n    });\n\n    it('should be a non-empty array', () => {\n      expect(ammunition.length).toBeGreaterThan(0);\n    });\n\n    it('count should match items length', () => {\n      expect(fileData.count).toBe(ammunition.length);\n    });\n\n    it('each ammo should have required fields', () => {\n      for (const ammo of ammunition as Record<string, unknown>[]) {\n        expect(ammo).toHaveProperty('id');\n        expect(ammo).toHaveProperty('name');\n        expect(ammo).toHaveProperty('techBase');\n        expect(ammo).toHaveProperty('shotsPerTon');\n        expect(ammo).toHaveProperty('weight');\n      }\n    });\n\n    it('each ammo ID should be unique', () => {\n      const ids = (ammunition as Record<string, unknown>[]).map(a => a.id);\n      const uniqueIds = new Set(ids);\n      expect(uniqueIds.size).toBe(ids.length);\n    });\n  });\n\n  // ============================================================================\n  // Electronics Data Validation\n  // ============================================================================\n  describe('Electronics Data Validation', () => {\n    let fileData: { items: unknown[]; count: number };\n    let electronics: unknown[];\n\n    beforeAll(() => {\n      const filePath = path.join(OFFICIAL_PATH, 'electronics.json');\n      const content = fs.readFileSync(filePath, 'utf-8');\n      fileData = JSON.parse(content);\n      electronics = fileData.items;\n    });\n\n    it('should have items array', () => {\n      expect(fileData).toHaveProperty('items');\n      expect(Array.isArray(electronics)).toBe(true);\n    });\n\n    it('should be a non-empty array', () => {\n      expect(electronics.length).toBeGreaterThan(0);\n    });\n\n    it('count should match items length', () => {\n      expect(fileData.count).toBe(electronics.length);\n    });\n\n    it('each electronics should have required fields', () => {\n      for (const item of electronics as Record<string, unknown>[]) {\n        expect(item).toHaveProperty('id');\n        expect(item).toHaveProperty('name');\n        expect(item).toHaveProperty('techBase');\n        expect(item).toHaveProperty('weight');\n        expect(item).toHaveProperty('criticalSlots');\n      }\n    });\n  });\n\n  // ============================================================================\n  // Index File Validation\n  // ============================================================================\n  describe('Index File Validation', () => {\n    let index: Record<string, unknown>;\n\n    beforeAll(() => {\n      const filePath = path.join(OFFICIAL_PATH, 'index.json');\n      const content = fs.readFileSync(filePath, 'utf-8');\n      index = JSON.parse(content);\n    });\n\n    it('should have version field', () => {\n      expect(index).toHaveProperty('version');\n    });\n\n    it('should have generatedAt timestamp', () => {\n      expect(index).toHaveProperty('generatedAt');\n    });\n\n    it('should have files object', () => {\n      expect(index).toHaveProperty('files');\n      expect(typeof index.files).toBe('object');\n    });\n\n    it('should have totalItems object', () => {\n      expect(index).toHaveProperty('totalItems');\n      expect(typeof index.totalItems).toBe('object');\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\integration\\dataLoading\\UnitFactoryService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\integration\\dataLoading\\UnitLoading.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":94,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":94,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":170,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":170,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":250,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":250,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":292,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":292,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":293,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":293,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .armor on an `any` value.","line":293,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":293,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Unit Loading Integration Tests\n * \n * Tests that unit data loads correctly from JSON files.\n * Validates era-based directory structure, file format, and index integrity.\n * \n * @spec openspec/specs/data-loading-architecture/spec.md\n * @spec openspec/specs/unit-services/spec.md\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nconst UNITS_PATH = path.join(__dirname, '../../../../public/data/units/battlemechs');\n\ndescribe('Unit Data Loading', () => {\n  \n  // ============================================================================\n  // Directory Structure\n  // ============================================================================\n  describe('Directory Structure', () => {\n    it('should have battlemechs directory', () => {\n      expect(fs.existsSync(UNITS_PATH)).toBe(true);\n    });\n\n    const expectedEras = [\n      '1-age-of-war',\n      '2-star-league',\n      '3-succession-wars',\n      '4-clan-invasion',\n      '5-civil-war',\n      '6-dark-age',\n    ];\n\n    expectedEras.forEach(era => {\n      it(`should have ${era} era folder`, () => {\n        const eraPath = path.join(UNITS_PATH, era);\n        expect(fs.existsSync(eraPath)).toBe(true);\n      });\n    });\n\n    it('era folders should be numbered chronologically', () => {\n      const dirs = fs.readdirSync(UNITS_PATH)\n        .filter(f => fs.statSync(path.join(UNITS_PATH, f)).isDirectory())\n        .filter(f => /^\\d+-/.test(f));\n      \n      // Check ordering\n      for (let i = 0; i < dirs.length - 1; i++) {\n        const currentNum = parseInt(dirs[i].split('-')[0]);\n        const nextNum = parseInt(dirs[i + 1].split('-')[0]);\n        expect(currentNum).toBeLessThan(nextNum);\n      }\n    });\n  });\n\n  // ============================================================================\n  // Rules Level Sub-directories\n  // ============================================================================\n  describe('Rules Level Sub-directories', () => {\n    const era = '3-succession-wars'; // Use one with all rules levels\n    const expectedRulesLevels = ['standard', 'advanced', 'experimental'];\n\n    expectedRulesLevels.forEach(rulesLevel => {\n      it(`should have ${rulesLevel} sub-folder in ${era}`, () => {\n        const rulesPath = path.join(UNITS_PATH, era, rulesLevel);\n        expect(fs.existsSync(rulesPath)).toBe(true);\n      });\n    });\n  });\n\n  // ============================================================================\n  // Master Index File\n  // ============================================================================\n  describe('Master Index File', () => {\n    let index: {\n      version: string;\n      generatedAt: string;\n      totalUnits: number;\n      units: Array<{\n        id: string;\n        chassis: string;\n        model: string;\n        tonnage: number;\n        techBase: string;\n        year: number;\n        role: string;\n        path: string;\n      }>;\n    };\n\n    beforeAll(() => {\n      const indexPath = path.join(UNITS_PATH, 'index.json');\n      const content = fs.readFileSync(indexPath, 'utf-8');\n      index = JSON.parse(content);\n    });\n\n    it('should exist', () => {\n      const indexPath = path.join(UNITS_PATH, 'index.json');\n      expect(fs.existsSync(indexPath)).toBe(true);\n    });\n\n    it('should have version field', () => {\n      expect(index).toHaveProperty('version');\n      expect(typeof index.version).toBe('string');\n    });\n\n    it('should have generatedAt timestamp', () => {\n      expect(index).toHaveProperty('generatedAt');\n      expect(typeof index.generatedAt).toBe('string');\n    });\n\n    it('should have totalUnits count', () => {\n      expect(index).toHaveProperty('totalUnits');\n      expect(typeof index.totalUnits).toBe('number');\n      expect(index.totalUnits).toBeGreaterThan(0);\n    });\n\n    it('should have units array matching totalUnits', () => {\n      expect(index).toHaveProperty('units');\n      expect(Array.isArray(index.units)).toBe(true);\n      expect(index.units.length).toBe(index.totalUnits);\n    });\n\n    it('each unit entry should have required fields', () => {\n      // Check first 50 units for performance\n      const sample = index.units.slice(0, 50);\n      for (const unit of sample) {\n        expect(unit).toHaveProperty('id');\n        expect(unit).toHaveProperty('chassis');\n        expect(unit).toHaveProperty('model');\n        expect(unit).toHaveProperty('tonnage');\n        expect(unit).toHaveProperty('techBase');\n        expect(unit).toHaveProperty('year');\n        expect(unit).toHaveProperty('path');\n      }\n    });\n\n    it('unit IDs should be unique', () => {\n      const ids = index.units.map(u => u.id);\n      const uniqueIds = new Set(ids);\n      expect(uniqueIds.size).toBe(ids.length);\n    });\n\n    it('unit paths should point to existing files', () => {\n      // Check a sample of paths for performance\n      const sample = index.units.slice(0, 20);\n      for (const unit of sample) {\n        const fullPath = path.join(UNITS_PATH, unit.path);\n        expect(fs.existsSync(fullPath)).toBe(true);\n      }\n    });\n  });\n\n  // ============================================================================\n  // Unit File Format Validation\n  // ============================================================================\n  describe('Unit File Format Validation', () => {\n    // Find a sample unit file to validate\n    const sampleUnitPath = path.join(UNITS_PATH, '2-star-league/standard/Atlas AS7-D.json');\n\n    it('sample unit file should exist', () => {\n      expect(fs.existsSync(sampleUnitPath)).toBe(true);\n    });\n\n    describe('ISerializedUnit Schema Compliance', () => {\n      let unit: Record<string, unknown>;\n\n      beforeAll(() => {\n        const content = fs.readFileSync(sampleUnitPath, 'utf-8');\n        unit = JSON.parse(content);\n      });\n\n      it('should have identity fields', () => {\n        expect(unit).toHaveProperty('id');\n        expect(unit).toHaveProperty('chassis');\n        expect(unit).toHaveProperty('model');\n      });\n\n      it('should have classification fields', () => {\n        expect(unit).toHaveProperty('unitType');\n        expect(unit).toHaveProperty('configuration');\n        expect(unit).toHaveProperty('techBase');\n        expect(unit).toHaveProperty('rulesLevel');\n        expect(unit).toHaveProperty('era');\n        expect(unit).toHaveProperty('year');\n        expect(unit).toHaveProperty('tonnage');\n      });\n\n      it('should have engine configuration', () => {\n        expect(unit).toHaveProperty('engine');\n        const engine = unit.engine as Record<string, unknown>;\n        expect(engine).toHaveProperty('type');\n        expect(engine).toHaveProperty('rating');\n      });\n\n      it('should have gyro configuration', () => {\n        expect(unit).toHaveProperty('gyro');\n        const gyro = unit.gyro as Record<string, unknown>;\n        expect(gyro).toHaveProperty('type');\n      });\n\n      it('should have structure configuration', () => {\n        expect(unit).toHaveProperty('structure');\n        const structure = unit.structure as Record<string, unknown>;\n        expect(structure).toHaveProperty('type');\n      });\n\n      it('should have armor configuration', () => {\n        expect(unit).toHaveProperty('armor');\n        const armor = unit.armor as Record<string, unknown>;\n        expect(armor).toHaveProperty('type');\n        expect(armor).toHaveProperty('allocation');\n      });\n\n      it('should have heat sink configuration', () => {\n        expect(unit).toHaveProperty('heatSinks');\n        const heatSinks = unit.heatSinks as Record<string, unknown>;\n        expect(heatSinks).toHaveProperty('type');\n        expect(heatSinks).toHaveProperty('count');\n      });\n\n      it('should have movement configuration', () => {\n        expect(unit).toHaveProperty('movement');\n        const movement = unit.movement as Record<string, unknown>;\n        expect(movement).toHaveProperty('walk');\n        expect(movement).toHaveProperty('jump');\n      });\n\n      it('should have equipment array', () => {\n        expect(unit).toHaveProperty('equipment');\n        expect(Array.isArray(unit.equipment)).toBe(true);\n      });\n\n      it('should have critical slots', () => {\n        expect(unit).toHaveProperty('criticalSlots');\n        expect(typeof unit.criticalSlots).toBe('object');\n      });\n    });\n  });\n\n  // ============================================================================\n  // Critical Slot Format Validation\n  // ============================================================================\n  describe('Critical Slot Format', () => {\n    let unit: Record<string, unknown>;\n\n    beforeAll(() => {\n      const samplePath = path.join(UNITS_PATH, '2-star-league/standard/Atlas AS7-D.json');\n      const content = fs.readFileSync(samplePath, 'utf-8');\n      unit = JSON.parse(content);\n    });\n\n    it('should have correct slot counts per location', () => {\n      const criticalSlots = unit.criticalSlots as Record<string, (string | null)[]>;\n      \n      // Head and legs should have 6 slots\n      expect(criticalSlots.HEAD.length).toBe(6);\n      expect(criticalSlots.LEFT_LEG.length).toBe(6);\n      expect(criticalSlots.RIGHT_LEG.length).toBe(6);\n      \n      // Arms and torsos should have 12 slots\n      expect(criticalSlots.LEFT_ARM.length).toBe(12);\n      expect(criticalSlots.RIGHT_ARM.length).toBe(12);\n      expect(criticalSlots.LEFT_TORSO.length).toBe(12);\n      expect(criticalSlots.RIGHT_TORSO.length).toBe(12);\n      expect(criticalSlots.CENTER_TORSO.length).toBe(12);\n    });\n\n    it('each slot should be string or null', () => {\n      const criticalSlots = unit.criticalSlots as Record<string, (string | null)[]>;\n      \n      for (const location of Object.keys(criticalSlots)) {\n        for (const slot of criticalSlots[location]) {\n          expect(slot === null || typeof slot === 'string').toBe(true);\n        }\n      }\n    });\n  });\n\n  // ============================================================================\n  // Armor Allocation Format\n  // ============================================================================\n  describe('Armor Allocation Format', () => {\n    let armor: {\n      type: string;\n      allocation: Record<string, number | { front: number; rear: number }>;\n    };\n\n    beforeAll(() => {\n      const samplePath = path.join(UNITS_PATH, '2-star-league/standard/Atlas AS7-D.json');\n      const content = fs.readFileSync(samplePath, 'utf-8');\n      const unit = JSON.parse(content);\n      armor = unit.armor;\n    });\n\n    it('should have armor type', () => {\n      expect(armor).toHaveProperty('type');\n      expect(typeof armor.type).toBe('string');\n    });\n\n    it('non-torso locations should have integer values', () => {\n      expect(typeof armor.allocation.HEAD).toBe('number');\n      expect(typeof armor.allocation.LEFT_ARM).toBe('number');\n      expect(typeof armor.allocation.RIGHT_ARM).toBe('number');\n      expect(typeof armor.allocation.LEFT_LEG).toBe('number');\n      expect(typeof armor.allocation.RIGHT_LEG).toBe('number');\n    });\n\n    it('torso locations should have front/rear object', () => {\n      const leftTorso = armor.allocation.LEFT_TORSO as { front: number; rear: number };\n      expect(leftTorso).toHaveProperty('front');\n      expect(leftTorso).toHaveProperty('rear');\n      expect(typeof leftTorso.front).toBe('number');\n      expect(typeof leftTorso.rear).toBe('number');\n    });\n  });\n\n  // ============================================================================\n  // Era Distribution\n  // ============================================================================\n  describe('Era Distribution', () => {\n    it('should have units in each era', () => {\n      const eras = fs.readdirSync(UNITS_PATH)\n        .filter(f => fs.statSync(path.join(UNITS_PATH, f)).isDirectory())\n        .filter(f => /^\\d+-/.test(f));\n\n      for (const era of eras) {\n        const eraPath = path.join(UNITS_PATH, era);\n        let unitCount = 0;\n\n        // Count units in all rules level subdirs\n        for (const rulesLevel of ['standard', 'advanced', 'experimental']) {\n          const rulesPath = path.join(eraPath, rulesLevel);\n          if (fs.existsSync(rulesPath)) {\n            const files = fs.readdirSync(rulesPath).filter(f => f.endsWith('.json'));\n            unitCount += files.length;\n          }\n        }\n\n        expect(unitCount).toBeGreaterThan(0);\n      }\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\integration\\dataLoading\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\integration\\techBaseSwitching.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createISComponentTechBases' is defined but never used.","line":37,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createClanComponentTechBases' is defined but never used.","line":38,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tech Base Switching Integration Tests\r\n * \r\n * End-to-end tests for tech base switching scenarios, verifying that\r\n * switching between Inner Sphere and Clan correctly:\r\n * - Filters available components\r\n * - Replaces incompatible selections\r\n * - Updates critical slot calculations\r\n * - Maintains state integrity across stores\r\n * \r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport { act } from '@testing-library/react';\r\nimport { renderHook } from '@testing-library/react';\r\nimport { useTabManagerStore, UNIT_TEMPLATES } from '@/stores/useTabManagerStore';\r\nimport { \r\n  clearAllStores, \r\n  getUnitStore, \r\n  createAndRegisterUnit,\r\n  duplicateUnit,\r\n} from '@/stores/unitStoreRegistry';\r\nimport { useTechBaseSync } from '@/hooks/useTechBaseSync';\r\nimport { useUnitCalculations } from '@/hooks/useUnitCalculations';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { TechBaseMode, TechBaseComponent } from '@/types/construction/TechBaseConfiguration';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType } from '@/types/construction/CockpitType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\r\nimport { IComponentSelections } from '@/stores/useMultiUnitStore';\r\nimport {\r\n  setupMockLocalStorage,\r\n  expectAllComponentTechBases,\r\n  createISComponentTechBases,\r\n  createClanComponentTechBases,\r\n} from '../helpers/storeTestHelpers';\r\n\r\ndescribe('Tech Base Switching Integration', () => {\r\n  let mockStorage: ReturnType<typeof setupMockLocalStorage>;\r\n  \r\n  beforeEach(() => {\r\n    mockStorage = setupMockLocalStorage();\r\n    clearAllStores(true);\r\n    useTabManagerStore.setState({\r\n      tabs: [],\r\n      activeTabId: null,\r\n      isLoading: false,\r\n      isNewTabModalOpen: false,\r\n    });\r\n  });\r\n  \r\n  afterEach(() => {\r\n    clearAllStores(true);\r\n    mockStorage.cleanup();\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Scenario 1: Create IS Unit -> Switch to Clan\r\n  // ===========================================================================\r\n  describe('Scenario: IS Unit Switches to Clan', () => {\r\n    it('should reset all componentTechBases to Clan', () => {\r\n      // Create IS unit\r\n      const store = createAndRegisterUnit({\r\n        name: 'IS Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      // Verify initial IS state\r\n      expectAllComponentTechBases(store.getState().componentTechBases, TechBase.INNER_SPHERE);\r\n      expect(store.getState().techBaseMode).toBe(TechBaseMode.INNER_SPHERE);\r\n      \r\n      // Switch to Clan\r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n      });\r\n      \r\n      // Verify Clan state\r\n      expectAllComponentTechBases(store.getState().componentTechBases, TechBase.CLAN);\r\n      expect(store.getState().techBaseMode).toBe(TechBaseMode.CLAN);\r\n    });\r\n    \r\n    it('should invalidate IS-only engine selection when switching to Clan', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'IS Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      // Set IS-only XL engine\r\n      act(() => {\r\n        store.getState().setEngineType(EngineType.XL_IS);\r\n      });\r\n      \r\n      expect(store.getState().engineType).toBe(EngineType.XL_IS);\r\n      \r\n      // Switch to Clan mode\r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n      });\r\n      \r\n      // Use tech base sync to validate\r\n      const { result } = renderHook(() => \r\n        useTechBaseSync(store.getState().componentTechBases)\r\n      );\r\n      \r\n      // XL_IS should no longer be valid\r\n      expect(result.current.isEngineValid(EngineType.XL_IS)).toBe(false);\r\n      expect(result.current.isEngineValid(EngineType.XL_CLAN)).toBe(true);\r\n    });\r\n    \r\n    it('should invalidate IS Endo Steel when switching to Clan', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'IS Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      // Set IS Endo Steel\r\n      act(() => {\r\n        store.getState().setInternalStructureType(InternalStructureType.ENDO_STEEL_IS);\r\n      });\r\n      \r\n      // Switch to Clan mode\r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n      });\r\n      \r\n      const { result } = renderHook(() => \r\n        useTechBaseSync(store.getState().componentTechBases)\r\n      );\r\n      \r\n      expect(result.current.isStructureValid(InternalStructureType.ENDO_STEEL_IS)).toBe(false);\r\n      expect(result.current.isStructureValid(InternalStructureType.ENDO_STEEL_CLAN)).toBe(true);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Scenario 2: Create Clan Unit -> Add Clan XL -> Switch to IS\r\n  // ===========================================================================\r\n  describe('Scenario: Clan Unit with XL Engine Switches to IS', () => {\r\n    it('should invalidate Clan XL engine when switching to IS', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'Clan Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.CLAN,\r\n      });\r\n      \r\n      // Set Clan XL engine\r\n      act(() => {\r\n        store.getState().setEngineType(EngineType.XL_CLAN);\r\n      });\r\n      \r\n      expect(store.getState().engineType).toBe(EngineType.XL_CLAN);\r\n      \r\n      // Switch to IS mode\r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.INNER_SPHERE);\r\n      });\r\n      \r\n      const { result } = renderHook(() => \r\n        useTechBaseSync(store.getState().componentTechBases)\r\n      );\r\n      \r\n      // Clan XL should no longer be valid\r\n      expect(result.current.isEngineValid(EngineType.XL_CLAN)).toBe(false);\r\n      expect(result.current.isEngineValid(EngineType.XL_IS)).toBe(true);\r\n    });\r\n    \r\n    it('should provide validated selections replacing Clan components with IS defaults', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'Clan Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.CLAN,\r\n      });\r\n      \r\n      // Set full Clan build\r\n      act(() => {\r\n        store.getState().setEngineType(EngineType.XL_CLAN);\r\n        store.getState().setInternalStructureType(InternalStructureType.ENDO_STEEL_CLAN);\r\n        store.getState().setHeatSinkType(HeatSinkType.DOUBLE_CLAN);\r\n        store.getState().setArmorType(ArmorTypeEnum.FERRO_FIBROUS_CLAN);\r\n      });\r\n      \r\n      // Switch to IS mode\r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.INNER_SPHERE);\r\n      });\r\n      \r\n      const { result } = renderHook(() => \r\n        useTechBaseSync(store.getState().componentTechBases)\r\n      );\r\n      \r\n      const currentSelections: IComponentSelections = {\r\n        engineType: store.getState().engineType,\r\n        engineRating: store.getState().engineRating,\r\n        gyroType: store.getState().gyroType,\r\n        internalStructureType: store.getState().internalStructureType,\r\n        cockpitType: store.getState().cockpitType,\r\n        heatSinkType: store.getState().heatSinkType,\r\n        heatSinkCount: store.getState().heatSinkCount,\r\n        armorType: store.getState().armorType,\r\n      };\r\n      \r\n      const validated = result.current.getValidatedSelections(currentSelections);\r\n      \r\n      // All Clan-specific components should be replaced with defaults\r\n      expect(validated.engineType).toBe(EngineType.STANDARD);\r\n      expect(validated.internalStructureType).toBe(InternalStructureType.STANDARD);\r\n      expect(validated.heatSinkType).toBe(HeatSinkType.SINGLE);\r\n      expect(validated.armorType).toBe(ArmorTypeEnum.STANDARD);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Scenario 3: Mixed Mode Configuration\r\n  // ===========================================================================\r\n  describe('Scenario: Mixed Tech Mode', () => {\r\n    it('should allow individual component tech bases in mixed mode', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'Mixed Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      // Switch to mixed mode\r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n      });\r\n      \r\n      // Set engine to Clan, armor to IS\r\n      act(() => {\r\n        store.getState().setComponentTechBase(TechBaseComponent.ENGINE, TechBase.CLAN);\r\n        store.getState().setComponentTechBase(TechBaseComponent.ARMOR, TechBase.INNER_SPHERE);\r\n      });\r\n      \r\n      expect(store.getState().componentTechBases.engine).toBe(TechBase.CLAN);\r\n      expect(store.getState().componentTechBases.armor).toBe(TechBase.INNER_SPHERE);\r\n      expect(store.getState().techBaseMode).toBe(TechBaseMode.MIXED);\r\n    });\r\n    \r\n    it('should filter engines based on engine tech base in mixed mode', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'Mixed Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n        store.getState().setComponentTechBase(TechBaseComponent.ENGINE, TechBase.CLAN);\r\n      });\r\n      \r\n      const { result } = renderHook(() => \r\n        useTechBaseSync(store.getState().componentTechBases)\r\n      );\r\n      \r\n      // With engine set to Clan, should have Clan XL available\r\n      expect(result.current.isEngineValid(EngineType.XL_CLAN)).toBe(true);\r\n      expect(result.current.isEngineValid(EngineType.XL_IS)).toBe(false);\r\n    });\r\n    \r\n    it('should filter heat sinks based on heatsink tech base in mixed mode', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'Mixed Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n        store.getState().setComponentTechBase(TechBaseComponent.HEATSINK, TechBase.CLAN);\r\n      });\r\n      \r\n      const { result } = renderHook(() => \r\n        useTechBaseSync(store.getState().componentTechBases)\r\n      );\r\n      \r\n      // With heatsink set to Clan, should have Clan Double available\r\n      expect(result.current.isHeatSinkValid(HeatSinkType.DOUBLE_CLAN)).toBe(true);\r\n      expect(result.current.isHeatSinkValid(HeatSinkType.DOUBLE_IS)).toBe(false);\r\n    });\r\n    \r\n    it('should preserve mixed settings when switching to mixed mode', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'Mixed Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      // Set specific components before switching to mixed\r\n      act(() => {\r\n        store.getState().setComponentTechBase(TechBaseComponent.ENGINE, TechBase.CLAN);\r\n        store.getState().setComponentTechBase(TechBaseComponent.HEATSINK, TechBase.CLAN);\r\n      });\r\n      \r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n      });\r\n      \r\n      // Settings should be preserved\r\n      expect(store.getState().componentTechBases.engine).toBe(TechBase.CLAN);\r\n      expect(store.getState().componentTechBases.heatsink).toBe(TechBase.CLAN);\r\n      expect(store.getState().componentTechBases.chassis).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Scenario 4: Tab Switching with Different Tech Bases\r\n  // ===========================================================================\r\n  describe('Scenario: Tab Switching with Different Tech Bases', () => {\r\n    it('should maintain separate tech base configurations per tab', () => {\r\n      // Create IS tab\r\n      let isTabId: string = '';\r\n      act(() => {\r\n        isTabId = useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]); // Medium IS\r\n      });\r\n      \r\n      // Create Clan tab\r\n      const clanTemplate = { ...UNIT_TEMPLATES[1], techBase: TechBase.CLAN };\r\n      let clanTabId: string = '';\r\n      act(() => {\r\n        clanTabId = useTabManagerStore.getState().createTab(clanTemplate);\r\n      });\r\n      \r\n      // Modify Clan tab\r\n      const clanStore = getUnitStore(clanTabId);\r\n      act(() => {\r\n        clanStore?.getState().setEngineType(EngineType.XL_CLAN);\r\n      });\r\n      \r\n      // Switch to IS tab\r\n      act(() => {\r\n        useTabManagerStore.getState().selectTab(isTabId);\r\n      });\r\n      \r\n      // IS store should be unchanged\r\n      const isStore = getUnitStore(isTabId);\r\n      expect(isStore?.getState().engineType).toBe(EngineType.STANDARD);\r\n      expectAllComponentTechBases(isStore!.getState().componentTechBases, TechBase.INNER_SPHERE);\r\n      \r\n      // Switch back to Clan tab - should have changes preserved\r\n      act(() => {\r\n        useTabManagerStore.getState().selectTab(clanTabId);\r\n      });\r\n      \r\n      expect(clanStore?.getState().engineType).toBe(EngineType.XL_CLAN);\r\n    });\r\n    \r\n    it('should correctly hydrate tab stores on selection', () => {\r\n      // Create two tabs\r\n      let tab1Id: string = '';\r\n      let tab2Id: string = '';\r\n      \r\n      act(() => {\r\n        tab1Id = useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        tab2Id = useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      // Modify tab1\r\n      const store1 = getUnitStore(tab1Id);\r\n      act(() => {\r\n        store1?.getState().setGyroType(GyroType.COMPACT);\r\n        store1?.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n      });\r\n      \r\n      // Switch to tab2\r\n      act(() => {\r\n        useTabManagerStore.getState().selectTab(tab2Id);\r\n      });\r\n      \r\n      // Switch back to tab1\r\n      act(() => {\r\n        useTabManagerStore.getState().selectTab(tab1Id);\r\n      });\r\n      \r\n      // tab1 should have preserved state\r\n      const rehydratedStore = getUnitStore(tab1Id);\r\n      expect(rehydratedStore?.getState().gyroType).toBe(GyroType.COMPACT);\r\n      expect(rehydratedStore?.getState().techBaseMode).toBe(TechBaseMode.MIXED);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Scenario 5: Duplicate Unit with Tech Base Configuration\r\n  // ===========================================================================\r\n  describe('Scenario: Duplicate Unit with Tech Base Configuration', () => {\r\n    it('should copy all tech base configuration to duplicate', () => {\r\n      const original = createAndRegisterUnit({\r\n        name: 'Original',\r\n        tonnage: 75,\r\n        techBase: TechBase.CLAN,\r\n      });\r\n      \r\n      // Configure original\r\n      act(() => {\r\n        original.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n      original.getState().setComponentTechBase(TechBaseComponent.ARMOR, TechBase.INNER_SPHERE);\r\n        original.getState().setEngineType(EngineType.XL_CLAN);\r\n        original.getState().setHeatSinkType(HeatSinkType.DOUBLE_CLAN);\r\n      });\r\n      \r\n      const duplicate = duplicateUnit(original.getState().id);\r\n      \r\n      expect(duplicate).not.toBeNull();\r\n      expect(duplicate!.getState().techBaseMode).toBe(TechBaseMode.MIXED);\r\n      expect(duplicate!.getState().componentTechBases.armor).toBe(TechBase.INNER_SPHERE);\r\n      expect(duplicate!.getState().componentTechBases.engine).toBe(TechBase.CLAN);\r\n      expect(duplicate!.getState().engineType).toBe(EngineType.XL_CLAN);\r\n      expect(duplicate!.getState().heatSinkType).toBe(HeatSinkType.DOUBLE_CLAN);\r\n    });\r\n    \r\n    it('should create independent copy that can be modified separately', () => {\r\n      const original = createAndRegisterUnit({\r\n        name: 'Original',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      act(() => {\r\n        original.getState().setEngineType(EngineType.XL_IS);\r\n      });\r\n      \r\n      const duplicate = duplicateUnit(original.getState().id);\r\n      \r\n      // Modify duplicate to Clan\r\n      act(() => {\r\n        duplicate!.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n        duplicate!.getState().setEngineType(EngineType.XL_CLAN);\r\n      });\r\n      \r\n      // Original should be unchanged\r\n      expect(original.getState().techBaseMode).toBe(TechBaseMode.INNER_SPHERE);\r\n      expect(original.getState().engineType).toBe(EngineType.XL_IS);\r\n      \r\n      // Duplicate should have changes\r\n      expect(duplicate!.getState().techBaseMode).toBe(TechBaseMode.CLAN);\r\n      expect(duplicate!.getState().engineType).toBe(EngineType.XL_CLAN);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Scenario 6: Critical Slot Changes on Tech Base Switch\r\n  // ===========================================================================\r\n  describe('Scenario: Critical Slot Changes on Tech Base Switch', () => {\r\n    it('should calculate different slots for IS vs Clan XL engines', () => {\r\n      const isSelections: IComponentSelections = {\r\n        engineType: EngineType.XL_IS,\r\n        engineRating: 200,\r\n        gyroType: GyroType.STANDARD,\r\n        internalStructureType: InternalStructureType.STANDARD,\r\n        cockpitType: CockpitType.STANDARD,\r\n        heatSinkType: HeatSinkType.SINGLE,\r\n        heatSinkCount: 10,\r\n        armorType: ArmorTypeEnum.STANDARD,\r\n      };\r\n      \r\n      const clanSelections: IComponentSelections = {\r\n        ...isSelections,\r\n        engineType: EngineType.XL_CLAN,\r\n      };\r\n      \r\n      const { result: isResult } = renderHook(() => \r\n        useUnitCalculations(50, isSelections)\r\n      );\r\n      \r\n      const { result: clanResult } = renderHook(() => \r\n        useUnitCalculations(50, clanSelections)\r\n      );\r\n      \r\n      // IS XL = 12 slots (6 CT + 3 per side)\r\n      // Clan XL = 10 slots (6 CT + 2 per side)\r\n      expect(isResult.current.engineSlots).toBe(12);\r\n      expect(clanResult.current.engineSlots).toBe(10);\r\n    });\r\n    \r\n    it('should calculate different slots for IS vs Clan Endo Steel', () => {\r\n      const isSelections: IComponentSelections = {\r\n        engineType: EngineType.STANDARD,\r\n        engineRating: 200,\r\n        gyroType: GyroType.STANDARD,\r\n        internalStructureType: InternalStructureType.ENDO_STEEL_IS,\r\n        cockpitType: CockpitType.STANDARD,\r\n        heatSinkType: HeatSinkType.SINGLE,\r\n        heatSinkCount: 10,\r\n        armorType: ArmorTypeEnum.STANDARD,\r\n      };\r\n      \r\n      const clanSelections: IComponentSelections = {\r\n        ...isSelections,\r\n        internalStructureType: InternalStructureType.ENDO_STEEL_CLAN,\r\n      };\r\n      \r\n      const { result: isResult } = renderHook(() => \r\n        useUnitCalculations(50, isSelections)\r\n      );\r\n      \r\n      const { result: clanResult } = renderHook(() => \r\n        useUnitCalculations(50, clanSelections)\r\n      );\r\n      \r\n      // IS Endo Steel = 14 slots\r\n      // Clan Endo Steel = 7 slots\r\n      expect(isResult.current.structureSlots).toBe(14);\r\n      expect(clanResult.current.structureSlots).toBe(7);\r\n    });\r\n    \r\n    it('should calculate different slots for IS vs Clan Double Heat Sinks', () => {\r\n      const baseSelections: IComponentSelections = {\r\n        engineType: EngineType.STANDARD,\r\n        engineRating: 200, // 8 integral\r\n        gyroType: GyroType.STANDARD,\r\n        internalStructureType: InternalStructureType.STANDARD,\r\n        cockpitType: CockpitType.STANDARD,\r\n        heatSinkType: HeatSinkType.DOUBLE_IS,\r\n        heatSinkCount: 12, // 4 external\r\n        armorType: ArmorTypeEnum.STANDARD,\r\n      };\r\n      \r\n      const clanSelections: IComponentSelections = {\r\n        ...baseSelections,\r\n        heatSinkType: HeatSinkType.DOUBLE_CLAN,\r\n      };\r\n      \r\n      const { result: isResult } = renderHook(() => \r\n        useUnitCalculations(50, baseSelections)\r\n      );\r\n      \r\n      const { result: clanResult } = renderHook(() => \r\n        useUnitCalculations(50, clanSelections)\r\n      );\r\n      \r\n      // 4 external IS Doubles = 12 slots (3 each)\r\n      // 4 external Clan Doubles = 8 slots (2 each)\r\n      expect(isResult.current.heatSinkSlots).toBe(12);\r\n      expect(clanResult.current.heatSinkSlots).toBe(8);\r\n    });\r\n    \r\n    it('should show significant slot savings for full Clan build', () => {\r\n      // Full IS XL build with all tech-specific components\r\n      const isFullBuild: IComponentSelections = {\r\n        engineType: EngineType.XL_IS,\r\n        engineRating: 200,\r\n        gyroType: GyroType.STANDARD,\r\n        internalStructureType: InternalStructureType.ENDO_STEEL_IS,\r\n        cockpitType: CockpitType.STANDARD,\r\n        heatSinkType: HeatSinkType.DOUBLE_IS,\r\n        heatSinkCount: 12, // 4 external\r\n        armorType: ArmorTypeEnum.STANDARD,\r\n      };\r\n      \r\n      // Equivalent Clan build\r\n      const clanFullBuild: IComponentSelections = {\r\n        engineType: EngineType.XL_CLAN,\r\n        engineRating: 200,\r\n        gyroType: GyroType.STANDARD,\r\n        internalStructureType: InternalStructureType.ENDO_STEEL_CLAN,\r\n        cockpitType: CockpitType.STANDARD,\r\n        heatSinkType: HeatSinkType.DOUBLE_CLAN,\r\n        heatSinkCount: 12, // 4 external\r\n        armorType: ArmorTypeEnum.STANDARD,\r\n      };\r\n      \r\n      const { result: isResult } = renderHook(() => \r\n        useUnitCalculations(50, isFullBuild)\r\n      );\r\n      \r\n      const { result: clanResult } = renderHook(() => \r\n        useUnitCalculations(50, clanFullBuild)\r\n      );\r\n      \r\n      // Calculate slot difference\r\n      const slotDifference = \r\n        (isResult.current.engineSlots - clanResult.current.engineSlots) +\r\n        (isResult.current.structureSlots - clanResult.current.structureSlots) +\r\n        (isResult.current.heatSinkSlots - clanResult.current.heatSinkSlots);\r\n      \r\n      // Engine: 2 fewer slots (12 vs 10)\r\n      // Structure: 7 fewer slots (14 vs 7)\r\n      // Heat Sinks: 4 fewer slots (12 vs 8)\r\n      // Total: 13 fewer slots\r\n      expect(slotDifference).toBe(13);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Scenario 7: Complete Workflow Test\r\n  // ===========================================================================\r\n  describe('Scenario: Complete Workflow', () => {\r\n    it('should handle complete IS -> Clan -> Mixed workflow', () => {\r\n      // Step 1: Create IS unit with IS XL engine\r\n      const store = createAndRegisterUnit({\r\n        name: 'Workflow Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      act(() => {\r\n        store.getState().setEngineType(EngineType.XL_IS);\r\n        store.getState().setInternalStructureType(InternalStructureType.ENDO_STEEL_IS);\r\n      });\r\n      \r\n      expect(store.getState().techBaseMode).toBe(TechBaseMode.INNER_SPHERE);\r\n      expect(store.getState().engineType).toBe(EngineType.XL_IS);\r\n      \r\n      // Step 2: Switch to Clan - verify selections become invalid\r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n      });\r\n      \r\n      const { result: clanCheck } = renderHook(() => \r\n        useTechBaseSync(store.getState().componentTechBases)\r\n      );\r\n      \r\n      expect(clanCheck.current.isEngineValid(EngineType.XL_IS)).toBe(false);\r\n      expect(clanCheck.current.isStructureValid(InternalStructureType.ENDO_STEEL_IS)).toBe(false);\r\n      \r\n      // Step 3: Update to valid Clan components\r\n      act(() => {\r\n        store.getState().setEngineType(EngineType.XL_CLAN);\r\n        store.getState().setInternalStructureType(InternalStructureType.ENDO_STEEL_CLAN);\r\n      });\r\n      \r\n      expect(clanCheck.current.isEngineValid(EngineType.XL_CLAN)).toBe(true);\r\n      \r\n      // Step 4: Switch to mixed mode\r\n      act(() => {\r\n        store.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n        store.getState().setComponentTechBase(TechBaseComponent.HEATSINK, TechBase.INNER_SPHERE);\r\n      });\r\n      \r\n      const { result: mixedCheck } = renderHook(() => \r\n        useTechBaseSync(store.getState().componentTechBases)\r\n      );\r\n      \r\n      // Engine still Clan, heat sinks now IS\r\n      expect(mixedCheck.current.isEngineValid(EngineType.XL_CLAN)).toBe(true);\r\n      expect(mixedCheck.current.isHeatSinkValid(HeatSinkType.DOUBLE_IS)).toBe(true);\r\n      expect(mixedCheck.current.isHeatSinkValid(HeatSinkType.DOUBLE_CLAN)).toBe(false);\r\n      \r\n      // Step 5: Verify final state\r\n      expect(store.getState().techBaseMode).toBe(TechBaseMode.MIXED);\r\n      expect(store.getState().componentTechBases.engine).toBe(TechBase.CLAN);\r\n      expect(store.getState().componentTechBases.heatsink).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\mocks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\mocks\\services\\MockFormulaRegistry.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'max' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":6}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Mock Formula Registry\r\n * \r\n * Mock implementation of IFormulaRegistry for testing.\r\n */\r\n\r\nimport { IFormulaRegistry } from '@/services/equipment/FormulaRegistry';\r\nimport { \r\n  IVariableFormulas, \r\n  ceilDivide, \r\n  floorDivide,\r\n  roundDivide,\r\n  equalsWeight, \r\n  multiply, \r\n  fixed,\r\n  plus,\r\n  multiplyRound,\r\n  max,\r\n} from '@/types/equipment/VariableEquipment';\r\n\r\n/**\r\n * Built-in test formulas for common equipment\r\n * Uses proper IFormula structure matching variableEquipmentFormulas.ts\r\n */\r\nconst TEST_FORMULAS: Map<string, IVariableFormulas> = new Map([\r\n  ['targeting-computer-is', {\r\n    weight: ceilDivide('directFireWeaponTonnage', 4),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 10000),\r\n    requiredContext: ['directFireWeaponTonnage'],\r\n  }],\r\n  ['targeting-computer-clan', {\r\n    weight: ceilDivide('directFireWeaponTonnage', 5),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 10000),\r\n    requiredContext: ['directFireWeaponTonnage'],\r\n  }],\r\n  ['masc-is', {\r\n    // MASC (IS): tonnage / 20, rounded to nearest whole ton\r\n    // Examples: 85t  4 tons, 90t  5 tons\r\n    weight: roundDivide('tonnage', 20),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('tonnage', 1000),\r\n    requiredContext: ['tonnage'],\r\n  }],\r\n  ['masc-clan', {\r\n    // MASC (Clan): tonnage / 25, rounded to nearest whole ton\r\n    weight: roundDivide('tonnage', 25),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('tonnage', 1000),\r\n    requiredContext: ['tonnage'],\r\n  }],\r\n  ['supercharger', {\r\n    // Weight = engineWeight  10%, rounded up to nearest 0.5 ton\r\n    weight: multiplyRound('engineWeight', 0.1, 0.5),\r\n    criticalSlots: fixed(1),\r\n    cost: multiply('engineWeight', 10000),\r\n    requiredContext: ['engineWeight'],\r\n  }],\r\n  ['hatchet', {\r\n    weight: ceilDivide('tonnage', 15),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 5000),\r\n    damage: floorDivide('tonnage', 5),\r\n    requiredContext: ['tonnage'],\r\n  }],\r\n  ['sword', {\r\n    weight: ceilDivide('tonnage', 15),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 10000),\r\n    damage: plus(floorDivide('tonnage', 10), 1),\r\n    requiredContext: ['tonnage'],\r\n  }],\r\n]);\r\n\r\n/**\r\n * Create a mock formula registry for testing\r\n */\r\nexport function createMockFormulaRegistry(): jest.Mocked<IFormulaRegistry> {\r\n  const customFormulas = new Map<string, IVariableFormulas>();\r\n\r\n  return {\r\n    initialize: jest.fn().mockImplementation(async () => {\r\n      // No-op for mock\r\n    }),\r\n\r\n    getFormulas: jest.fn().mockImplementation((equipmentId: string) => {\r\n      // Check custom formulas first\r\n      if (customFormulas.has(equipmentId)) {\r\n        return customFormulas.get(equipmentId);\r\n      }\r\n      // Then check built-in test formulas\r\n      return TEST_FORMULAS.get(equipmentId);\r\n    }),\r\n\r\n    isVariable: jest.fn().mockImplementation((equipmentId: string) => {\r\n      return TEST_FORMULAS.has(equipmentId) || customFormulas.has(equipmentId);\r\n    }),\r\n\r\n    getRequiredContext: jest.fn().mockImplementation((equipmentId: string) => {\r\n      const formulas = TEST_FORMULAS.get(equipmentId) || customFormulas.get(equipmentId);\r\n      return formulas?.requiredContext ?? [];\r\n    }),\r\n\r\n    getAllVariableEquipmentIds: jest.fn().mockImplementation(() => {\r\n      return [\r\n        ...Array.from(TEST_FORMULAS.keys()),\r\n        ...Array.from(customFormulas.keys()),\r\n      ];\r\n    }),\r\n\r\n    registerCustomFormulas: jest.fn().mockImplementation(async (equipmentId: string, formulas: IVariableFormulas) => {\r\n      customFormulas.set(equipmentId, formulas);\r\n    }),\r\n\r\n    unregisterCustomFormulas: jest.fn().mockImplementation(async (equipmentId: string) => {\r\n      customFormulas.delete(equipmentId);\r\n    }),\r\n\r\n    getCustomFormulaIds: jest.fn().mockImplementation(() => {\r\n      return Array.from(customFormulas.keys());\r\n    }),\r\n  };\r\n}\r\n\r\n/**\r\n * Create a formula registry that throws errors for testing error handling\r\n */\r\nexport function createFailingFormulaRegistry(): jest.Mocked<IFormulaRegistry> {\r\n  return {\r\n    initialize: jest.fn().mockRejectedValue(new Error('Storage unavailable')),\r\n    getFormulas: jest.fn().mockReturnValue(undefined),\r\n    isVariable: jest.fn().mockReturnValue(false),\r\n    getRequiredContext: jest.fn().mockReturnValue([]),\r\n    getAllVariableEquipmentIds: jest.fn().mockReturnValue([]),\r\n    registerCustomFormulas: jest.fn().mockRejectedValue(new Error('Cannot save')),\r\n    unregisterCustomFormulas: jest.fn().mockRejectedValue(new Error('Cannot delete')),\r\n    getCustomFormulaIds: jest.fn().mockReturnValue([]),\r\n  };\r\n}\r\n\r\n/**\r\n * Export test formulas for direct access in tests\r\n */\r\nexport { TEST_FORMULAS };\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\mocks\\storage\\MockIndexedDB.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\common\\errors.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\construction\\CalculationService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IMechTotals' is defined but never used.","line":9,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Calculation Service Tests\n * \n * Tests for mech calculation and derived values.\n * \n * @spec openspec/specs/construction-services/spec.md\n */\n\nimport { CalculationService, IMechTotals } from '@/services/construction/CalculationService';\nimport { MechBuilderService, IEditableMech } from '@/services/construction/MechBuilderService';\nimport { TechBase } from '@/types/enums/TechBase';\n\ndescribe('CalculationService', () => {\n  let calculationService: CalculationService;\n  let builderService: MechBuilderService;\n\n  beforeEach(() => {\n    calculationService = new CalculationService();\n    builderService = new MechBuilderService();\n  });\n\n  /**\n   * Create a test mech with optional overrides\n   */\n  function createTestMech(tonnage: number = 50, options: Partial<{\n    walkMP: number;\n    engineType: string;\n    armor: Record<string, number>;\n  }> = {}): IEditableMech {\n    let mech = builderService.createEmpty(tonnage, TechBase.INNER_SPHERE);\n    \n    if (options.walkMP) {\n      mech = builderService.setEngine(mech, options.engineType || 'Standard', options.walkMP);\n    }\n    \n    if (options.armor) {\n      mech = builderService.setArmor(mech, options.armor);\n    }\n    \n    return mech;\n  }\n\n  // ============================================================================\n  // calculateTotals\n  // ============================================================================\n  describe('calculateTotals', () => {\n    it('should calculate total weight', () => {\n      const mech = createTestMech(50);\n      const totals = calculationService.calculateTotals(mech);\n      \n      expect(totals.totalWeight).toBeGreaterThan(0);\n      expect(totals.maxWeight).toBe(50);\n    });\n\n    it('should calculate remaining weight', () => {\n      const mech = createTestMech(50);\n      const totals = calculationService.calculateTotals(mech);\n      \n      expect(totals.remainingWeight).toBe(totals.maxWeight - totals.totalWeight);\n    });\n\n    it('should calculate armor points', () => {\n      const mech = createTestMech(50, {\n        armor: { head: 9, centerTorso: 20, leftArm: 10, rightArm: 10 },\n      });\n      const totals = calculationService.calculateTotals(mech);\n      \n      expect(totals.totalArmorPoints).toBe(49); // 9 + 20 + 10 + 10\n    });\n\n    it('should calculate max armor points', () => {\n      const mech = createTestMech(50);\n      const totals = calculationService.calculateTotals(mech);\n      \n      // Max armor depends on tonnage\n      expect(totals.maxArmorPoints).toBeGreaterThan(0);\n    });\n\n    it('should count used critical slots', () => {\n      let mech = createTestMech(50);\n      mech = builderService.addEquipment(mech, 'medium-laser', 'RT');\n      mech = builderService.addEquipment(mech, 'medium-laser', 'LT');\n      \n      const totals = calculationService.calculateTotals(mech);\n      \n      expect(totals.usedCriticalSlots).toBe(2);\n      expect(totals.totalCriticalSlots).toBe(78);\n    });\n\n    it('should scale with tonnage', () => {\n      const lightMech = createTestMech(20);\n      const assaultMech = createTestMech(100);\n      \n      const lightTotals = calculationService.calculateTotals(lightMech);\n      const assaultTotals = calculationService.calculateTotals(assaultMech);\n      \n      expect(assaultTotals.maxArmorPoints).toBeGreaterThan(lightTotals.maxArmorPoints);\n    });\n  });\n\n  // ============================================================================\n  // calculateBattleValue\n  // ============================================================================\n  describe('calculateBattleValue', () => {\n    it('should calculate positive BV', () => {\n      const mech = createTestMech(50);\n      const bv = calculationService.calculateBattleValue(mech);\n      \n      expect(bv).toBeGreaterThan(0);\n    });\n\n    it('should increase with tonnage', () => {\n      const lightBV = calculationService.calculateBattleValue(createTestMech(20));\n      const assaultBV = calculationService.calculateBattleValue(createTestMech(100));\n      \n      expect(assaultBV).toBeGreaterThan(lightBV);\n    });\n\n    it('should increase with movement', () => {\n      const slowMech = createTestMech(50, { walkMP: 3 });\n      const fastMech = createTestMech(50, { walkMP: 5 });\n      \n      const slowBV = calculationService.calculateBattleValue(slowMech);\n      const fastBV = calculationService.calculateBattleValue(fastMech);\n      \n      expect(fastBV).toBeGreaterThan(slowBV);\n    });\n\n    it('should increase with armor', () => {\n      const unarmored = createTestMech(50);\n      const armored = createTestMech(50, {\n        armor: { head: 9, centerTorso: 30, leftTorso: 20, rightTorso: 20 },\n      });\n      \n      const unarmoredBV = calculationService.calculateBattleValue(unarmored);\n      const armoredBV = calculationService.calculateBattleValue(armored);\n      \n      expect(armoredBV).toBeGreaterThan(unarmoredBV);\n    });\n\n    it('should return integer', () => {\n      const mech = createTestMech(50);\n      const bv = calculationService.calculateBattleValue(mech);\n      \n      expect(Number.isInteger(bv)).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // calculateCost\n  // ============================================================================\n  describe('calculateCost', () => {\n    it('should calculate positive cost', () => {\n      const mech = createTestMech(50);\n      const cost = calculationService.calculateCost(mech);\n      \n      expect(cost).toBeGreaterThan(0);\n    });\n\n    it('should increase with tonnage', () => {\n      const lightCost = calculationService.calculateCost(createTestMech(20));\n      const assaultCost = calculationService.calculateCost(createTestMech(100));\n      \n      expect(assaultCost).toBeGreaterThan(lightCost);\n    });\n\n    it('XL engine should increase cost', () => {\n      const standardMech = createTestMech(50, { walkMP: 4, engineType: 'Standard' });\n      const xlMech = createTestMech(50, { walkMP: 4, engineType: 'XL' });\n      \n      const standardCost = calculationService.calculateCost(standardMech);\n      const xlCost = calculationService.calculateCost(xlMech);\n      \n      expect(xlCost).toBeGreaterThan(standardCost);\n    });\n\n    it('should return integer', () => {\n      const mech = createTestMech(50);\n      const cost = calculationService.calculateCost(mech);\n      \n      expect(Number.isInteger(cost)).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // calculateHeatProfile\n  // ============================================================================\n  describe('calculateHeatProfile', () => {\n    it('should calculate heat dissipation', () => {\n      const mech = createTestMech(50);\n      const heat = calculationService.calculateHeatProfile(mech);\n      \n      expect(heat.heatDissipated).toBeGreaterThan(0);\n    });\n\n    it('Single heat sinks should dissipate 1 each', () => {\n      const mech = builderService.createEmpty(50, TechBase.INNER_SPHERE);\n      // Default is 10 single heat sinks\n      \n      const heat = calculationService.calculateHeatProfile(mech);\n      \n      expect(heat.heatDissipated).toBe(10); // 10  1\n    });\n\n    it('Double heat sinks should dissipate 2 each', () => {\n      const mech = builderService.createEmpty(50, TechBase.CLAN);\n      // Clan defaults to double heat sinks\n      \n      const heat = calculationService.calculateHeatProfile(mech);\n      \n      expect(heat.heatDissipated).toBe(20); // 10  2\n    });\n\n    it('should calculate net heat', () => {\n      const mech = createTestMech(50);\n      const heat = calculationService.calculateHeatProfile(mech);\n      \n      expect(heat.netHeat).toBe(heat.heatGenerated - heat.heatDissipated);\n    });\n  });\n\n  // ============================================================================\n  // calculateMovement\n  // ============================================================================\n  describe('calculateMovement', () => {\n    it('should calculate run MP from walk MP', () => {\n      const mech = createTestMech(50, { walkMP: 4 });\n      const movement = calculationService.calculateMovement(mech);\n      \n      expect(movement.walkMP).toBe(4);\n      expect(movement.runMP).toBe(6); // floor(4  1.5) = 6\n    });\n\n    it.each([\n      [3, 4],   // floor(4.5) = 4\n      [4, 6],   // floor(6) = 6\n      [5, 7],   // floor(7.5) = 7\n      [6, 9],   // floor(9) = 9\n      [8, 12],  // floor(12) = 12\n    ])('walk %d should give run %d', (walk, expectedRun) => {\n      const mech = createTestMech(50, { walkMP: walk });\n      const movement = calculationService.calculateMovement(mech);\n      \n      expect(movement.runMP).toBe(expectedRun);\n    });\n\n    it('should default to 0 jump MP', () => {\n      const mech = createTestMech(50);\n      const movement = calculationService.calculateMovement(mech);\n      \n      expect(movement.jumpMP).toBe(0);\n    });\n  });\n\n  // ============================================================================\n  // Component Weights\n  // ============================================================================\n  describe('Component Weight Calculations', () => {\n    it('structure should be 10% of tonnage', () => {\n      const mech = createTestMech(50);\n      const totals = calculationService.calculateTotals(mech);\n      \n      // Structure weight is included in total\n      // 50  0.1 = 5 tons for standard structure\n      expect(totals.totalWeight).toBeGreaterThanOrEqual(5);\n    });\n\n    it('cockpit should add 3 tons', () => {\n      const mech = createTestMech(50);\n      const totals = calculationService.calculateTotals(mech);\n      \n      // With structure (5) + cockpit (3) = at least 8 tons\n      expect(totals.totalWeight).toBeGreaterThanOrEqual(8);\n    });\n\n    it('external heat sinks should add weight', () => {\n      // 10 heat sinks included in engine, more add weight\n      const mech = createTestMech(50);\n      // Default has 10 heat sinks, none external\n      const totals = calculationService.calculateTotals(mech);\n      \n      // Heat sinks at base 10 shouldn't add weight (integrated in engine)\n      // This is simplified - actual calculation is more complex\n      expect(totals.totalWeight).toBeGreaterThan(0);\n    });\n  });\n\n  // ============================================================================\n  // Edge Cases\n  // ============================================================================\n  describe('Edge Cases', () => {\n    it('should handle minimum tonnage', () => {\n      const mech = createTestMech(20);\n      \n      expect(() => calculationService.calculateTotals(mech)).not.toThrow();\n      expect(() => calculationService.calculateBattleValue(mech)).not.toThrow();\n      expect(() => calculationService.calculateCost(mech)).not.toThrow();\n    });\n\n    it('should handle maximum tonnage', () => {\n      const mech = createTestMech(100);\n      \n      expect(() => calculationService.calculateTotals(mech)).not.toThrow();\n      expect(() => calculationService.calculateBattleValue(mech)).not.toThrow();\n      expect(() => calculationService.calculateCost(mech)).not.toThrow();\n    });\n\n    it('should handle zero armor', () => {\n      const mech = createTestMech(50);\n      const totals = calculationService.calculateTotals(mech);\n      \n      expect(totals.totalArmorPoints).toBe(0);\n    });\n\n    it('should handle no equipment', () => {\n      const mech = createTestMech(50);\n      const totals = calculationService.calculateTotals(mech);\n      \n      expect(totals.usedCriticalSlots).toBe(0);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\construction\\MechBuilderService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\construction\\ValidationService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ValidationSeverity' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":207,"column":11,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":207,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":208,"column":11,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":208,"endColumn":63}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Validation Service Tests\n * \n * Tests for mech build validation.\n * \n * @spec openspec/specs/construction-services/spec.md\n */\n\nimport { ValidationService, validationService } from '@/services/construction/ValidationService';\nimport { IEditableMech, IEquipmentSlot } from '@/services/construction/MechBuilderService';\nimport { ValidationSeverity } from '@/services/common/types';\nimport { TechBase } from '@/types/enums/TechBase';\n\ndescribe('ValidationService', () => {\n  let service: ValidationService;\n\n  beforeEach(() => {\n    service = new ValidationService();\n  });\n\n  /**\n   * Create a valid mock mech for testing\n   */\n  function createValidMech(overrides: Partial<IEditableMech> = {}): IEditableMech {\n    return {\n      id: 'test-mech',\n      chassis: 'Test',\n      variant: 'Mech',\n      tonnage: 50,\n      techBase: TechBase.INNER_SPHERE,\n      engineRating: 200,\n      engineType: 'Standard',\n      gyroType: 'Standard',\n      structureType: 'Standard',\n      armorType: 'Standard',\n      heatSinkType: 'Single',\n      heatSinkCount: 10,\n      walkMP: 4,\n      cockpitType: 'Standard',\n      armorAllocation: {\n        head: 9,\n        centerTorso: 16,\n        centerTorsoRear: 5,\n        leftTorso: 12,\n        leftTorsoRear: 4,\n        rightTorso: 12,\n        rightTorsoRear: 4,\n        leftArm: 10,\n        rightArm: 10,\n        leftLeg: 12,\n        rightLeg: 12,\n      },\n      equipment: [],\n      isDirty: false,\n      ...overrides,\n    } as IEditableMech;\n  }\n\n  // ============================================================================\n  // Singleton\n  // ============================================================================\n  describe('Singleton', () => {\n    it('should export a singleton instance', () => {\n      expect(validationService).toBeInstanceOf(ValidationService);\n    });\n  });\n\n  // ============================================================================\n  // validate()\n  // ============================================================================\n  describe('validate()', () => {\n    it('should return valid for proper mech', () => {\n      const mech = createValidMech();\n      const result = service.validate(mech);\n      \n      expect(result.isValid).toBe(true);\n    });\n\n    it('should aggregate all validation errors', () => {\n      const mech = createValidMech({\n        engineRating: 7, // Invalid: not multiple of 5 and too low\n        heatSinkCount: 5, // Invalid: less than 10\n        armorAllocation: {\n          ...createValidMech().armorAllocation,\n          head: 15, // Invalid: exceeds 9\n        },\n      });\n      \n      const result = service.validate(mech);\n      \n      expect(result.isValid).toBe(false);\n      expect(result.errors.length).toBeGreaterThan(0);\n    });\n  });\n\n  // ============================================================================\n  // validateWeight()\n  // ============================================================================\n  describe('validateWeight()', () => {\n    it('should pass for valid weight', () => {\n      const mech = createValidMech();\n      const errors = service.validateWeight(mech);\n      \n      expect(errors).toHaveLength(0);\n    });\n\n    it('should detect overweight', () => {\n      // Create a mech with lots of armor and equipment\n      const mech = createValidMech({\n        tonnage: 20,\n        engineRating: 200, // Very heavy for a 20-tonner\n        heatSinkCount: 20,\n        armorAllocation: {\n          head: 9,\n          centerTorso: 50,\n          centerTorsoRear: 20,\n          leftTorso: 40,\n          leftTorsoRear: 15,\n          rightTorso: 40,\n          rightTorsoRear: 15,\n          leftArm: 30,\n          rightArm: 30,\n          leftLeg: 30,\n          rightLeg: 30,\n        },\n      });\n      \n      const errors = service.validateWeight(mech);\n      \n      expect(errors.some(e => e.code === 'OVERWEIGHT')).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // validateArmor()\n  // ============================================================================\n  describe('validateArmor()', () => {\n    it('should pass for valid armor', () => {\n      const mech = createValidMech();\n      const errors = service.validateArmor(mech);\n      \n      expect(errors).toHaveLength(0);\n    });\n\n    it('should detect head armor exceeding 9', () => {\n      const mech = createValidMech({\n        armorAllocation: {\n          ...createValidMech().armorAllocation,\n          head: 15,\n        },\n      });\n      \n      const errors = service.validateArmor(mech);\n      \n      expect(errors.some(e => e.code === 'ARMOR_EXCEEDS_MAX')).toBe(true);\n      expect(errors[0].field).toBe('head');\n    });\n\n    it('should allow exactly 9 head armor', () => {\n      const mech = createValidMech({\n        armorAllocation: {\n          ...createValidMech().armorAllocation,\n          head: 9,\n        },\n      });\n      \n      const errors = service.validateArmor(mech);\n      \n      expect(errors).toHaveLength(0);\n    });\n  });\n\n  // ============================================================================\n  // validateCriticalSlots()\n  // ============================================================================\n  describe('validateCriticalSlots()', () => {\n    it('should pass for valid slot count', () => {\n      const mech = createValidMech({\n        equipment: [\n          { equipmentId: 'eq-1', location: 'rightArm', slotIndex: 0 },\n          { equipmentId: 'eq-2', location: 'rightArm', slotIndex: 1 },\n        ] as readonly IEquipmentSlot[],\n      });\n      \n      const errors = service.validateCriticalSlots(mech);\n      \n      expect(errors).toHaveLength(0);\n    });\n\n    it('should detect slots exceeding max in location', () => {\n      // Create equipment that exceeds 6 slots in head\n      const equipment = Array(10).fill(null).map((_, i) => ({ \n        equipmentId: `eq-${i}`, \n        location: 'head', \n        slotIndex: i \n      })) as IEquipmentSlot[];\n      const mech = createValidMech({ equipment });\n      \n      const errors = service.validateCriticalSlots(mech);\n      \n      expect(errors.some(e => e.code === 'SLOTS_EXCEEDED')).toBe(true);\n    });\n\n    it('should validate each location separately', () => {\n      const mech = createValidMech({\n        equipment: [\n          ...Array(6).fill({ id: 'eq', location: 'leftArm' }),\n          ...Array(6).fill({ id: 'eq', location: 'rightArm' }),\n        ],\n      });\n      \n      const errors = service.validateCriticalSlots(mech);\n      \n      // 6 slots in each arm should be fine (max is 12)\n      expect(errors).toHaveLength(0);\n    });\n  });\n\n  // ============================================================================\n  // validateTechLevel()\n  // ============================================================================\n  describe('validateTechLevel()', () => {\n    it('should return empty array (stub implementation)', () => {\n      const mech = createValidMech();\n      const errors = service.validateTechLevel(mech);\n      \n      // Currently a stub\n      expect(Array.isArray(errors)).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // Engine Validation (private)\n  // ============================================================================\n  describe('Engine Validation', () => {\n    it('should detect engine rating below 10', () => {\n      const mech = createValidMech({ engineRating: 5 });\n      const result = service.validate(mech);\n      \n      expect(result.errors.some(e => e.code === 'INVALID_ENGINE_RATING')).toBe(true);\n    });\n\n    it('should detect engine rating above 400', () => {\n      const mech = createValidMech({ engineRating: 450 });\n      const result = service.validate(mech);\n      \n      expect(result.errors.some(e => e.code === 'INVALID_ENGINE_RATING')).toBe(true);\n    });\n\n    it('should detect engine rating not multiple of 5', () => {\n      const mech = createValidMech({ engineRating: 203 });\n      const result = service.validate(mech);\n      \n      expect(result.errors.some(e => e.code === 'INVALID_ENGINE_RATING')).toBe(true);\n    });\n\n    it('should pass valid engine ratings', () => {\n      const validRatings = [100, 150, 200, 250, 300, 400];\n      \n      for (const rating of validRatings) {\n        const mech = createValidMech({ engineRating: rating });\n        const result = service.validate(mech);\n        \n        expect(result.errors.filter(e => e.code === 'INVALID_ENGINE_RATING')).toHaveLength(0);\n      }\n    });\n  });\n\n  // ============================================================================\n  // Heat Sink Validation (private)\n  // ============================================================================\n  describe('Heat Sink Validation', () => {\n    it('should detect less than 10 heat sinks', () => {\n      const mech = createValidMech({ heatSinkCount: 5 });\n      const result = service.validate(mech);\n      \n      expect(result.errors.some(e => e.code === 'INSUFFICIENT_HEAT_SINKS')).toBe(true);\n    });\n\n    it('should pass with exactly 10 heat sinks', () => {\n      const mech = createValidMech({ heatSinkCount: 10 });\n      const result = service.validate(mech);\n      \n      expect(result.errors.filter(e => e.code === 'INSUFFICIENT_HEAT_SINKS')).toHaveLength(0);\n    });\n\n    it('should pass with more than 10 heat sinks', () => {\n      const mech = createValidMech({ heatSinkCount: 20 });\n      const result = service.validate(mech);\n      \n      expect(result.errors.filter(e => e.code === 'INSUFFICIENT_HEAT_SINKS')).toHaveLength(0);\n    });\n  });\n\n  // ============================================================================\n  // canAddEquipment()\n  // ============================================================================\n  describe('canAddEquipment()', () => {\n    it('should allow adding to empty location', () => {\n      const mech = createValidMech({ equipment: [] });\n      \n      expect(service.canAddEquipment(mech, 'medium-laser', 'rightArm')).toBe(true);\n    });\n\n    it('should allow adding to partially filled location', () => {\n      const mech = createValidMech({\n        equipment: [\n          { equipmentId: 'eq-1', location: 'rightArm', slotIndex: 0 },\n        ] as readonly IEquipmentSlot[],\n      });\n      \n      expect(service.canAddEquipment(mech, 'medium-laser', 'rightArm')).toBe(true);\n    });\n\n    it('should prevent adding to full location', () => {\n      const equipment = Array(12).fill({ id: 'eq', location: 'rightArm' });\n      const mech = createValidMech({ equipment });\n      \n      expect(service.canAddEquipment(mech, 'medium-laser', 'rightArm')).toBe(false);\n    });\n\n    it('should handle head with 6 slot limit', () => {\n      const equipment = Array(6).fill({ id: 'eq', location: 'head' });\n      const mech = createValidMech({ equipment });\n      \n      expect(service.canAddEquipment(mech, 'equipment', 'head')).toBe(false);\n    });\n\n    it('should handle leg locations with 6 slot limit', () => {\n      const equipment = Array(6).fill({ id: 'eq', location: 'leftLeg' });\n      const mech = createValidMech({ equipment });\n      \n      expect(service.canAddEquipment(mech, 'equipment', 'leftLeg')).toBe(false);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\conversion\\ConversionValidation.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ConversionValidationResult' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Conversion Validation Tests\n * \n * Tests for validating converted units against BattleTech construction rules.\n * \n * @spec openspec/specs/validation-patterns/spec.md\n */\n\nimport {\n  validateConvertedUnit,\n  validateBatch,\n  ConversionValidationSeverity,\n  ConversionValidationResult,\n} from '@/services/conversion/ConversionValidation';\nimport { ISerializedUnit } from '@/types/unit/UnitSerialization';\nimport { TechBase } from '@/types/enums/TechBase';\n\ndescribe('ConversionValidation', () => {\n  /**\n   * Create a valid base unit for testing\n   */\n  function createValidUnit(overrides: Partial<ISerializedUnit> = {}): ISerializedUnit {\n    return {\n      id: 'test-unit-id',\n      chassis: 'Test Mech',\n      model: 'TST-1A',\n      unitType: 'BattleMech',\n      configuration: 'Biped',\n      techBase: TechBase.INNER_SPHERE,\n      rulesLevel: 'Standard',\n      era: 'Succession Wars',\n      year: 3025,\n      tonnage: 50,\n      engine: { type: 'Standard', rating: 200 },\n      gyro: { type: 'Standard' },\n      cockpit: 'Standard',\n      structure: { type: 'Standard' },\n      armor: {\n        type: 'Standard',\n        allocation: {\n          head: 9,\n          centerTorso: 23,\n          leftTorso: 18,\n          rightTorso: 18,\n          leftArm: 16,\n          rightArm: 16,\n          leftLeg: 20,\n          rightLeg: 20,\n        },\n      },\n      heatSinks: { type: 'Single', count: 10 },\n      movement: { walk: 4, jump: 0 },\n      equipment: [\n        { id: 'medium-laser', location: 'RA' },\n        { id: 'medium-laser', location: 'LA' },\n      ],\n      criticalSlots: {},\n      ...overrides,\n    };\n  }\n\n  // ============================================================================\n  // validateConvertedUnit() - Valid Units\n  // ============================================================================\n  describe('validateConvertedUnit() - Valid Units', () => {\n    it('should pass valid unit', () => {\n      const unit = createValidUnit();\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.isValid).toBe(true);\n      expect(result.errors).toHaveLength(0);\n    });\n\n    it('should return proper structure', () => {\n      const unit = createValidUnit();\n      const result = validateConvertedUnit(unit);\n      \n      expect(result).toHaveProperty('isValid');\n      expect(result).toHaveProperty('errors');\n      expect(result).toHaveProperty('warnings');\n      expect(result).toHaveProperty('info');\n      expect(Array.isArray(result.errors)).toBe(true);\n      expect(Array.isArray(result.warnings)).toBe(true);\n      expect(Array.isArray(result.info)).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // validateConvertedUnit() - Tonnage Validation\n  // ============================================================================\n  describe('validateConvertedUnit() - Tonnage Validation', () => {\n    it('should warn on non-standard tonnage', () => {\n      const unit = createValidUnit({ tonnage: 47 }); // Not in 5-ton increments\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.warnings.some(w => w.code === 'INVALID_TONNAGE')).toBe(true);\n    });\n\n    it('should accept standard tonnages', () => {\n      const tonnages = [20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 100];\n      \n      for (const tonnage of tonnages) {\n        const unit = createValidUnit({ \n          tonnage,\n          engine: { type: 'Standard', rating: tonnage * 4 },\n          movement: { walk: 4, jump: 0 },\n        });\n        const result = validateConvertedUnit(unit);\n        \n        expect(result.warnings.find(w => w.code === 'INVALID_TONNAGE')).toBeUndefined();\n      }\n    });\n  });\n\n  // ============================================================================\n  // validateConvertedUnit() - Engine Validation\n  // ============================================================================\n  describe('validateConvertedUnit() - Engine Validation', () => {\n    it('should error on engine rating below 10', () => {\n      const unit = createValidUnit({\n        engine: { type: 'Standard', rating: 5 },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.isValid).toBe(false);\n      expect(result.errors.some(e => e.code === 'INVALID_ENGINE_RATING')).toBe(true);\n    });\n\n    it('should error on engine rating above 500', () => {\n      const unit = createValidUnit({\n        engine: { type: 'Standard', rating: 550 },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.isValid).toBe(false);\n      expect(result.errors.some(e => e.code === 'INVALID_ENGINE_RATING')).toBe(true);\n    });\n\n    it('should error on engine rating not multiple of 5', () => {\n      const unit = createValidUnit({\n        engine: { type: 'Standard', rating: 203 },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.isValid).toBe(false);\n      expect(result.errors.some(e => e.code === 'INVALID_ENGINE_RATING')).toBe(true);\n    });\n\n    it('should accept valid engine ratings', () => {\n      const ratings = [100, 150, 200, 250, 300, 400];\n      \n      for (const rating of ratings) {\n        const tonnage = Math.floor(rating / 4);\n        const unit = createValidUnit({\n          tonnage: tonnage > 20 ? tonnage : 20,\n          engine: { type: 'Standard', rating },\n        });\n        const result = validateConvertedUnit(unit);\n        \n        expect(result.errors.find(e => e.code === 'INVALID_ENGINE_RATING')).toBeUndefined();\n      }\n    });\n  });\n\n  // ============================================================================\n  // validateConvertedUnit() - Movement Validation\n  // ============================================================================\n  describe('validateConvertedUnit() - Movement Validation', () => {\n    it('should error on walk MP less than 1', () => {\n      const unit = createValidUnit({\n        movement: { walk: 0, jump: 0 },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.isValid).toBe(false);\n      expect(result.errors.some(e => e.code === 'INVALID_WALK_MP')).toBe(true);\n    });\n\n    it('should info on walk MP mismatch with engine', () => {\n      // Engine 200 / tonnage 50 = 4 walk MP expected\n      const unit = createValidUnit({\n        tonnage: 50,\n        engine: { type: 'Standard', rating: 200 },\n        movement: { walk: 5, jump: 0 }, // Doesn't match\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.info.some(i => i.code === 'WALK_MP_MISMATCH')).toBe(true);\n    });\n\n    it('should not warn when walk MP matches engine', () => {\n      const unit = createValidUnit({\n        tonnage: 50,\n        engine: { type: 'Standard', rating: 200 },\n        movement: { walk: 4, jump: 0 }, // Matches: 200/50 = 4\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.info.find(i => i.code === 'WALK_MP_MISMATCH')).toBeUndefined();\n    });\n  });\n\n  // ============================================================================\n  // validateConvertedUnit() - Heat Sink Validation\n  // ============================================================================\n  describe('validateConvertedUnit() - Heat Sink Validation', () => {\n    it('should warn on less than 10 heat sinks', () => {\n      const unit = createValidUnit({\n        heatSinks: { type: 'Single', count: 5 },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.warnings.some(w => w.code === 'INSUFFICIENT_HEAT_SINKS')).toBe(true);\n    });\n\n    it('should not warn on 10 or more heat sinks', () => {\n      const unit = createValidUnit({\n        heatSinks: { type: 'Single', count: 10 },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.warnings.find(w => w.code === 'INSUFFICIENT_HEAT_SINKS')).toBeUndefined();\n    });\n  });\n\n  // ============================================================================\n  // validateConvertedUnit() - Armor Validation\n  // ============================================================================\n  describe('validateConvertedUnit() - Armor Validation', () => {\n    it('should error on head armor exceeding 9', () => {\n      const unit = createValidUnit({\n        armor: {\n          type: 'Standard',\n          allocation: {\n            head: 12,\n            centerTorso: 20,\n            leftTorso: 15,\n            rightTorso: 15,\n            leftArm: 10,\n            rightArm: 10,\n            leftLeg: 15,\n            rightLeg: 15,\n          },\n        },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.errors.some(e => e.code === 'HEAD_ARMOR_EXCEEDED')).toBe(true);\n    });\n\n    it('should accept head armor of 9', () => {\n      const unit = createValidUnit({\n        armor: {\n          type: 'Standard',\n          allocation: {\n            head: 9,\n            centerTorso: 20,\n            leftTorso: 15,\n            rightTorso: 15,\n            leftArm: 10,\n            rightArm: 10,\n            leftLeg: 15,\n            rightLeg: 15,\n          },\n        },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.errors.find(e => e.code === 'HEAD_ARMOR_EXCEEDED')).toBeUndefined();\n    });\n\n    it('should warn on location armor exceeding maximum', () => {\n      const unit = createValidUnit({\n        tonnage: 20, // Light mech has lower armor limits\n        engine: { type: 'Standard', rating: 80 },\n        movement: { walk: 4, jump: 0 },\n        armor: {\n          type: 'Standard',\n          allocation: {\n            head: 9,\n            centerTorso: 20,\n            leftTorso: 15,\n            rightTorso: 15,\n            leftArm: 50, // Way too much for a 20-ton mech\n            rightArm: 50,\n            leftLeg: 15,\n            rightLeg: 15,\n          },\n        },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.warnings.some(w => w.code === 'ARMOR_EXCEEDED')).toBe(true);\n    });\n\n    it('should handle front/rear armor format', () => {\n      const unit = createValidUnit({\n        armor: {\n          type: 'Standard',\n          allocation: {\n            head: 9,\n            centerTorso: { front: 30, rear: 10 },\n            leftTorso: { front: 20, rear: 8 },\n            rightTorso: { front: 20, rear: 8 },\n            leftArm: 16,\n            rightArm: 16,\n            leftLeg: 20,\n            rightLeg: 20,\n          },\n        },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      // Should be able to validate without errors\n      expect(result).toBeDefined();\n    });\n  });\n\n  // ============================================================================\n  // validateConvertedUnit() - Required Fields\n  // ============================================================================\n  describe('validateConvertedUnit() - Required Fields', () => {\n    it('should error on missing ID', () => {\n      const unit = createValidUnit({ id: '' });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.isValid).toBe(false);\n      expect(result.errors.some(e => e.code === 'MISSING_ID')).toBe(true);\n    });\n\n    it('should error on missing chassis', () => {\n      const unit = createValidUnit({ chassis: '' });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.isValid).toBe(false);\n      expect(result.errors.some(e => e.code === 'MISSING_CHASSIS')).toBe(true);\n    });\n\n    it('should error on missing model', () => {\n      const unit = createValidUnit({ model: '' });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.isValid).toBe(false);\n      expect(result.errors.some(e => e.code === 'MISSING_MODEL')).toBe(true);\n    });\n\n    it('should warn on no equipment', () => {\n      const unit = createValidUnit({ equipment: [] });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.warnings.some(w => w.code === 'NO_EQUIPMENT')).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // validateConvertedUnit() - Issue Structure\n  // ============================================================================\n  describe('validateConvertedUnit() - Issue Structure', () => {\n    it('should include code in issues', () => {\n      const unit = createValidUnit({ id: '' });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.errors[0].code).toBeDefined();\n    });\n\n    it('should include message in issues', () => {\n      const unit = createValidUnit({ id: '' });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.errors[0].message).toBeDefined();\n      expect(typeof result.errors[0].message).toBe('string');\n    });\n\n    it('should include severity in issues', () => {\n      const unit = createValidUnit({ id: '' });\n      const result = validateConvertedUnit(unit);\n      \n      expect(result.errors[0].severity).toBe(ConversionValidationSeverity.ERROR);\n    });\n\n    it('should include expected/actual in relevant issues', () => {\n      const unit = createValidUnit({\n        armor: {\n          type: 'Standard',\n          allocation: {\n            head: 15,\n            centerTorso: 20,\n            leftTorso: 15,\n            rightTorso: 15,\n            leftArm: 10,\n            rightArm: 10,\n            leftLeg: 15,\n            rightLeg: 15,\n          },\n        },\n      });\n      const result = validateConvertedUnit(unit);\n      \n      const headError = result.errors.find(e => e.code === 'HEAD_ARMOR_EXCEEDED');\n      expect(headError?.expected).toBe(9);\n      expect(headError?.actual).toBe(15);\n    });\n  });\n\n  // ============================================================================\n  // validateBatch()\n  // ============================================================================\n  describe('validateBatch()', () => {\n    it('should validate multiple units', () => {\n      const units = [\n        createValidUnit({ id: 'unit-1' }),\n        createValidUnit({ id: 'unit-2' }),\n        createValidUnit({ id: 'unit-3' }),\n      ];\n      \n      const result = validateBatch(units);\n      \n      expect(result.total).toBe(3);\n      expect(result.valid).toBe(3);\n      expect(result.invalid).toBe(0);\n    });\n\n    it('should count invalid units', () => {\n      const units = [\n        createValidUnit({ id: 'valid-1' }),\n        createValidUnit({ id: '' }), // Invalid - missing ID\n        createValidUnit({ id: 'valid-2' }),\n      ];\n      \n      const result = validateBatch(units);\n      \n      expect(result.total).toBe(3);\n      expect(result.valid).toBe(2);\n      expect(result.invalid).toBe(1);\n    });\n\n    it('should count units with warnings', () => {\n      const units = [\n        createValidUnit({ id: 'unit-1' }),\n        createValidUnit({ id: 'unit-2', tonnage: 47 }), // Warning - non-standard tonnage\n      ];\n      \n      const result = validateBatch(units);\n      \n      expect(result.withWarnings).toBe(1);\n    });\n\n    it('should include per-unit results', () => {\n      const units = [\n        createValidUnit({ id: 'unit-1' }),\n        createValidUnit({ id: 'unit-2' }),\n      ];\n      \n      const result = validateBatch(units);\n      \n      expect(result.results).toHaveLength(2);\n      expect(result.results[0].id).toBe('unit-1');\n      expect(result.results[1].id).toBe('unit-2');\n    });\n\n    it('should handle empty batch', () => {\n      const result = validateBatch([]);\n      \n      expect(result.total).toBe(0);\n      expect(result.valid).toBe(0);\n      expect(result.invalid).toBe(0);\n      expect(result.results).toHaveLength(0);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\conversion\\EquipmentNameResolver.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EquipmentResolution' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment Name Resolver Tests\n * \n * Tests for resolving MegaMekLab equipment names to internal IDs.\n * \n * @spec openspec/specs/equipment-database/spec.md\n */\n\nimport {\n  EquipmentNameResolver,\n  equipmentNameResolver,\n  EquipmentResolution,\n} from '@/services/conversion/EquipmentNameResolver';\nimport { TechBase } from '@/types/enums/TechBase';\n\ndescribe('EquipmentNameResolver', () => {\n  let resolver: EquipmentNameResolver;\n\n  beforeEach(() => {\n    resolver = new EquipmentNameResolver();\n  });\n\n  // ============================================================================\n  // Initialization\n  // ============================================================================\n  describe('Initialization', () => {\n    it('should initialize lazily', () => {\n      // Should not throw before initialization\n      const result = resolver.resolve('MediumLaser', 'Medium Laser');\n      expect(result).toBeDefined();\n    });\n\n    it('should use singleton instance', () => {\n      expect(equipmentNameResolver).toBeDefined();\n    });\n  });\n\n  // ============================================================================\n  // resolve() - Direct Type Mapping\n  // ============================================================================\n  describe('resolve() - Direct Type Mapping', () => {\n    it('should resolve standard lasers', () => {\n      expect(resolver.resolve('SmallLaser', 'Small Laser').found).toBe(true);\n      expect(resolver.resolve('MediumLaser', 'Medium Laser').found).toBe(true);\n      expect(resolver.resolve('LargeLaser', 'Large Laser').found).toBe(true);\n    });\n\n    it('should resolve ER lasers (IS)', () => {\n      expect(resolver.resolve('ISERSmallLaser', 'ER Small Laser').found).toBe(true);\n      expect(resolver.resolve('ISERMediumLaser', 'ER Medium Laser').found).toBe(true);\n      expect(resolver.resolve('ISERLargeLaser', 'ER Large Laser').found).toBe(true);\n    });\n\n    it('should resolve ER lasers (Clan)', () => {\n      expect(resolver.resolve('CLERSmallLaser', 'Clan ER Small Laser').found).toBe(true);\n      expect(resolver.resolve('CLERMediumLaser', 'Clan ER Medium Laser').found).toBe(true);\n      expect(resolver.resolve('CLERLargeLaser', 'Clan ER Large Laser').found).toBe(true);\n    });\n\n    it('should resolve pulse lasers (IS)', () => {\n      expect(resolver.resolve('SmallPulseLaser', 'Small Pulse Laser').found).toBe(true);\n      expect(resolver.resolve('MediumPulseLaser', 'Medium Pulse Laser').found).toBe(true);\n      expect(resolver.resolve('LargePulseLaser', 'Large Pulse Laser').found).toBe(true);\n    });\n\n    it('should resolve pulse lasers (Clan)', () => {\n      expect(resolver.resolve('CLSmallPulseLaser', 'Clan Small Pulse Laser').found).toBe(true);\n      expect(resolver.resolve('CLMediumPulseLaser', 'Clan Medium Pulse Laser').found).toBe(true);\n      expect(resolver.resolve('CLLargePulseLaser', 'Clan Large Pulse Laser').found).toBe(true);\n    });\n\n    it('should resolve PPCs', () => {\n      expect(resolver.resolve('PPC', 'PPC').found).toBe(true);\n      expect(resolver.resolve('ISERPPC', 'ER PPC').found).toBe(true);\n      expect(resolver.resolve('CLERPPC', 'Clan ER PPC').found).toBe(true);\n    });\n\n    it('should resolve autocannons', () => {\n      expect(resolver.resolve('AC2', 'Autocannon/2').found).toBe(true);\n      expect(resolver.resolve('AC5', 'Autocannon/5').found).toBe(true);\n      expect(resolver.resolve('AC10', 'Autocannon/10').found).toBe(true);\n      expect(resolver.resolve('AC20', 'Autocannon/20').found).toBe(true);\n    });\n\n    it('should resolve ultra ACs (IS)', () => {\n      expect(resolver.resolve('ISUltraAC5', 'Ultra AC/5').found).toBe(true);\n      expect(resolver.resolve('ISUltraAC10', 'Ultra AC/10').found).toBe(true);\n    });\n\n    it('should resolve ultra ACs (Clan)', () => {\n      expect(resolver.resolve('CLUltraAC5', 'Clan Ultra AC/5').found).toBe(true);\n      expect(resolver.resolve('CLUltraAC10', 'Clan Ultra AC/10').found).toBe(true);\n    });\n\n    it('should resolve LB-X ACs', () => {\n      expect(resolver.resolve('ISLBXAC10', 'LB 10-X AC').found).toBe(true);\n      expect(resolver.resolve('CLLBXAC10', 'Clan LB 10-X AC').found).toBe(true);\n    });\n\n    it('should resolve gauss rifles', () => {\n      expect(resolver.resolve('GaussRifle', 'Gauss Rifle').found).toBe(true);\n      expect(resolver.resolve('ISGaussRifle', 'Gauss Rifle').found).toBe(true);\n      expect(resolver.resolve('CLGaussRifle', 'Clan Gauss Rifle').found).toBe(true);\n    });\n\n    it('should resolve missile weapons', () => {\n      expect(resolver.resolve('LRM5', 'LRM 5').found).toBe(true);\n      expect(resolver.resolve('LRM10', 'LRM 10').found).toBe(true);\n      expect(resolver.resolve('LRM15', 'LRM 15').found).toBe(true);\n      expect(resolver.resolve('LRM20', 'LRM 20').found).toBe(true);\n      expect(resolver.resolve('SRM2', 'SRM 2').found).toBe(true);\n      expect(resolver.resolve('SRM4', 'SRM 4').found).toBe(true);\n      expect(resolver.resolve('SRM6', 'SRM 6').found).toBe(true);\n    });\n\n    it('should resolve streak SRMs', () => {\n      expect(resolver.resolve('ISStreakSRM2', 'Streak SRM 2').found).toBe(true);\n      expect(resolver.resolve('CLStreakSRM4', 'Clan Streak SRM 4').found).toBe(true);\n    });\n\n    it('should resolve machine guns', () => {\n      expect(resolver.resolve('MachineGun', 'Machine Gun').found).toBe(true);\n      expect(resolver.resolve('ISLightMachineGun', 'Light Machine Gun').found).toBe(true);\n      expect(resolver.resolve('ISHeavyMachineGun', 'Heavy Machine Gun').found).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // resolve() - Quantity Prefix Stripping\n  // ============================================================================\n  describe('resolve() - Quantity Prefix Stripping', () => {\n    it('should handle quantity prefixes', () => {\n      // MegaMekLab sometimes prefixes with count like \"1ISMediumLaser\"\n      const result = resolver.resolve('1ISMediumLaser', 'Medium Laser');\n      // Should attempt to resolve after stripping the quantity\n      expect(result).toBeDefined();\n    });\n\n    it('should handle prefixes with tech base', () => {\n      const result = resolver.resolve('2CLERMediumLaser', 'Clan ER Medium Laser');\n      expect(result).toBeDefined();\n    });\n  });\n\n  // ============================================================================\n  // resolve() - Equipment Categories\n  // ============================================================================\n  describe('resolve() - Equipment Categories', () => {\n    it('should resolve AMS', () => {\n      expect(resolver.resolve('AMS', 'Anti-Missile System').found).toBe(true);\n      expect(resolver.resolve('ISAMS', 'Anti-Missile System').found).toBe(true);\n      expect(resolver.resolve('CLAMS', 'Clan Anti-Missile System').found).toBe(true);\n    });\n\n    it('should resolve TAG', () => {\n      expect(resolver.resolve('TAG', 'TAG').found).toBe(true);\n      expect(resolver.resolve('LightTAG', 'Light TAG').found).toBe(true);\n    });\n\n    it('should resolve C3 systems', () => {\n      expect(resolver.resolve('C3MasterComputer', 'C3 Master').found).toBe(true);\n      expect(resolver.resolve('ISC3SlaveUnit', 'C3 Slave').found).toBe(true);\n    });\n\n    it('should resolve ECM/BAP', () => {\n      expect(resolver.resolve('GuardianECM', 'Guardian ECM').found).toBe(true);\n      expect(resolver.resolve('BeagleActiveProbe', 'Beagle Active Probe').found).toBe(true);\n    });\n\n    it('should resolve targeting computers', () => {\n      expect(resolver.resolve('ISTargetingComputer', 'Targeting Computer').found).toBe(true);\n      expect(resolver.resolve('CLTargetingComputer', 'Clan Targeting Computer').found).toBe(true);\n    });\n\n    it('should resolve heat sinks', () => {\n      expect(resolver.resolve('HeatSink', 'Heat Sink').found).toBe(true);\n      expect(resolver.resolve('ISDoubleHeatSink', 'Double Heat Sink').found).toBe(true);\n      expect(resolver.resolve('CLDoubleHeatSink', 'Clan Double Heat Sink').found).toBe(true);\n    });\n\n    it('should resolve jump jets', () => {\n      // Jump jets may or may not be in the equipment database\n      // Test that resolution returns a defined result\n      const jjResult = resolver.resolve('JumpJet', 'Jump Jet');\n      expect(jjResult).toBeDefined();\n      expect(jjResult.originalType).toBe('JumpJet');\n    });\n\n    it('should resolve CASE', () => {\n      // CASE may or may not be in the equipment database\n      // Test that resolution returns a defined result\n      const caseResult = resolver.resolve('CASE', 'CASE');\n      expect(caseResult).toBeDefined();\n      expect(caseResult.originalType).toBe('CASE');\n    });\n\n    it('should resolve MASC', () => {\n      expect(resolver.resolve('ISMASC', 'MASC').found).toBe(true);\n      expect(resolver.resolve('CLMASC', 'Clan MASC').found).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // resolve() - Confidence Levels\n  // ============================================================================\n  describe('resolve() - Confidence Levels', () => {\n    it('should return exact confidence for direct mapping', () => {\n      const result = resolver.resolve('MediumLaser', 'Medium Laser');\n      if (result.found) {\n        expect(result.confidence).toBe('exact');\n      }\n    });\n\n    it('should return none confidence for unknown equipment', () => {\n      const result = resolver.resolve('CompletelyFakeWeapon12345', 'Fake Weapon');\n      expect(result.found).toBe(false);\n      expect(result.confidence).toBe('none');\n    });\n\n    it('should preserve original name and type', () => {\n      const result = resolver.resolve('MediumLaser', 'Medium Laser');\n      expect(result.originalName).toBe('Medium Laser');\n      expect(result.originalType).toBe('MediumLaser');\n    });\n  });\n\n  // ============================================================================\n  // resolve() - Tech Base Context\n  // ============================================================================\n  describe('resolve() - Tech Base Context', () => {\n    it('should use tech base for ambiguous resolution', () => {\n      // Some equipment might resolve differently based on tech base\n      const isResult = resolver.resolve('MASC', 'MASC', TechBase.INNER_SPHERE);\n      const clanResult = resolver.resolve('MASC', 'MASC', TechBase.CLAN);\n      \n      // Both should resolve, possibly to different IDs\n      expect(isResult).toBeDefined();\n      expect(clanResult).toBeDefined();\n    });\n  });\n\n  // ============================================================================\n  // getById()\n  // ============================================================================\n  describe('getById()', () => {\n    it('should return equipment by ID', () => {\n      // After initialization, should be able to look up by ID\n      resolver.resolve('MediumLaser', 'Medium Laser'); // Trigger initialization\n      \n      const equipment = resolver.getById('medium-laser');\n      // May or may not find depending on equipment database state\n      expect(equipment === undefined || equipment !== null).toBe(true);\n    });\n  });\n\n  // ============================================================================\n  // isSystemComponent()\n  // ============================================================================\n  describe('isSystemComponent()', () => {\n    it('should identify system components', () => {\n      expect(resolver.isSystemComponent('Life Support')).toBe(true);\n      expect(resolver.isSystemComponent('Sensors')).toBe(true);\n      expect(resolver.isSystemComponent('Cockpit')).toBe(true);\n      expect(resolver.isSystemComponent('Gyro')).toBe(true);\n    });\n\n    it('should identify actuators', () => {\n      expect(resolver.isSystemComponent('Shoulder')).toBe(true);\n      expect(resolver.isSystemComponent('Upper Arm Actuator')).toBe(true);\n      expect(resolver.isSystemComponent('Lower Arm Actuator')).toBe(true);\n      expect(resolver.isSystemComponent('Hand Actuator')).toBe(true);\n      expect(resolver.isSystemComponent('Hip')).toBe(true);\n      expect(resolver.isSystemComponent('Upper Leg Actuator')).toBe(true);\n      expect(resolver.isSystemComponent('Lower Leg Actuator')).toBe(true);\n      expect(resolver.isSystemComponent('Foot Actuator')).toBe(true);\n    });\n\n    it('should identify engine components', () => {\n      expect(resolver.isSystemComponent('Fusion Engine')).toBe(true);\n      expect(resolver.isSystemComponent('Engine')).toBe(true);\n    });\n\n    it('should identify empty slots', () => {\n      expect(resolver.isSystemComponent('-Empty-')).toBe(true);\n      expect(resolver.isSystemComponent('Empty')).toBe(true);\n    });\n\n    it('should not identify weapons as system components', () => {\n      expect(resolver.isSystemComponent('Medium Laser')).toBe(false);\n      expect(resolver.isSystemComponent('AC/20')).toBe(false);\n      expect(resolver.isSystemComponent('LRM 20')).toBe(false);\n    });\n  });\n\n  // ============================================================================\n  // isHeatSink()\n  // ============================================================================\n  describe('isHeatSink()', () => {\n    it('should identify heat sinks', () => {\n      expect(resolver.isHeatSink('Heat Sink')).toBe(true);\n      expect(resolver.isHeatSink('Double Heat Sink')).toBe(true);\n      expect(resolver.isHeatSink('Clan Double Heat Sink')).toBe(true);\n    });\n\n    it('should handle alternate spellings', () => {\n      expect(resolver.isHeatSink('heatsink')).toBe(true);\n      expect(resolver.isHeatSink('HeatSink')).toBe(true);\n    });\n\n    it('should not identify non-heat sinks', () => {\n      expect(resolver.isHeatSink('Medium Laser')).toBe(false);\n      expect(resolver.isHeatSink('CASE')).toBe(false);\n    });\n  });\n\n  // ============================================================================\n  // getMappings()\n  // ============================================================================\n  describe('getMappings()', () => {\n    it('should return all registered mappings', () => {\n      const mappings = resolver.getMappings();\n      \n      expect(mappings).toBeDefined();\n      expect(typeof mappings).toBe('object');\n      expect(mappings['MediumLaser']).toBe('medium-laser');\n      expect(mappings['LargeLaser']).toBe('large-laser');\n    });\n\n    it('should return a copy, not the original', () => {\n      const mappings1 = resolver.getMappings();\n      const mappings2 = resolver.getMappings();\n      \n      expect(mappings1).not.toBe(mappings2);\n      expect(mappings1).toEqual(mappings2);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\conversion\\LocationMappings.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type `any[]` to a variable of type `string[]`.","line":245,"column":33,"nodeType":"Property","messageId":"unsafeAssignment","endLine":245,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type `any[]` to a variable of type `string[]`.","line":246,"column":34,"nodeType":"Property","messageId":"unsafeAssignment","endLine":246,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type `any[]` to a variable of type `string[]`.","line":247,"column":35,"nodeType":"Property","messageId":"unsafeAssignment","endLine":247,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type `any[]` to a variable of type `string[]`.","line":248,"column":36,"nodeType":"Property","messageId":"unsafeAssignment","endLine":248,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type `any[]` to a variable of type `string[]`.","line":249,"column":37,"nodeType":"Property","messageId":"unsafeAssignment","endLine":249,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type `any[]` to a variable of type `string[]`.","line":250,"column":33,"nodeType":"Property","messageId":"unsafeAssignment","endLine":250,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type `any[]` to a variable of type `string[]`.","line":251,"column":34,"nodeType":"Property","messageId":"unsafeAssignment","endLine":251,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":265,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":265,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":266,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":266,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":268,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":268,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":269,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":269,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":271,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":271,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":272,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":272,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":274,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":274,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":276,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":276,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":278,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":278,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":280,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":280,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":282,"column":9,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":282,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type `any[]` to a variable of type `string[]`.","line":286,"column":29,"nodeType":"Property","messageId":"unsafeAssignment","endLine":286,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type `any[]` to a variable of type `string[]`.","line":298,"column":29,"nodeType":"Property","messageId":"unsafeAssignment","endLine":298,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Location Mappings Tests\n * \n * Tests for location name normalization and armor/critical slot parsing.\n * \n * @spec openspec/specs/critical-slot-allocation/spec.md\n */\n\nimport {\n  mapLocation,\n  parseLocation,\n  convertArmorLocations,\n  calculateTotalArmor,\n  parseCriticalSlots,\n  getAllMechLocations,\n  isValidMechLocation,\n  BIPED_SLOT_COUNTS,\n  SourceArmorLocation,\n  SourceCriticalEntry,\n} from '@/services/conversion/LocationMappings';\nimport { MechLocation } from '@/types/construction/CriticalSlotAllocation';\n\ndescribe('LocationMappings', () => {\n  // ============================================================================\n  // mapLocation()\n  // ============================================================================\n  describe('mapLocation()', () => {\n    it('should map full location names', () => {\n      expect(mapLocation('Head')).toBe(MechLocation.HEAD);\n      expect(mapLocation('Center Torso')).toBe(MechLocation.CENTER_TORSO);\n      expect(mapLocation('Left Torso')).toBe(MechLocation.LEFT_TORSO);\n      expect(mapLocation('Right Torso')).toBe(MechLocation.RIGHT_TORSO);\n      expect(mapLocation('Left Arm')).toBe(MechLocation.LEFT_ARM);\n      expect(mapLocation('Right Arm')).toBe(MechLocation.RIGHT_ARM);\n      expect(mapLocation('Left Leg')).toBe(MechLocation.LEFT_LEG);\n      expect(mapLocation('Right Leg')).toBe(MechLocation.RIGHT_LEG);\n    });\n\n    it('should map abbreviated location names', () => {\n      expect(mapLocation('HD')).toBe(MechLocation.HEAD);\n      expect(mapLocation('CT')).toBe(MechLocation.CENTER_TORSO);\n      expect(mapLocation('LT')).toBe(MechLocation.LEFT_TORSO);\n      expect(mapLocation('RT')).toBe(MechLocation.RIGHT_TORSO);\n      expect(mapLocation('LA')).toBe(MechLocation.LEFT_ARM);\n      expect(mapLocation('RA')).toBe(MechLocation.RIGHT_ARM);\n      expect(mapLocation('LL')).toBe(MechLocation.LEFT_LEG);\n      expect(mapLocation('RL')).toBe(MechLocation.RIGHT_LEG);\n    });\n\n    it('should map single letter for head', () => {\n      expect(mapLocation('H')).toBe(MechLocation.HEAD);\n    });\n\n    it('should return undefined for unknown locations', () => {\n      expect(mapLocation('Unknown')).toBeUndefined();\n      expect(mapLocation('')).toBeUndefined();\n      expect(mapLocation('XYZ')).toBeUndefined();\n    });\n\n    it('should handle whitespace', () => {\n      expect(mapLocation('  Head  ')).toBe(MechLocation.HEAD);\n      expect(mapLocation('  CT  ')).toBe(MechLocation.CENTER_TORSO);\n    });\n\n    it('should map camelCase variations', () => {\n      expect(mapLocation('CenterTorso')).toBe(MechLocation.CENTER_TORSO);\n      expect(mapLocation('LeftTorso')).toBe(MechLocation.LEFT_TORSO);\n      expect(mapLocation('RightTorso')).toBe(MechLocation.RIGHT_TORSO);\n      expect(mapLocation('LeftArm')).toBe(MechLocation.LEFT_ARM);\n      expect(mapLocation('RightArm')).toBe(MechLocation.RIGHT_ARM);\n      expect(mapLocation('LeftLeg')).toBe(MechLocation.LEFT_LEG);\n      expect(mapLocation('RightLeg')).toBe(MechLocation.RIGHT_LEG);\n    });\n  });\n\n  // ============================================================================\n  // parseLocation()\n  // ============================================================================\n  describe('parseLocation()', () => {\n    it('should parse standard locations', () => {\n      const head = parseLocation('Head');\n      expect(head?.location).toBe(MechLocation.HEAD);\n      expect(head?.isRear).toBe(false);\n    });\n\n    it('should detect rear locations', () => {\n      expect(parseLocation('Center Torso (Rear)')?.isRear).toBe(true);\n      expect(parseLocation('Left Torso (Rear)')?.isRear).toBe(true);\n      expect(parseLocation('Right Torso (Rear)')?.isRear).toBe(true);\n    });\n\n    it('should parse abbreviated rear locations', () => {\n      expect(parseLocation('CTR')?.isRear).toBe(true);\n      expect(parseLocation('CTR')?.location).toBe(MechLocation.CENTER_TORSO);\n      expect(parseLocation('LTR')?.isRear).toBe(true);\n      expect(parseLocation('LTR')?.location).toBe(MechLocation.LEFT_TORSO);\n      expect(parseLocation('RTR')?.isRear).toBe(true);\n      expect(parseLocation('RTR')?.location).toBe(MechLocation.RIGHT_TORSO);\n    });\n\n    it('should parse CT (Rear) format', () => {\n      expect(parseLocation('CT (Rear)')?.isRear).toBe(true);\n      expect(parseLocation('LT (Rear)')?.isRear).toBe(true);\n      expect(parseLocation('RT (Rear)')?.isRear).toBe(true);\n    });\n\n    it('should use fuzzy matching for partial names', () => {\n      expect(parseLocation('head something')?.location).toBe(MechLocation.HEAD);\n      expect(parseLocation('center torso area')?.location).toBe(MechLocation.CENTER_TORSO);\n      expect(parseLocation('my left arm')?.location).toBe(MechLocation.LEFT_ARM);\n    });\n\n    it('should return undefined for invalid locations', () => {\n      expect(parseLocation('')).toBeUndefined();\n      expect(parseLocation('random text')).toBeUndefined();\n    });\n  });\n\n  // ============================================================================\n  // convertArmorLocations()\n  // ============================================================================\n  describe('convertArmorLocations()', () => {\n    it('should convert armor allocation from source format', () => {\n      const sourceArmor: SourceArmorLocation[] = [\n        { location: 'Head', armor_points: 9 },\n        { location: 'Center Torso', armor_points: 40, rear_armor_points: 15 },\n        { location: 'Left Torso', armor_points: 28, rear_armor_points: 10 },\n        { location: 'Right Torso', armor_points: 28, rear_armor_points: 10 },\n        { location: 'Left Arm', armor_points: 24 },\n        { location: 'Right Arm', armor_points: 24 },\n        { location: 'Left Leg', armor_points: 30 },\n        { location: 'Right Leg', armor_points: 30 },\n      ];\n\n      const allocation = convertArmorLocations(sourceArmor);\n\n      expect(allocation.head).toBe(9);\n      expect(allocation.centerTorso).toBe(40);\n      expect(allocation.centerTorsoRear).toBe(15);\n      expect(allocation.leftTorso).toBe(28);\n      expect(allocation.leftTorsoRear).toBe(10);\n      expect(allocation.rightTorso).toBe(28);\n      expect(allocation.rightTorsoRear).toBe(10);\n      expect(allocation.leftArm).toBe(24);\n      expect(allocation.rightArm).toBe(24);\n      expect(allocation.leftLeg).toBe(30);\n      expect(allocation.rightLeg).toBe(30);\n    });\n\n    it('should handle separate rear armor entries', () => {\n      const sourceArmor: SourceArmorLocation[] = [\n        { location: 'Center Torso', armor_points: 40 },\n        { location: 'Center Torso (Rear)', armor_points: 15 },\n      ];\n\n      const allocation = convertArmorLocations(sourceArmor);\n\n      expect(allocation.centerTorso).toBe(40);\n      expect(allocation.centerTorsoRear).toBe(15);\n    });\n\n    it('should handle null rear armor', () => {\n      const sourceArmor: SourceArmorLocation[] = [\n        { location: 'Left Arm', armor_points: 20, rear_armor_points: null },\n      ];\n\n      const allocation = convertArmorLocations(sourceArmor);\n\n      expect(allocation.leftArm).toBe(20);\n    });\n\n    it('should default missing locations to 0', () => {\n      const allocation = convertArmorLocations([]);\n\n      expect(allocation.head).toBe(0);\n      expect(allocation.centerTorso).toBe(0);\n      expect(allocation.leftArm).toBe(0);\n    });\n\n    it('should handle abbreviated location names', () => {\n      const sourceArmor: SourceArmorLocation[] = [\n        { location: 'HD', armor_points: 9 },\n        { location: 'CT', armor_points: 30 },\n        { location: 'LA', armor_points: 20 },\n      ];\n\n      const allocation = convertArmorLocations(sourceArmor);\n\n      expect(allocation.head).toBe(9);\n      expect(allocation.centerTorso).toBe(30);\n      expect(allocation.leftArm).toBe(20);\n    });\n  });\n\n  // ============================================================================\n  // calculateTotalArmor()\n  // ============================================================================\n  describe('calculateTotalArmor()', () => {\n    it('should sum all armor points', () => {\n      const allocation = {\n        head: 9,\n        centerTorso: 40,\n        centerTorsoRear: 15,\n        leftTorso: 28,\n        leftTorsoRear: 10,\n        rightTorso: 28,\n        rightTorsoRear: 10,\n        leftArm: 24,\n        rightArm: 24,\n        leftLeg: 30,\n        rightLeg: 30,\n      };\n\n      const total = calculateTotalArmor(allocation);\n\n      expect(total).toBe(9 + 40 + 15 + 28 + 10 + 28 + 10 + 24 + 24 + 30 + 30);\n    });\n\n    it('should handle zero armor', () => {\n      const allocation = {\n        head: 0,\n        centerTorso: 0,\n        centerTorsoRear: 0,\n        leftTorso: 0,\n        leftTorsoRear: 0,\n        rightTorso: 0,\n        rightTorsoRear: 0,\n        leftArm: 0,\n        rightArm: 0,\n        leftLeg: 0,\n        rightLeg: 0,\n      };\n\n      expect(calculateTotalArmor(allocation)).toBe(0);\n    });\n  });\n\n  // ============================================================================\n  // parseCriticalSlots()\n  // ============================================================================\n  describe('parseCriticalSlots()', () => {\n    it('should parse properly separated location entries', () => {\n      const entries: SourceCriticalEntry[] = [\n        { location: 'Head', slots: ['Life Support', 'Sensors', 'Cockpit', 'null', 'Sensors', 'Life Support'] },\n        { location: 'Left Arm', slots: Array(12).fill('-Empty-') },\n        { location: 'Right Arm', slots: Array(12).fill('-Empty-') },\n        { location: 'Left Torso', slots: Array(12).fill('-Empty-') },\n        { location: 'Right Torso', slots: Array(12).fill('-Empty-') },\n        { location: 'Center Torso', slots: Array(12).fill('-Empty-') },\n        { location: 'Left Leg', slots: Array(6).fill('-Empty-') },\n        { location: 'Right Leg', slots: Array(6).fill('-Empty-') },\n      ];\n\n      const result = parseCriticalSlots(entries);\n\n      expect(result.length).toBe(8);\n      expect(result.find(r => r.location === MechLocation.HEAD)?.slots.length).toBe(6);\n    });\n\n    it('should handle combined format (all slots in one entry)', () => {\n      // MegaMekLab converter sometimes outputs all slots in a single concatenated array\n      // Order: Head(12), LeftLeg(12), RightLeg(12), LeftArm(12), RightArm(12), LeftTorso(12), RightTorso(12), CenterTorso(12)\n      const combinedSlots = [\n        // Head (6 real + 6 padding)\n        ...Array(6).fill('Head Slot'),\n        ...Array(6).fill('-Empty-'),\n        // Left Leg (6 real + 6 padding)\n        ...Array(6).fill('LL Slot'),\n        ...Array(6).fill('-Empty-'),\n        // Right Leg (6 real + 6 padding)\n        ...Array(6).fill('RL Slot'),\n        ...Array(6).fill('-Empty-'),\n        // Left Arm (12)\n        ...Array(12).fill('LA Slot'),\n        // Right Arm (12)\n        ...Array(12).fill('RA Slot'),\n        // Left Torso (12)\n        ...Array(12).fill('LT Slot'),\n        // Right Torso (12)\n        ...Array(12).fill('RT Slot'),\n        // Center Torso (12)\n        ...Array(12).fill('CT Slot'),\n      ];\n\n      const entries: SourceCriticalEntry[] = [\n        { location: 'Head', slots: combinedSlots },\n      ];\n\n      const result = parseCriticalSlots(entries);\n\n      expect(result.length).toBe(8);\n      expect(result.find(r => r.location === MechLocation.HEAD)?.slots.length).toBe(6);\n      expect(result.find(r => r.location === MechLocation.LEFT_ARM)?.slots.length).toBe(12);\n    });\n\n    it('should trim slots to actual capacity', () => {\n      const entries: SourceCriticalEntry[] = [\n        { location: 'Head', slots: Array(12).fill('Slot') }, // Head only has 6 slots\n      ];\n\n      const result = parseCriticalSlots(entries);\n\n      expect(result.find(r => r.location === MechLocation.HEAD)?.slots.length).toBe(6);\n    });\n\n    it('should handle empty entries', () => {\n      const result = parseCriticalSlots([]);\n      expect(result).toHaveLength(0);\n    });\n  });\n\n  // ============================================================================\n  // BIPED_SLOT_COUNTS\n  // ============================================================================\n  describe('BIPED_SLOT_COUNTS', () => {\n    it('should have correct slot counts', () => {\n      expect(BIPED_SLOT_COUNTS[MechLocation.HEAD]).toBe(6);\n      expect(BIPED_SLOT_COUNTS[MechLocation.CENTER_TORSO]).toBe(12);\n      expect(BIPED_SLOT_COUNTS[MechLocation.LEFT_TORSO]).toBe(12);\n      expect(BIPED_SLOT_COUNTS[MechLocation.RIGHT_TORSO]).toBe(12);\n      expect(BIPED_SLOT_COUNTS[MechLocation.LEFT_ARM]).toBe(12);\n      expect(BIPED_SLOT_COUNTS[MechLocation.RIGHT_ARM]).toBe(12);\n      expect(BIPED_SLOT_COUNTS[MechLocation.LEFT_LEG]).toBe(6);\n      expect(BIPED_SLOT_COUNTS[MechLocation.RIGHT_LEG]).toBe(6);\n    });\n\n    it('should sum to 78 total slots', () => {\n      const total = Object.values(BIPED_SLOT_COUNTS).reduce((a, b) => a + b, 0);\n      expect(total).toBe(78);\n    });\n  });\n\n  // ============================================================================\n  // getAllMechLocations()\n  // ============================================================================\n  describe('getAllMechLocations()', () => {\n    it('should return all 8 locations', () => {\n      const locations = getAllMechLocations();\n      expect(locations).toContain(MechLocation.HEAD);\n      expect(locations).toContain(MechLocation.CENTER_TORSO);\n      expect(locations).toContain(MechLocation.LEFT_TORSO);\n      expect(locations).toContain(MechLocation.RIGHT_TORSO);\n      expect(locations).toContain(MechLocation.LEFT_ARM);\n      expect(locations).toContain(MechLocation.RIGHT_ARM);\n      expect(locations).toContain(MechLocation.LEFT_LEG);\n      expect(locations).toContain(MechLocation.RIGHT_LEG);\n    });\n  });\n\n  // ============================================================================\n  // isValidMechLocation()\n  // ============================================================================\n  describe('isValidMechLocation()', () => {\n    it('should return true for valid locations', () => {\n      expect(isValidMechLocation('Head')).toBe(true);\n      expect(isValidMechLocation('CT')).toBe(true);\n      expect(isValidMechLocation('Left Arm')).toBe(true);\n    });\n\n    it('should return false for invalid locations', () => {\n      expect(isValidMechLocation('')).toBe(false);\n      expect(isValidMechLocation('Unknown')).toBe(false);\n      expect(isValidMechLocation('XYZ')).toBe(false);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\conversion\\MTFImportService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IMTFImportResult' is defined but never used.","line":9,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * MTF Import Service Tests\n * \n * Tests for importing and validating unit data from JSON.\n * \n * @spec openspec/specs/data-loading-architecture/spec.md\n */\n\nimport { MTFImportService, getMTFImportService, IMTFImportResult } from '@/services/conversion/MTFImportService';\nimport { ISerializedUnit } from '@/types/unit/UnitSerialization';\nimport { TechBase } from '@/types/enums/TechBase';\n\ndescribe('MTFImportService', () => {\n  let service: MTFImportService;\n\n  beforeEach(() => {\n    service = getMTFImportService();\n  });\n\n  // ============================================================================\n  // Singleton Pattern\n  // ============================================================================\n  describe('Singleton Pattern', () => {\n    it('should return the same instance', () => {\n      const instance1 = getMTFImportService();\n      const instance2 = getMTFImportService();\n      expect(instance1).toBe(instance2);\n    });\n\n    it('should return same instance from static method', () => {\n      const instance1 = MTFImportService.getInstance();\n      const instance2 = MTFImportService.getInstance();\n      expect(instance1).toBe(instance2);\n    });\n  });\n\n  // ============================================================================\n  // import() - Raw MTF (not implemented)\n  // ============================================================================\n  describe('import()', () => {\n    it('should return error for raw MTF parsing', () => {\n      const result = service.import('some mtf content');\n      \n      expect(result.success).toBe(false);\n      expect(result.errors).toContain('Direct MTF parsing not implemented. Use importFromJSON for pre-converted JSON.');\n    });\n  });\n\n  // ============================================================================\n  // validate() - Raw MTF (not implemented)\n  // ============================================================================\n  describe('validate()', () => {\n    it('should return error for raw MTF validation', () => {\n      const result = service.validate('some mtf content');\n      \n      expect(result.isValid).toBe(false);\n      expect(result.errors).toContain('Direct MTF validation not implemented. Use validateJSON for JSON data.');\n    });\n  });\n\n  // ============================================================================\n  // validateJSON()\n  // ============================================================================\n  describe('validateJSON()', () => {\n    it('should reject non-object data', () => {\n      const result = service.validateJSON(null);\n      expect(result.isValid).toBe(false);\n      expect(result.errors).toContain('Data must be an object');\n    });\n\n    it('should reject undefined', () => {\n      const result = service.validateJSON(undefined);\n      expect(result.isValid).toBe(false);\n    });\n\n    it('should validate required string fields', () => {\n      const result = service.validateJSON({\n        id: 123, // wrong type\n        chassis: 'Atlas',\n        model: 'AS7-D',\n        unitType: 'BattleMech',\n        configuration: 'Biped',\n        techBase: 'Inner Sphere',\n        rulesLevel: 'Standard',\n        era: 'Star League',\n        year: 2755,\n        tonnage: 100,\n      });\n\n      expect(result.isValid).toBe(false);\n      expect(result.errors).toContain('Field \"id\" must be a string');\n    });\n\n    it('should validate required number fields', () => {\n      const result = service.validateJSON({\n        id: 'test-id',\n        chassis: 'Atlas',\n        model: 'AS7-D',\n        unitType: 'BattleMech',\n        configuration: 'Biped',\n        techBase: 'Inner Sphere',\n        rulesLevel: 'Standard',\n        era: 'Star League',\n        year: '2755', // wrong type\n        tonnage: 100,\n      });\n\n      expect(result.isValid).toBe(false);\n      expect(result.errors).toContain('Field \"year\" must be a number');\n    });\n\n    it('should validate required object fields', () => {\n      const result = service.validateJSON({\n        id: 'test-id',\n        chassis: 'Atlas',\n        model: 'AS7-D',\n        unitType: 'BattleMech',\n        configuration: 'Biped',\n        techBase: 'Inner Sphere',\n        rulesLevel: 'Standard',\n        era: 'Star League',\n        year: 2755,\n        tonnage: 100,\n        engine: null, // should be object\n      });\n\n      expect(result.isValid).toBe(false);\n      expect(result.errors).toContain('Field \"engine\" must be an object');\n    });\n\n    it('should validate equipment is array', () => {\n      const result = service.validateJSON({\n        id: 'test-id',\n        chassis: 'Atlas',\n        model: 'AS7-D',\n        unitType: 'BattleMech',\n        configuration: 'Biped',\n        techBase: 'Inner Sphere',\n        rulesLevel: 'Standard',\n        era: 'Star League',\n        year: 2755,\n        tonnage: 100,\n        engine: { type: 'Standard', rating: 300 },\n        gyro: { type: 'Standard' },\n        structure: { type: 'Standard' },\n        armor: { type: 'Standard', allocation: {} },\n        heatSinks: { type: 'Single', count: 10 },\n        movement: { walk: 3, jump: 0 },\n        criticalSlots: {},\n        equipment: 'not-an-array', // should be array\n      });\n\n      expect(result.isValid).toBe(false);\n      expect(result.errors).toContain('Field \"equipment\" must be an array');\n    });\n\n    it('should pass valid minimal data', () => {\n      const result = service.validateJSON({\n        id: 'test-id',\n        chassis: 'Atlas',\n        model: 'AS7-D',\n        unitType: 'BattleMech',\n        configuration: 'Biped',\n        techBase: 'Inner Sphere',\n        rulesLevel: 'Standard',\n        era: 'Star League',\n        year: 2755,\n        tonnage: 100,\n        engine: { type: 'Standard', rating: 300 },\n        gyro: { type: 'Standard' },\n        structure: { type: 'Standard' },\n        armor: { type: 'Standard', allocation: {} },\n        heatSinks: { type: 'Single', count: 10 },\n        movement: { walk: 3, jump: 0 },\n        criticalSlots: {},\n        equipment: [],\n      });\n\n      expect(result.isValid).toBe(true);\n      expect(result.errors).toHaveLength(0);\n    });\n  });\n\n  // ============================================================================\n  // importFromJSON()\n  // ============================================================================\n  describe('importFromJSON()', () => {\n    const validUnit: ISerializedUnit = {\n      id: 'atlas-as7-d',\n      chassis: 'Atlas',\n      model: 'AS7-D',\n      unitType: 'BattleMech',\n      configuration: 'Biped',\n      techBase: TechBase.INNER_SPHERE,\n      rulesLevel: 'Standard',\n      era: 'Star League',\n      year: 2755,\n      tonnage: 100,\n      engine: { type: 'Standard', rating: 300 },\n      gyro: { type: 'Standard' },\n      cockpit: 'Standard',\n      structure: { type: 'Standard' },\n      armor: {\n        type: 'Standard',\n        allocation: {\n          HEAD: 9,\n          CENTER_TORSO: 47,\n          LEFT_TORSO: 32,\n          RIGHT_TORSO: 32,\n        },\n      },\n      heatSinks: { type: 'Single', count: 20 },\n      movement: { walk: 3, jump: 0 },\n      equipment: [\n        { id: 'ac-20', location: 'RT' },\n        { id: 'lrm-20', location: 'LT' },\n      ],\n      criticalSlots: {\n        HEAD: ['Life Support', 'Sensors', 'Cockpit', 'null', 'Sensors', 'Life Support'],\n      },\n    };\n\n    it('should import valid unit successfully', () => {\n      const result = service.importFromJSON(validUnit);\n      \n      expect(result.success).toBe(true);\n      expect(result.unitId).toBe('atlas-as7-d');\n      expect(result.errors).toHaveLength(0);\n    });\n\n    it('should detect missing required fields', () => {\n      const invalidUnit = { ...validUnit, id: undefined } as unknown as ISerializedUnit;\n      \n      const result = service.importFromJSON(invalidUnit);\n      \n      expect(result.errors).toContain('Missing required field: id');\n    });\n\n    it('should validate all required fields', () => {\n      const emptyUnit = {} as ISerializedUnit;\n      \n      const result = service.importFromJSON(emptyUnit);\n      \n      expect(result.errors.length).toBeGreaterThan(0);\n      expect(result.errors).toContain('Missing required field: id');\n      expect(result.errors).toContain('Missing required field: chassis');\n      expect(result.errors).toContain('Missing required field: model');\n      expect(result.errors).toContain('Missing required field: engine');\n    });\n\n    it('should fail in strict mode with any errors', () => {\n      const invalidUnit = { ...validUnit, id: undefined } as unknown as ISerializedUnit;\n      \n      const result = service.importFromJSON(invalidUnit, { strictMode: true });\n      \n      expect(result.success).toBe(false);\n    });\n\n    it('should validate armor allocation', () => {\n      const unitWithBadArmor: ISerializedUnit = {\n        ...validUnit,\n        armor: {\n          type: 'Standard',\n          allocation: {\n            HEAD: 15, // exceeds max of 9\n          },\n        },\n      };\n\n      const result = service.importFromJSON(unitWithBadArmor, { validateArmor: true });\n      \n      // In non-strict mode, armor errors become warnings\n      expect(result.warnings.some(w => w.includes('Head armor exceeds maximum'))).toBe(true);\n    });\n\n    it('should validate critical slots', () => {\n      const unitWithBadSlots: ISerializedUnit = {\n        ...validUnit,\n        criticalSlots: {\n          HEAD: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'], // 12 slots, should be 6\n        },\n      };\n\n      const result = service.importFromJSON(unitWithBadSlots, { validateCriticalSlots: true });\n      \n      expect(result.warnings.some(w => w.includes('HEAD has'))).toBe(true);\n    });\n\n    it('should skip equipment validation when disabled', () => {\n      const result = service.importFromJSON(validUnit, { validateEquipment: false });\n      \n      expect(result.success).toBe(true);\n    });\n\n    it('should handle thrown exceptions', () => {\n      // Create a unit that will cause an exception during processing\n      const badUnit = {\n        id: 'test',\n        // Missing most fields will trigger exception\n      } as unknown as ISerializedUnit;\n\n      const result = service.importFromJSON(badUnit);\n      \n      expect(result.success).toBe(false);\n    });\n  });\n\n  // ============================================================================\n  // resolveEquipment()\n  // ============================================================================\n  describe('resolveEquipment()', () => {\n    it('should resolve known equipment IDs', () => {\n      const result = service.resolveEquipment(['medium-laser', 'ac-20']);\n      \n      // The actual resolution depends on the equipment registry\n      expect(result.resolved).toBeDefined();\n      expect(result.unresolved).toBeDefined();\n    });\n\n    it('should track unresolved IDs', () => {\n      const result = service.resolveEquipment(['completely-fake-equipment-12345']);\n      \n      expect(result.unresolved).toContain('completely-fake-equipment-12345');\n    });\n\n    it('should handle empty array', () => {\n      const result = service.resolveEquipment([]);\n      \n      expect(result.resolved.size).toBe(0);\n      expect(result.unresolved).toHaveLength(0);\n    });\n  });\n\n  // ============================================================================\n  // loadFromUrl() - Async\n  // ============================================================================\n  describe('loadFromUrl()', () => {\n    it('should handle fetch errors gracefully', async () => {\n      const result = await service.loadFromUrl('http://invalid-url-that-does-not-exist.invalid/unit.json');\n      \n      expect(result.success).toBe(false);\n      expect(result.errors.length).toBeGreaterThan(0);\n      expect(result.unitId).toBeNull();\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\conversion\\UnitFormatConverter.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ConversionResult' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BatchConversionResult' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Format Converter Tests\r\n * \r\n * Tests for converting MegaMekLab JSON format to internal format.\r\n * \r\n * @spec openspec/specs/serialization-formats/spec.md\r\n */\r\n\r\nimport {\r\n  UnitFormatConverter,\r\n  unitFormatConverter,\r\n  MegaMekLabUnit,\r\n  ConversionResult,\r\n  BatchConversionResult,\r\n} from '@/services/conversion/UnitFormatConverter';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { RulesLevel } from '@/types/enums/RulesLevel';\r\nimport { Era } from '@/types/enums/Era';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { MechConfiguration } from '@/types/unit/BattleMechInterfaces';\r\n\r\ndescribe('UnitFormatConverter', () => {\r\n  let converter: UnitFormatConverter;\r\n\r\n  beforeEach(() => {\r\n    converter = new UnitFormatConverter();\r\n  });\r\n\r\n  /**\r\n   * Create a valid MegaMekLab unit for testing\r\n   */\r\n  function createMegaMekLabUnit(overrides: Partial<MegaMekLabUnit> = {}): MegaMekLabUnit {\r\n    return {\r\n      chassis: 'Test Mech',\r\n      model: 'TST-1A',\r\n      mul_id: 12345,\r\n      config: 'Biped',\r\n      tech_base: 'Inner Sphere',\r\n      era: 3025,\r\n      source: 'TechManual',\r\n      rules_level: '2',\r\n      mass: 50,\r\n      engine: {\r\n        type: 'Fusion',\r\n        rating: 200,\r\n      },\r\n      structure: {\r\n        type: 'Standard',\r\n      },\r\n      heat_sinks: {\r\n        type: 'Single',\r\n        count: 10,\r\n      },\r\n      walk_mp: 4,\r\n      jump_mp: 0,\r\n      armor: {\r\n        type: 'Standard',\r\n        locations: [\r\n          { location: 'Head', armor_points: 9 },\r\n          { location: 'Center Torso', armor_points: 23, rear_armor_points: 8 },\r\n          { location: 'Left Torso', armor_points: 18, rear_armor_points: 6 },\r\n          { location: 'Right Torso', armor_points: 18, rear_armor_points: 6 },\r\n          { location: 'Left Arm', armor_points: 16 },\r\n          { location: 'Right Arm', armor_points: 16 },\r\n          { location: 'Left Leg', armor_points: 20 },\r\n          { location: 'Right Leg', armor_points: 20 },\r\n        ],\r\n      },\r\n      weapons_and_equipment: [\r\n        { item_name: 'Medium Laser', location: 'Right Arm', item_type: 'MediumLaser', tech_base: 'IS' },\r\n        { item_name: 'Medium Laser', location: 'Left Arm', item_type: 'MediumLaser', tech_base: 'IS' },\r\n      ],\r\n      criticals: [\r\n        { location: 'Head', slots: ['Life Support', 'Sensors', 'Cockpit', '-Empty-', 'Sensors', 'Life Support'] },\r\n      ],\r\n      ...overrides,\r\n    };\r\n  }\r\n\r\n  // ============================================================================\r\n  // Singleton Instance\r\n  // ============================================================================\r\n  describe('Singleton Instance', () => {\r\n    it('should provide a singleton instance', () => {\r\n      expect(unitFormatConverter).toBeDefined();\r\n      expect(unitFormatConverter).toBeInstanceOf(UnitFormatConverter);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Basic Conversion\r\n  // ============================================================================\r\n  describe('convert() - Basic Conversion', () => {\r\n    it('should convert a valid unit', () => {\r\n      const source = createMegaMekLabUnit();\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.success).toBe(true);\r\n      expect(result.unit).not.toBeNull();\r\n      expect(result.errors).toHaveLength(0);\r\n    });\r\n\r\n    it('should preserve chassis and model', () => {\r\n      const source = createMegaMekLabUnit({\r\n        chassis: 'Atlas',\r\n        model: 'AS7-D',\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.chassis).toBe('Atlas');\r\n      expect(result.unit?.model).toBe('AS7-D');\r\n    });\r\n\r\n    it('should generate ID from MUL ID when available', () => {\r\n      const source = createMegaMekLabUnit({ mul_id: 99999 });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.id).toBe('mul-99999');\r\n    });\r\n\r\n    it('should generate ID from chassis/model when no MUL ID', () => {\r\n      const source = createMegaMekLabUnit({\r\n        chassis: 'Test Mech',\r\n        model: 'TST-1A',\r\n        mul_id: '',\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.id).toContain('test-mech');\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Tech Base Mapping\r\n  // ============================================================================\r\n  describe('convert() - Tech Base Mapping', () => {\r\n    it('should map Inner Sphere tech base', () => {\r\n      const source = createMegaMekLabUnit({ tech_base: 'Inner Sphere' });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.techBase).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n\r\n    it('should map Clan tech base', () => {\r\n      const source = createMegaMekLabUnit({ tech_base: 'Clan' });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.techBase).toBe(TechBase.CLAN);\r\n    });\r\n\r\n    it('should map Mixed tech base to INNER_SPHERE (per spec VAL-ENUM-004)', () => {\r\n      // Per spec: Components must have binary tech base, MIXED defaults to IS\r\n      const source = createMegaMekLabUnit({ tech_base: 'Mixed' });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.techBase).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Era and Year Mapping\r\n  // ============================================================================\r\n  describe('convert() - Era and Year Mapping', () => {\r\n    it('should extract year from numeric era', () => {\r\n      const source = createMegaMekLabUnit({ era: 3025 });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.year).toBe(3025);\r\n    });\r\n\r\n    it('should map year to era', () => {\r\n      const source = createMegaMekLabUnit({ era: 3050 });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.era).toBe(Era.CLAN_INVASION);\r\n    });\r\n\r\n    it('should handle string era values', () => {\r\n      const source = createMegaMekLabUnit({ era: 'Star League' });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.era).toBe(Era.STAR_LEAGUE);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Rules Level Mapping\r\n  // ============================================================================\r\n  describe('convert() - Rules Level Mapping', () => {\r\n    it('should map numeric rules levels', () => {\r\n      expect(converter.convert(createMegaMekLabUnit({ rules_level: '1' })).unit?.rulesLevel)\r\n        .toBe(RulesLevel.INTRODUCTORY);\r\n      expect(converter.convert(createMegaMekLabUnit({ rules_level: '2' })).unit?.rulesLevel)\r\n        .toBe(RulesLevel.STANDARD);\r\n      expect(converter.convert(createMegaMekLabUnit({ rules_level: '3' })).unit?.rulesLevel)\r\n        .toBe(RulesLevel.ADVANCED);\r\n      expect(converter.convert(createMegaMekLabUnit({ rules_level: '4' })).unit?.rulesLevel)\r\n        .toBe(RulesLevel.EXPERIMENTAL);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Engine Conversion\r\n  // ============================================================================\r\n  describe('convert() - Engine Conversion', () => {\r\n    it('should convert standard engine', () => {\r\n      const source = createMegaMekLabUnit({\r\n        engine: { type: 'Fusion', rating: 300 },\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.engine.rating).toBe(300);\r\n    });\r\n\r\n    it('should convert XL engine', () => {\r\n      const source = createMegaMekLabUnit({\r\n        engine: { type: 'XL Engine', rating: 300 },\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.engine.type).toBe(EngineType.XL_IS);\r\n    });\r\n\r\n    it('should convert Clan XL engine', () => {\r\n      const source = createMegaMekLabUnit({\r\n        tech_base: 'Clan',\r\n        engine: { type: 'Clan XL Engine', rating: 300 },\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.engine.type).toBe(EngineType.XL_CLAN);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Armor Conversion\r\n  // ============================================================================\r\n  describe('convert() - Armor Conversion', () => {\r\n    it('should convert armor allocation', () => {\r\n      const source = createMegaMekLabUnit({\r\n        armor: {\r\n          type: 'Standard',\r\n          locations: [\r\n            { location: 'Head', armor_points: 9 },\r\n            { location: 'Center Torso', armor_points: 40, rear_armor_points: 15 },\r\n          ],\r\n        },\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.armor.allocation.head).toBe(9);\r\n      expect((result.unit?.armor.allocation.centerTorso as { front: number }).front).toBe(40);\r\n      expect((result.unit?.armor.allocation.centerTorso as { rear: number }).rear).toBe(15);\r\n    });\r\n\r\n    it('should convert armor type', () => {\r\n      const source = createMegaMekLabUnit({\r\n        armor: {\r\n          type: 'Ferro-Fibrous',\r\n          locations: [],\r\n        },\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.armor.type).toBeDefined();\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Movement Conversion\r\n  // ============================================================================\r\n  describe('convert() - Movement Conversion', () => {\r\n    it('should convert walk MP', () => {\r\n      const source = createMegaMekLabUnit({ walk_mp: 5 });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.movement.walk).toBe(5);\r\n    });\r\n\r\n    it('should convert jump MP', () => {\r\n      const source = createMegaMekLabUnit({ jump_mp: 3 });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.movement.jump).toBe(3);\r\n    });\r\n\r\n    it('should handle string MP values', () => {\r\n      const source = createMegaMekLabUnit({ walk_mp: '4', jump_mp: '2' });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.movement.walk).toBe(4);\r\n      expect(result.unit?.movement.jump).toBe(2);\r\n    });\r\n\r\n    it('should detect MASC enhancement', () => {\r\n      const source = createMegaMekLabUnit({\r\n        weapons_and_equipment: [\r\n          { item_name: 'MASC', location: 'Left Leg', item_type: 'ISMASC', tech_base: 'IS' },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.movement.enhancements).toContain('MASC');\r\n    });\r\n\r\n    it('should detect TSM enhancement', () => {\r\n      const source = createMegaMekLabUnit({\r\n        weapons_and_equipment: [\r\n          { item_name: 'Triple Strength Myomer', location: 'Left Torso', item_type: 'ISTripleStrengthMyomer', tech_base: 'IS' },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.movement.enhancements).toContain('TSM');\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Equipment Conversion\r\n  // ============================================================================\r\n  describe('convert() - Equipment Conversion', () => {\r\n    it('should convert equipment list', () => {\r\n      const source = createMegaMekLabUnit({\r\n        weapons_and_equipment: [\r\n          { item_name: 'Medium Laser', location: 'Right Arm', item_type: 'MediumLaser', tech_base: 'IS' },\r\n          { item_name: 'Large Laser', location: 'Left Torso', item_type: 'LargeLaser', tech_base: 'IS' },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.equipment.length).toBe(2);\r\n    });\r\n\r\n    it('should preserve equipment location', () => {\r\n      const source = createMegaMekLabUnit({\r\n        weapons_and_equipment: [\r\n          { item_name: 'AC/20', location: 'Right Torso', item_type: 'AC20', tech_base: 'IS' },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.equipment[0].location).toBeDefined();\r\n    });\r\n\r\n    it('should handle rear-mounted equipment', () => {\r\n      const source = createMegaMekLabUnit({\r\n        weapons_and_equipment: [\r\n          { item_name: 'Medium Laser', location: 'Center Torso', item_type: 'MediumLaser', tech_base: 'IS', rear_facing: true },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.equipment[0].isRearMounted).toBe(true);\r\n    });\r\n\r\n    it('should warn on unknown equipment', () => {\r\n      const source = createMegaMekLabUnit({\r\n        weapons_and_equipment: [\r\n          { item_name: 'Completely Fake Weapon', location: 'Right Arm', item_type: 'FakeWeapon123', tech_base: 'IS' },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.warnings.some(w => w.field === 'equipment')).toBe(true);\r\n    });\r\n\r\n    it('should skip system components', () => {\r\n      const source = createMegaMekLabUnit({\r\n        weapons_and_equipment: [\r\n          { item_name: 'Life Support', location: 'Head', item_type: 'Life Support', tech_base: 'IS' },\r\n          { item_name: 'Sensors', location: 'Head', item_type: 'Sensors', tech_base: 'IS' },\r\n          { item_name: 'Medium Laser', location: 'Right Arm', item_type: 'MediumLaser', tech_base: 'IS' },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      // Should only have the Medium Laser, not system components\r\n      expect(result.unit?.equipment.length).toBe(1);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Configuration Mapping\r\n  // ============================================================================\r\n  describe('convert() - Configuration Mapping', () => {\r\n    it('should map biped configuration', () => {\r\n      const source = createMegaMekLabUnit({ config: 'Biped' });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.configuration).toBe(MechConfiguration.BIPED);\r\n    });\r\n\r\n    it('should map quad configuration', () => {\r\n      const source = createMegaMekLabUnit({ config: 'Quad' });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.configuration).toBe(MechConfiguration.QUAD);\r\n    });\r\n\r\n    it('should detect OmniMech from config', () => {\r\n      const source = createMegaMekLabUnit({ config: 'Biped Omnimech' });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.unitType).toBe('OmniMech');\r\n    });\r\n\r\n    it('should detect OmniMech from is_omnimech flag', () => {\r\n      const source = createMegaMekLabUnit({ is_omnimech: true });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.unitType).toBe('OmniMech');\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Critical Slots Conversion\r\n  // ============================================================================\r\n  describe('convert() - Critical Slots Conversion', () => {\r\n    it('should convert critical slot entries', () => {\r\n      const source = createMegaMekLabUnit({\r\n        criticals: [\r\n          { location: 'Head', slots: ['Life Support', 'Sensors', 'Cockpit', '-Empty-', 'Sensors', 'Life Support'] },\r\n          { location: 'Right Arm', slots: ['Shoulder', 'Upper Arm Actuator', 'Medium Laser', '-Empty-', '-Empty-', '-Empty-'] },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.criticalSlots).toBeDefined();\r\n      expect(Object.keys(result.unit?.criticalSlots ?? {}).length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should convert empty slots to null', () => {\r\n      const source = createMegaMekLabUnit({\r\n        criticals: [\r\n          { location: 'Right Arm', slots: ['-Empty-', 'Empty', 'Medium Laser'] },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      const rightArm = result.unit?.criticalSlots['RIGHT_ARM'];\r\n      if (rightArm) {\r\n        expect(rightArm[0]).toBeNull();\r\n        expect(rightArm[1]).toBeNull();\r\n        expect(rightArm[2]).toBe('Medium Laser');\r\n      }\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Fluff Conversion\r\n  // ============================================================================\r\n  describe('convert() - Fluff Conversion', () => {\r\n    it('should convert fluff text', () => {\r\n      const source = createMegaMekLabUnit({\r\n        fluff_text: {\r\n          overview: 'A test mech overview.',\r\n          capabilities: 'Test capabilities.',\r\n          deployment: 'Test deployment.',\r\n          history: 'Test history.',\r\n        },\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.fluff?.overview).toBe('A test mech overview.');\r\n      expect(result.unit?.fluff?.capabilities).toBe('Test capabilities.');\r\n    });\r\n\r\n    it('should convert manufacturer info', () => {\r\n      const source = createMegaMekLabUnit({\r\n        manufacturers: [\r\n          { name: 'Defiance Industries', location: 'Hesperus II' },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.fluff?.manufacturer).toBe('Defiance Industries');\r\n      expect(result.unit?.fluff?.primaryFactory).toBe('Hesperus II');\r\n    });\r\n\r\n    it('should convert system manufacturers', () => {\r\n      const source = createMegaMekLabUnit({\r\n        system_manufacturers: [\r\n          { type: 'Engine', name: 'Vlar 300' },\r\n          { type: 'Armor', name: 'Durallex Standard' },\r\n        ],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.fluff?.systemManufacturer?.engine).toBe('Vlar 300');\r\n      expect(result.unit?.fluff?.systemManufacturer?.armor).toBe('Durallex Standard');\r\n    });\r\n\r\n    it('should handle missing fluff', () => {\r\n      const source = createMegaMekLabUnit();\r\n      delete (source as Partial<MegaMekLabUnit>).fluff_text;\r\n      delete (source as Partial<MegaMekLabUnit>).manufacturers;\r\n      \r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.fluff).toBeUndefined();\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Quirks\r\n  // ============================================================================\r\n  describe('convert() - Quirks', () => {\r\n    it('should convert quirks', () => {\r\n      const source = createMegaMekLabUnit({\r\n        quirks: ['easy_to_maintain', 'command_mech'],\r\n      });\r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.quirks).toContain('easy_to_maintain');\r\n      expect(result.unit?.quirks).toContain('command_mech');\r\n    });\r\n\r\n    it('should handle no quirks', () => {\r\n      const source = createMegaMekLabUnit();\r\n      delete (source as Partial<MegaMekLabUnit>).quirks;\r\n      \r\n      const result = converter.convert(source);\r\n      \r\n      expect(result.unit?.quirks).toBeUndefined();\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convert() - Error Handling\r\n  // ============================================================================\r\n  describe('convert() - Error Handling', () => {\r\n    it('should handle conversion errors gracefully', () => {\r\n      // Create a unit that might cause issues\r\n      const source = {\r\n        chassis: 'Test',\r\n        model: 'T-1',\r\n        // Minimal fields that might cause issues\r\n      } as unknown as MegaMekLabUnit;\r\n      \r\n      // Should not throw\r\n      expect(() => converter.convert(source)).not.toThrow();\r\n    });\r\n\r\n    it('should capture errors in result', () => {\r\n      const source = {} as MegaMekLabUnit;\r\n      const result = converter.convert(source);\r\n      \r\n      // Should have errors or handle gracefully\r\n      expect(result).toBeDefined();\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // convertBatch()\r\n  // ============================================================================\r\n  describe('convertBatch()', () => {\r\n    it('should convert multiple units', () => {\r\n      const sources = [\r\n        createMegaMekLabUnit({ chassis: 'Mech 1', model: 'M1' }),\r\n        createMegaMekLabUnit({ chassis: 'Mech 2', model: 'M2' }),\r\n        createMegaMekLabUnit({ chassis: 'Mech 3', model: 'M3' }),\r\n      ];\r\n      \r\n      const result = converter.convertBatch(sources);\r\n      \r\n      expect(result.total).toBe(3);\r\n      expect(result.successful).toBe(3);\r\n      expect(result.failed).toBe(0);\r\n      expect(result.results).toHaveLength(3);\r\n    });\r\n\r\n    it('should count successful and failed conversions', () => {\r\n      const sources = [\r\n        createMegaMekLabUnit({ chassis: 'Valid Mech', model: 'VM1' }),\r\n        {} as MegaMekLabUnit, // Invalid\r\n        createMegaMekLabUnit({ chassis: 'Valid Mech 2', model: 'VM2' }),\r\n      ];\r\n      \r\n      const result = converter.convertBatch(sources);\r\n      \r\n      expect(result.total).toBe(3);\r\n      // At least 2 should succeed\r\n      expect(result.successful).toBeGreaterThanOrEqual(2);\r\n    });\r\n\r\n    it('should handle empty batch', () => {\r\n      const result = converter.convertBatch([]);\r\n      \r\n      expect(result.total).toBe(0);\r\n      expect(result.successful).toBe(0);\r\n      expect(result.failed).toBe(0);\r\n      expect(result.results).toHaveLength(0);\r\n    });\r\n\r\n    it('should include individual results', () => {\r\n      const sources = [\r\n        createMegaMekLabUnit({ chassis: 'Test', model: 'T1', mul_id: 1 }),\r\n        createMegaMekLabUnit({ chassis: 'Test', model: 'T2', mul_id: 2 }),\r\n      ];\r\n      \r\n      const result = converter.convertBatch(sources);\r\n      \r\n      expect(result.results[0].unit?.id).toBe('mul-1');\r\n      expect(result.results[1].unit?.id).toBe('mul-2');\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\conversion\\ValueMappings.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\equipment\\EquipmentCalculatorService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\equipment\\EquipmentLoaderService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":59,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":59,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1941,1944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1941,1944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .weapons on an `any` value.","line":59,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":59,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2030,2033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2030,2033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .isLoaded on an `any` value.","line":60,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":60,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":139,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":139,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4504,4507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4504,4507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":146,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":146,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4653,4656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4653,4656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .weapons on an `any` value.","line":146,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":146,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":161,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":161,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5107,5110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5107,5110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .weapons on an `any` value.","line":161,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":161,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":168,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":168,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":168,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5349,5352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5349,5352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .weapons on an `any` value.","line":168,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":168,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":175,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":175,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5588,5591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5588,5591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .weapons on an `any` value.","line":175,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":175,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":255,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":255,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":255,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8343,8346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8343,8346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .weapons on an `any` value.","line":255,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":255,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":256,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":256,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":256,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8390,8393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8390,8393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .weapons on an `any` value.","line":256,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":256,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":257,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":257,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":257,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8437,8440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8437,8440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .ammunition on an `any` value.","line":257,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":257,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":258,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":258,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":258,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8487,8490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8487,8490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .electronics on an `any` value.","line":258,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":258,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":259,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":259,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8538,8541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8538,8541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .miscEquipment on an `any` value.","line":259,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":259,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":34,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { EquipmentLoaderService, getEquipmentLoader, IEquipmentFilter } from '@/services/equipment/EquipmentLoaderService';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { RulesLevel } from '@/types/enums/RulesLevel';\r\n\r\n// Mock fetch globally\r\nglobal.fetch = jest.fn();\r\n\r\ndescribe('EquipmentLoaderService', () => {\r\n  let service: EquipmentLoaderService;\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    // Get fresh instance\r\n    service = EquipmentLoaderService.getInstance();\r\n    service.clear();\r\n    (global.fetch as jest.Mock).mockClear();\r\n  });\r\n\r\n  describe('Singleton pattern', () => {\r\n    it('should return same instance', () => {\r\n      const instance1 = EquipmentLoaderService.getInstance();\r\n      const instance2 = EquipmentLoaderService.getInstance();\r\n      \r\n      expect(instance1).toBe(instance2);\r\n    });\r\n\r\n    it('should return same instance via convenience function', () => {\r\n      const instance1 = getEquipmentLoader();\r\n      const instance2 = EquipmentLoaderService.getInstance();\r\n      \r\n      expect(instance1).toBe(instance2);\r\n    });\r\n  });\r\n\r\n  describe('Initial state', () => {\r\n    it('should not be loaded initially', () => {\r\n      expect(service.getIsLoaded()).toBe(false);\r\n    });\r\n\r\n    it('should have no load errors initially', () => {\r\n      expect(service.getLoadErrors()).toEqual([]);\r\n    });\r\n\r\n    it('should return empty arrays when not loaded', () => {\r\n      expect(service.getAllWeapons()).toEqual([]);\r\n      expect(service.getAllAmmunition()).toEqual([]);\r\n      expect(service.getAllElectronics()).toEqual([]);\r\n      expect(service.getAllMiscEquipment()).toEqual([]);\r\n    });\r\n\r\n    it('should return zero total count when not loaded', () => {\r\n      expect(service.getTotalCount()).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('clear()', () => {\r\n    it('should clear all equipment', () => {\r\n      // Manually add some items to test clear\r\n      (service as any).weapons.set('test-weapon', { id: 'test-weapon', name: 'Test' });\r\n      (service as any).isLoaded = true;\r\n      \r\n      service.clear();\r\n      \r\n      expect(service.getIsLoaded()).toBe(false);\r\n      expect(service.getAllWeapons()).toEqual([]);\r\n      expect(service.getLoadErrors()).toEqual([]);\r\n    });\r\n  });\r\n\r\n  describe('loadOfficialEquipment()', () => {\r\n    it('should handle successful load', async () => {\r\n      const mockWeaponData = {\r\n        $schema: 'test',\r\n        version: '1.0',\r\n        generatedAt: '2024-01-01',\r\n        count: 1,\r\n        items: [{\r\n          id: 'medium-laser',\r\n          name: 'Medium Laser',\r\n          category: 'Energy',\r\n          subType: 'Laser',\r\n          techBase: 'INNER_SPHERE',\r\n          rulesLevel: 'STANDARD',\r\n          damage: 5,\r\n          heat: 3,\r\n          ranges: { minimum: 0, short: 3, medium: 6, long: 9 },\r\n          weight: 1,\r\n          criticalSlots: 1,\r\n          costCBills: 40000,\r\n          battleValue: 46,\r\n          introductionYear: 2470,\r\n        }],\r\n      };\r\n\r\n      (global.fetch as jest.Mock)\r\n        .mockResolvedValueOnce({\r\n          ok: true,\r\n          json: async () => mockWeaponData,\r\n        })\r\n        .mockResolvedValueOnce({ ok: false, status: 404 })\r\n        .mockResolvedValueOnce({ ok: false, status: 404 })\r\n        .mockResolvedValueOnce({ ok: false, status: 404 })\r\n        .mockResolvedValueOnce({ ok: false, status: 404 })\r\n        .mockResolvedValueOnce({ ok: false, status: 404 });\r\n\r\n      const result = await service.loadOfficialEquipment();\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.itemsLoaded).toBeGreaterThan(0);\r\n      expect(service.getIsLoaded()).toBe(true);\r\n    });\r\n\r\n    it('should handle fetch errors gracefully', async () => {\r\n      (global.fetch as jest.Mock).mockRejectedValue(new Error('Network error'));\r\n\r\n      const result = await service.loadOfficialEquipment();\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.errors.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should handle 404 errors as warnings', async () => {\r\n      (global.fetch as jest.Mock).mockResolvedValue({\r\n        ok: false,\r\n        status: 404,\r\n      });\r\n\r\n      const result = await service.loadOfficialEquipment();\r\n\r\n      expect(result.warnings.length).toBeGreaterThan(0);\r\n    });\r\n  });\r\n\r\n  describe('getWeaponById()', () => {\r\n    it('should return weapon when found', () => {\r\n      const mockWeapon = {\r\n        id: 'medium-laser',\r\n        name: 'Medium Laser',\r\n        category: 'Energy' as any,\r\n        weight: 1,\r\n        criticalSlots: 1,\r\n        heat: 3,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      };\r\n      \r\n      (service as any).weapons.set('medium-laser', mockWeapon);\r\n      \r\n      const weapon = service.getWeaponById('medium-laser');\r\n      expect(weapon).toEqual(mockWeapon);\r\n    });\r\n\r\n    it('should return undefined when not found', () => {\r\n      const weapon = service.getWeaponById('non-existent');\r\n      expect(weapon).toBeUndefined();\r\n    });\r\n  });\r\n\r\n  describe('searchWeapons()', () => {\r\n    beforeEach(() => {\r\n      // Add test weapons\r\n      (service as any).weapons.set('medium-laser', {\r\n        id: 'medium-laser',\r\n        name: 'Medium Laser',\r\n        techBase: TechBase.INNER_SPHERE,\r\n        rulesLevel: RulesLevel.STANDARD,\r\n        introductionYear: 2470,\r\n      });\r\n      (service as any).weapons.set('large-laser', {\r\n        id: 'large-laser',\r\n        name: 'Large Laser',\r\n        techBase: TechBase.INNER_SPHERE,\r\n        rulesLevel: RulesLevel.STANDARD,\r\n        introductionYear: 2470,\r\n      });\r\n      (service as any).weapons.set('clan-er-large', {\r\n        id: 'clan-er-large',\r\n        name: 'ER Large Laser',\r\n        techBase: TechBase.CLAN,\r\n        rulesLevel: RulesLevel.ADVANCED,\r\n        introductionYear: 3050,\r\n      });\r\n    });\r\n\r\n    it('should return all weapons when no filter', () => {\r\n      const results = service.searchWeapons({});\r\n      expect(results.length).toBe(3);\r\n    });\r\n\r\n    it('should filter by tech base', () => {\r\n      const filter: IEquipmentFilter = { techBase: TechBase.INNER_SPHERE };\r\n      const results = service.searchWeapons(filter);\r\n      \r\n      expect(results.length).toBe(2);\r\n      expect(results.every(w => w.techBase === TechBase.INNER_SPHERE)).toBe(true);\r\n    });\r\n\r\n    it('should filter by multiple tech bases', () => {\r\n      const filter: IEquipmentFilter = { techBase: [TechBase.INNER_SPHERE, TechBase.CLAN] };\r\n      const results = service.searchWeapons(filter);\r\n      \r\n      expect(results.length).toBe(3);\r\n    });\r\n\r\n    it('should filter by rules level', () => {\r\n      const filter: IEquipmentFilter = { rulesLevel: RulesLevel.ADVANCED };\r\n      const results = service.searchWeapons(filter);\r\n      \r\n      expect(results.length).toBe(1);\r\n      expect(results[0].rulesLevel).toBe(RulesLevel.ADVANCED);\r\n    });\r\n\r\n    it('should filter by max year', () => {\r\n      const filter: IEquipmentFilter = { maxYear: 2500 };\r\n      const results = service.searchWeapons(filter);\r\n      \r\n      expect(results.length).toBe(2);\r\n      expect(results.every(w => w.introductionYear <= 2500)).toBe(true);\r\n    });\r\n\r\n    it('should filter by min year', () => {\r\n      const filter: IEquipmentFilter = { minYear: 3000 };\r\n      const results = service.searchWeapons(filter);\r\n      \r\n      expect(results.length).toBe(1);\r\n      expect(results[0].introductionYear).toBeGreaterThanOrEqual(3000);\r\n    });\r\n\r\n    it('should filter by search text', () => {\r\n      const filter: IEquipmentFilter = { searchText: 'Large' };\r\n      const results = service.searchWeapons(filter);\r\n      \r\n      expect(results.length).toBe(2);\r\n      expect(results.every(w => w.name.includes('Large'))).toBe(true);\r\n    });\r\n\r\n    it('should combine multiple filters', () => {\r\n      const filter: IEquipmentFilter = {\r\n        techBase: TechBase.INNER_SPHERE,\r\n        searchText: 'Laser',\r\n        maxYear: 2500,\r\n      };\r\n      const results = service.searchWeapons(filter);\r\n      \r\n      expect(results.length).toBe(2);\r\n      expect(results.every(w => \r\n        w.techBase === TechBase.INNER_SPHERE &&\r\n        w.name.includes('Laser') &&\r\n        w.introductionYear <= 2500\r\n      )).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('getTotalCount()', () => {\r\n    it('should return correct total count', () => {\r\n      (service as any).weapons.set('w1', {});\r\n      (service as any).weapons.set('w2', {});\r\n      (service as any).ammunition.set('a1', {});\r\n      (service as any).electronics.set('e1', {});\r\n      (service as any).miscEquipment.set('m1', {});\r\n      \r\n      expect(service.getTotalCount()).toBe(5);\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\equipment\\EquipmentLookupService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\equipment\\EquipmentNameMapper.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":45,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":45,"endColumn":64},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1398,1401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1398,1401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .lookupByName on an `any` value.","line":46,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":46,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { EquipmentNameMapper } from '@/services/equipment/EquipmentNameMapper';\nimport { EquipmentRegistry } from '@/services/equipment/EquipmentRegistry';\n\n// Mock EquipmentRegistry\njest.mock('@/services/equipment/EquipmentRegistry', () => ({\n  EquipmentRegistry: {\n    getInstance: jest.fn(() => ({\n      lookupByName: jest.fn().mockReturnValue({\n        found: true,\n        equipment: { id: 'medium-laser', name: 'Medium Laser' },\n      }),\n    })),\n  },\n  getEquipmentRegistry: jest.fn(() => ({\n    lookupByName: jest.fn().mockReturnValue({\n      found: true,\n      equipment: { id: 'medium-laser', name: 'Medium Laser' },\n    }),\n  })),\n}));\n\ndescribe('EquipmentNameMapper', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('should return singleton instance', () => {\n    const instance1 = EquipmentNameMapper.getInstance();\n    const instance2 = EquipmentNameMapper.getInstance();\n    \n    expect(instance1).toBe(instance2);\n  });\n\n  it('should map equipment name to ID', async () => {\n    const mapper = EquipmentNameMapper.getInstance();\n    \n    const result = await mapper.mapName('Medium Laser');\n    \n    expect(result.success).toBe(true);\n    expect(result.equipmentId).toBeDefined();\n  });\n\n  it('should handle unknown equipment names', async () => {\n    const mapper = EquipmentNameMapper.getInstance();\n    const mockRegistry = EquipmentRegistry.getInstance() as any;\n    mockRegistry.lookupByName = jest.fn().mockReturnValue({\n      found: false,\n      equipment: null,\n    });\n    \n    const result = await mapper.mapName('Unknown Equipment');\n    \n    expect(result.success).toBe(false);\n  });\n\n  it('should get mapping statistics', async () => {\n    const mapper = EquipmentNameMapper.getInstance();\n    \n    const stats = mapper.getStats();\n    \n    expect(stats).toBeDefined();\n    expect(stats.totalMappings).toBeGreaterThanOrEqual(0);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\equipment\\EquipmentRegistry.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EquipmentLoaderService' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[785,788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[785,788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .instance on an `any` value.","line":20,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":20,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":53,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":53,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":53,"column":20,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":53,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .found on an `error` typed value.","line":55,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":55,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .equipment on an `error` typed value.","line":56,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":56,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":63,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":63,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":63,"column":20,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":63,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .found on an `error` typed value.","line":65,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":65,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .equipment on an `error` typed value.","line":66,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":66,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":73,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":73,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `error` type typed value.","line":73,"column":20,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":73,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .found on an `error` typed value.","line":75,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":75,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { EquipmentRegistry } from '@/services/equipment/EquipmentRegistry';\nimport { EquipmentLoaderService } from '@/services/equipment/EquipmentLoaderService';\n\n// Mock EquipmentLoaderService\njest.mock('@/services/equipment/EquipmentLoaderService', () => ({\n  EquipmentLoaderService: jest.fn(),\n  getEquipmentLoader: jest.fn(() => ({\n    getIsLoaded: jest.fn().mockReturnValue(true),\n    loadOfficialEquipment: jest.fn().mockResolvedValue(undefined),\n    getAllEquipment: jest.fn().mockReturnValue([\n      { id: 'medium-laser', name: 'Medium Laser', category: 'Energy Weapon' },\n      { id: 'ac-5', name: 'AC/5', category: 'Ballistic Weapon' },\n    ]),\n  })),\n}));\n\ndescribe('EquipmentRegistry', () => {\n  beforeEach(() => {\n    // Reset singleton instance\n    (EquipmentRegistry as any).instance = null;\n  });\n\n  it('should return singleton instance', () => {\n    const instance1 = EquipmentRegistry.getInstance();\n    const instance2 = EquipmentRegistry.getInstance();\n    \n    expect(instance1).toBe(instance2);\n  });\n\n  it('should initialize registry', async () => {\n    const registry = EquipmentRegistry.getInstance();\n    \n    await registry.initialize();\n    \n    // Registry should be initialized\n    expect(registry).toBeDefined();\n  });\n\n  it('should not reinitialize if already initialized', async () => {\n    const registry = EquipmentRegistry.getInstance();\n    \n    await registry.initialize();\n    await registry.initialize();\n    \n    // Should only initialize once\n    expect(registry).toBeDefined();\n  });\n\n  it('should lookup equipment by ID', async () => {\n    const registry = EquipmentRegistry.getInstance();\n    await registry.initialize();\n    \n    const result = registry.lookupById('medium-laser');\n    \n    expect(result.found).toBe(true);\n    expect(result.equipment).toBeDefined();\n  });\n\n  it('should lookup equipment by name', async () => {\n    const registry = EquipmentRegistry.getInstance();\n    await registry.initialize();\n    \n    const result = registry.lookupByName('Medium Laser');\n    \n    expect(result.found).toBe(true);\n    expect(result.equipment).toBeDefined();\n  });\n\n  it('should return not found for unknown ID', async () => {\n    const registry = EquipmentRegistry.getInstance();\n    await registry.initialize();\n    \n    const result = registry.lookupById('unknown-equipment');\n    \n    expect(result.found).toBe(false);\n  });\n\n  it('should get registry statistics', async () => {\n    const registry = EquipmentRegistry.getInstance();\n    await registry.initialize();\n    \n    const stats = registry.getStats();\n    \n    expect(stats).toBeDefined();\n    expect(stats.totalItems).toBeGreaterThanOrEqual(0);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\equipment\\FormulaEvaluator.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\equipment\\FormulaRegistry.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\equipment\\variableEquipmentFormulas.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":163,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":163,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for Variable Equipment Formulas\r\n */\r\n\r\nimport {\r\n  VARIABLE_EQUIPMENT_FORMULAS,\r\n  getVariableEquipmentIds,\r\n  hasVariableEquipmentFormulas,\r\n  getVariableEquipmentFormulas,\r\n} from '@/services/equipment/variableEquipmentFormulas';\r\n\r\ndescribe('Variable Equipment Formulas', () => {\r\n  // ============================================================================\r\n  // VARIABLE_EQUIPMENT_FORMULAS\r\n  // ============================================================================\r\n  describe('VARIABLE_EQUIPMENT_FORMULAS', () => {\r\n    it('should contain targeting computer formulas', () => {\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['targeting-computer-is']).toBeDefined();\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['targeting-computer-clan']).toBeDefined();\r\n    });\r\n\r\n    it('should contain MASC formulas', () => {\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['masc-is']).toBeDefined();\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['masc-clan']).toBeDefined();\r\n    });\r\n\r\n    it('should contain supercharger formula', () => {\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['supercharger']).toBeDefined();\r\n    });\r\n\r\n    it('should contain partial wing formula', () => {\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['partial-wing']).toBeDefined();\r\n    });\r\n\r\n    it('should contain TSM formula', () => {\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['tsm']).toBeDefined();\r\n    });\r\n\r\n    it('should contain physical weapon formulas', () => {\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['hatchet']).toBeDefined();\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['sword']).toBeDefined();\r\n      expect(VARIABLE_EQUIPMENT_FORMULAS['mace']).toBeDefined();\r\n    });\r\n\r\n    it('should have required formula properties', () => {\r\n      const formula = VARIABLE_EQUIPMENT_FORMULAS['targeting-computer-is'];\r\n      expect(formula.weight).toBeDefined();\r\n      expect(formula.criticalSlots).toBeDefined();\r\n      expect(formula.cost).toBeDefined();\r\n      expect(formula.requiredContext).toBeDefined();\r\n    });\r\n\r\n    it('should have correct required context for targeting computer', () => {\r\n      const formula = VARIABLE_EQUIPMENT_FORMULAS['targeting-computer-is'];\r\n      expect(formula.requiredContext).toContain('directFireWeaponTonnage');\r\n    });\r\n\r\n    it('should have correct required context for MASC', () => {\r\n      const formula = VARIABLE_EQUIPMENT_FORMULAS['masc-is'];\r\n      // MASC uses tonnage-based formula: tonnage / 20 (IS), tonnage / 25 (Clan)\r\n      expect(formula.requiredContext).toContain('tonnage');\r\n      expect(formula.requiredContext).not.toContain('engineRating');\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // getVariableEquipmentIds\r\n  // ============================================================================\r\n  describe('getVariableEquipmentIds', () => {\r\n    it('should return array of equipment IDs', () => {\r\n      const ids = getVariableEquipmentIds();\r\n      expect(Array.isArray(ids)).toBe(true);\r\n      expect(ids.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should include known equipment IDs', () => {\r\n      const ids = getVariableEquipmentIds();\r\n      expect(ids).toContain('targeting-computer-is');\r\n      expect(ids).toContain('masc-is');\r\n      expect(ids).toContain('tsm');\r\n    });\r\n\r\n    it('should match keys of VARIABLE_EQUIPMENT_FORMULAS', () => {\r\n      const ids = getVariableEquipmentIds();\r\n      const keys = Object.keys(VARIABLE_EQUIPMENT_FORMULAS);\r\n      expect(ids).toEqual(keys);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // hasVariableEquipmentFormulas\r\n  // ============================================================================\r\n  describe('hasVariableEquipmentFormulas', () => {\r\n    it('should return true for known equipment', () => {\r\n      expect(hasVariableEquipmentFormulas('targeting-computer-is')).toBe(true);\r\n      expect(hasVariableEquipmentFormulas('masc-clan')).toBe(true);\r\n      expect(hasVariableEquipmentFormulas('hatchet')).toBe(true);\r\n    });\r\n\r\n    it('should return false for unknown equipment', () => {\r\n      expect(hasVariableEquipmentFormulas('unknown-equipment')).toBe(false);\r\n      expect(hasVariableEquipmentFormulas('medium-laser')).toBe(false);\r\n      expect(hasVariableEquipmentFormulas('')).toBe(false);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // getVariableEquipmentFormulas\r\n  // ============================================================================\r\n  describe('getVariableEquipmentFormulas', () => {\r\n    it('should return formula for known equipment', () => {\r\n      const formula = getVariableEquipmentFormulas('tsm');\r\n      expect(formula).toBeDefined();\r\n      expect(formula?.weight).toBeDefined();\r\n      expect(formula?.criticalSlots).toBeDefined();\r\n    });\r\n\r\n    it('should return undefined for unknown equipment', () => {\r\n      expect(getVariableEquipmentFormulas('unknown')).toBeUndefined();\r\n    });\r\n\r\n    it('should return formula matching VARIABLE_EQUIPMENT_FORMULAS', () => {\r\n      const formula = getVariableEquipmentFormulas('supercharger');\r\n      expect(formula).toBe(VARIABLE_EQUIPMENT_FORMULAS['supercharger']);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // Formula structures\r\n  // ============================================================================\r\n  describe('Formula structures', () => {\r\n    it('should have fixed slots for supercharger', () => {\r\n      const formula = VARIABLE_EQUIPMENT_FORMULAS['supercharger'];\r\n      // Fixed(1) creates an object with value 1\r\n      expect(formula.criticalSlots).toBeDefined();\r\n    });\r\n\r\n    it('should have damage formula for physical weapons', () => {\r\n      const hatchet = VARIABLE_EQUIPMENT_FORMULAS['hatchet'];\r\n      expect(hatchet.damage).toBeDefined();\r\n    });\r\n\r\n    it('should have all physical weapon formulas', () => {\r\n      const physicalWeapons = [\r\n        'hatchet',\r\n        'sword',\r\n        'mace',\r\n        'claws',\r\n        'lance',\r\n        'talons',\r\n        'retractable-blade',\r\n        'flail',\r\n        'wrecking-ball',\r\n      ];\r\n      \r\n      for (const weapon of physicalWeapons) {\r\n        expect(VARIABLE_EQUIPMENT_FORMULAS[weapon]).toBeDefined();\r\n        expect(VARIABLE_EQUIPMENT_FORMULAS[weapon].damage).toBeDefined();\r\n      }\r\n    });\r\n\r\n    it('should have required context for all formulas', () => {\r\n      for (const [id, formula] of Object.entries(VARIABLE_EQUIPMENT_FORMULAS)) {\r\n        expect(formula.requiredContext).toBeDefined();\r\n        expect(Array.isArray(formula.requiredContext)).toBe(true);\r\n      }\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\persistence\\FileService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileError' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockAppendChild' is assigned a value but never used.","line":9,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockRemoveChild' is assigned a value but never used.","line":10,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":67,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":67,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .download on an `any` value.","line":68,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":68,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":80,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":80,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .download on an `any` value.","line":81,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":81,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":89,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":89,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .download on an `any` value.","line":90,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":90,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":112,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":112,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .download on an `any` value.","line":113,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":113,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":122,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":122,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .download on an `any` value.","line":123,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":123,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { FileService } from '@/services/persistence/FileService';\r\nimport { FileError } from '@/services/common/errors';\r\n\r\ndescribe('FileService', () => {\r\n  let service: FileService;\r\n  let mockCreateElement: jest.SpyInstance;\r\n  let mockCreateObjectURL: jest.SpyInstance;\r\n  let mockRevokeObjectURL: jest.SpyInstance;\r\n  let mockAppendChild: jest.SpyInstance;\r\n  let mockRemoveChild: jest.SpyInstance;\r\n  let mockClick: jest.Mock;\r\n\r\n  beforeEach(() => {\r\n    service = new FileService();\r\n    \r\n    // Mock DOM APIs\r\n    mockClick = jest.fn();\r\n    const mockAnchor = {\r\n      href: '',\r\n      download: '',\r\n      click: mockClick,\r\n    };\r\n    \r\n    mockCreateElement = jest.spyOn(document, 'createElement').mockReturnValue(mockAnchor as unknown as HTMLElement);\r\n    mockAppendChild = jest.spyOn(document.body, 'appendChild').mockImplementation();\r\n    mockRemoveChild = jest.spyOn(document.body, 'removeChild').mockImplementation();\r\n    \r\n    // Mock URL methods\r\n    const urlMock = {\r\n      createObjectURL: jest.fn().mockReturnValue('blob:mock-url'),\r\n      revokeObjectURL: jest.fn(),\r\n    };\r\n    // @ts-expect-error - Mocking URL methods\r\n    global.URL.createObjectURL = urlMock.createObjectURL;\r\n    // @ts-expect-error - Mocking URL methods\r\n    global.URL.revokeObjectURL = urlMock.revokeObjectURL;\r\n    mockCreateObjectURL = urlMock.createObjectURL;\r\n    mockRevokeObjectURL = urlMock.revokeObjectURL;\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.restoreAllMocks();\r\n  });\r\n\r\n  describe('exportUnit', () => {\r\n    it('should export unit with generated filename', () => {\r\n      const unit = {\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-D',\r\n        tonnage: 100,\r\n      };\r\n\r\n      service.exportUnit(unit);\r\n\r\n      expect(mockCreateElement).toHaveBeenCalledWith('a');\r\n      expect(mockCreateObjectURL).toHaveBeenCalled();\r\n      expect(mockClick).toHaveBeenCalled();\r\n      expect(mockRevokeObjectURL).toHaveBeenCalledWith('blob:mock-url');\r\n    });\r\n\r\n    it('should use custom filename when provided', () => {\r\n      const unit = { chassis: 'Atlas', variant: 'AS7-D' };\r\n      const customFilename = 'custom-name.json';\r\n\r\n      service.exportUnit(unit, customFilename);\r\n\r\n      const anchor = mockCreateElement.mock.results[0].value;\r\n      expect(anchor.download).toBe(customFilename);\r\n    });\r\n\r\n    it('should generate safe filename from unit data', () => {\r\n      const unit = {\r\n        chassis: 'Atlas AS7',\r\n        variant: 'D-Variant',\r\n        tonnage: 100,\r\n      };\r\n\r\n      service.exportUnit(unit);\r\n\r\n      const anchor = mockCreateElement.mock.results[0].value;\r\n      expect(anchor.download).toMatch(/^atlas-as7-d-variant\\.json$/);\r\n    });\r\n\r\n    it('should handle units without chassis or variant', () => {\r\n      const unit = { tonnage: 100 };\r\n\r\n      service.exportUnit(unit);\r\n\r\n      const anchor = mockCreateElement.mock.results[0].value;\r\n      expect(anchor.download).toMatch(/^unknown-variant\\.json$/);\r\n    });\r\n  });\r\n\r\n  describe('exportBatch', () => {\r\n    it('should export multiple units as JSON array', async () => {\r\n      const units = [\r\n        { id: '1', chassis: 'Atlas', variant: 'AS7-D' },\r\n        { id: '2', chassis: 'Marauder', variant: 'MAD-3R' },\r\n      ];\r\n\r\n      await service.exportBatch(units);\r\n\r\n      expect(mockCreateObjectURL).toHaveBeenCalled();\r\n      expect(mockClick).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should use default filename for batch export', async () => {\r\n      const units = [{ id: '1' }];\r\n\r\n      await service.exportBatch(units);\r\n\r\n      const anchor = mockCreateElement.mock.results[0].value;\r\n      expect(anchor.download).toBe('units-export.json');\r\n    });\r\n\r\n    it('should use custom filename for batch export', async () => {\r\n      const units = [{ id: '1' }];\r\n      const customFilename = 'my-units.json';\r\n\r\n      await service.exportBatch(units, customFilename);\r\n\r\n      const anchor = mockCreateElement.mock.results[0].value;\r\n      expect(anchor.download).toBe(customFilename);\r\n    });\r\n  });\r\n\r\n  describe('importUnit', () => {\r\n    it('should successfully import valid unit file', async () => {\r\n      const unitData = {\r\n        id: 'unit-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-D',\r\n        tonnage: 100,\r\n      };\r\n      const file = new File([JSON.stringify(unitData)], 'atlas.json', { type: 'application/json' });\r\n\r\n      const result = await service.importUnit(file);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.filename).toBe('atlas.json');\r\n      expect(result.unit).toEqual(unitData);\r\n      expect(result.errors).toBeUndefined();\r\n    });\r\n\r\n    it('should reject invalid JSON', async () => {\r\n      const file = new File(['invalid json'], 'test.json', { type: 'application/json' });\r\n\r\n      const result = await service.importUnit(file);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.errors).toContain('Invalid JSON in test.json');\r\n    });\r\n\r\n    it('should reject unit without id or chassis', async () => {\r\n      const unitData = { tonnage: 100 };\r\n      const file = new File([JSON.stringify(unitData)], 'test.json', { type: 'application/json' });\r\n\r\n      const result = await service.importUnit(file);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.errors).toContain('Unit must have an id or chassis field');\r\n    });\r\n\r\n    it('should reject unit with invalid tonnage type', async () => {\r\n      const unitData = {\r\n        id: 'unit-1',\r\n        tonnage: '100', // string instead of number\r\n      };\r\n      const file = new File([JSON.stringify(unitData)], 'test.json', { type: 'application/json' });\r\n\r\n      const result = await service.importUnit(file);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.errors).toContain('Tonnage must be a number');\r\n    });\r\n\r\n    it('should handle file read errors', async () => {\r\n      const file = new File([''], 'test.json', { type: 'application/json' });\r\n      \r\n      // Mock FileReader to fail\r\n      const originalFileReader = global.FileReader;\r\n      global.FileReader = jest.fn().mockImplementation(() => ({\r\n        readAsText: jest.fn(function(this: FileReader) {\r\n          setTimeout(() => {\r\n            // @ts-expect-error - accessing private property for testing\r\n            this.onerror?.(new Error('Read error'));\r\n          }, 0);\r\n        }),\r\n      })) as unknown as typeof FileReader;\r\n\r\n      const result = await service.importUnit(file);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.errors).toBeDefined();\r\n\r\n      global.FileReader = originalFileReader;\r\n    });\r\n  });\r\n\r\n  describe('importBatch', () => {\r\n    it('should import multiple files', async () => {\r\n      const unit1 = { id: '1', chassis: 'Atlas', variant: 'AS7-D' };\r\n      const unit2 = { id: '2', chassis: 'Marauder', variant: 'MAD-3R' };\r\n      \r\n      const files = [\r\n        new File([JSON.stringify(unit1)], 'atlas.json', { type: 'application/json' }),\r\n        new File([JSON.stringify(unit2)], 'marauder.json', { type: 'application/json' }),\r\n      ];\r\n\r\n      const results = await service.importBatch(files);\r\n\r\n      expect(results).toHaveLength(2);\r\n      expect(results[0].success).toBe(true);\r\n      expect(results[1].success).toBe(true);\r\n    });\r\n\r\n    it('should handle mixed success and failure', async () => {\r\n      const validUnit = { id: '1', chassis: 'Atlas', variant: 'AS7-D' };\r\n      const invalidUnit = { tonnage: 100 }; // missing id/chassis\r\n      \r\n      const files = [\r\n        new File([JSON.stringify(validUnit)], 'valid.json', { type: 'application/json' }),\r\n        new File([JSON.stringify(invalidUnit)], 'invalid.json', { type: 'application/json' }),\r\n      ];\r\n\r\n      const results = await service.importBatch(files);\r\n\r\n      expect(results).toHaveLength(2);\r\n      expect(results[0].success).toBe(true);\r\n      expect(results[1].success).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('validateFile', () => {\r\n    it('should validate valid unit file', async () => {\r\n      const unitData = {\r\n        id: 'unit-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-D',\r\n        tonnage: 100,\r\n      };\r\n      const file = new File([JSON.stringify(unitData)], 'atlas.json', { type: 'application/json' });\r\n\r\n      const result = await service.validateFile(file);\r\n\r\n      expect(result.isValid).toBe(true);\r\n      expect(result.errors).toHaveLength(0);\r\n    });\r\n\r\n    it('should reject non-JSON files', async () => {\r\n      const file = new File(['content'], 'test.txt', { type: 'text/plain' });\r\n\r\n      const result = await service.validateFile(file);\r\n\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.errors).toContainEqual(\r\n        expect.objectContaining({\r\n          code: 'INVALID_EXTENSION',\r\n          message: 'File must have .json extension',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should reject files that are too large', async () => {\r\n      const largeContent = 'x'.repeat(11 * 1024 * 1024); // 11MB\r\n      const file = new File([largeContent], 'large.json', { type: 'application/json' });\r\n\r\n      const result = await service.validateFile(file);\r\n\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.errors).toContainEqual(\r\n        expect.objectContaining({\r\n          code: 'FILE_TOO_LARGE',\r\n          message: 'File exceeds maximum size of 10MB',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should reject invalid JSON', async () => {\r\n      const file = new File(['invalid json'], 'test.json', { type: 'application/json' });\r\n\r\n      const result = await service.validateFile(file);\r\n\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.errors).toContainEqual(\r\n        expect.objectContaining({\r\n          code: 'INVALID_JSON',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should reject non-object JSON', async () => {\r\n      const file = new File(['\"string\"'], 'test.json', { type: 'application/json' });\r\n\r\n      const result = await service.validateFile(file);\r\n\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.errors).toContainEqual(\r\n        expect.objectContaining({\r\n          code: 'INVALID_STRUCTURE',\r\n          message: 'File must contain a JSON object',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should reject null JSON', async () => {\r\n      const file = new File(['null'], 'test.json', { type: 'application/json' });\r\n\r\n      const result = await service.validateFile(file);\r\n\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.errors).toContainEqual(\r\n        expect.objectContaining({\r\n          code: 'INVALID_STRUCTURE',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should handle file read errors', async () => {\r\n      const file = new File([''], 'test.json', { type: 'application/json' });\r\n      \r\n      // Mock FileReader to fail\r\n      const originalFileReader = global.FileReader;\r\n      global.FileReader = jest.fn().mockImplementation(() => ({\r\n        readAsText: jest.fn(function(this: FileReader) {\r\n          setTimeout(() => {\r\n            // @ts-expect-error - accessing private property for testing\r\n            this.onerror?.(new Error('Read error'));\r\n          }, 0);\r\n        }),\r\n      })) as unknown as typeof FileReader;\r\n\r\n      const result = await service.validateFile(file);\r\n\r\n      expect(result.isValid).toBe(false);\r\n      expect(result.errors).toContainEqual(\r\n        expect.objectContaining({\r\n          code: 'READ_ERROR',\r\n        })\r\n      );\r\n\r\n      global.FileReader = originalFileReader;\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\persistence\\IndexedDBService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setupMockIndexedDB' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'teardownMockIndexedDB' is defined but never used.","line":3,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clearAllMockDatabases' is defined but never used.","line":3,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":32,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":32,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":34,"column":9,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":34,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .put on an `any` value.","line":34,"column":15,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":34,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":48,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":48,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":50,"column":26,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":50,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .get on an `any` value.","line":50,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":50,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":63,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":63,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":65,"column":9,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":65,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .delete on an `any` value.","line":65,"column":15,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":65,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":79,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":79,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":81,"column":26,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":81,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .getAll on an `any` value.","line":81,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":81,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":94,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":94,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":96,"column":9,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":96,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .clear on an `any` value.","line":96,"column":15,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":96,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3365,3368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3365,3368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3707,3710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3707,3710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4215,4218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4215,4218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":397,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":397,"endColumn":91},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'originalTransaction' is assigned a value but never used.","line":397,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":397,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .result on an `any` value.","line":397,"column":72,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":397,"endColumn":78},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockTransaction' is assigned a value but never used.","line":398,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":398,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":531,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":531,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16547,16550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16547,16550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":539,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":539,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16853,16856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16853,16856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":27,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { IndexedDBService, STORES } from '@/services/persistence/IndexedDBService';\r\nimport { StorageError } from '@/services/common/errors';\r\nimport { setupMockIndexedDB, teardownMockIndexedDB, clearAllMockDatabases } from '@/__tests__/mocks/storage/MockIndexedDB';\r\n\r\n// Enhanced mock that supports transactions\r\nclass MockTransaction {\r\n  private store: MockObjectStore;\r\n  mode: 'readonly' | 'readwrite';\r\n\r\n  constructor(storeName: string, mode: 'readonly' | 'readwrite', db: MockDatabase) {\r\n    this.mode = mode;\r\n    this.store = new MockObjectStore(storeName, db);\r\n  }\r\n\r\n  objectStore(_name: string): MockObjectStore {\r\n    return this.store;\r\n  }\r\n}\r\n\r\nclass MockObjectStore {\r\n  private storeName: string;\r\n  private db: MockDatabase;\r\n\r\n  constructor(storeName: string, db: MockDatabase) {\r\n    this.storeName = storeName;\r\n    this.db = db;\r\n  }\r\n\r\n  put(value: unknown, key: string): MockRequest {\r\n    const request = new MockRequest();\r\n    setTimeout(() => {\r\n      const store = this.db.getStore(this.storeName);\r\n      if (store) {\r\n        store.put(key, value);\r\n        request.result = undefined;\r\n        request.onsuccess?.(new Event('success'));\r\n      } else {\r\n        request.error = new Error('Store not found');\r\n        request.onerror?.(new Event('error'));\r\n      }\r\n    }, 0);\r\n    return request;\r\n  }\r\n\r\n  get(key: string): MockRequest {\r\n    const request = new MockRequest();\r\n    setTimeout(() => {\r\n      const store = this.db.getStore(this.storeName);\r\n      if (store) {\r\n        request.result = store.get(key);\r\n        request.onsuccess?.(new Event('success'));\r\n      } else {\r\n        request.error = new Error('Store not found');\r\n        request.onerror?.(new Event('error'));\r\n      }\r\n    }, 0);\r\n    return request;\r\n  }\r\n\r\n  delete(key: string): MockRequest {\r\n    const request = new MockRequest();\r\n    setTimeout(() => {\r\n      const store = this.db.getStore(this.storeName);\r\n      if (store) {\r\n        store.delete(key);\r\n        request.result = undefined;\r\n        request.onsuccess?.(new Event('success'));\r\n      } else {\r\n        request.error = new Error('Store not found');\r\n        request.onerror?.(new Event('error'));\r\n      }\r\n    }, 0);\r\n    return request;\r\n  }\r\n\r\n  getAll(): MockRequest {\r\n    const request = new MockRequest();\r\n    setTimeout(() => {\r\n      const store = this.db.getStore(this.storeName);\r\n      if (store) {\r\n        request.result = store.getAll();\r\n        request.onsuccess?.(new Event('success'));\r\n      } else {\r\n        request.error = new Error('Store not found');\r\n        request.onerror?.(new Event('error'));\r\n      }\r\n    }, 0);\r\n    return request;\r\n  }\r\n\r\n  clear(): MockRequest {\r\n    const request = new MockRequest();\r\n    setTimeout(() => {\r\n      const store = this.db.getStore(this.storeName);\r\n      if (store) {\r\n        store.clear();\r\n        request.result = undefined;\r\n        request.onsuccess?.(new Event('success'));\r\n      } else {\r\n        request.error = new Error('Store not found');\r\n        request.onerror?.(new Event('error'));\r\n      }\r\n    }, 0);\r\n    return request;\r\n  }\r\n}\r\n\r\nclass MockRequest {\r\n  result: unknown = undefined;\r\n  error: Error | null = null;\r\n  onsuccess: ((event: Event) => void) | null = null;\r\n  onerror: ((event: Event) => void) | null = null;\r\n}\r\n\r\nclass MockDatabase {\r\n  private stores: Map<string, any> = new Map();\r\n  readonly name: string;\r\n  readonly version: number;\r\n\r\n  constructor(name: string, version: number) {\r\n    this.name = name;\r\n    this.version = version;\r\n  }\r\n\r\n  createObjectStore(name: string): void {\r\n    if (!this.stores.has(name)) {\r\n      this.stores.set(name, new Map());\r\n    }\r\n  }\r\n\r\n  getStore(name: string): any {\r\n    return this.stores.get(name);\r\n  }\r\n\r\n  transaction(storeNames: string | string[], mode: 'readonly' | 'readwrite'): MockTransaction {\r\n    const names = Array.isArray(storeNames) ? storeNames : [storeNames];\r\n    return new MockTransaction(names[0], mode, this);\r\n  }\r\n\r\n  close(): void {\r\n    // No-op\r\n  }\r\n}\r\n\r\n// Mock IndexedDB with transaction support\r\nconst mockDatabases = new Map<string, MockDatabase>();\r\n\r\nconst mockIndexedDBWithTransactions = {\r\n  open(name: string, version?: number): any {\r\n    const dbVersion = version ?? 1;\r\n    const request = {\r\n      result: null as MockDatabase | null,\r\n      error: null as Error | null,\r\n      onsuccess: null as ((event: Event) => void) | null,\r\n      onerror: null as ((event: Event) => void) | null,\r\n      onupgradeneeded: null as ((event: Event) => void) | null,\r\n    };\r\n\r\n    setTimeout(() => {\r\n      try {\r\n        let db = mockDatabases.get(name);\r\n        const isNew = !db;\r\n        \r\n        if (isNew || (db && db.version < dbVersion)) {\r\n          db = new MockDatabase(name, dbVersion);\r\n          mockDatabases.set(name, db);\r\n          \r\n          // Create default stores\r\n          db.createObjectStore(STORES.CUSTOM_UNITS);\r\n          db.createObjectStore(STORES.UNIT_METADATA);\r\n          db.createObjectStore(STORES.CUSTOM_FORMULAS);\r\n          \r\n          if (request.onupgradeneeded) {\r\n            request.onupgradeneeded(new Event('upgradeneeded'));\r\n          }\r\n        }\r\n        \r\n        request.result = db;\r\n        if (request.onsuccess) {\r\n          request.onsuccess(new Event('success'));\r\n        }\r\n      } catch (error) {\r\n        request.error = error as Error;\r\n        if (request.onerror) {\r\n          request.onerror(new Event('error'));\r\n        }\r\n      }\r\n    }, 0);\r\n\r\n    return request;\r\n  },\r\n};\r\n\r\ndescribe('IndexedDBService', () => {\r\n  let service: IndexedDBService;\r\n\r\n  beforeEach(() => {\r\n    mockDatabases.clear();\r\n    // @ts-expect-error - Mock for testing\r\n    global.indexedDB = mockIndexedDBWithTransactions;\r\n    service = new IndexedDBService();\r\n  });\r\n\r\n  afterEach(() => {\r\n    service.close();\r\n    mockDatabases.clear();\r\n  });\r\n\r\n  describe('initialize', () => {\r\n    it('should initialize database successfully', async () => {\r\n      await service.initialize();\r\n      // Should not throw\r\n    });\r\n\r\n    it('should return immediately if already initialized', async () => {\r\n      await service.initialize();\r\n      await service.initialize(); // Second call should return immediately\r\n      // Should not throw\r\n    });\r\n\r\n    it('should return same promise if initialization in progress', async () => {\r\n      const promise1 = service.initialize();\r\n      const promise2 = service.initialize();\r\n      expect(promise1).toBe(promise2);\r\n      await promise1;\r\n    });\r\n\r\n    it('should handle database open errors', async () => {\r\n      // Mock a failing open\r\n      const originalOpen = mockIndexedDBWithTransactions.open;\r\n      mockIndexedDBWithTransactions.open = jest.fn(() => {\r\n        const request = {\r\n          result: null,\r\n          error: new Error('Database error'),\r\n          onsuccess: null,\r\n          onerror: null,\r\n          onupgradeneeded: null,\r\n        };\r\n        setTimeout(() => {\r\n          if (request.onerror) {\r\n            request.onerror(new Event('error'));\r\n          }\r\n        }, 0);\r\n        return request;\r\n      });\r\n\r\n      await expect(service.initialize()).rejects.toThrow(StorageError);\r\n      \r\n      mockIndexedDBWithTransactions.open = originalOpen;\r\n    });\r\n  });\r\n\r\n  describe('put', () => {\r\n    it('should store a value', async () => {\r\n      await service.initialize();\r\n      const value = { id: '1', name: 'Test Unit' };\r\n      \r\n      await service.put(STORES.CUSTOM_UNITS, 'unit-1', value);\r\n      \r\n      const retrieved = await service.get(STORES.CUSTOM_UNITS, 'unit-1');\r\n      expect(retrieved).toEqual(value);\r\n    });\r\n\r\n    it('should throw if database not initialized', async () => {\r\n      await expect(\r\n        service.put(STORES.CUSTOM_UNITS, 'key', {})\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n  });\r\n\r\n  describe('get', () => {\r\n    it('should retrieve a stored value', async () => {\r\n      await service.initialize();\r\n      const value = { id: '1', name: 'Test Unit' };\r\n      \r\n      await service.put(STORES.CUSTOM_UNITS, 'unit-1', value);\r\n      const retrieved = await service.get(STORES.CUSTOM_UNITS, 'unit-1');\r\n      \r\n      expect(retrieved).toEqual(value);\r\n    });\r\n\r\n    it('should return undefined for non-existent key', async () => {\r\n      await service.initialize();\r\n      \r\n      const retrieved = await service.get(STORES.CUSTOM_UNITS, 'non-existent');\r\n      \r\n      expect(retrieved).toBeUndefined();\r\n    });\r\n\r\n    it('should throw if database not initialized', async () => {\r\n      await expect(\r\n        service.get(STORES.CUSTOM_UNITS, 'key')\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n  });\r\n\r\n  describe('delete', () => {\r\n    it('should delete a stored value', async () => {\r\n      await service.initialize();\r\n      const value = { id: '1', name: 'Test Unit' };\r\n      \r\n      await service.put(STORES.CUSTOM_UNITS, 'unit-1', value);\r\n      await service.delete(STORES.CUSTOM_UNITS, 'unit-1');\r\n      \r\n      const retrieved = await service.get(STORES.CUSTOM_UNITS, 'unit-1');\r\n      expect(retrieved).toBeUndefined();\r\n    });\r\n\r\n    it('should throw if database not initialized', async () => {\r\n      await expect(\r\n        service.delete(STORES.CUSTOM_UNITS, 'key')\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n  });\r\n\r\n  describe('getAll', () => {\r\n    it('should retrieve all values from store', async () => {\r\n      await service.initialize();\r\n      const unit1 = { id: '1', name: 'Unit 1' };\r\n      const unit2 = { id: '2', name: 'Unit 2' };\r\n      \r\n      await service.put(STORES.CUSTOM_UNITS, 'unit-1', unit1);\r\n      await service.put(STORES.CUSTOM_UNITS, 'unit-2', unit2);\r\n      \r\n      const all = await service.getAll(STORES.CUSTOM_UNITS);\r\n      \r\n      expect(all).toHaveLength(2);\r\n      expect(all).toContainEqual(unit1);\r\n      expect(all).toContainEqual(unit2);\r\n    });\r\n\r\n    it('should return empty array for empty store', async () => {\r\n      await service.initialize();\r\n      \r\n      const all = await service.getAll(STORES.CUSTOM_UNITS);\r\n      \r\n      expect(all).toEqual([]);\r\n    });\r\n\r\n    it('should throw if database not initialized', async () => {\r\n      await expect(\r\n        service.getAll(STORES.CUSTOM_UNITS)\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n  });\r\n\r\n  describe('clear', () => {\r\n    it('should clear all values from store', async () => {\r\n      await service.initialize();\r\n      await service.put(STORES.CUSTOM_UNITS, 'unit-1', { id: '1' });\r\n      await service.put(STORES.CUSTOM_UNITS, 'unit-2', { id: '2' });\r\n      \r\n      await service.clear(STORES.CUSTOM_UNITS);\r\n      \r\n      const all = await service.getAll(STORES.CUSTOM_UNITS);\r\n      expect(all).toEqual([]);\r\n    });\r\n\r\n    it('should throw if database not initialized', async () => {\r\n      await expect(\r\n        service.clear(STORES.CUSTOM_UNITS)\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n  });\r\n\r\n  describe('close', () => {\r\n    it('should close database connection', async () => {\r\n      await service.initialize();\r\n      \r\n      service.close();\r\n      \r\n      // Should be able to initialize again after close\r\n      await service.initialize();\r\n    });\r\n\r\n    it('should reset initialization promise', async () => {\r\n      await service.initialize();\r\n      service.close();\r\n      \r\n      // Should create new promise on next initialize\r\n      const promise1 = service.initialize();\r\n      await promise1;\r\n      const promise2 = service.initialize();\r\n      expect(promise2).toBe(promise1); // Same promise if already initialized\r\n    });\r\n\r\n    it('should handle close when database not initialized', () => {\r\n      expect(() => service.close()).not.toThrow();\r\n    });\r\n  });\r\n\r\n  describe('error handling', () => {\r\n    it('should handle transaction errors in put', async () => {\r\n      await service.initialize();\r\n      \r\n      // Mock transaction error\r\n      const originalTransaction = mockIndexedDBWithTransactions.open().result?.transaction;\r\n      const mockTransaction = {\r\n        objectStore: jest.fn(() => ({\r\n          put: jest.fn(() => ({\r\n            onerror: null,\r\n            onsuccess: null,\r\n            error: new Error('Transaction error'),\r\n          })),\r\n        })),\r\n      };\r\n      \r\n      // Force error by triggering onerror\r\n      const db = mockDatabases.get('battletech-editor');\r\n      if (db) {\r\n        const originalTransactionMethod = db.transaction;\r\n        db.transaction = jest.fn(() => {\r\n          const transaction = originalTransactionMethod.call(db, STORES.CUSTOM_UNITS, 'readwrite');\r\n          const store = transaction.objectStore(STORES.CUSTOM_UNITS);\r\n          const request = store.put({}, 'test-key');\r\n          setTimeout(() => {\r\n            if (request.onerror) {\r\n              request.onerror(new Event('error'));\r\n            }\r\n          }, 0);\r\n          return transaction;\r\n        });\r\n      }\r\n\r\n      await expect(\r\n        service.put(STORES.CUSTOM_UNITS, 'test-key', {})\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n\r\n    it('should handle transaction errors in get', async () => {\r\n      await service.initialize();\r\n      \r\n      const db = mockDatabases.get('battletech-editor');\r\n      if (db) {\r\n        const originalTransactionMethod = db.transaction;\r\n        db.transaction = jest.fn(() => {\r\n          const transaction = originalTransactionMethod.call(db, STORES.CUSTOM_UNITS, 'readonly');\r\n          const store = transaction.objectStore(STORES.CUSTOM_UNITS);\r\n          const request = store.get('test-key');\r\n          setTimeout(() => {\r\n            if (request.onerror) {\r\n              request.onerror(new Event('error'));\r\n            }\r\n          }, 0);\r\n          return transaction;\r\n        });\r\n      }\r\n\r\n      await expect(\r\n        service.get(STORES.CUSTOM_UNITS, 'test-key')\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n\r\n    it('should handle transaction errors in delete', async () => {\r\n      await service.initialize();\r\n      \r\n      const db = mockDatabases.get('battletech-editor');\r\n      if (db) {\r\n        const originalTransactionMethod = db.transaction;\r\n        db.transaction = jest.fn(() => {\r\n          const transaction = originalTransactionMethod.call(db, STORES.CUSTOM_UNITS, 'readwrite');\r\n          const store = transaction.objectStore(STORES.CUSTOM_UNITS);\r\n          const request = store.delete('test-key');\r\n          setTimeout(() => {\r\n            if (request.onerror) {\r\n              request.onerror(new Event('error'));\r\n            }\r\n          }, 0);\r\n          return transaction;\r\n        });\r\n      }\r\n\r\n      await expect(\r\n        service.delete(STORES.CUSTOM_UNITS, 'test-key')\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n\r\n    it('should handle transaction errors in getAll', async () => {\r\n      await service.initialize();\r\n      \r\n      const db = mockDatabases.get('battletech-editor');\r\n      if (db) {\r\n        const originalTransactionMethod = db.transaction;\r\n        db.transaction = jest.fn(() => {\r\n          const transaction = originalTransactionMethod.call(db, STORES.CUSTOM_UNITS, 'readonly');\r\n          const store = transaction.objectStore(STORES.CUSTOM_UNITS);\r\n          const request = store.getAll();\r\n          setTimeout(() => {\r\n            if (request.onerror) {\r\n              request.onerror(new Event('error'));\r\n            }\r\n          }, 0);\r\n          return transaction;\r\n        });\r\n      }\r\n\r\n      await expect(\r\n        service.getAll(STORES.CUSTOM_UNITS)\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n\r\n    it('should handle transaction errors in clear', async () => {\r\n      await service.initialize();\r\n      \r\n      const db = mockDatabases.get('battletech-editor');\r\n      if (db) {\r\n        const originalTransactionMethod = db.transaction;\r\n        db.transaction = jest.fn(() => {\r\n          const transaction = originalTransactionMethod.call(db, STORES.CUSTOM_UNITS, 'readwrite');\r\n          const store = transaction.objectStore(STORES.CUSTOM_UNITS);\r\n          const request = store.clear();\r\n          setTimeout(() => {\r\n            if (request.onerror) {\r\n              request.onerror(new Event('error'));\r\n            }\r\n          }, 0);\r\n          return transaction;\r\n        });\r\n      }\r\n\r\n      await expect(\r\n        service.clear(STORES.CUSTOM_UNITS)\r\n      ).rejects.toThrow(StorageError);\r\n    });\r\n  });\r\n\r\n  describe('edge cases', () => {\r\n    it('should handle null values', async () => {\r\n      await service.initialize();\r\n      \r\n      await service.put(STORES.CUSTOM_UNITS, 'null-key', null as any);\r\n      const retrieved = await service.get(STORES.CUSTOM_UNITS, 'null-key');\r\n      expect(retrieved).toBeNull();\r\n    });\r\n\r\n    it('should handle undefined values', async () => {\r\n      await service.initialize();\r\n      \r\n      await service.put(STORES.CUSTOM_UNITS, 'undefined-key', undefined as any);\r\n      const retrieved = await service.get(STORES.CUSTOM_UNITS, 'undefined-key');\r\n      expect(retrieved).toBeUndefined();\r\n    });\r\n\r\n    it('should handle large objects', async () => {\r\n      await service.initialize();\r\n      const largeObject = {\r\n        id: 'large',\r\n        data: 'x'.repeat(10000),\r\n        nested: {\r\n          array: Array(100).fill({ value: 'test' }),\r\n        },\r\n      };\r\n      \r\n      await service.put(STORES.CUSTOM_UNITS, 'large-key', largeObject);\r\n      const retrieved = await service.get(STORES.CUSTOM_UNITS, 'large-key');\r\n      expect(retrieved).toEqual(largeObject);\r\n    });\r\n\r\n    it('should handle all store types', async () => {\r\n      await service.initialize();\r\n      const testValue = { id: 'test' };\r\n      \r\n      await service.put(STORES.CUSTOM_UNITS, 'key1', testValue);\r\n      await service.put(STORES.UNIT_METADATA, 'key2', testValue);\r\n      await service.put(STORES.CUSTOM_FORMULAS, 'key3', testValue);\r\n      \r\n      expect(await service.get(STORES.CUSTOM_UNITS, 'key1')).toEqual(testValue);\r\n      expect(await service.get(STORES.UNIT_METADATA, 'key2')).toEqual(testValue);\r\n      expect(await service.get(STORES.CUSTOM_FORMULAS, 'key3')).toEqual(testValue);\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\persistence\\MigrationService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1402,1405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1402,1405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1522,1525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1522,1525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3477,3480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3477,3480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4460,4463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4460,4463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5228,5231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5228,5231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6096,6099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6096,6099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7003,7006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7003,7006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":256,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8384,8387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8384,8387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { MigrationService } from '@/services/persistence/MigrationService';\r\nimport { indexedDBService, STORES } from '@/services/persistence/IndexedDBService';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\nimport { IFullUnit } from '@/services/units/CanonicalUnitService';\r\n\r\n// Mock dependencies\r\njest.mock('@/services/persistence/IndexedDBService');\r\njest.mock('@/services/persistence/SQLiteService');\r\njest.mock('@/services/units/UnitRepository');\r\n\r\nconst mockIndexedDBService = indexedDBService as jest.Mocked<typeof indexedDBService>;\r\nconst mockSQLiteService = getSQLiteService as jest.MockedFunction<typeof getSQLiteService>;\r\nconst mockUnitRepository = getUnitRepository as jest.MockedFunction<typeof getUnitRepository>;\r\n\r\ndescribe('MigrationService', () => {\r\n  let service: MigrationService;\r\n  let mockProgressCallback: jest.Mock;\r\n\r\n  beforeEach(() => {\r\n    service = new MigrationService();\r\n    mockProgressCallback = jest.fn();\r\n    \r\n    // Reset mocks\r\n    jest.clearAllMocks();\r\n    \r\n    // Setup default mock implementations\r\n    mockIndexedDBService.initialize.mockResolvedValue();\r\n    mockIndexedDBService.getAll.mockResolvedValue([]);\r\n    mockIndexedDBService.clear.mockResolvedValue();\r\n    \r\n    mockSQLiteService.mockReturnValue({\r\n      initialize: jest.fn(),\r\n    } as any);\r\n    \r\n    mockUnitRepository.mockReturnValue({\r\n      findByName: jest.fn(),\r\n      create: jest.fn(),\r\n    } as any);\r\n  });\r\n\r\n  describe('hasIndexedDBData', () => {\r\n    it('should return true when IndexedDB has units', async () => {\r\n      const mockUnits: IFullUnit[] = [\r\n        {\r\n          id: 'unit-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        } as IFullUnit,\r\n      ];\r\n      \r\n      mockIndexedDBService.getAll.mockResolvedValue(mockUnits);\r\n      \r\n      const result = await service.hasIndexedDBData();\r\n      \r\n      expect(result).toBe(true);\r\n      expect(mockIndexedDBService.initialize).toHaveBeenCalled();\r\n      expect(mockIndexedDBService.getAll).toHaveBeenCalledWith(STORES.CUSTOM_UNITS);\r\n    });\r\n\r\n    it('should return false when IndexedDB is empty', async () => {\r\n      mockIndexedDBService.getAll.mockResolvedValue([]);\r\n      \r\n      const result = await service.hasIndexedDBData();\r\n      \r\n      expect(result).toBe(false);\r\n    });\r\n\r\n    it('should return false when IndexedDB initialization fails', async () => {\r\n      mockIndexedDBService.initialize.mockRejectedValue(new Error('IndexedDB unavailable'));\r\n      \r\n      const result = await service.hasIndexedDBData();\r\n      \r\n      expect(result).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('migrateToSQLite', () => {\r\n    it('should migrate units successfully', async () => {\r\n      const mockUnits: IFullUnit[] = [\r\n        {\r\n          id: 'unit-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        } as IFullUnit,\r\n        {\r\n          id: 'unit-2',\r\n          chassis: 'Marauder',\r\n          variant: 'MAD-3R',\r\n          tonnage: 75,\r\n        } as IFullUnit,\r\n      ];\r\n      \r\n      mockIndexedDBService.getAll.mockResolvedValue(mockUnits);\r\n      \r\n      const mockRepo = {\r\n        findByName: jest.fn().mockReturnValue(null), // Unit doesn't exist\r\n        create: jest.fn().mockReturnValue({ success: true }),\r\n      };\r\n      mockUnitRepository.mockReturnValue(mockRepo as any);\r\n      \r\n      const result = await service.migrateToSQLite(mockProgressCallback);\r\n      \r\n      expect(result.success).toBe(true);\r\n      expect(result.totalUnits).toBe(2);\r\n      expect(result.migratedUnits).toBe(2);\r\n      expect(result.failedUnits).toBe(0);\r\n      expect(result.errors).toHaveLength(0);\r\n      expect(mockProgressCallback).toHaveBeenCalledTimes(2);\r\n      expect(mockRepo.create).toHaveBeenCalledTimes(2);\r\n    });\r\n\r\n    it('should skip units that already exist', async () => {\r\n      const mockUnits: IFullUnit[] = [\r\n        {\r\n          id: 'unit-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        } as IFullUnit,\r\n      ];\r\n      \r\n      mockIndexedDBService.getAll.mockResolvedValue(mockUnits);\r\n      \r\n      const mockRepo = {\r\n        findByName: jest.fn().mockReturnValue({ id: 'existing' }), // Unit exists\r\n        create: jest.fn(),\r\n      };\r\n      mockUnitRepository.mockReturnValue(mockRepo as any);\r\n      \r\n      const result = await service.migrateToSQLite();\r\n      \r\n      expect(result.success).toBe(true);\r\n      expect(result.totalUnits).toBe(1);\r\n      expect(result.migratedUnits).toBe(0);\r\n      expect(mockRepo.create).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should handle units without chassis or variant', async () => {\r\n      const mockUnits: IFullUnit[] = [\r\n        {\r\n          id: 'unit-1',\r\n          tonnage: 100,\r\n        } as IFullUnit,\r\n      ];\r\n      \r\n      mockIndexedDBService.getAll.mockResolvedValue(mockUnits);\r\n      \r\n      const mockRepo = {\r\n        findByName: jest.fn().mockReturnValue(null),\r\n        create: jest.fn().mockReturnValue({ success: true }),\r\n      };\r\n      mockUnitRepository.mockReturnValue(mockRepo as any);\r\n      \r\n      const result = await service.migrateToSQLite();\r\n      \r\n      expect(result.success).toBe(true);\r\n      expect(mockRepo.create).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          chassis: 'Unknown',\r\n          variant: 'Unknown',\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should handle creation failures', async () => {\r\n      const mockUnits: IFullUnit[] = [\r\n        {\r\n          id: 'unit-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        } as IFullUnit,\r\n      ];\r\n      \r\n      mockIndexedDBService.getAll.mockResolvedValue(mockUnits);\r\n      \r\n      const mockRepo = {\r\n        findByName: jest.fn().mockReturnValue(null),\r\n        create: jest.fn().mockReturnValue({ success: false, error: 'Creation failed' }),\r\n      };\r\n      mockUnitRepository.mockReturnValue(mockRepo as any);\r\n      \r\n      const result = await service.migrateToSQLite();\r\n      \r\n      expect(result.success).toBe(false);\r\n      expect(result.migratedUnits).toBe(0);\r\n      expect(result.failedUnits).toBe(1);\r\n      expect(result.errors).toHaveLength(1);\r\n      expect(result.errors[0].error).toBe('Creation failed');\r\n    });\r\n\r\n    it('should handle exceptions during migration', async () => {\r\n      const mockUnits: IFullUnit[] = [\r\n        {\r\n          id: 'unit-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        } as IFullUnit,\r\n      ];\r\n      \r\n      mockIndexedDBService.getAll.mockResolvedValue(mockUnits);\r\n      \r\n      const mockRepo = {\r\n        findByName: jest.fn().mockImplementation(() => {\r\n          throw new Error('Repository error');\r\n        }),\r\n        create: jest.fn(),\r\n      };\r\n      mockUnitRepository.mockReturnValue(mockRepo as any);\r\n      \r\n      const result = await service.migrateToSQLite();\r\n      \r\n      expect(result.success).toBe(false);\r\n      expect(result.failedUnits).toBe(1);\r\n      expect(result.errors).toHaveLength(1);\r\n      expect(result.errors[0].error).toBe('Repository error');\r\n    });\r\n\r\n    it('should return success with zero units when IndexedDB is empty', async () => {\r\n      mockIndexedDBService.getAll.mockResolvedValue([]);\r\n      \r\n      const result = await service.migrateToSQLite();\r\n      \r\n      expect(result.success).toBe(true);\r\n      expect(result.totalUnits).toBe(0);\r\n      expect(result.migratedUnits).toBe(0);\r\n      expect(result.failedUnits).toBe(0);\r\n    });\r\n\r\n    it('should call progress callback for each unit', async () => {\r\n      const mockUnits: IFullUnit[] = [\r\n        {\r\n          id: 'unit-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          tonnage: 100,\r\n        } as IFullUnit,\r\n        {\r\n          id: 'unit-2',\r\n          chassis: 'Marauder',\r\n          variant: 'MAD-3R',\r\n          tonnage: 75,\r\n        } as IFullUnit,\r\n      ];\r\n      \r\n      mockIndexedDBService.getAll.mockResolvedValue(mockUnits);\r\n      \r\n      const mockRepo = {\r\n        findByName: jest.fn().mockReturnValue(null),\r\n        create: jest.fn().mockReturnValue({ success: true }),\r\n      };\r\n      mockUnitRepository.mockReturnValue(mockRepo as any);\r\n      \r\n      await service.migrateToSQLite(mockProgressCallback);\r\n      \r\n      expect(mockProgressCallback).toHaveBeenCalledTimes(2);\r\n      expect(mockProgressCallback).toHaveBeenNthCalledWith(1, {\r\n        current: 1,\r\n        total: 2,\r\n        currentUnit: 'Atlas AS7-D',\r\n      });\r\n      expect(mockProgressCallback).toHaveBeenNthCalledWith(2, {\r\n        current: 2,\r\n        total: 2,\r\n        currentUnit: 'Marauder MAD-3R',\r\n      });\r\n    });\r\n\r\n    it('should handle initialization errors', async () => {\r\n      mockIndexedDBService.initialize.mockRejectedValue(new Error('Init failed'));\r\n      \r\n      const result = await service.migrateToSQLite();\r\n      \r\n      expect(result.success).toBe(false);\r\n      expect(result.errors).toHaveLength(1);\r\n      expect(result.errors[0].error).toContain('Init failed');\r\n    });\r\n  });\r\n\r\n  describe('clearIndexedDB', () => {\r\n    it('should clear custom units store', async () => {\r\n      await service.clearIndexedDB();\r\n      \r\n      expect(mockIndexedDBService.initialize).toHaveBeenCalled();\r\n      expect(mockIndexedDBService.clear).toHaveBeenCalledWith(STORES.CUSTOM_UNITS);\r\n      expect(mockIndexedDBService.clear).toHaveBeenCalledWith(STORES.UNIT_METADATA);\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\units\\CanonicalUnitService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\units\\CustomUnitApiService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7303,7306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7303,7306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":290,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8323,8326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8323,8326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { CustomUnitApiService } from '@/services/units/CustomUnitApiService';\r\nimport { canonicalUnitService } from '@/services/units/CanonicalUnitService';\r\nimport { IFullUnit } from '@/services/units/CanonicalUnitService';\r\n\r\n// Mock dependencies\r\njest.mock('@/services/units/CanonicalUnitService');\r\n\r\nconst mockCanonicalUnitService = canonicalUnitService as jest.Mocked<typeof canonicalUnitService>;\r\n\r\n// Mock fetch globally\r\nglobal.fetch = jest.fn();\r\n\r\ndescribe('CustomUnitApiService', () => {\r\n  let service: CustomUnitApiService;\r\n  let mockFetch: jest.MockedFunction<typeof fetch>;\r\n\r\n  beforeEach(() => {\r\n    service = new CustomUnitApiService();\r\n    mockFetch = global.fetch as jest.MockedFunction<typeof fetch>;\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('list', () => {\r\n    it('should list all custom units', async () => {\r\n      const mockUnits = [\r\n        { id: 'custom-1', chassis: 'Atlas', variant: 'AS7-X' },\r\n        { id: 'custom-2', chassis: 'Marauder', variant: 'MAD-3R' },\r\n      ];\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({ units: mockUnits }),\r\n      } as Response);\r\n\r\n      const result = await service.list();\r\n\r\n      expect(result).toEqual(mockUnits);\r\n      expect(mockFetch).toHaveBeenCalledWith('/api/units/custom');\r\n    });\r\n\r\n    it('should throw on API error', async () => {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: false,\r\n        statusText: 'Internal Server Error',\r\n      } as Response);\r\n\r\n      await expect(service.list()).rejects.toThrow('Failed to list units');\r\n    });\r\n  });\r\n\r\n  describe('getById', () => {\r\n    it('should get unit by ID', async () => {\r\n      const mockUnit = {\r\n        id: 'custom-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        parsedData: { id: 'custom-1', chassis: 'Atlas', variant: 'AS7-X', tonnage: 100 },\r\n        currentVersion: 1,\r\n        createdAt: '2024-01-01',\r\n        updatedAt: '2024-01-02',\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => mockUnit,\r\n      } as Response);\r\n\r\n      const result = await service.getById('custom-1');\r\n\r\n      expect(result).toEqual({\r\n        ...mockUnit.parsedData,\r\n        id: 'custom-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        currentVersion: 1,\r\n        createdAt: '2024-01-01',\r\n        updatedAt: '2024-01-02',\r\n      });\r\n      expect(mockFetch).toHaveBeenCalledWith('/api/units/custom/custom-1');\r\n    });\r\n\r\n    it('should return null for 404', async () => {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: false,\r\n        status: 404,\r\n        statusText: 'Not Found',\r\n      } as Response);\r\n\r\n      const result = await service.getById('non-existent');\r\n\r\n      expect(result).toBeNull();\r\n    });\r\n\r\n    it('should throw on other errors', async () => {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: false,\r\n        status: 500,\r\n        statusText: 'Internal Server Error',\r\n      } as Response);\r\n\r\n      await expect(service.getById('custom-1')).rejects.toThrow('Failed to get unit');\r\n    });\r\n  });\r\n\r\n  describe('create', () => {\r\n    it('should create a new unit', async () => {\r\n      const unit: IFullUnit = {\r\n        id: 'temp',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        tonnage: 100,\r\n      } as IFullUnit;\r\n\r\n      // Mock findByName to return null (no conflict)\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({ units: [] }),\r\n      } as Response);\r\n\r\n      // Mock create API call\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({ id: 'custom-1', version: 1 }),\r\n      } as Response);\r\n\r\n      const result = await service.create(unit, 'Atlas', 'AS7-X');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.id).toBe('custom-1');\r\n      expect(result.version).toBe(1);\r\n    });\r\n\r\n    it('should reject duplicate names', async () => {\r\n      const unit: IFullUnit = {\r\n        id: 'temp',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        tonnage: 100,\r\n      } as IFullUnit;\r\n\r\n      // Mock findByName to return existing unit\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({\r\n          units: [{ id: 'custom-1', chassis: 'Atlas', variant: 'AS7-X' }],\r\n        }),\r\n      } as Response);\r\n\r\n      // Mock suggestCloneName\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-X',\r\n          suggestedVariant: 'AS7-X-Custom-1',\r\n        }),\r\n      } as Response);\r\n\r\n      const result = await service.create(unit, 'Atlas', 'AS7-X');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.requiresRename).toBe(true);\r\n      expect(result.suggestedName).toBeDefined();\r\n    });\r\n\r\n    it('should handle API errors', async () => {\r\n      const unit: IFullUnit = {\r\n        id: 'temp',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        tonnage: 100,\r\n      } as IFullUnit;\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({ units: [] }),\r\n      } as Response);\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: false,\r\n        json: async () => ({ error: 'Database error' }),\r\n      } as Response);\r\n\r\n      const result = await service.create(unit, 'Atlas', 'AS7-X');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toBe('Database error');\r\n    });\r\n  });\r\n\r\n  describe('save', () => {\r\n    it('should save an existing unit', async () => {\r\n      const unit: IFullUnit = {\r\n        id: 'custom-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        tonnage: 100,\r\n      } as IFullUnit;\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({ id: 'custom-1', version: 2 }),\r\n      } as Response);\r\n\r\n      const result = await service.save('custom-1', unit);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.version).toBe(2);\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        '/api/units/custom/custom-1',\r\n        expect.objectContaining({\r\n          method: 'PUT',\r\n          headers: { 'Content-Type': 'application/json' },\r\n        })\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('delete', () => {\r\n    it('should delete a unit', async () => {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({ id: 'custom-1' }),\r\n      } as Response);\r\n\r\n      const result = await service.delete('custom-1');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.id).toBe('custom-1');\r\n    });\r\n\r\n    it('should handle delete errors', async () => {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: false,\r\n        json: async () => ({ error: 'Not found' }),\r\n      } as Response);\r\n\r\n      const result = await service.delete('non-existent');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toBe('Not found');\r\n    });\r\n  });\r\n\r\n  describe('isCanonical', () => {\r\n    it('should check if unit is canonical', async () => {\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([\r\n        {\r\n          id: 'canon-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n        } as any,\r\n      ]);\r\n\r\n      const result = await service.isCanonical('Atlas', 'AS7-D');\r\n      expect(result).toBe(true);\r\n\r\n      const result2 = await service.isCanonical('Custom', 'Mech');\r\n      expect(result2).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('checkSaveAllowed', () => {\r\n    it('should allow saving existing custom units', async () => {\r\n      const unit: IFullUnit = {\r\n        id: 'custom-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-X',\r\n        tonnage: 100,\r\n      } as IFullUnit;\r\n\r\n      const result = await service.checkSaveAllowed(unit, 'custom-1');\r\n\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('should block canonical units', async () => {\r\n      const unit: IFullUnit = {\r\n        id: 'canon-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-D',\r\n        tonnage: 100,\r\n      } as IFullUnit;\r\n\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([\r\n        {\r\n          id: 'canon-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n        } as any,\r\n      ]);\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          suggestedVariant: 'AS7-D-Custom-1',\r\n        }),\r\n      } as Response);\r\n\r\n      const result = await service.checkSaveAllowed(unit);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.requiresRename).toBe(true);\r\n      expect(result.suggestedName).toBeDefined();\r\n    });\r\n\r\n    it('should allow new custom units', async () => {\r\n      const unit: IFullUnit = {\r\n        id: 'temp',\r\n        chassis: 'Custom',\r\n        variant: 'Mech',\r\n        tonnage: 50,\r\n      } as IFullUnit;\r\n\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([]);\r\n\r\n      const result = await service.checkSaveAllowed(unit);\r\n\r\n      expect(result.success).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('getVersionHistory', () => {\r\n    it('should get version history', async () => {\r\n      const mockVersions = [\r\n        { version: 1, savedAt: '2024-01-01', notes: 'Initial' },\r\n        { version: 2, savedAt: '2024-01-02', notes: 'Updated' },\r\n      ];\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({ versions: mockVersions }),\r\n      } as Response);\r\n\r\n      const result = await service.getVersionHistory('custom-1');\r\n\r\n      expect(result).toEqual(mockVersions);\r\n    });\r\n  });\r\n\r\n  describe('getVersion', () => {\r\n    it('should get specific version', async () => {\r\n      const mockVersion = {\r\n        version: 2,\r\n        savedAt: '2024-01-02',\r\n        notes: 'Updated',\r\n        revertSource: null,\r\n        parsedData: { id: 'custom-1', chassis: 'Atlas', variant: 'AS7-X' },\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => mockVersion,\r\n      } as Response);\r\n\r\n      const result = await service.getVersion('custom-1', 2);\r\n\r\n      expect(result).toEqual({\r\n        version: 2,\r\n        savedAt: '2024-01-02',\r\n        notes: 'Updated',\r\n        revertSource: null,\r\n        data: mockVersion.parsedData,\r\n      });\r\n    });\r\n\r\n    it('should return null for 404', async () => {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: false,\r\n        status: 404,\r\n      } as Response);\r\n\r\n      const result = await service.getVersion('custom-1', 999);\r\n\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('revert', () => {\r\n    it('should revert to previous version', async () => {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({ id: 'custom-1', version: 3 }),\r\n      } as Response);\r\n\r\n      const result = await service.revert('custom-1', 2, 'Reverted to version 2');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.version).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe('exportUnit', () => {\r\n    it('should export unit', async () => {\r\n      const mockEnvelope = {\r\n        unit: { id: 'custom-1', chassis: 'Atlas', variant: 'AS7-X' },\r\n        metadata: { version: 1 },\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => mockEnvelope,\r\n      } as Response);\r\n\r\n      const result = await service.exportUnit('custom-1');\r\n\r\n      expect(result).toEqual(mockEnvelope);\r\n    });\r\n\r\n    it('should return null for 404', async () => {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: false,\r\n        status: 404,\r\n      } as Response);\r\n\r\n      const result = await service.exportUnit('non-existent');\r\n\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('importUnit', () => {\r\n    it('should import unit', async () => {\r\n      const mockEnvelope = {\r\n        unit: { id: 'temp', chassis: 'Atlas', variant: 'AS7-X' },\r\n        metadata: { version: 1 },\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: async () => ({ unitId: 'custom-1' }),\r\n      } as Response);\r\n\r\n      const result = await service.importUnit(mockEnvelope);\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.id).toBe('custom-1');\r\n    });\r\n\r\n    it('should handle conflicts', async () => {\r\n      const mockEnvelope = {\r\n        unit: { id: 'temp', chassis: 'Atlas', variant: 'AS7-D' },\r\n      };\r\n\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: false,\r\n        status: 409,\r\n        json: async () => ({\r\n          error: 'Duplicate name',\r\n          suggestedName: 'AS7-D-Custom-1',\r\n        }),\r\n      } as Response);\r\n\r\n      const result = await service.importUnit(mockEnvelope);\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.requiresRename).toBe(true);\r\n      expect(result.suggestedName).toBeDefined();\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\units\\CustomUnitService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\units\\UnitFactoryService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\units\\UnitLoaderService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3566,3569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3566,3569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5339,5342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5339,5342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10407,10410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10407,10410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { UnitLoaderService, ISerializedUnit } from '@/services/units/UnitLoaderService';\r\nimport { canonicalUnitService, IFullUnit } from '@/services/units/CanonicalUnitService';\r\nimport { customUnitApiService } from '@/services/units/CustomUnitApiService';\r\nimport { equipmentLookupService } from '@/services/equipment/EquipmentLookupService';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { RulesLevel } from '@/types/enums/RulesLevel';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType } from '@/types/construction/CockpitType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\r\nimport { MechLocation } from '@/types/construction/CriticalSlotAllocation';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\n\r\n// Mock dependencies\r\njest.mock('@/services/units/CanonicalUnitService');\r\njest.mock('@/services/units/CustomUnitApiService');\r\njest.mock('@/services/equipment/EquipmentLookupService');\r\njest.mock('uuid', () => ({\r\n  v4: jest.fn(() => 'mock-uuid-123'),\r\n}));\r\n\r\nconst mockCanonicalUnitService = canonicalUnitService as jest.Mocked<typeof canonicalUnitService>;\r\nconst mockCustomUnitApiService = customUnitApiService as jest.Mocked<typeof customUnitApiService>;\r\nconst mockEquipmentLookupService = equipmentLookupService as jest.Mocked<typeof equipmentLookupService>;\r\n\r\ndescribe('UnitLoaderService', () => {\r\n  let service: UnitLoaderService;\r\n\r\n  beforeEach(() => {\r\n    service = new UnitLoaderService();\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('loadCanonicalUnit', () => {\r\n    it('should load canonical unit successfully', async () => {\r\n      const mockUnit: IFullUnit = {\r\n        id: 'canon-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-D',\r\n        tonnage: 100,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      } as IFullUnit;\r\n\r\n      mockCanonicalUnitService.getById.mockResolvedValue(mockUnit);\r\n\r\n      const result = await service.loadCanonicalUnit('canon-1');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.state).toBeDefined();\r\n      expect(result.state?.chassis).toBe('Atlas');\r\n      expect(result.state?.model).toBe('AS7-D');\r\n      expect(result.error).toBeUndefined();\r\n    });\r\n\r\n    it('should return error when unit not found', async () => {\r\n      mockCanonicalUnitService.getById.mockResolvedValue(null);\r\n\r\n      const result = await service.loadCanonicalUnit('non-existent');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain('not found');\r\n      expect(result.state).toBeUndefined();\r\n    });\r\n\r\n    it('should handle errors gracefully', async () => {\r\n      mockCanonicalUnitService.getById.mockRejectedValue(new Error('Service error'));\r\n\r\n      const result = await service.loadCanonicalUnit('canon-1');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toBe('Service error');\r\n    });\r\n  });\r\n\r\n  describe('loadCustomUnit', () => {\r\n    it('should load custom unit successfully', async () => {\r\n      const mockUnit = {\r\n        id: 'custom-1',\r\n        chassis: 'Custom Atlas',\r\n        variant: 'AS7-X',\r\n        tonnage: 100,\r\n        techBase: TechBase.INNER_SPHERE,\r\n        currentVersion: 1,\r\n        createdAt: '2024-01-01',\r\n        updatedAt: '2024-01-02',\r\n      };\r\n\r\n      mockCustomUnitApiService.getById.mockResolvedValue(mockUnit as any);\r\n\r\n      const result = await service.loadCustomUnit('custom-1');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(result.state).toBeDefined();\r\n      expect(result.state?.chassis).toBe('Custom Atlas');\r\n    });\r\n\r\n    it('should return error when custom unit not found', async () => {\r\n      mockCustomUnitApiService.getById.mockResolvedValue(null);\r\n\r\n      const result = await service.loadCustomUnit('non-existent');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toContain('not found');\r\n    });\r\n\r\n    it('should handle errors gracefully', async () => {\r\n      mockCustomUnitApiService.getById.mockRejectedValue(new Error('API error'));\r\n\r\n      const result = await service.loadCustomUnit('custom-1');\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toBe('API error');\r\n    });\r\n  });\r\n\r\n  describe('loadUnit', () => {\r\n    it('should load canonical unit when source is canonical', async () => {\r\n      const mockUnit: IFullUnit = {\r\n        id: 'canon-1',\r\n        chassis: 'Atlas',\r\n        variant: 'AS7-D',\r\n        tonnage: 100,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      } as IFullUnit;\r\n\r\n      mockCanonicalUnitService.getById.mockResolvedValue(mockUnit);\r\n\r\n      const result = await service.loadUnit('canon-1', 'canonical');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(mockCanonicalUnitService.getById).toHaveBeenCalledWith('canon-1');\r\n    });\r\n\r\n    it('should load custom unit when source is custom', async () => {\r\n      const mockUnit = {\r\n        id: 'custom-1',\r\n        chassis: 'Custom',\r\n        variant: 'Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      };\r\n\r\n      mockCustomUnitApiService.getById.mockResolvedValue(mockUnit as any);\r\n\r\n      const result = await service.loadUnit('custom-1', 'custom');\r\n\r\n      expect(result.success).toBe(true);\r\n      expect(mockCustomUnitApiService.getById).toHaveBeenCalledWith('custom-1');\r\n    });\r\n  });\r\n\r\n  describe('mapToUnitState', () => {\r\n    const createMockSerializedUnit = (overrides?: Partial<ISerializedUnit>): ISerializedUnit => ({\r\n      id: 'test-unit',\r\n      chassis: 'Atlas',\r\n      variant: 'AS7-D',\r\n      tonnage: 100,\r\n      techBase: 'Inner Sphere',\r\n      ...overrides,\r\n    });\r\n\r\n    it('should map basic unit data', () => {\r\n      const serialized = createMockSerializedUnit();\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.chassis).toBe('Atlas');\r\n      expect(state.model).toBe('AS7-D');\r\n      expect(state.tonnage).toBe(100);\r\n      expect(state.techBase).toBe(TechBase.INNER_SPHERE);\r\n      expect(state.id).toBe('mock-uuid-123'); // New UUID for loaded units\r\n    });\r\n\r\n    it('should map engine types', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        engine: { type: 'Standard Fusion', rating: 300 },\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.engineType).toBe(EngineType.STANDARD);\r\n      expect(state.engineRating).toBe(300);\r\n    });\r\n\r\n    it('should map XL engine based on tech base', () => {\r\n      const serializedIS = createMockSerializedUnit({\r\n        techBase: 'Inner Sphere',\r\n        engine: { type: 'XL', rating: 300 },\r\n      });\r\n      const stateIS = service.mapToUnitState(serializedIS, true);\r\n      expect(stateIS.engineType).toBe(EngineType.XL_IS);\r\n\r\n      const serializedClan = createMockSerializedUnit({\r\n        techBase: 'Clan',\r\n        engine: { type: 'XL', rating: 300 },\r\n      });\r\n      const stateClan = service.mapToUnitState(serializedClan, true);\r\n      expect(stateClan.engineType).toBe(EngineType.XL_CLAN);\r\n    });\r\n\r\n    it('should calculate engine rating from movement if not provided', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        movement: { walk: 3 },\r\n        tonnage: 100,\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.engineRating).toBe(300); // 3 * 100\r\n    });\r\n\r\n    it('should map gyro types', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        gyro: { type: 'XL Gyro' },\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.gyroType).toBe(GyroType.XL);\r\n    });\r\n\r\n    it('should map structure types', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        structure: { type: 'Endo Steel' },\r\n        techBase: 'Inner Sphere',\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.internalStructureType).toBe(InternalStructureType.ENDO_STEEL_IS);\r\n    });\r\n\r\n    it('should map cockpit types', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        cockpit: 'Small Cockpit',\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.cockpitType).toBe(CockpitType.SMALL);\r\n    });\r\n\r\n    it('should map heat sink types', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        heatSinks: { type: 'Double', count: 20 },\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.heatSinkType).toBe(HeatSinkType.DOUBLE_IS);\r\n      expect(state.heatSinkCount).toBe(20);\r\n    });\r\n\r\n    it('should use default heat sink count if not provided', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        heatSinks: { type: 'Single' },\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.heatSinkCount).toBe(10);\r\n    });\r\n\r\n    it('should map armor types', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        armor: { type: 'Ferro-Fibrous' },\r\n        techBase: 'Inner Sphere',\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.armorType).toBe(ArmorTypeEnum.FERRO_FIBROUS_IS);\r\n    });\r\n\r\n    it('should map armor allocation', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        armor: {\r\n          type: 'Standard',\r\n          allocation: {\r\n            Head: 9,\r\n            'Center Torso': { front: 30, rear: 10 },\r\n          },\r\n        },\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.armorAllocation[MechLocation.HEAD]).toBe(9);\r\n      expect(state.armorAllocation[MechLocation.CENTER_TORSO]).toBe(30);\r\n      expect(state.armorAllocation.centerTorsoRear).toBe(10);\r\n    });\r\n\r\n    it('should map equipment with location', () => {\r\n      const mockEquipment = {\r\n        id: 'medium-laser',\r\n        name: 'Medium Laser',\r\n        category: EquipmentCategory.ENERGY_WEAPON,\r\n        weight: 1,\r\n        criticalSlots: 1,\r\n        heat: 3,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      };\r\n\r\n      mockEquipmentLookupService.getById.mockReturnValue(mockEquipment as any);\r\n\r\n      const serialized = createMockSerializedUnit({\r\n        equipment: [\r\n          { id: 'medium-laser', location: 'Right Arm' },\r\n        ],\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.equipment).toHaveLength(1);\r\n      expect(state.equipment[0].equipmentId).toBe('medium-laser');\r\n      expect(state.equipment[0].location).toBe(MechLocation.RIGHT_ARM);\r\n      expect(state.equipment[0].name).toBe('Medium Laser');\r\n    });\r\n\r\n    it('should create placeholder for unknown equipment', () => {\r\n      mockEquipmentLookupService.getById.mockReturnValue(undefined);\r\n\r\n      const serialized = createMockSerializedUnit({\r\n        equipment: [\r\n          { id: 'unknown-equipment', location: 'Left Arm' },\r\n        ],\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.equipment).toHaveLength(1);\r\n      expect(state.equipment[0].equipmentId).toBe('unknown-equipment');\r\n      expect(state.equipment[0].name).toBe('unknown-equipment');\r\n      expect(state.equipment[0].category).toBe(EquipmentCategory.MISC_EQUIPMENT);\r\n    });\r\n\r\n    it('should map rules level', () => {\r\n      const serialized = createMockSerializedUnit({\r\n        rulesLevel: 'Advanced',\r\n      });\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.rulesLevel).toBe(RulesLevel.ADVANCED);\r\n    });\r\n\r\n    it('should use model or variant for name', () => {\r\n      const serializedWithModel = createMockSerializedUnit({\r\n        model: 'AS7-D',\r\n      });\r\n      const stateWithModel = service.mapToUnitState(serializedWithModel, true);\r\n      expect(stateWithModel.model).toBe('AS7-D');\r\n      expect(stateWithModel.name).toBe('Atlas AS7-D');\r\n\r\n      const serializedWithVariant = createMockSerializedUnit({\r\n        variant: 'AS7-K',\r\n      });\r\n      const stateWithVariant = service.mapToUnitState(serializedWithVariant, true);\r\n      expect(stateWithVariant.model).toBe('AS7-K');\r\n    });\r\n\r\n    it('should set tech base mode based on tech base', () => {\r\n      const serializedIS = createMockSerializedUnit({\r\n        techBase: 'Inner Sphere',\r\n      });\r\n      const stateIS = service.mapToUnitState(serializedIS, true);\r\n      expect(stateIS.techBaseMode).toBe('inner_sphere');\r\n\r\n      const serializedClan = createMockSerializedUnit({\r\n        techBase: 'Clan',\r\n      });\r\n      const stateClan = service.mapToUnitState(serializedClan, true);\r\n      expect(stateClan.techBaseMode).toBe('clan');\r\n    });\r\n\r\n    it('should use defaults for missing optional fields', () => {\r\n      const minimalUnit = createMockSerializedUnit({\r\n        engine: undefined,\r\n        gyro: undefined,\r\n        cockpit: undefined,\r\n        structure: undefined,\r\n        heatSinks: undefined,\r\n        armor: undefined,\r\n        equipment: undefined,\r\n        rulesLevel: undefined,\r\n        year: undefined,\r\n      });\r\n      const state = service.mapToUnitState(minimalUnit, true);\r\n\r\n      expect(state.engineType).toBe(EngineType.STANDARD);\r\n      expect(state.gyroType).toBe(GyroType.STANDARD);\r\n      expect(state.cockpitType).toBe(CockpitType.STANDARD);\r\n      expect(state.internalStructureType).toBe(InternalStructureType.STANDARD);\r\n      expect(state.heatSinkType).toBe(HeatSinkType.SINGLE);\r\n      expect(state.armorType).toBe(ArmorTypeEnum.STANDARD);\r\n      expect(state.rulesLevel).toBe(RulesLevel.STANDARD);\r\n      expect(state.year).toBe(3025);\r\n      expect(state.equipment).toEqual([]);\r\n    });\r\n\r\n    it('should set isModified to false for loaded units', () => {\r\n      const serialized = createMockSerializedUnit();\r\n      const state = service.mapToUnitState(serialized, true);\r\n\r\n      expect(state.isModified).toBe(false);\r\n    });\r\n\r\n    it('should set timestamps for loaded units', () => {\r\n      const serialized = createMockSerializedUnit();\r\n      const beforeTime = Date.now();\r\n      const state = service.mapToUnitState(serialized, true);\r\n      const afterTime = Date.now();\r\n\r\n      expect(state.createdAt).toBeGreaterThanOrEqual(beforeTime);\r\n      expect(state.createdAt).toBeLessThanOrEqual(afterTime);\r\n      expect(state.lastModifiedAt).toBeGreaterThanOrEqual(beforeTime);\r\n      expect(state.lastModifiedAt).toBeLessThanOrEqual(afterTime);\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\units\\UnitNameValidator.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2666,2669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2666,2669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3457,3460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3457,3460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4233,4236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4233,4236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5174,5177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5174,5177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6175,6178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6175,6178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6395,6398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6395,6398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":185,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6894,6897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6894,6897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7361,7364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7361,7364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7908,7911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7908,7911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8074,8077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8074,8077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { unitNameValidator } from '@/services/units/UnitNameValidator';\r\nimport { canonicalUnitService } from '@/services/units/CanonicalUnitService';\r\nimport { customUnitService } from '@/services/units/CustomUnitService';\r\n\r\n// Mock dependencies\r\njest.mock('@/services/units/CanonicalUnitService');\r\njest.mock('@/services/units/CustomUnitService');\r\n\r\nconst mockCanonicalUnitService = canonicalUnitService as jest.Mocked<typeof canonicalUnitService>;\r\nconst mockCustomUnitService = customUnitService as jest.Mocked<typeof customUnitService>;\r\n\r\ndescribe('UnitNameValidator', () => {\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('normalizeForComparison', () => {\r\n    it('should normalize names for case-insensitive comparison', () => {\r\n      expect(unitNameValidator.normalizeForComparison('Atlas AS7-D')).toBe('atlas as7-d');\r\n      expect(unitNameValidator.normalizeForComparison('  Atlas   AS7-D  ')).toBe('atlas as7-d');\r\n      expect(unitNameValidator.normalizeForComparison('ATLAS AS7-D')).toBe('atlas as7-d');\r\n    });\r\n\r\n    it('should normalize multiple spaces to single space', () => {\r\n      expect(unitNameValidator.normalizeForComparison('Atlas   AS7-D')).toBe('atlas as7-d');\r\n    });\r\n  });\r\n\r\n  describe('buildFullName', () => {\r\n    it('should build full name from chassis and variant', () => {\r\n      expect(unitNameValidator.buildFullName('Atlas', 'AS7-D')).toBe('Atlas AS7-D');\r\n    });\r\n\r\n    it('should handle empty variant', () => {\r\n      expect(unitNameValidator.buildFullName('Atlas', '')).toBe('Atlas');\r\n    });\r\n\r\n    it('should trim whitespace', () => {\r\n      expect(unitNameValidator.buildFullName('  Atlas  ', '  AS7-D  ')).toBe('Atlas AS7-D');\r\n    });\r\n  });\r\n\r\n  describe('validateUnitName', () => {\r\n    it('should reject empty chassis', async () => {\r\n      const result = await unitNameValidator.validateUnitName('', 'AS7-D');\r\n      \r\n      expect(result.isValid).toBe(false);\r\n      expect(result.errorMessage).toBe('Chassis name is required');\r\n      expect(result.isCanonicalConflict).toBe(false);\r\n      expect(result.isCustomConflict).toBe(false);\r\n    });\r\n\r\n    it('should reject empty variant', async () => {\r\n      const result = await unitNameValidator.validateUnitName('Atlas', '');\r\n      \r\n      expect(result.isValid).toBe(false);\r\n      expect(result.errorMessage).toBe('Variant designation is required');\r\n    });\r\n\r\n    it('should reject canonical unit conflicts', async () => {\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([\r\n        {\r\n          id: 'canon-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          name: 'Atlas AS7-D',\r\n        } as any,\r\n      ]);\r\n      mockCustomUnitService.list.mockResolvedValue([]);\r\n      \r\n      const result = await unitNameValidator.validateUnitName('Atlas', 'AS7-D');\r\n      \r\n      expect(result.isValid).toBe(false);\r\n      expect(result.isCanonicalConflict).toBe(true);\r\n      expect(result.isCustomConflict).toBe(false);\r\n      expect(result.errorMessage).toContain('official BattleTech unit');\r\n      expect(result.suggestedName).toBeDefined();\r\n    });\r\n\r\n    it('should detect custom unit conflicts', async () => {\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([]);\r\n      mockCustomUnitService.list.mockResolvedValue([\r\n        {\r\n          id: 'custom-1',\r\n          chassis: 'Custom Atlas',\r\n          variant: 'AS7-X',\r\n          name: 'Custom Atlas AS7-X',\r\n        } as any,\r\n      ]);\r\n      \r\n      const result = await unitNameValidator.validateUnitName('Custom Atlas', 'AS7-X');\r\n      \r\n      expect(result.isValid).toBe(true); // Valid but needs confirmation\r\n      expect(result.isCanonicalConflict).toBe(false);\r\n      expect(result.isCustomConflict).toBe(true);\r\n      expect(result.conflictingUnitId).toBe('custom-1');\r\n      expect(result.errorMessage).toContain('already exists');\r\n    });\r\n\r\n    it('should exclude unit ID from conflict check', async () => {\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([]);\r\n      mockCustomUnitService.list.mockResolvedValue([\r\n        {\r\n          id: 'custom-1',\r\n          chassis: 'Custom Atlas',\r\n          variant: 'AS7-X',\r\n          name: 'Custom Atlas AS7-X',\r\n        } as any,\r\n      ]);\r\n      \r\n      const result = await unitNameValidator.validateUnitName('Custom Atlas', 'AS7-X', 'custom-1');\r\n      \r\n      expect(result.isValid).toBe(true);\r\n      expect(result.isCustomConflict).toBe(false);\r\n    });\r\n\r\n    it('should accept unique names', async () => {\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([]);\r\n      mockCustomUnitService.list.mockResolvedValue([]);\r\n      \r\n      const result = await unitNameValidator.validateUnitName('Unique Mech', 'UM-1');\r\n      \r\n      expect(result.isValid).toBe(true);\r\n      expect(result.isCanonicalConflict).toBe(false);\r\n      expect(result.isCustomConflict).toBe(false);\r\n    });\r\n\r\n    it('should handle case-insensitive matching', async () => {\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([\r\n        {\r\n          id: 'canon-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          name: 'Atlas AS7-D',\r\n        } as any,\r\n      ]);\r\n      mockCustomUnitService.list.mockResolvedValue([]);\r\n      \r\n      const result = await unitNameValidator.validateUnitName('atlas', 'as7-d');\r\n      \r\n      expect(result.isCanonicalConflict).toBe(true);\r\n    });\r\n\r\n    it('should handle canonical service errors gracefully', async () => {\r\n      mockCanonicalUnitService.getIndex.mockRejectedValue(new Error('Service error'));\r\n      mockCustomUnitService.list.mockResolvedValue([]);\r\n      \r\n      const result = await unitNameValidator.validateUnitName('Test Mech', 'TM-1');\r\n      \r\n      // Should not block on canonical check failure\r\n      expect(result.isCanonicalConflict).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('generateUniqueName', () => {\r\n    it('should generate unique name by appending suffix', async () => {\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([\r\n        {\r\n          id: 'canon-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D',\r\n          name: 'Atlas AS7-D',\r\n        } as any,\r\n      ]);\r\n      mockCustomUnitService.list.mockResolvedValue([\r\n        {\r\n          id: 'custom-1',\r\n          chassis: 'Atlas',\r\n          variant: 'AS7-D (2)',\r\n          name: 'Atlas AS7-D (2)',\r\n        } as any,\r\n      ]);\r\n      \r\n      // First two names are taken, third should be available\r\n      let callCount = 0;\r\n      mockCanonicalUnitService.getIndex.mockImplementation(() => {\r\n        callCount++;\r\n        if (callCount <= 2) {\r\n          return Promise.resolve([\r\n            {\r\n              id: 'canon-1',\r\n              chassis: 'Atlas',\r\n              variant: callCount === 1 ? 'AS7-D' : 'AS7-D (2)',\r\n              name: `Atlas AS7-D${callCount === 2 ? ' (2)' : ''}`,\r\n            } as any,\r\n          ]);\r\n        }\r\n        return Promise.resolve([]);\r\n      });\r\n      \r\n      mockCustomUnitService.list.mockImplementation(() => {\r\n        callCount++;\r\n        if (callCount <= 2) {\r\n          return Promise.resolve([\r\n            {\r\n              id: 'custom-1',\r\n              chassis: 'Atlas',\r\n              variant: callCount === 1 ? 'AS7-D' : 'AS7-D (2)',\r\n              name: `Atlas AS7-D${callCount === 2 ? ' (2)' : ''}`,\r\n            } as any,\r\n          ]);\r\n        }\r\n        return Promise.resolve([]);\r\n      });\r\n      \r\n      const result = await unitNameValidator.generateUniqueName('Atlas', 'AS7-D');\r\n      \r\n      expect(result.chassis).toBe('Atlas');\r\n      expect(result.variant).toBe('AS7-D (3)');\r\n    });\r\n\r\n    it('should use timestamp fallback if many conflicts', async () => {\r\n      // Mock to always return conflicts\r\n      mockCanonicalUnitService.getIndex.mockResolvedValue([\r\n        { id: 'canon-1', chassis: 'Atlas', variant: 'AS7-D', name: 'Atlas AS7-D' } as any,\r\n      ]);\r\n      mockCustomUnitService.list.mockResolvedValue([\r\n        { id: 'custom-1', chassis: 'Atlas', variant: 'AS7-D (2)', name: 'Atlas AS7-D (2)' } as any,\r\n      ]);\r\n      \r\n      // Mock validateUnitName to always return conflicts for first 100 attempts\r\n      const originalValidate = unitNameValidator.validateUnitName.bind(unitNameValidator);\r\n      let attemptCount = 0;\r\n      jest.spyOn(unitNameValidator, 'validateUnitName').mockImplementation(async (chassis, variant) => {\r\n        attemptCount++;\r\n        if (attemptCount < 100) {\r\n          return {\r\n            isValid: false,\r\n            isCanonicalConflict: true,\r\n            isCustomConflict: false,\r\n          };\r\n        }\r\n        return originalValidate(chassis, variant);\r\n      });\r\n      \r\n      const result = await unitNameValidator.generateUniqueName('Atlas', 'AS7-D');\r\n      \r\n      expect(result.chassis).toBe('Atlas');\r\n      expect(result.variant).toMatch(/AS7-D-[a-z0-9]+/); // Timestamp suffix\r\n      \r\n      jest.restoreAllMocks();\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\units\\UnitRepository.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\units\\UnitSearchService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1038,1041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1038,1041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .addAll on an `any` value.","line":104,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":104,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'results' is assigned a value but never used.","line":128,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":128,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .search on an `any` value.","line":130,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":130,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'results' is assigned a value but never used.","line":140,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":140,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .search on an `any` value.","line":142,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":142,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'results' is assigned a value but never used.","line":146,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .search on an `any` value.","line":148,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":148,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .add on an `any` value.","line":166,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":166,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .discard on an `any` value.","line":178,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":178,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { UnitSearchService } from '@/services/units/UnitSearchService';\r\nimport { canonicalUnitService } from '@/services/units/CanonicalUnitService';\r\nimport { customUnitApiService } from '@/services/units/CustomUnitApiService';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { WeightClass } from '@/types/enums/WeightClass';\r\n\r\n// Mock MiniSearch\r\njest.mock('minisearch', () => {\r\n  const mockIndex = {\r\n    addAll: jest.fn(),\r\n    add: jest.fn(),\r\n    remove: jest.fn(),\r\n    search: jest.fn(),\r\n  };\r\n  \r\n  return {\r\n    __esModule: true,\r\n    default: jest.fn().mockImplementation(() => mockIndex),\r\n  };\r\n});\r\n\r\n// Mock services\r\njest.mock('@/services/units/CanonicalUnitService', () => ({\r\n  canonicalUnitService: {\r\n    getIndex: jest.fn(),\r\n  },\r\n}));\r\n\r\njest.mock('@/services/units/CustomUnitApiService', () => ({\r\n  customUnitApiService: {\r\n    list: jest.fn(),\r\n  },\r\n}));\r\n\r\nimport MiniSearch from 'minisearch';\r\n\r\ndescribe('UnitSearchService', () => {\r\n  let service: UnitSearchService;\r\n  let mockSearchIndex: any;\r\n\r\n  const mockCanonicalUnit = {\r\n    id: 'atlas-as7-d',\r\n    chassis: 'Atlas',\r\n    variant: 'AS7-D',\r\n    tonnage: 100,\r\n    techBase: TechBase.INNER_SPHERE,\r\n    era: 'AGE_OF_WAR',\r\n    weightClass: WeightClass.ASSAULT,\r\n    unitType: 'BattleMech',\r\n    name: 'Atlas AS7-D',\r\n    filePath: '/data/units/atlas-as7-d.json',\r\n  };\r\n\r\n  const mockCustomUnit = {\r\n    id: 'custom-1',\r\n    chassis: 'Custom',\r\n    variant: 'C-1',\r\n    tonnage: 50,\r\n    techBase: TechBase.CLAN,\r\n    era: 'CLAN_INVASION',\r\n    weightClass: WeightClass.MEDIUM,\r\n    unitType: 'BattleMech',\r\n  };\r\n\r\n  beforeEach(() => {\r\n    jest.clearAllMocks();\r\n    service = new UnitSearchService();\r\n    \r\n    mockSearchIndex = {\r\n      addAll: jest.fn(),\r\n      add: jest.fn(),\r\n      remove: jest.fn(),\r\n      discard: jest.fn(),\r\n      search: jest.fn().mockReturnValue([{ id: 'atlas-as7-d' }]),\r\n    };\r\n    \r\n    (MiniSearch as jest.Mock).mockReturnValue(mockSearchIndex);\r\n    (canonicalUnitService.getIndex as jest.Mock).mockResolvedValue([mockCanonicalUnit]);\r\n    (customUnitApiService.list as jest.Mock).mockResolvedValue([mockCustomUnit]);\r\n  });\r\n\r\n  describe('initialize()', () => {\r\n    it('should create search index', async () => {\r\n      await service.initialize();\r\n      \r\n      expect(MiniSearch).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should load canonical units', async () => {\r\n      await service.initialize();\r\n      \r\n      expect(canonicalUnitService.getIndex).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should load custom units', async () => {\r\n      await service.initialize();\r\n      \r\n      expect(customUnitApiService.list).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should add units to search index', async () => {\r\n      await service.initialize();\r\n      \r\n      expect(mockSearchIndex.addAll).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should not reinitialize if already initialized', async () => {\r\n      await service.initialize();\r\n      await service.initialize();\r\n      \r\n      expect(MiniSearch).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n\r\n  describe('search()', () => {\r\n    beforeEach(async () => {\r\n      await service.initialize();\r\n    });\r\n\r\n    it('should return empty array if not initialized', () => {\r\n      const uninitializedService = new UnitSearchService();\r\n      const results = uninitializedService.search('Atlas');\r\n      \r\n      expect(results).toEqual([]);\r\n    });\r\n\r\n    it('should search units by query', () => {\r\n      const results = service.search('Atlas');\r\n      \r\n      expect(mockSearchIndex.search).toHaveBeenCalledWith('Atlas', expect.any(Object));\r\n    });\r\n\r\n    it('should return matching units', () => {\r\n      const results = service.search('Atlas');\r\n      \r\n      expect(results.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should filter by tech base when provided', () => {\r\n      const results = service.search('Atlas', { techBase: TechBase.INNER_SPHERE });\r\n      \r\n      expect(mockSearchIndex.search).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should filter by weight class when provided', () => {\r\n      const results = service.search('Atlas', { weightClass: WeightClass.ASSAULT });\r\n      \r\n      expect(mockSearchIndex.search).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should limit results when maxResults is provided', () => {\r\n      const results = service.search('Atlas', { maxResults: 5 });\r\n      \r\n      expect(results.length).toBeLessThanOrEqual(5);\r\n    });\r\n  });\r\n\r\n  describe('addToIndex()', () => {\r\n    beforeEach(async () => {\r\n      await service.initialize();\r\n    });\r\n\r\n    it('should add unit to search index', () => {\r\n      service.addToIndex(mockCanonicalUnit);\r\n      \r\n      expect(mockSearchIndex.add).toHaveBeenCalledWith(mockCanonicalUnit);\r\n    });\r\n  });\r\n\r\n  describe('removeFromIndex()', () => {\r\n    beforeEach(async () => {\r\n      await service.initialize();\r\n    });\r\n\r\n    it('should remove unit from search index', () => {\r\n      service.removeFromIndex('atlas-as7-d');\r\n      \r\n      expect(mockSearchIndex.discard).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('rebuildIndex()', () => {\r\n    it('should reload units and rebuild index', async () => {\r\n      await service.initialize();\r\n      await service.rebuildIndex();\r\n      \r\n      expect(canonicalUnitService.getIndex).toHaveBeenCalledTimes(2);\r\n      expect(customUnitApiService.list).toHaveBeenCalledTimes(2);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\units\\VersionRepository.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\validation\\ValidationOrchestrator.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\service\\validation\\ValidationRuleRegistry.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\stores\\unitStoreRegistry.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'act' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createNewUnitStore' is defined but never used.","line":25,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Store Registry Tests\r\n * \r\n * Tests for the unit store registry, including store registration,\r\n * lookup, hydration, and cleanup operations.\r\n * \r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport { act } from '@testing-library/react';\r\nimport {\r\n  getUnitStore,\r\n  hasUnitStore,\r\n  getAllUnitIds,\r\n  getStoreCount,\r\n  createAndRegisterUnit,\r\n  registerStore,\r\n  hydrateOrCreateUnit,\r\n  unregisterStore,\r\n  deleteUnit,\r\n  clearAllStores,\r\n  duplicateUnit,\r\n  createUnitFromFullState,\r\n} from '@/stores/unitStoreRegistry';\r\nimport { createUnitStore, createNewUnitStore } from '@/stores/useUnitStore';\r\nimport { createDefaultUnitState } from '@/stores/unitState';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { TechBaseMode, TechBaseComponent } from '@/types/construction/TechBaseConfiguration';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { isValidUUID } from '@/utils/uuid';\r\nimport {\r\n  setupMockLocalStorage,\r\n  createTestUnitOptions,\r\n} from '../helpers/storeTestHelpers';\r\n\r\ndescribe('unitStoreRegistry', () => {\r\n  let mockStorage: ReturnType<typeof setupMockLocalStorage>;\r\n  \r\n  beforeEach(() => {\r\n    mockStorage = setupMockLocalStorage();\r\n    clearAllStores(true); // Clear registry and localStorage\r\n  });\r\n  \r\n  afterEach(() => {\r\n    clearAllStores(true);\r\n    mockStorage.cleanup();\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Store Creation and Registration\r\n  // ===========================================================================\r\n  describe('createAndRegisterUnit()', () => {\r\n    it('should create and register a new unit store', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'Test Mech',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      const state = store.getState();\r\n      \r\n      expect(state.name).toBe('Test Mech');\r\n      expect(state.tonnage).toBe(50);\r\n      expect(state.techBase).toBe(TechBase.INNER_SPHERE);\r\n      expect(hasUnitStore(state.id)).toBe(true);\r\n    });\r\n    \r\n    it('should generate unique IDs for each unit', () => {\r\n      const store1 = createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 1' }));\r\n      const store2 = createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 2' }));\r\n      \r\n      expect(store1.getState().id).not.toBe(store2.getState().id);\r\n    });\r\n    \r\n    it('should add store to registry', () => {\r\n      const initialCount = getStoreCount();\r\n      \r\n      createAndRegisterUnit(createTestUnitOptions());\r\n      \r\n      expect(getStoreCount()).toBe(initialCount + 1);\r\n    });\r\n  });\r\n  \r\n  describe('registerStore()', () => {\r\n    it('should register an existing store', () => {\r\n      const state = createDefaultUnitState(createTestUnitOptions({ name: 'Manual Store' }));\r\n      const store = createUnitStore(state);\r\n      \r\n      registerStore(store);\r\n      \r\n      expect(hasUnitStore(state.id)).toBe(true);\r\n      expect(getUnitStore(state.id)).toBe(store);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Store Lookup\r\n  // ===========================================================================\r\n  describe('getUnitStore()', () => {\r\n    it('should return store for registered unit', () => {\r\n      const store = createAndRegisterUnit(createTestUnitOptions());\r\n      const unitId = store.getState().id;\r\n      \r\n      const retrieved = getUnitStore(unitId);\r\n      \r\n      expect(retrieved).toBe(store);\r\n    });\r\n    \r\n    it('should return undefined for non-existent unit', () => {\r\n      const retrieved = getUnitStore('non-existent-id');\r\n      \r\n      expect(retrieved).toBeUndefined();\r\n    });\r\n  });\r\n  \r\n  describe('hasUnitStore()', () => {\r\n    it('should return true for registered unit', () => {\r\n      const store = createAndRegisterUnit(createTestUnitOptions());\r\n      \r\n      expect(hasUnitStore(store.getState().id)).toBe(true);\r\n    });\r\n    \r\n    it('should return false for non-existent unit', () => {\r\n      expect(hasUnitStore('non-existent-id')).toBe(false);\r\n    });\r\n  });\r\n  \r\n  describe('getAllUnitIds()', () => {\r\n    it('should return empty array when no units', () => {\r\n      expect(getAllUnitIds()).toEqual([]);\r\n    });\r\n    \r\n    it('should return all registered unit IDs', () => {\r\n      const store1 = createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 1' }));\r\n      const store2 = createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 2' }));\r\n      const store3 = createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 3' }));\r\n      \r\n      const ids = getAllUnitIds();\r\n      \r\n      expect(ids).toContain(store1.getState().id);\r\n      expect(ids).toContain(store2.getState().id);\r\n      expect(ids).toContain(store3.getState().id);\r\n      expect(ids).toHaveLength(3);\r\n    });\r\n  });\r\n  \r\n  describe('getStoreCount()', () => {\r\n    it('should return 0 when no stores', () => {\r\n      expect(getStoreCount()).toBe(0);\r\n    });\r\n    \r\n    it('should return correct count', () => {\r\n      createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 1' }));\r\n      createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 2' }));\r\n      \r\n      expect(getStoreCount()).toBe(2);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Hydration\r\n  // ===========================================================================\r\n  describe('hydrateOrCreateUnit()', () => {\r\n    it('should return existing store if already registered', () => {\r\n      const existing = createAndRegisterUnit(createTestUnitOptions({ name: 'Existing' }));\r\n      const unitId = existing.getState().id;\r\n      \r\n      const hydrated = hydrateOrCreateUnit(unitId, createTestUnitOptions({ name: 'Fallback' }));\r\n      \r\n      expect(hydrated).toBe(existing);\r\n      expect(hydrated.getState().name).toBe('Existing');\r\n    });\r\n    \r\n    it('should create new store with fallback options if no saved state', () => {\r\n      // Use a valid UUID\r\n      const unitId = '550e8400-e29b-41d4-a716-446655440001';\r\n      \r\n      const hydrated = hydrateOrCreateUnit(unitId, {\r\n        name: 'New Unit',\r\n        tonnage: 75,\r\n        techBase: TechBase.CLAN,\r\n      });\r\n      \r\n      expect(hydrated.getState().id).toBe(unitId);\r\n      expect(hydrated.getState().name).toBe('New Unit');\r\n      expect(hydrated.getState().tonnage).toBe(75);\r\n      expect(hydrated.getState().techBase).toBe(TechBase.CLAN);\r\n    });\r\n    \r\n    it('should restore from localStorage if available', () => {\r\n      // Use a valid UUID\r\n      const unitId = '550e8400-e29b-41d4-a716-446655440002';\r\n      const savedState = {\r\n        state: {\r\n          id: unitId,\r\n          name: 'Saved Unit',\r\n          tonnage: 80,\r\n          techBase: TechBase.CLAN,\r\n          engineType: EngineType.XL_CLAN,\r\n          gyroType: GyroType.XL,\r\n        },\r\n        version: 0,\r\n      };\r\n      \r\n      mockStorage.mockStorage.setItem(`megamek-unit-${unitId}`, JSON.stringify(savedState));\r\n      \r\n      const hydrated = hydrateOrCreateUnit(unitId, createTestUnitOptions({ name: 'Fallback' }));\r\n      \r\n      expect(hydrated.getState().name).toBe('Saved Unit');\r\n      expect(hydrated.getState().tonnage).toBe(80);\r\n      expect(hydrated.getState().engineType).toBe(EngineType.XL_CLAN);\r\n    });\r\n    \r\n    it('should use fallback options if localStorage is corrupted', () => {\r\n      // Use a valid UUID\r\n      const unitId = '550e8400-e29b-41d4-a716-446655440003';\r\n      \r\n      mockStorage.mockStorage.setItem(`megamek-unit-${unitId}`, 'not valid json');\r\n      \r\n      const hydrated = hydrateOrCreateUnit(unitId, {\r\n        name: 'Fallback Unit',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      expect(hydrated.getState().name).toBe('Fallback Unit');\r\n      expect(hydrated.getState().tonnage).toBe(50);\r\n    });\r\n    \r\n    it('should register hydrated store in registry', () => {\r\n      // Use a valid UUID\r\n      const unitId = '550e8400-e29b-41d4-a716-446655440004';\r\n      \r\n      hydrateOrCreateUnit(unitId, createTestUnitOptions());\r\n      \r\n      expect(hasUnitStore(unitId)).toBe(true);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Store Cleanup\r\n  // ===========================================================================\r\n  describe('unregisterStore()', () => {\r\n    it('should remove store from registry', () => {\r\n      const store = createAndRegisterUnit(createTestUnitOptions());\r\n      const unitId = store.getState().id;\r\n      \r\n      expect(hasUnitStore(unitId)).toBe(true);\r\n      \r\n      const removed = unregisterStore(unitId);\r\n      \r\n      expect(removed).toBe(true);\r\n      expect(hasUnitStore(unitId)).toBe(false);\r\n    });\r\n    \r\n    it('should not affect localStorage', () => {\r\n      const store = createAndRegisterUnit(createTestUnitOptions());\r\n      const unitId = store.getState().id;\r\n      \r\n      // Force a state update to trigger localStorage save\r\n      store.getState().setName('Updated');\r\n      \r\n      const storageKey = `megamek-unit-${unitId}`;\r\n      const beforeUnregister = mockStorage.mockStorage.getItem(storageKey);\r\n      \r\n      unregisterStore(unitId);\r\n      \r\n      const afterUnregister = mockStorage.mockStorage.getItem(storageKey);\r\n      expect(afterUnregister).toBe(beforeUnregister);\r\n    });\r\n    \r\n    it('should return false for non-existent store', () => {\r\n      const removed = unregisterStore('non-existent');\r\n      \r\n      expect(removed).toBe(false);\r\n    });\r\n  });\r\n  \r\n  describe('deleteUnit()', () => {\r\n    it('should remove store and localStorage entry', () => {\r\n      const store = createAndRegisterUnit(createTestUnitOptions());\r\n      const unitId = store.getState().id;\r\n      \r\n      // Force localStorage persistence\r\n      store.getState().setName('Trigger Save');\r\n      \r\n      const storageKey = `megamek-unit-${unitId}`;\r\n      \r\n      const deleted = deleteUnit(unitId);\r\n      \r\n      expect(deleted).toBe(true);\r\n      expect(hasUnitStore(unitId)).toBe(false);\r\n      expect(mockStorage.mockStorage.getItem(storageKey)).toBeNull();\r\n    });\r\n    \r\n    it('should return false for non-existent unit', () => {\r\n      const deleted = deleteUnit('non-existent');\r\n      \r\n      expect(deleted).toBe(false);\r\n    });\r\n  });\r\n  \r\n  describe('clearAllStores()', () => {\r\n    it('should remove all stores from registry', () => {\r\n      createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 1' }));\r\n      createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 2' }));\r\n      createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 3' }));\r\n      \r\n      expect(getStoreCount()).toBe(3);\r\n      \r\n      clearAllStores(false);\r\n      \r\n      expect(getStoreCount()).toBe(0);\r\n    });\r\n    \r\n    it('should clear localStorage when requested', () => {\r\n      const store1 = createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 1' }));\r\n      const store2 = createAndRegisterUnit(createTestUnitOptions({ name: 'Unit 2' }));\r\n      \r\n      // Trigger saves\r\n      store1.getState().setName('Trigger Save 1');\r\n      store2.getState().setName('Trigger Save 2');\r\n      \r\n      const key1 = `megamek-unit-${store1.getState().id}`;\r\n      const key2 = `megamek-unit-${store2.getState().id}`;\r\n      \r\n      clearAllStores(true);\r\n      \r\n      expect(mockStorage.mockStorage.getItem(key1)).toBeNull();\r\n      expect(mockStorage.mockStorage.getItem(key2)).toBeNull();\r\n    });\r\n    \r\n    it('should preserve localStorage when not requested', () => {\r\n      const store = createAndRegisterUnit(createTestUnitOptions());\r\n      store.getState().setName('Trigger Save');\r\n      \r\n      const key = `megamek-unit-${store.getState().id}`;\r\n      const beforeClear = mockStorage.mockStorage.getItem(key);\r\n      \r\n      clearAllStores(false);\r\n      \r\n      const afterClear = mockStorage.mockStorage.getItem(key);\r\n      expect(afterClear).toBe(beforeClear);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Duplication\r\n  // ===========================================================================\r\n  describe('duplicateUnit()', () => {\r\n    it('should create a copy with new ID', () => {\r\n      const original = createAndRegisterUnit({\r\n        name: 'Original',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      const originalId = original.getState().id;\r\n      \r\n      // Modify original\r\n      original.getState().setEngineType(EngineType.XL_IS);\r\n      original.getState().setHeatSinkType(HeatSinkType.DOUBLE_IS);\r\n      \r\n      const duplicate = duplicateUnit(originalId);\r\n      \r\n      expect(duplicate).not.toBeNull();\r\n      expect(duplicate!.getState().id).not.toBe(originalId);\r\n      expect(duplicate!.getState().name).toContain('(Copy)');\r\n    });\r\n    \r\n    it('should copy all configuration from source', () => {\r\n      const original = createAndRegisterUnit({\r\n        name: 'Original',\r\n        tonnage: 75,\r\n        techBase: TechBase.CLAN,\r\n      });\r\n      \r\n      // Modify original with specific configuration\r\n      original.getState().setEngineType(EngineType.XL_CLAN);\r\n      original.getState().setGyroType(GyroType.XL);\r\n      original.getState().setHeatSinkType(HeatSinkType.DOUBLE_CLAN);\r\n      original.getState().setInternalStructureType(InternalStructureType.ENDO_STEEL_CLAN);\r\n      original.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n      original.getState().setComponentTechBase(TechBaseComponent.ARMOR, TechBase.INNER_SPHERE);\r\n      \r\n      const duplicate = duplicateUnit(original.getState().id);\r\n      \r\n      expect(duplicate).not.toBeNull();\r\n      const dupState = duplicate!.getState();\r\n      \r\n      expect(dupState.tonnage).toBe(75);\r\n      expect(dupState.techBase).toBe(TechBase.CLAN);\r\n      expect(dupState.engineType).toBe(EngineType.XL_CLAN);\r\n      expect(dupState.gyroType).toBe(GyroType.XL);\r\n      expect(dupState.heatSinkType).toBe(HeatSinkType.DOUBLE_CLAN);\r\n      expect(dupState.internalStructureType).toBe(InternalStructureType.ENDO_STEEL_CLAN);\r\n      expect(dupState.techBaseMode).toBe(TechBaseMode.MIXED);\r\n      expect(dupState.componentTechBases.armor).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n    \r\n    it('should use custom name if provided', () => {\r\n      const original = createAndRegisterUnit({\r\n        name: 'Original',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      const duplicate = duplicateUnit(original.getState().id, 'Custom Copy Name');\r\n      \r\n      expect(duplicate!.getState().name).toBe('Custom Copy Name');\r\n    });\r\n    \r\n    it('should register duplicate in registry', () => {\r\n      const original = createAndRegisterUnit(createTestUnitOptions());\r\n      const initialCount = getStoreCount();\r\n      \r\n      const duplicate = duplicateUnit(original.getState().id);\r\n      \r\n      expect(getStoreCount()).toBe(initialCount + 1);\r\n      expect(hasUnitStore(duplicate!.getState().id)).toBe(true);\r\n    });\r\n    \r\n    it('should return null for non-existent source', () => {\r\n      const duplicate = duplicateUnit('non-existent-id');\r\n      \r\n      expect(duplicate).toBeNull();\r\n    });\r\n    \r\n    it('should create independent copy (not share references)', () => {\r\n      const original = createAndRegisterUnit({\r\n        name: 'Original',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      original.getState().setComponentTechBase(TechBaseComponent.ENGINE, TechBase.CLAN);\r\n      \r\n      const duplicate = duplicateUnit(original.getState().id);\r\n      \r\n      // Modify duplicate\r\n      duplicate!.getState().setComponentTechBase(TechBaseComponent.ENGINE, TechBase.INNER_SPHERE);\r\n      duplicate!.getState().setEngineType(EngineType.LIGHT);\r\n      \r\n      // Original should be unchanged\r\n      expect(original.getState().componentTechBases.engine).toBe(TechBase.CLAN);\r\n      expect(original.getState().engineType).toBe(EngineType.STANDARD);\r\n      \r\n      // Duplicate should have changes\r\n      expect(duplicate!.getState().componentTechBases.engine).toBe(TechBase.INNER_SPHERE);\r\n      expect(duplicate!.getState().engineType).toBe(EngineType.LIGHT);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // ID Validation\r\n  // ===========================================================================\r\n  describe('ID Validation', () => {\r\n    describe('hydrateOrCreateUnit() with invalid IDs', () => {\r\n      it('should generate valid UUID when called with empty string ID', () => {\r\n        const store = hydrateOrCreateUnit('', {\r\n          name: 'Test Unit',\r\n          tonnage: 50,\r\n          techBase: TechBase.INNER_SPHERE,\r\n        });\r\n        \r\n        const state = store.getState();\r\n        expect(state.id).not.toBe('');\r\n        expect(isValidUUID(state.id)).toBe(true);\r\n      });\r\n      \r\n      it('should generate valid UUID when called with invalid ID', () => {\r\n        const store = hydrateOrCreateUnit('not-a-valid-uuid', {\r\n          name: 'Test Unit',\r\n          tonnage: 50,\r\n          techBase: TechBase.INNER_SPHERE,\r\n        });\r\n        \r\n        const state = store.getState();\r\n        expect(state.id).not.toBe('not-a-valid-uuid');\r\n        expect(isValidUUID(state.id)).toBe(true);\r\n      });\r\n      \r\n      it('should preserve valid UUID when called with valid ID', () => {\r\n        const validId = '550e8400-e29b-41d4-a716-446655440000';\r\n        \r\n        const store = hydrateOrCreateUnit(validId, {\r\n          name: 'Test Unit',\r\n          tonnage: 50,\r\n          techBase: TechBase.INNER_SPHERE,\r\n        });\r\n        \r\n        expect(store.getState().id).toBe(validId);\r\n      });\r\n      \r\n      it('should repair invalid ID in localStorage state', () => {\r\n        const requestedId = '550e8400-e29b-41d4-a716-446655440000';\r\n        const savedState = {\r\n          state: {\r\n            id: 'corrupted-id-in-storage',\r\n            name: 'Saved Unit',\r\n            tonnage: 80,\r\n            techBase: TechBase.CLAN,\r\n          },\r\n          version: 0,\r\n        };\r\n        \r\n        mockStorage.mockStorage.setItem(`megamek-unit-${requestedId}`, JSON.stringify(savedState));\r\n        \r\n        const store = hydrateOrCreateUnit(requestedId, createTestUnitOptions());\r\n        \r\n        // Should use the requested ID, not the corrupted one from storage\r\n        expect(store.getState().id).toBe(requestedId);\r\n        expect(store.getState().name).toBe('Saved Unit');\r\n      });\r\n    });\r\n    \r\n    describe('createUnitFromFullState() with invalid IDs', () => {\r\n      it('should generate valid UUID when state has empty ID', () => {\r\n        const state = createDefaultUnitState({\r\n          name: 'Full State Unit',\r\n          tonnage: 50,\r\n          techBase: TechBase.INNER_SPHERE,\r\n        });\r\n        \r\n        // Force empty ID\r\n        const stateWithEmptyId = { ...state, id: '' };\r\n        \r\n        const store = createUnitFromFullState(stateWithEmptyId);\r\n        \r\n        expect(store.getState().id).not.toBe('');\r\n        expect(isValidUUID(store.getState().id)).toBe(true);\r\n      });\r\n      \r\n      it('should generate valid UUID when state has invalid ID', () => {\r\n        const state = createDefaultUnitState({\r\n          name: 'Full State Unit',\r\n          tonnage: 50,\r\n          techBase: TechBase.INNER_SPHERE,\r\n        });\r\n        \r\n        // Force invalid ID\r\n        const stateWithInvalidId = { ...state, id: 'invalid-id' };\r\n        \r\n        const store = createUnitFromFullState(stateWithInvalidId);\r\n        \r\n        expect(store.getState().id).not.toBe('invalid-id');\r\n        expect(isValidUUID(store.getState().id)).toBe(true);\r\n      });\r\n      \r\n      it('should preserve valid UUID in state', () => {\r\n        const validId = '550e8400-e29b-41d4-a716-446655440000';\r\n        const state = createDefaultUnitState({\r\n          name: 'Full State Unit',\r\n          tonnage: 50,\r\n          techBase: TechBase.INNER_SPHERE,\r\n        });\r\n        \r\n        const stateWithValidId = { ...state, id: validId };\r\n        \r\n        const store = createUnitFromFullState(stateWithValidId);\r\n        \r\n        expect(store.getState().id).toBe(validId);\r\n      });\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // State Persistence Across Operations\r\n  // ===========================================================================\r\n  describe('State Persistence', () => {\r\n    it('should maintain state after unregister and re-hydrate', () => {\r\n      const store = createAndRegisterUnit({\r\n        name: 'Persistent Unit',\r\n        tonnage: 85,\r\n        techBase: TechBase.CLAN,\r\n      });\r\n      \r\n      // Modify state\r\n      store.getState().setEngineType(EngineType.XL_CLAN);\r\n      store.getState().setGyroType(GyroType.COMPACT);\r\n      \r\n      const unitId = store.getState().id;\r\n      \r\n      // Unregister (simulates tab close without delete)\r\n      unregisterStore(unitId);\r\n      expect(hasUnitStore(unitId)).toBe(false);\r\n      \r\n      // Re-hydrate (simulates tab reopen)\r\n      const rehydrated = hydrateOrCreateUnit(unitId, createTestUnitOptions());\r\n      \r\n      // State should be preserved from localStorage\r\n      expect(rehydrated.getState().name).toBe('Persistent Unit');\r\n      expect(rehydrated.getState().tonnage).toBe(85);\r\n      expect(rehydrated.getState().engineType).toBe(EngineType.XL_CLAN);\r\n      expect(rehydrated.getState().gyroType).toBe(GyroType.COMPACT);\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\stores\\useMultiUnitStore.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'originalId' is assigned a value but never used.","line":230,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":230,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Multi-Unit Store Tests\r\n * \r\n * Tests for the multi-unit tab store, including tab management\r\n * and component selection actions.\r\n * \r\n * @spec openspec/specs/multi-unit-tabs/spec.md\r\n */\r\n\r\nimport { act } from '@testing-library/react';\r\nimport { \r\n  useMultiUnitStore, \r\n  UNIT_TEMPLATES,\r\n  createDefaultComponentSelections,\r\n} from '@/stores/useMultiUnitStore';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { TechBaseMode, TechBaseComponent } from '@/types/construction/TechBaseConfiguration';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType } from '@/types/construction/CockpitType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\r\nimport {\r\n  setupMockLocalStorage,\r\n  expectAllComponentTechBases,\r\n} from '../helpers/storeTestHelpers';\r\n\r\ndescribe('useMultiUnitStore', () => {\r\n  let mockStorage: ReturnType<typeof setupMockLocalStorage>;\r\n  \r\n  beforeEach(() => {\r\n    mockStorage = setupMockLocalStorage();\r\n    // Reset store state before each test\r\n    useMultiUnitStore.setState({\r\n      tabs: [],\r\n      activeTabId: null,\r\n      isLoading: false,\r\n      isNewTabModalOpen: false,\r\n    });\r\n  });\r\n  \r\n  afterEach(() => {\r\n    mockStorage.cleanup();\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Unit Templates\r\n  // ===========================================================================\r\n  describe('UNIT_TEMPLATES', () => {\r\n    it('should have correct weight class templates', () => {\r\n      expect(UNIT_TEMPLATES).toHaveLength(4);\r\n      \r\n      const lightTemplate = UNIT_TEMPLATES.find(t => t.id === 'light');\r\n      const mediumTemplate = UNIT_TEMPLATES.find(t => t.id === 'medium');\r\n      const heavyTemplate = UNIT_TEMPLATES.find(t => t.id === 'heavy');\r\n      const assaultTemplate = UNIT_TEMPLATES.find(t => t.id === 'assault');\r\n      \r\n      expect(lightTemplate?.tonnage).toBe(25);\r\n      expect(mediumTemplate?.tonnage).toBe(50);\r\n      expect(heavyTemplate?.tonnage).toBe(70);\r\n      expect(assaultTemplate?.tonnage).toBe(100);\r\n    });\r\n    \r\n    it('should have appropriate walk MPs for each weight class', () => {\r\n      const lightTemplate = UNIT_TEMPLATES.find(t => t.id === 'light');\r\n      const assaultTemplate = UNIT_TEMPLATES.find(t => t.id === 'assault');\r\n      \r\n      // Light mechs should be faster\r\n      expect(lightTemplate?.walkMP).toBeGreaterThan(assaultTemplate?.walkMP ?? 0);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // createDefaultComponentSelections\r\n  // ===========================================================================\r\n  describe('createDefaultComponentSelections()', () => {\r\n    it('should create default selections with correct engine rating', () => {\r\n      const selections = createDefaultComponentSelections(50, 4);\r\n      \r\n      expect(selections.engineRating).toBe(200); // 50 * 4\r\n    });\r\n    \r\n    it('should default to standard components', () => {\r\n      const selections = createDefaultComponentSelections(50);\r\n      \r\n      expect(selections.engineType).toBe(EngineType.STANDARD);\r\n      expect(selections.gyroType).toBe(GyroType.STANDARD);\r\n      expect(selections.internalStructureType).toBe(InternalStructureType.STANDARD);\r\n      expect(selections.cockpitType).toBe(CockpitType.STANDARD);\r\n      expect(selections.heatSinkType).toBe(HeatSinkType.SINGLE);\r\n      expect(selections.heatSinkCount).toBe(10);\r\n      expect(selections.armorType).toBe(ArmorTypeEnum.STANDARD);\r\n    });\r\n    \r\n    it('should use default walkMP of 4', () => {\r\n      const selections = createDefaultComponentSelections(100);\r\n      \r\n      expect(selections.engineRating).toBe(400); // 100 * 4\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Creation\r\n  // ===========================================================================\r\n  describe('createTab()', () => {\r\n    it('should create a new tab with unique ID', () => {\r\n      const template = UNIT_TEMPLATES[1]; // Medium\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(template);\r\n      });\r\n      \r\n      const { tabs, activeTabId } = useMultiUnitStore.getState();\r\n      \r\n      expect(tabs).toHaveLength(1);\r\n      expect(tabs[0].id).toMatch(/^tab-\\d+-[a-z0-9]+$/);\r\n      expect(activeTabId).toBe(tabs[0].id);\r\n    });\r\n    \r\n    it('should set tab name from template', () => {\r\n      const template = UNIT_TEMPLATES[0]; // Light\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(template);\r\n      });\r\n      \r\n      const { tabs } = useMultiUnitStore.getState();\r\n      \r\n      expect(tabs[0].name).toBe(`New ${template.name}`);\r\n    });\r\n    \r\n    it('should use custom name if provided', () => {\r\n      const template = UNIT_TEMPLATES[0];\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(template, 'Custom Name');\r\n      });\r\n      \r\n      const { tabs } = useMultiUnitStore.getState();\r\n      \r\n      expect(tabs[0].name).toBe('Custom Name');\r\n    });\r\n    \r\n    it('should initialize tech base mode based on template', () => {\r\n      const isTemplate = { ...UNIT_TEMPLATES[0], techBase: TechBase.INNER_SPHERE };\r\n      const clanTemplate = { ...UNIT_TEMPLATES[0], techBase: TechBase.CLAN };\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(isTemplate);\r\n        useMultiUnitStore.getState().createTab(clanTemplate);\r\n      });\r\n      \r\n      const { tabs } = useMultiUnitStore.getState();\r\n      \r\n      expect(tabs[0].techBaseMode).toBe(TechBaseMode.INNER_SPHERE);\r\n      expect(tabs[1].techBaseMode).toBe(TechBaseMode.CLAN);\r\n    });\r\n    \r\n    it('should initialize componentTechBases matching template tech base', () => {\r\n      const isTemplate = { ...UNIT_TEMPLATES[0], techBase: TechBase.INNER_SPHERE };\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(isTemplate);\r\n      });\r\n      \r\n      const { tabs } = useMultiUnitStore.getState();\r\n      \r\n      expectAllComponentTechBases(tabs[0].componentTechBases, TechBase.INNER_SPHERE);\r\n    });\r\n    \r\n    it('should close new tab modal after creating', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().openNewTabModal();\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().isNewTabModalOpen).toBe(false);\r\n    });\r\n    \r\n    it('should create multiple tabs', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[2]);\r\n      });\r\n      \r\n      const { tabs } = useMultiUnitStore.getState();\r\n      \r\n      expect(tabs).toHaveLength(3);\r\n      // Active tab should be the last created\r\n      expect(useMultiUnitStore.getState().activeTabId).toBe(tabs[2].id);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Duplication\r\n  // ===========================================================================\r\n  describe('duplicateTab()', () => {\r\n    it('should duplicate tab with all configuration', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        // Modify the original tab\r\n        useMultiUnitStore.getState().updateEngineType(tabId, EngineType.XL_IS);\r\n        useMultiUnitStore.getState().updateTechBaseMode(tabId, TechBaseMode.MIXED);\r\n        \r\n        // Duplicate\r\n        useMultiUnitStore.getState().duplicateTab(tabId);\r\n      });\r\n      \r\n      const { tabs, activeTabId } = useMultiUnitStore.getState();\r\n      \r\n      expect(tabs).toHaveLength(2);\r\n      expect(tabs[1].name).toContain('(Copy)');\r\n      expect(tabs[1].componentSelections.engineType).toBe(EngineType.XL_IS);\r\n      expect(tabs[1].techBaseMode).toBe(TechBaseMode.MIXED);\r\n      expect(activeTabId).toBe(tabs[1].id);\r\n    });\r\n    \r\n    it('should create independent copy (not share references)', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        const originalId = useMultiUnitStore.getState().tabs[0].id;\r\n        useMultiUnitStore.getState().duplicateTab(originalId);\r\n      });\r\n      \r\n      const { tabs } = useMultiUnitStore.getState();\r\n      const originalId = tabs[0].id;\r\n      const copyId = tabs[1].id;\r\n      \r\n      // Modify copy\r\n      act(() => {\r\n        useMultiUnitStore.getState().updateGyroType(copyId, GyroType.XL);\r\n      });\r\n      \r\n      // Original should be unchanged\r\n      expect(useMultiUnitStore.getState().tabs[0].componentSelections.gyroType).toBe(GyroType.STANDARD);\r\n      expect(useMultiUnitStore.getState().tabs[1].componentSelections.gyroType).toBe(GyroType.XL);\r\n    });\r\n    \r\n    it('should return null for non-existent tab', () => {\r\n      let result: string | null = 'initial';\r\n      \r\n      act(() => {\r\n        result = useMultiUnitStore.getState().duplicateTab('non-existent');\r\n      });\r\n      \r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Closing\r\n  // ===========================================================================\r\n  describe('closeTab()', () => {\r\n    it('should close a tab', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const firstTabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().closeTab(firstTabId);\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().tabs).toHaveLength(1);\r\n    });\r\n    \r\n    it('should not close last tab', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().closeTab(tabId);\r\n      });\r\n      \r\n      // Should still have one tab\r\n      expect(useMultiUnitStore.getState().tabs).toHaveLength(1);\r\n    });\r\n    \r\n    it('should select adjacent tab when closing active tab', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[2]);\r\n      });\r\n      \r\n      const tabs = useMultiUnitStore.getState().tabs;\r\n      const middleTabId = tabs[1].id;\r\n      \r\n      // Select middle tab then close it\r\n      act(() => {\r\n        useMultiUnitStore.getState().selectTab(middleTabId);\r\n        useMultiUnitStore.getState().closeTab(middleTabId);\r\n      });\r\n      \r\n      // Should select adjacent tab (now at same index)\r\n      expect(useMultiUnitStore.getState().activeTabId).toBe(tabs[2].id);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Selection\r\n  // ===========================================================================\r\n  describe('selectTab()', () => {\r\n    it('should change active tab', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const tabs = useMultiUnitStore.getState().tabs;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().selectTab(tabs[0].id);\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().activeTabId).toBe(tabs[0].id);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Renaming\r\n  // ===========================================================================\r\n  describe('renameTab()', () => {\r\n    it('should rename a tab', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().renameTab(tabId, 'My Custom Mech');\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().tabs[0].name).toBe('My Custom Mech');\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Mark Modified\r\n  // ===========================================================================\r\n  describe('markModified()', () => {\r\n    it('should mark tab as modified', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().markModified(tabId, true);\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().tabs[0].isModified).toBe(true);\r\n    });\r\n    \r\n    it('should mark tab as not modified', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().markModified(tabId, false);\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().tabs[0].isModified).toBe(false);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tech Base Mode Updates\r\n  // ===========================================================================\r\n  describe('updateTechBaseMode()', () => {\r\n    it('should update tech base mode', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().updateTechBaseMode(tabId, TechBaseMode.CLAN);\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().tabs[0].techBaseMode).toBe(TechBaseMode.CLAN);\r\n    });\r\n    \r\n    it('should reset componentTechBases when switching to Clan', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]); // IS by default\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().updateTechBaseMode(tabId, TechBaseMode.CLAN);\r\n      });\r\n      \r\n      expectAllComponentTechBases(\r\n        useMultiUnitStore.getState().tabs[0].componentTechBases,\r\n        TechBase.CLAN\r\n      );\r\n    });\r\n    \r\n    it('should reset componentTechBases when switching to IS', () => {\r\n      const clanTemplate = { ...UNIT_TEMPLATES[0], techBase: TechBase.CLAN };\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(clanTemplate);\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().updateTechBaseMode(tabId, TechBaseMode.INNER_SPHERE);\r\n      });\r\n      \r\n      expectAllComponentTechBases(\r\n        useMultiUnitStore.getState().tabs[0].componentTechBases,\r\n        TechBase.INNER_SPHERE\r\n      );\r\n    });\r\n    \r\n    it('should preserve componentTechBases when switching to mixed', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      // Set a specific component to Clan\r\n      act(() => {\r\n        useMultiUnitStore.getState().updateComponentTechBase(tabId, TechBaseComponent.ENGINE, TechBase.CLAN);\r\n      });\r\n      \r\n      // Switch to mixed\r\n      act(() => {\r\n        useMultiUnitStore.getState().updateTechBaseMode(tabId, TechBaseMode.MIXED);\r\n      });\r\n      \r\n      // Engine should still be Clan\r\n      expect(useMultiUnitStore.getState().tabs[0].componentTechBases.engine).toBe(TechBase.CLAN);\r\n      // Others should be IS\r\n      expect(useMultiUnitStore.getState().tabs[0].componentTechBases.chassis).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Component Tech Base Updates\r\n  // ===========================================================================\r\n  describe('updateComponentTechBase()', () => {\r\n    it('should update individual component tech base', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().updateComponentTechBase(tabId, TechBaseComponent.ENGINE, TechBase.CLAN);\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().tabs[0].componentTechBases.engine).toBe(TechBase.CLAN);\r\n    });\r\n    \r\n    it('should not affect other component tech bases', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useMultiUnitStore.getState().updateComponentTechBase(tabId, TechBaseComponent.HEATSINK, TechBase.CLAN);\r\n      });\r\n      \r\n      const { componentTechBases } = useMultiUnitStore.getState().tabs[0];\r\n      \r\n      expect(componentTechBases.heatsink).toBe(TechBase.CLAN);\r\n      expect(componentTechBases.engine).toBe(TechBase.INNER_SPHERE);\r\n      expect(componentTechBases.armor).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Component Selection Updates\r\n  // ===========================================================================\r\n  describe('Component Selection Updates', () => {\r\n    describe('updateEngineType()', () => {\r\n      it('should update engine type', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().updateEngineType(tabId, EngineType.XL_IS);\r\n        });\r\n        \r\n        expect(useMultiUnitStore.getState().tabs[0].componentSelections.engineType).toBe(EngineType.XL_IS);\r\n      });\r\n      \r\n      it('should mark tab as modified', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().markModified(tabId, false);\r\n          useMultiUnitStore.getState().updateEngineType(tabId, EngineType.LIGHT);\r\n        });\r\n        \r\n        expect(useMultiUnitStore.getState().tabs[0].isModified).toBe(true);\r\n      });\r\n    });\r\n    \r\n    describe('updateEngineRating()', () => {\r\n      it('should update engine rating', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[1]); // 50 tons\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().updateEngineRating(tabId, 300);\r\n        });\r\n        \r\n        expect(useMultiUnitStore.getState().tabs[0].componentSelections.engineRating).toBe(300);\r\n      });\r\n    });\r\n    \r\n    describe('updateGyroType()', () => {\r\n      it('should update gyro type', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().updateGyroType(tabId, GyroType.COMPACT);\r\n        });\r\n        \r\n        expect(useMultiUnitStore.getState().tabs[0].componentSelections.gyroType).toBe(GyroType.COMPACT);\r\n      });\r\n    });\r\n    \r\n    describe('updateStructureType()', () => {\r\n      it('should update structure type', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().updateStructureType(tabId, InternalStructureType.ENDO_STEEL_IS);\r\n        });\r\n        \r\n        expect(useMultiUnitStore.getState().tabs[0].componentSelections.internalStructureType)\r\n          .toBe(InternalStructureType.ENDO_STEEL_IS);\r\n      });\r\n    });\r\n    \r\n    describe('updateCockpitType()', () => {\r\n      it('should update cockpit type', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().updateCockpitType(tabId, CockpitType.SMALL);\r\n        });\r\n        \r\n        expect(useMultiUnitStore.getState().tabs[0].componentSelections.cockpitType).toBe(CockpitType.SMALL);\r\n      });\r\n    });\r\n    \r\n    describe('updateHeatSinkType()', () => {\r\n      it('should update heat sink type', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().updateHeatSinkType(tabId, HeatSinkType.DOUBLE_IS);\r\n        });\r\n        \r\n        expect(useMultiUnitStore.getState().tabs[0].componentSelections.heatSinkType)\r\n          .toBe(HeatSinkType.DOUBLE_IS);\r\n      });\r\n    });\r\n    \r\n    describe('updateHeatSinkCount()', () => {\r\n      it('should update heat sink count', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().updateHeatSinkCount(tabId, 15);\r\n        });\r\n        \r\n        expect(useMultiUnitStore.getState().tabs[0].componentSelections.heatSinkCount).toBe(15);\r\n      });\r\n    });\r\n    \r\n    describe('updateArmorType()', () => {\r\n      it('should update armor type', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().updateArmorType(tabId, ArmorTypeEnum.FERRO_FIBROUS_IS);\r\n        });\r\n        \r\n        expect(useMultiUnitStore.getState().tabs[0].componentSelections.armorType)\r\n          .toBe(ArmorTypeEnum.FERRO_FIBROUS_IS);\r\n      });\r\n    });\r\n    \r\n    describe('updateComponentSelections()', () => {\r\n      it('should update multiple selections at once', () => {\r\n        act(() => {\r\n          useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n        });\r\n        \r\n        const tabId = useMultiUnitStore.getState().tabs[0].id;\r\n        \r\n        act(() => {\r\n          useMultiUnitStore.getState().updateComponentSelections(tabId, {\r\n            engineType: EngineType.XL_IS,\r\n            gyroType: GyroType.XL,\r\n            heatSinkType: HeatSinkType.DOUBLE_IS,\r\n          });\r\n        });\r\n        \r\n        const { componentSelections } = useMultiUnitStore.getState().tabs[0];\r\n        \r\n        expect(componentSelections.engineType).toBe(EngineType.XL_IS);\r\n        expect(componentSelections.gyroType).toBe(GyroType.XL);\r\n        expect(componentSelections.heatSinkType).toBe(HeatSinkType.DOUBLE_IS);\r\n        // Others should remain unchanged\r\n        expect(componentSelections.internalStructureType).toBe(InternalStructureType.STANDARD);\r\n      });\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Modal State\r\n  // ===========================================================================\r\n  describe('Modal State', () => {\r\n    it('should open new tab modal', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().openNewTabModal();\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().isNewTabModalOpen).toBe(true);\r\n    });\r\n    \r\n    it('should close new tab modal', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().openNewTabModal();\r\n        useMultiUnitStore.getState().closeNewTabModal();\r\n      });\r\n      \r\n      expect(useMultiUnitStore.getState().isNewTabModalOpen).toBe(false);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Helper Functions\r\n  // ===========================================================================\r\n  describe('getActiveTab()', () => {\r\n    it('should return active tab', () => {\r\n      act(() => {\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useMultiUnitStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const activeTab = useMultiUnitStore.getState().getActiveTab();\r\n      \r\n      expect(activeTab).not.toBeNull();\r\n      expect(activeTab?.id).toBe(useMultiUnitStore.getState().activeTabId);\r\n    });\r\n    \r\n    it('should return null when no tabs', () => {\r\n      const activeTab = useMultiUnitStore.getState().getActiveTab();\r\n      \r\n      expect(activeTab).toBeNull();\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\stores\\useTabManagerStore.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabInfo' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EngineType' is defined but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'firstId' is assigned a value but never used.","line":414,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":414,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'thirdId' is assigned a value but never used.","line":415,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":415,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tab Manager Store Tests\r\n * \r\n * Tests for the tab manager store, which manages tab lifecycle\r\n * without containing unit data (that's in individual unit stores).\r\n * \r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport { act } from '@testing-library/react';\r\nimport {\r\n  useTabManagerStore,\r\n  UNIT_TEMPLATES,\r\n  TabInfo,\r\n} from '@/stores/useTabManagerStore';\r\nimport {\r\n  clearAllStores,\r\n  getUnitStore,\r\n  hasUnitStore,\r\n  getStoreCount,\r\n} from '@/stores/unitStoreRegistry';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { isValidUUID } from '@/utils/uuid';\r\nimport {\r\n  setupMockLocalStorage,\r\n} from '../helpers/storeTestHelpers';\r\n\r\ndescribe('useTabManagerStore', () => {\r\n  let mockStorage: ReturnType<typeof setupMockLocalStorage>;\r\n  \r\n  beforeEach(() => {\r\n    mockStorage = setupMockLocalStorage();\r\n    // Reset both tab manager and unit store registry\r\n    clearAllStores(true);\r\n    useTabManagerStore.setState({\r\n      tabs: [],\r\n      activeTabId: null,\r\n      isLoading: false,\r\n      isNewTabModalOpen: false,\r\n    });\r\n  });\r\n  \r\n  afterEach(() => {\r\n    clearAllStores(true);\r\n    mockStorage.cleanup();\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Unit Templates\r\n  // ===========================================================================\r\n  describe('UNIT_TEMPLATES', () => {\r\n    it('should have correct weight class templates', () => {\r\n      expect(UNIT_TEMPLATES).toHaveLength(4);\r\n      \r\n      const lightTemplate = UNIT_TEMPLATES.find(t => t.id === 'light');\r\n      const assaultTemplate = UNIT_TEMPLATES.find(t => t.id === 'assault');\r\n      \r\n      expect(lightTemplate?.tonnage).toBe(25);\r\n      expect(lightTemplate?.walkMP).toBe(8);\r\n      expect(assaultTemplate?.tonnage).toBe(100);\r\n      expect(assaultTemplate?.walkMP).toBe(3);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Creation\r\n  // ===========================================================================\r\n  describe('createTab()', () => {\r\n    it('should create a new tab with unique ID', () => {\r\n      const template = UNIT_TEMPLATES[1]; // Medium\r\n      \r\n      let tabId: string = '';\r\n      act(() => {\r\n        tabId = useTabManagerStore.getState().createTab(template);\r\n      });\r\n      \r\n      const { tabs, activeTabId } = useTabManagerStore.getState();\r\n      \r\n      expect(tabs).toHaveLength(1);\r\n      expect(tabs[0].id).toBe(tabId);\r\n      expect(activeTabId).toBe(tabId);\r\n    });\r\n    \r\n    it('should create unit store in registry', () => {\r\n      const initialCount = getStoreCount();\r\n      const template = UNIT_TEMPLATES[0];\r\n      \r\n      let tabId: string = '';\r\n      act(() => {\r\n        tabId = useTabManagerStore.getState().createTab(template);\r\n      });\r\n      \r\n      expect(getStoreCount()).toBe(initialCount + 1);\r\n      expect(hasUnitStore(tabId)).toBe(true);\r\n    });\r\n    \r\n    it('should set tab name from template', () => {\r\n      const template = UNIT_TEMPLATES[0]; // Light\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(template);\r\n      });\r\n      \r\n      const { tabs } = useTabManagerStore.getState();\r\n      expect(tabs[0].name).toBe(`New ${template.name}`);\r\n    });\r\n    \r\n    it('should use custom name if provided', () => {\r\n      const template = UNIT_TEMPLATES[0];\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(template, 'Custom Mech');\r\n      });\r\n      \r\n      const { tabs } = useTabManagerStore.getState();\r\n      expect(tabs[0].name).toBe('Custom Mech');\r\n    });\r\n    \r\n    it('should store tab metadata correctly', () => {\r\n      const template = UNIT_TEMPLATES[2]; // Heavy - 70 tons\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(template);\r\n      });\r\n      \r\n      const { tabs } = useTabManagerStore.getState();\r\n      \r\n      expect(tabs[0].tonnage).toBe(70);\r\n      expect(tabs[0].techBase).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n    \r\n    it('should close new tab modal after creating', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().openNewTabModal();\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().isNewTabModalOpen).toBe(false);\r\n    });\r\n    \r\n    it('should create multiple tabs', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[2]);\r\n      });\r\n      \r\n      const { tabs } = useTabManagerStore.getState();\r\n      expect(tabs).toHaveLength(3);\r\n      \r\n      // Active tab should be the last created\r\n      const lastTab = tabs[2];\r\n      expect(useTabManagerStore.getState().activeTabId).toBe(lastTab.id);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Duplication\r\n  // ===========================================================================\r\n  describe('duplicateTab()', () => {\r\n    it('should duplicate tab and create new unit store', () => {\r\n      let originalId: string = '';\r\n      \r\n      act(() => {\r\n        originalId = useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const initialStoreCount = getStoreCount();\r\n      \r\n      let duplicateId: string | null = null;\r\n      act(() => {\r\n        duplicateId = useTabManagerStore.getState().duplicateTab(originalId);\r\n      });\r\n      \r\n      expect(duplicateId).not.toBeNull();\r\n      expect(duplicateId).not.toBe(originalId);\r\n      expect(getStoreCount()).toBe(initialStoreCount + 1);\r\n      expect(useTabManagerStore.getState().tabs).toHaveLength(2);\r\n    });\r\n    \r\n    it('should set active tab to duplicate', () => {\r\n      let originalId: string = '';\r\n      \r\n      act(() => {\r\n        originalId = useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      let duplicateId: string | null = null;\r\n      act(() => {\r\n        duplicateId = useTabManagerStore.getState().duplicateTab(originalId);\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().activeTabId).toBe(duplicateId);\r\n    });\r\n    \r\n    it('should add (Copy) to tab name', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0], 'Original Mech');\r\n      });\r\n      \r\n      const originalId = useTabManagerStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().duplicateTab(originalId);\r\n      });\r\n      \r\n      const { tabs } = useTabManagerStore.getState();\r\n      expect(tabs[1].name).toContain('(Copy)');\r\n    });\r\n    \r\n    it('should return null for non-existent tab', () => {\r\n      let result: string | null = 'initial';\r\n      \r\n      act(() => {\r\n        result = useTabManagerStore.getState().duplicateTab('non-existent');\r\n      });\r\n      \r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Closing\r\n  // ===========================================================================\r\n  describe('closeTab()', () => {\r\n    it('should close a tab', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const firstTabId = useTabManagerStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().closeTab(firstTabId);\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().tabs).toHaveLength(1);\r\n    });\r\n    \r\n    it('should close last tab and set activeTabId to null', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useTabManagerStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().closeTab(tabId);\r\n      });\r\n      \r\n      // Per spec: users CAN close the last tab\r\n      expect(useTabManagerStore.getState().tabs).toHaveLength(0);\r\n      expect(useTabManagerStore.getState().activeTabId).toBeNull();\r\n    });\r\n    \r\n    it('should select adjacent tab when closing active tab', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[2]);\r\n      });\r\n      \r\n      const tabs = useTabManagerStore.getState().tabs;\r\n      const middleTabId = tabs[1].id;\r\n      \r\n      // Select middle tab\r\n      act(() => {\r\n        useTabManagerStore.getState().selectTab(middleTabId);\r\n      });\r\n      \r\n      // Close middle tab\r\n      act(() => {\r\n        useTabManagerStore.getState().closeTab(middleTabId);\r\n      });\r\n      \r\n      // Should select next tab (now at same index)\r\n      const remainingTabs = useTabManagerStore.getState().tabs;\r\n      expect(useTabManagerStore.getState().activeTabId).toBe(remainingTabs[1].id);\r\n    });\r\n    \r\n    it('should select previous tab when closing last tab', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const tabs = useTabManagerStore.getState().tabs;\r\n      const lastTabId = tabs[1].id;\r\n      \r\n      // Last tab is already active after creation\r\n      expect(useTabManagerStore.getState().activeTabId).toBe(lastTabId);\r\n      \r\n      // Close last tab\r\n      act(() => {\r\n        useTabManagerStore.getState().closeTab(lastTabId);\r\n      });\r\n      \r\n      // Should select first tab\r\n      const remainingTabs = useTabManagerStore.getState().tabs;\r\n      expect(useTabManagerStore.getState().activeTabId).toBe(remainingTabs[0].id);\r\n    });\r\n    \r\n    it('should not affect active tab when closing non-active tab', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[2]);\r\n      });\r\n      \r\n      const tabs = useTabManagerStore.getState().tabs;\r\n      const firstTabId = tabs[0].id;\r\n      const lastTabId = tabs[2].id;\r\n      \r\n      // Last tab is active\r\n      expect(useTabManagerStore.getState().activeTabId).toBe(lastTabId);\r\n      \r\n      // Close first tab\r\n      act(() => {\r\n        useTabManagerStore.getState().closeTab(firstTabId);\r\n      });\r\n      \r\n      // Active tab should still be the last one\r\n      expect(useTabManagerStore.getState().activeTabId).toBe(lastTabId);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Selection\r\n  // ===========================================================================\r\n  describe('selectTab()', () => {\r\n    it('should change active tab', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const tabs = useTabManagerStore.getState().tabs;\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().selectTab(tabs[0].id);\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().activeTabId).toBe(tabs[0].id);\r\n    });\r\n    \r\n    it('should hydrate unit store when selecting', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const tabs = useTabManagerStore.getState().tabs;\r\n      \r\n      // Clear registry to simulate stores being garbage collected\r\n      clearAllStores(false);\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().selectTab(tabs[0].id);\r\n      });\r\n      \r\n      // Store should be hydrated\r\n      expect(hasUnitStore(tabs[0].id)).toBe(true);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Renaming\r\n  // ===========================================================================\r\n  describe('renameTab()', () => {\r\n    it('should rename a tab', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useTabManagerStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().renameTab(tabId, 'My Custom Mech');\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().tabs[0].name).toBe('My Custom Mech');\r\n    });\r\n    \r\n    it('should also update unit store name', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n      });\r\n      \r\n      const tabId = useTabManagerStore.getState().tabs[0].id;\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().renameTab(tabId, 'Renamed Unit');\r\n      });\r\n      \r\n      const store = getUnitStore(tabId);\r\n      expect(store?.getState().name).toBe('Renamed Unit');\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Reordering\r\n  // ===========================================================================\r\n  describe('reorderTabs()', () => {\r\n    it('should reorder tabs', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0], 'First');\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1], 'Second');\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[2], 'Third');\r\n      });\r\n      \r\n      const initialTabs = useTabManagerStore.getState().tabs;\r\n      const firstId = initialTabs[0].id;\r\n      const thirdId = initialTabs[2].id;\r\n      \r\n      // Move first to last position\r\n      act(() => {\r\n        useTabManagerStore.getState().reorderTabs(0, 2);\r\n      });\r\n      \r\n      const reorderedTabs = useTabManagerStore.getState().tabs;\r\n      \r\n      expect(reorderedTabs[0].name).toBe('Second');\r\n      expect(reorderedTabs[1].name).toBe('Third');\r\n      expect(reorderedTabs[2].name).toBe('First');\r\n    });\r\n    \r\n    it('should preserve all tab data during reorder', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[3], 'Assault'); // 100 tons\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0], 'Light');   // 25 tons\r\n      });\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().reorderTabs(1, 0);\r\n      });\r\n      \r\n      const tabs = useTabManagerStore.getState().tabs;\r\n      \r\n      expect(tabs[0].name).toBe('Light');\r\n      expect(tabs[0].tonnage).toBe(25);\r\n      expect(tabs[1].name).toBe('Assault');\r\n      expect(tabs[1].tonnage).toBe(100);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Modal State\r\n  // ===========================================================================\r\n  describe('Modal State', () => {\r\n    it('should open new tab modal', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().openNewTabModal();\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().isNewTabModalOpen).toBe(true);\r\n    });\r\n    \r\n    it('should close new tab modal', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().openNewTabModal();\r\n        useTabManagerStore.getState().closeNewTabModal();\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().isNewTabModalOpen).toBe(false);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Helper Functions\r\n  // ===========================================================================\r\n  describe('getActiveTab()', () => {\r\n    it('should return active tab', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const activeTab = useTabManagerStore.getState().getActiveTab();\r\n      const expectedId = useTabManagerStore.getState().activeTabId;\r\n      \r\n      expect(activeTab).not.toBeNull();\r\n      expect(activeTab?.id).toBe(expectedId);\r\n    });\r\n    \r\n    it('should return null when no tabs', () => {\r\n      const activeTab = useTabManagerStore.getState().getActiveTab();\r\n      \r\n      expect(activeTab).toBeNull();\r\n    });\r\n  });\r\n  \r\n  describe('setLoading()', () => {\r\n    it('should set loading state', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().setLoading(true);\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().isLoading).toBe(true);\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().setLoading(false);\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().isLoading).toBe(false);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tab Manager Only Stores Tab Metadata\r\n  // ===========================================================================\r\n  describe('Tab Manager Data Separation', () => {\r\n    it('should only store tab metadata in TabManager', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const tab = useTabManagerStore.getState().tabs[0];\r\n      \r\n      // TabInfo should only have metadata\r\n      expect(tab).toHaveProperty('id');\r\n      expect(tab).toHaveProperty('name');\r\n      expect(tab).toHaveProperty('tonnage');\r\n      expect(tab).toHaveProperty('techBase');\r\n      \r\n      // Should NOT have component configuration\r\n      expect(tab).not.toHaveProperty('engineType');\r\n      expect(tab).not.toHaveProperty('gyroType');\r\n      expect(tab).not.toHaveProperty('componentSelections');\r\n    });\r\n    \r\n    it('should store full configuration in unit store', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const tabId = useTabManagerStore.getState().tabs[0].id;\r\n      const unitStore = getUnitStore(tabId);\r\n      \r\n      expect(unitStore).not.toBeNull();\r\n      const state = unitStore!.getState();\r\n      \r\n      // Unit store should have full configuration\r\n      expect(state).toHaveProperty('engineType');\r\n      expect(state).toHaveProperty('gyroType');\r\n      expect(state).toHaveProperty('internalStructureType');\r\n      expect(state).toHaveProperty('heatSinkType');\r\n      expect(state).toHaveProperty('armorType');\r\n      expect(state).toHaveProperty('componentTechBases');\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Persistence\r\n  // Note: Zustand's persist middleware uses async storage operations.\r\n  // In a test environment with mocked localStorage, the actual persistence\r\n  // behavior may vary. These tests verify the store's state management\r\n  // rather than localStorage integration.\r\n  // ===========================================================================\r\n  // ===========================================================================\r\n  // Tab ID Validation on Hydration\r\n  // ===========================================================================\r\n  describe('Tab ID Validation', () => {\r\n    it('should repair tabs with missing IDs on hydration', () => {\r\n      // Simulate corrupted localStorage with missing ID\r\n      const corruptedState = {\r\n        state: {\r\n          tabs: [\r\n            { id: '', name: 'Missing ID Tab', tonnage: 50, techBase: TechBase.INNER_SPHERE },\r\n          ],\r\n          activeTabId: '',\r\n        },\r\n        version: 0,\r\n      };\r\n      \r\n      mockStorage.mockStorage.setItem('megamek-tab-manager', JSON.stringify(corruptedState));\r\n      \r\n      // Trigger rehydration\r\n      act(() => {\r\n        useTabManagerStore.persist.rehydrate();\r\n      });\r\n      \r\n      const { tabs, activeTabId } = useTabManagerStore.getState();\r\n      \r\n      // Tab should have a valid UUID now\r\n      expect(tabs).toHaveLength(1);\r\n      expect(tabs[0].id).not.toBe('');\r\n      expect(isValidUUID(tabs[0].id)).toBe(true);\r\n      expect(tabs[0].name).toBe('Missing ID Tab');\r\n      \r\n      // Active tab should be updated to the new ID\r\n      expect(activeTabId).toBe(tabs[0].id);\r\n    });\r\n    \r\n    it('should repair tabs with invalid (non-UUID) IDs on hydration', () => {\r\n      // Simulate corrupted localStorage with invalid ID\r\n      const corruptedState = {\r\n        state: {\r\n          tabs: [\r\n            { id: 'invalid-not-a-uuid', name: 'Invalid ID Tab', tonnage: 75, techBase: TechBase.CLAN },\r\n          ],\r\n          activeTabId: 'invalid-not-a-uuid',\r\n        },\r\n        version: 0,\r\n      };\r\n      \r\n      mockStorage.mockStorage.setItem('megamek-tab-manager', JSON.stringify(corruptedState));\r\n      \r\n      // Trigger rehydration\r\n      act(() => {\r\n        useTabManagerStore.persist.rehydrate();\r\n      });\r\n      \r\n      const { tabs, activeTabId } = useTabManagerStore.getState();\r\n      \r\n      // Tab should have a valid UUID now\r\n      expect(tabs).toHaveLength(1);\r\n      expect(tabs[0].id).not.toBe('invalid-not-a-uuid');\r\n      expect(isValidUUID(tabs[0].id)).toBe(true);\r\n      \r\n      // Active tab should be updated to the new ID\r\n      expect(activeTabId).toBe(tabs[0].id);\r\n    });\r\n    \r\n    it('should repair multiple tabs with invalid IDs', () => {\r\n      const corruptedState = {\r\n        state: {\r\n          tabs: [\r\n            { id: 'bad-id-1', name: 'Tab 1', tonnage: 25, techBase: TechBase.INNER_SPHERE },\r\n            { id: '', name: 'Tab 2', tonnage: 50, techBase: TechBase.INNER_SPHERE },\r\n            { id: 'bad-id-3', name: 'Tab 3', tonnage: 100, techBase: TechBase.CLAN },\r\n          ],\r\n          activeTabId: 'bad-id-1',\r\n        },\r\n        version: 0,\r\n      };\r\n      \r\n      mockStorage.mockStorage.setItem('megamek-tab-manager', JSON.stringify(corruptedState));\r\n      \r\n      act(() => {\r\n        useTabManagerStore.persist.rehydrate();\r\n      });\r\n      \r\n      const { tabs, activeTabId } = useTabManagerStore.getState();\r\n      \r\n      // All tabs should have valid UUIDs\r\n      expect(tabs).toHaveLength(3);\r\n      tabs.forEach((tab, index) => {\r\n        expect(isValidUUID(tab.id)).toBe(true);\r\n        expect(tab.name).toBe(`Tab ${index + 1}`);\r\n      });\r\n      \r\n      // All IDs should be unique\r\n      const ids = tabs.map(t => t.id);\r\n      expect(new Set(ids).size).toBe(3);\r\n      \r\n      // Active tab ID should be updated\r\n      expect(isValidUUID(activeTabId!)).toBe(true);\r\n      expect(activeTabId).toBe(tabs[0].id);\r\n    });\r\n    \r\n    it('should preserve valid UUIDs during hydration', () => {\r\n      const validId = '550e8400-e29b-41d4-a716-446655440000';\r\n      const validState = {\r\n        state: {\r\n          tabs: [\r\n            { id: validId, name: 'Valid Tab', tonnage: 50, techBase: TechBase.INNER_SPHERE },\r\n          ],\r\n          activeTabId: validId,\r\n        },\r\n        version: 0,\r\n      };\r\n      \r\n      mockStorage.mockStorage.setItem('megamek-tab-manager', JSON.stringify(validState));\r\n      \r\n      act(() => {\r\n        useTabManagerStore.persist.rehydrate();\r\n      });\r\n      \r\n      const { tabs, activeTabId } = useTabManagerStore.getState();\r\n      \r\n      // Valid UUID should be preserved\r\n      expect(tabs[0].id).toBe(validId);\r\n      expect(activeTabId).toBe(validId);\r\n    });\r\n    \r\n    it('should handle mixed valid and invalid IDs', () => {\r\n      const validId = '550e8400-e29b-41d4-a716-446655440000';\r\n      const mixedState = {\r\n        state: {\r\n          tabs: [\r\n            { id: validId, name: 'Valid Tab', tonnage: 50, techBase: TechBase.INNER_SPHERE },\r\n            { id: 'invalid', name: 'Invalid Tab', tonnage: 75, techBase: TechBase.CLAN },\r\n          ],\r\n          activeTabId: 'invalid',\r\n        },\r\n        version: 0,\r\n      };\r\n      \r\n      mockStorage.mockStorage.setItem('megamek-tab-manager', JSON.stringify(mixedState));\r\n      \r\n      act(() => {\r\n        useTabManagerStore.persist.rehydrate();\r\n      });\r\n      \r\n      const { tabs, activeTabId } = useTabManagerStore.getState();\r\n      \r\n      // Valid ID should be preserved\r\n      expect(tabs[0].id).toBe(validId);\r\n      \r\n      // Invalid ID should be replaced\r\n      expect(tabs[1].id).not.toBe('invalid');\r\n      expect(isValidUUID(tabs[1].id)).toBe(true);\r\n      \r\n      // Active tab should point to the repaired tab\r\n      expect(activeTabId).toBe(tabs[1].id);\r\n    });\r\n  });\r\n  \r\n  describe('Persistence Configuration', () => {\r\n    it('should only include tabs and activeTabId in partialize', () => {\r\n      // The store is configured to only persist tabs and activeTabId\r\n      // Verify by checking that isLoading and isNewTabModalOpen \r\n      // are not persisted in the state structure\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0], 'Test Tab');\r\n        useTabManagerStore.getState().setLoading(true);\r\n        useTabManagerStore.getState().openNewTabModal();\r\n      });\r\n      \r\n      const state = useTabManagerStore.getState();\r\n      \r\n      // These should exist in state\r\n      expect(state.tabs).toHaveLength(1);\r\n      expect(state.activeTabId).not.toBeNull();\r\n      \r\n      // These are UI state and should not affect persistence\r\n      // (In a real scenario, partialize filters them out)\r\n      expect(state.isLoading).toBe(true);\r\n      expect(state.isNewTabModalOpen).toBe(true);\r\n    });\r\n    \r\n    it('should maintain tab data after state updates', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0], 'Persisted Tab');\r\n      });\r\n      \r\n      const tabId = useTabManagerStore.getState().tabs[0].id;\r\n      \r\n      // Update other state\r\n      act(() => {\r\n        useTabManagerStore.getState().setLoading(false);\r\n        useTabManagerStore.getState().closeNewTabModal();\r\n      });\r\n      \r\n      // Tab data should remain intact\r\n      expect(useTabManagerStore.getState().tabs).toHaveLength(1);\r\n      expect(useTabManagerStore.getState().tabs[0].name).toBe('Persisted Tab');\r\n      expect(useTabManagerStore.getState().activeTabId).toBe(tabId);\r\n    });\r\n    \r\n    it('should persist correct activeTabId when switching tabs', () => {\r\n      act(() => {\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[0]);\r\n        useTabManagerStore.getState().createTab(UNIT_TEMPLATES[1]);\r\n      });\r\n      \r\n      const tabs = useTabManagerStore.getState().tabs;\r\n      \r\n      act(() => {\r\n        useTabManagerStore.getState().selectTab(tabs[0].id);\r\n      });\r\n      \r\n      expect(useTabManagerStore.getState().activeTabId).toBe(tabs[0].id);\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\stores\\useUnitStore.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'act' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StoreApi' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UnitState' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UnitStore' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'originalTime' is assigned a value but never used.","line":286,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":286,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'originalTime' is assigned a value but never used.","line":528,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":528,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Store Tests\r\n * \r\n * Tests for the isolated unit store factory and state management.\r\n * \r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport { act } from '@testing-library/react';\r\nimport { StoreApi } from 'zustand';\r\nimport { createUnitStore, createNewUnitStore } from '@/stores/useUnitStore';\r\nimport { \r\n  UnitState, \r\n  UnitStore, \r\n  createDefaultUnitState,\r\n  generateUnitId,\r\n  CreateUnitOptions,\r\n} from '@/stores/unitState';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { TechBaseMode, TechBaseComponent } from '@/types/construction/TechBaseConfiguration';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType } from '@/types/construction/CockpitType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\r\nimport { \r\n  setupMockLocalStorage, \r\n  createTestStore,\r\n  createISTestStore,\r\n  createClanTestStore,\r\n  expectAllComponentTechBases,\r\n  expectTechBaseMode,\r\n} from '../helpers/storeTestHelpers';\r\n\r\ndescribe('Unit Store', () => {\r\n  let mockStorage: ReturnType<typeof setupMockLocalStorage>;\r\n  \r\n  beforeEach(() => {\r\n    mockStorage = setupMockLocalStorage();\r\n  });\r\n  \r\n  afterEach(() => {\r\n    mockStorage.cleanup();\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // generateUnitId Tests\r\n  // ===========================================================================\r\n  describe('generateUnitId()', () => {\r\n    it('should generate unique IDs', () => {\r\n      const id1 = generateUnitId();\r\n      const id2 = generateUnitId();\r\n      \r\n      expect(id1).not.toBe(id2);\r\n    });\r\n    \r\n    it('should generate IDs with expected UUID format', () => {\r\n      const id = generateUnitId();\r\n      \r\n      // UUIDs are 36 characters: 8-4-4-4-12 format\r\n      expect(id).toMatch(/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // createDefaultUnitState Tests\r\n  // ===========================================================================\r\n  describe('createDefaultUnitState()', () => {\r\n    it('should create state with provided options', () => {\r\n      const options: CreateUnitOptions = {\r\n        name: 'Test Mech',\r\n        tonnage: 75,\r\n        techBase: TechBase.INNER_SPHERE,\r\n        walkMP: 4,\r\n      };\r\n      \r\n      const state = createDefaultUnitState(options);\r\n      \r\n      expect(state.name).toBe('Test Mech');\r\n      expect(state.tonnage).toBe(75);\r\n      expect(state.techBase).toBe(TechBase.INNER_SPHERE);\r\n      expect(state.engineRating).toBe(300); // 75 * 4\r\n    });\r\n    \r\n    it('should use provided ID if given', () => {\r\n      const options: CreateUnitOptions = {\r\n        id: 'custom-id-123',\r\n        name: 'Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      };\r\n      \r\n      const state = createDefaultUnitState(options);\r\n      \r\n      expect(state.id).toBe('custom-id-123');\r\n    });\r\n    \r\n    it('should generate ID if not provided', () => {\r\n      const options: CreateUnitOptions = {\r\n        name: 'Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      };\r\n      \r\n      const state = createDefaultUnitState(options);\r\n      \r\n      // UUIDs are 36 characters: 8-4-4-4-12 format (UUID v4)\r\n      expect(state.id).toMatch(/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i);\r\n    });\r\n    \r\n    it('should set techBaseMode to inner_sphere for IS units', () => {\r\n      const options: CreateUnitOptions = {\r\n        name: 'Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      };\r\n      \r\n      const state = createDefaultUnitState(options);\r\n      \r\n      expect(state.techBaseMode).toBe(TechBaseMode.INNER_SPHERE);\r\n    });\r\n    \r\n    it('should set techBaseMode to clan for Clan units', () => {\r\n      const options: CreateUnitOptions = {\r\n        name: 'Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.CLAN,\r\n      };\r\n      \r\n      const state = createDefaultUnitState(options);\r\n      \r\n      expect(state.techBaseMode).toBe(TechBaseMode.CLAN);\r\n    });\r\n    \r\n    it('should initialize componentTechBases matching unit tech base', () => {\r\n      const isState = createDefaultUnitState({\r\n        name: 'Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      const clanState = createDefaultUnitState({\r\n        name: 'Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.CLAN,\r\n      });\r\n      \r\n      expectAllComponentTechBases(isState.componentTechBases, TechBase.INNER_SPHERE);\r\n      expectAllComponentTechBases(clanState.componentTechBases, TechBase.CLAN);\r\n    });\r\n    \r\n    it('should use default walkMP of 4 if not provided', () => {\r\n      const state = createDefaultUnitState({\r\n        name: 'Test',\r\n        tonnage: 100,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      expect(state.engineRating).toBe(400); // 100 * 4\r\n    });\r\n    \r\n    it('should set default component types', () => {\r\n      const state = createDefaultUnitState({\r\n        name: 'Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      expect(state.engineType).toBe(EngineType.STANDARD);\r\n      expect(state.gyroType).toBe(GyroType.STANDARD);\r\n      expect(state.internalStructureType).toBe(InternalStructureType.STANDARD);\r\n      expect(state.cockpitType).toBe(CockpitType.STANDARD);\r\n      expect(state.heatSinkType).toBe(HeatSinkType.SINGLE);\r\n      expect(state.heatSinkCount).toBe(10);\r\n      expect(state.armorType).toBe(ArmorTypeEnum.STANDARD);\r\n    });\r\n    \r\n    it('should set isModified to true for new units', () => {\r\n      const state = createDefaultUnitState({\r\n        name: 'Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      expect(state.isModified).toBe(true);\r\n    });\r\n    \r\n    it('should set creation timestamps', () => {\r\n      const before = Date.now();\r\n      const state = createDefaultUnitState({\r\n        name: 'Test',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      const after = Date.now();\r\n      \r\n      expect(state.createdAt).toBeGreaterThanOrEqual(before);\r\n      expect(state.createdAt).toBeLessThanOrEqual(after);\r\n      expect(state.lastModifiedAt).toBe(state.createdAt);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // createUnitStore Tests\r\n  // ===========================================================================\r\n  describe('createUnitStore()', () => {\r\n    it('should create store with provided initial state', () => {\r\n      const initialState = createDefaultUnitState({\r\n        name: 'Test Mech',\r\n        tonnage: 75,\r\n        techBase: TechBase.CLAN,\r\n      });\r\n      \r\n      const store = createUnitStore(initialState);\r\n      const state = store.getState();\r\n      \r\n      expect(state.name).toBe('Test Mech');\r\n      expect(state.tonnage).toBe(75);\r\n      expect(state.techBase).toBe(TechBase.CLAN);\r\n    });\r\n    \r\n    it('should include all action methods', () => {\r\n      const store = createTestStore();\r\n      const state = store.getState();\r\n      \r\n      expect(typeof state.setName).toBe('function');\r\n      expect(typeof state.setTechBaseMode).toBe('function');\r\n      expect(typeof state.setComponentTechBase).toBe('function');\r\n      expect(typeof state.setAllComponentTechBases).toBe('function');\r\n      expect(typeof state.setEngineType).toBe('function');\r\n      expect(typeof state.setEngineRating).toBe('function');\r\n      expect(typeof state.setGyroType).toBe('function');\r\n      expect(typeof state.setInternalStructureType).toBe('function');\r\n      expect(typeof state.setCockpitType).toBe('function');\r\n      expect(typeof state.setHeatSinkType).toBe('function');\r\n      expect(typeof state.setHeatSinkCount).toBe('function');\r\n      expect(typeof state.setArmorType).toBe('function');\r\n      expect(typeof state.markModified).toBe('function');\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // createNewUnitStore Tests\r\n  // ===========================================================================\r\n  describe('createNewUnitStore()', () => {\r\n    it('should create store from options', () => {\r\n      const store = createNewUnitStore({\r\n        name: 'New Unit',\r\n        tonnage: 50,\r\n        techBase: TechBase.INNER_SPHERE,\r\n      });\r\n      \r\n      const state = store.getState();\r\n      \r\n      expect(state.name).toBe('New Unit');\r\n      expect(state.tonnage).toBe(50);\r\n      // UUIDs are 36 characters: 8-4-4-4-12 format (UUID v4)\r\n      expect(state.id).toMatch(/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Name Actions Tests\r\n  // ===========================================================================\r\n  describe('setName()', () => {\r\n    it('should update name', () => {\r\n      const store = createTestStore({ name: 'Original' });\r\n      \r\n      store.getState().setName('Updated');\r\n      \r\n      expect(store.getState().name).toBe('Updated');\r\n    });\r\n    \r\n    it('should mark as modified', () => {\r\n      const store = createTestStore();\r\n      store.getState().markModified(false);\r\n      \r\n      store.getState().setName('New Name');\r\n      \r\n      expect(store.getState().isModified).toBe(true);\r\n    });\r\n    \r\n    it('should update lastModifiedAt', () => {\r\n      const store = createTestStore();\r\n      const originalTime = store.getState().lastModifiedAt;\r\n      \r\n      // Wait a bit to ensure time difference\r\n      const later = Date.now() + 1;\r\n      jest.spyOn(Date, 'now').mockReturnValue(later);\r\n      \r\n      store.getState().setName('New Name');\r\n      \r\n      expect(store.getState().lastModifiedAt).toBe(later);\r\n      \r\n      jest.restoreAllMocks();\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tech Base Mode Actions Tests\r\n  // ===========================================================================\r\n  describe('setTechBaseMode()', () => {\r\n    it('should update tech base mode', () => {\r\n      const store = createISTestStore();\r\n      \r\n      store.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n      \r\n      expectTechBaseMode(store, TechBaseMode.CLAN);\r\n    });\r\n    \r\n    it('should reset componentTechBases to Clan when switching to clan mode', () => {\r\n      const store = createISTestStore();\r\n      \r\n      store.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n      \r\n      expectAllComponentTechBases(store.getState().componentTechBases, TechBase.CLAN);\r\n    });\r\n    \r\n    it('should reset componentTechBases to IS when switching to inner_sphere mode', () => {\r\n      const store = createClanTestStore();\r\n      \r\n      store.getState().setTechBaseMode(TechBaseMode.INNER_SPHERE);\r\n      \r\n      expectAllComponentTechBases(store.getState().componentTechBases, TechBase.INNER_SPHERE);\r\n    });\r\n    \r\n    it('should preserve componentTechBases when switching to mixed mode', () => {\r\n      const store = createISTestStore();\r\n      \r\n      // Set a specific component to Clan\r\n      store.getState().setComponentTechBase(TechBaseComponent.ENGINE, TechBase.CLAN);\r\n      \r\n      // Switch to mixed mode\r\n      store.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n      \r\n      // Engine should still be Clan\r\n      expect(store.getState().componentTechBases.engine).toBe(TechBase.CLAN);\r\n      // Others should still be IS\r\n      expect(store.getState().componentTechBases.chassis).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n    \r\n    it('should mark as modified when changing tech base mode', () => {\r\n      const store = createTestStore();\r\n      store.getState().markModified(false);\r\n      \r\n      store.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n      \r\n      expect(store.getState().isModified).toBe(true);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Component Tech Base Actions Tests\r\n  // ===========================================================================\r\n  describe('setComponentTechBase()', () => {\r\n    it('should update individual component tech base', () => {\r\n      const store = createISTestStore();\r\n      \r\n      store.getState().setComponentTechBase(TechBaseComponent.ENGINE, TechBase.CLAN);\r\n      \r\n      expect(store.getState().componentTechBases.engine).toBe(TechBase.CLAN);\r\n      // Other components remain unchanged\r\n      expect(store.getState().componentTechBases.chassis).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n    \r\n    it('should mark as modified', () => {\r\n      const store = createTestStore();\r\n      store.getState().markModified(false);\r\n      \r\n      store.getState().setComponentTechBase(TechBaseComponent.ARMOR, TechBase.CLAN);\r\n      \r\n      expect(store.getState().isModified).toBe(true);\r\n    });\r\n  });\r\n  \r\n  describe('setAllComponentTechBases()', () => {\r\n    it('should replace all component tech bases', () => {\r\n      const store = createISTestStore();\r\n      \r\n      const newTechBases = {\r\n        chassis: TechBase.CLAN,\r\n        gyro: TechBase.CLAN,\r\n        engine: TechBase.CLAN,\r\n        heatsink: TechBase.INNER_SPHERE,\r\n        targeting: TechBase.INNER_SPHERE,\r\n        myomer: TechBase.INNER_SPHERE,\r\n        movement: TechBase.CLAN,\r\n        armor: TechBase.CLAN,\r\n      };\r\n      \r\n      store.getState().setAllComponentTechBases(newTechBases);\r\n      \r\n      expect(store.getState().componentTechBases).toEqual(newTechBases);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Engine Actions Tests\r\n  // ===========================================================================\r\n  describe('setEngineType()', () => {\r\n    it('should update engine type', () => {\r\n      const store = createISTestStore();\r\n      \r\n      store.getState().setEngineType(EngineType.XL_IS);\r\n      \r\n      expect(store.getState().engineType).toBe(EngineType.XL_IS);\r\n    });\r\n    \r\n    it('should mark as modified', () => {\r\n      const store = createTestStore();\r\n      store.getState().markModified(false);\r\n      \r\n      store.getState().setEngineType(EngineType.LIGHT);\r\n      \r\n      expect(store.getState().isModified).toBe(true);\r\n    });\r\n  });\r\n  \r\n  describe('setEngineRating()', () => {\r\n    it('should update engine rating', () => {\r\n      const store = createTestStore({ tonnage: 50 });\r\n      \r\n      store.getState().setEngineRating(250);\r\n      \r\n      expect(store.getState().engineRating).toBe(250);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Gyro Actions Tests\r\n  // ===========================================================================\r\n  describe('setGyroType()', () => {\r\n    it('should update gyro type', () => {\r\n      const store = createTestStore();\r\n      \r\n      store.getState().setGyroType(GyroType.XL);\r\n      \r\n      expect(store.getState().gyroType).toBe(GyroType.XL);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Internal Structure Actions Tests\r\n  // ===========================================================================\r\n  describe('setInternalStructureType()', () => {\r\n    it('should update internal structure type', () => {\r\n      const store = createISTestStore();\r\n      \r\n      store.getState().setInternalStructureType(InternalStructureType.ENDO_STEEL_IS);\r\n      \r\n      expect(store.getState().internalStructureType).toBe(InternalStructureType.ENDO_STEEL_IS);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Cockpit Actions Tests\r\n  // ===========================================================================\r\n  describe('setCockpitType()', () => {\r\n    it('should update cockpit type', () => {\r\n      const store = createTestStore();\r\n      \r\n      store.getState().setCockpitType(CockpitType.SMALL);\r\n      \r\n      expect(store.getState().cockpitType).toBe(CockpitType.SMALL);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Heat Sink Actions Tests\r\n  // ===========================================================================\r\n  describe('setHeatSinkType()', () => {\r\n    it('should update heat sink type', () => {\r\n      const store = createISTestStore();\r\n      \r\n      store.getState().setHeatSinkType(HeatSinkType.DOUBLE_IS);\r\n      \r\n      expect(store.getState().heatSinkType).toBe(HeatSinkType.DOUBLE_IS);\r\n    });\r\n  });\r\n  \r\n  describe('setHeatSinkCount()', () => {\r\n    it('should update heat sink count', () => {\r\n      const store = createTestStore();\r\n      \r\n      store.getState().setHeatSinkCount(15);\r\n      \r\n      expect(store.getState().heatSinkCount).toBe(15);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Armor Actions Tests\r\n  // ===========================================================================\r\n  describe('setArmorType()', () => {\r\n    it('should update armor type', () => {\r\n      const store = createISTestStore();\r\n      \r\n      store.getState().setArmorType(ArmorTypeEnum.FERRO_FIBROUS_IS);\r\n      \r\n      expect(store.getState().armorType).toBe(ArmorTypeEnum.FERRO_FIBROUS_IS);\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Metadata Actions Tests\r\n  // ===========================================================================\r\n  describe('markModified()', () => {\r\n    it('should set isModified to true by default', () => {\r\n      const store = createTestStore();\r\n      store.setState({ isModified: false });\r\n      \r\n      store.getState().markModified();\r\n      \r\n      expect(store.getState().isModified).toBe(true);\r\n    });\r\n    \r\n    it('should set isModified to false when passed false', () => {\r\n      const store = createTestStore();\r\n      \r\n      store.getState().markModified(false);\r\n      \r\n      expect(store.getState().isModified).toBe(false);\r\n    });\r\n    \r\n    it('should update lastModifiedAt', () => {\r\n      const store = createTestStore();\r\n      const originalTime = store.getState().lastModifiedAt;\r\n      \r\n      const later = Date.now() + 1000;\r\n      jest.spyOn(Date, 'now').mockReturnValue(later);\r\n      \r\n      store.getState().markModified();\r\n      \r\n      expect(store.getState().lastModifiedAt).toBe(later);\r\n      \r\n      jest.restoreAllMocks();\r\n    });\r\n  });\r\n  \r\n  // ===========================================================================\r\n  // Tech Base Switching Scenarios\r\n  // ===========================================================================\r\n  describe('Tech Base Switching Scenarios', () => {\r\n    it('should handle IS to Clan switch correctly', () => {\r\n      const store = createISTestStore();\r\n      \r\n      // Verify initial IS state\r\n      expectTechBaseMode(store, TechBaseMode.INNER_SPHERE);\r\n      expectAllComponentTechBases(store.getState().componentTechBases, TechBase.INNER_SPHERE);\r\n      \r\n      // Switch to Clan\r\n      store.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n      \r\n      // Verify Clan state\r\n      expectTechBaseMode(store, TechBaseMode.CLAN);\r\n      expectAllComponentTechBases(store.getState().componentTechBases, TechBase.CLAN);\r\n    });\r\n    \r\n    it('should handle Clan to IS switch correctly', () => {\r\n      const store = createClanTestStore();\r\n      \r\n      // Verify initial Clan state\r\n      expectTechBaseMode(store, TechBaseMode.CLAN);\r\n      expectAllComponentTechBases(store.getState().componentTechBases, TechBase.CLAN);\r\n      \r\n      // Switch to IS\r\n      store.getState().setTechBaseMode(TechBaseMode.INNER_SPHERE);\r\n      \r\n      // Verify IS state\r\n      expectTechBaseMode(store, TechBaseMode.INNER_SPHERE);\r\n      expectAllComponentTechBases(store.getState().componentTechBases, TechBase.INNER_SPHERE);\r\n    });\r\n    \r\n    it('should handle IS to mixed mode correctly', () => {\r\n      const store = createISTestStore();\r\n      \r\n      // Set specific components before switching to mixed\r\n      store.getState().setComponentTechBase(TechBaseComponent.ENGINE, TechBase.CLAN);\r\n      store.getState().setComponentTechBase(TechBaseComponent.HEATSINK, TechBase.CLAN);\r\n      \r\n      // Switch to mixed\r\n      store.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n      \r\n      // Verify preserved settings\r\n      expect(store.getState().componentTechBases.engine).toBe(TechBase.CLAN);\r\n      expect(store.getState().componentTechBases.heatsink).toBe(TechBase.CLAN);\r\n      expect(store.getState().componentTechBases.chassis).toBe(TechBase.INNER_SPHERE);\r\n    });\r\n    \r\n    it('should reset mixed settings when switching back to non-mixed', () => {\r\n      const store = createISTestStore();\r\n      \r\n      // Switch to mixed and set varied tech bases\r\n      store.getState().setTechBaseMode(TechBaseMode.MIXED);\r\n      store.getState().setComponentTechBase(TechBaseComponent.ENGINE, TechBase.CLAN);\r\n      store.getState().setComponentTechBase(TechBaseComponent.ARMOR, TechBase.CLAN);\r\n      \r\n      // Switch to Clan (non-mixed)\r\n      store.getState().setTechBaseMode(TechBaseMode.CLAN);\r\n      \r\n      // All should be Clan now\r\n      expectAllComponentTechBases(store.getState().componentTechBases, TechBase.CLAN);\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\types\\definitionLookups.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\types\\typeGuards.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\types\\validation\\HeatManagement.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\colors\\equipmentColors.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\colors\\index.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\colors\\slotColors.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\colors\\statusColors.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\colors\\techBaseColors.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\armorCalculations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\battleValueCalculations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\constructionRules.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\costCalculations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\displacementUtils.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[442,445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[442,445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":12,"column":49,"nodeType":"ObjectExpression","messageId":"unsafeReturn","endLine":18,"endColumn":4}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  getDisplacedEquipment,\r\n  getEquipmentDisplacedByEngineChange,\r\n  getEquipmentDisplacedByGyroChange,\r\n  applyDisplacement,\r\n} from '@/utils/construction/displacementUtils';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { MechLocation } from '@/types/construction';\r\n\r\ndescribe('displacementUtils', () => {\r\n  const createEquipment = (overrides?: any) => ({\r\n    instanceId: 'equip-1',\r\n    equipmentId: 'medium-laser',\r\n    location: MechLocation.CENTER_TORSO,\r\n    slots: [0, 1],\r\n    ...overrides,\r\n  });\r\n\r\n  describe('getDisplacedEquipment()', () => {\r\n    it('should return empty result when no displacement', () => {\r\n      const equipment = [createEquipment()];\r\n      const result = getDisplacedEquipment(\r\n        equipment,\r\n        EngineType.STANDARD_FUSION,\r\n        EngineType.STANDARD_FUSION,\r\n        GyroType.STANDARD,\r\n        GyroType.STANDARD\r\n      );\r\n\r\n      expect(result.displacedEquipmentIds.length).toBe(0);\r\n      expect(result.affectedLocations.length).toBe(0);\r\n    });\r\n\r\n    it('should detect equipment displaced by engine change', () => {\r\n      const equipment = [createEquipment({ slots: [0, 1] })];\r\n      const result = getDisplacedEquipment(\r\n        equipment,\r\n        EngineType.STANDARD_FUSION,\r\n        EngineType.XL_FUSION,\r\n        GyroType.STANDARD,\r\n        GyroType.STANDARD\r\n      );\r\n\r\n      // Result depends on engine slot requirements\r\n      expect(result).toBeDefined();\r\n    });\r\n\r\n    it('should detect equipment displaced by gyro change', () => {\r\n      const equipment = [createEquipment({ slots: [3, 4] })];\r\n      const result = getDisplacedEquipment(\r\n        equipment,\r\n        EngineType.STANDARD_FUSION,\r\n        EngineType.STANDARD_FUSION,\r\n        GyroType.STANDARD,\r\n        GyroType.COMPACT\r\n      );\r\n\r\n      expect(result).toBeDefined();\r\n    });\r\n\r\n    it('should include affected locations', () => {\r\n      const equipment = [createEquipment({ location: MechLocation.CENTER_TORSO })];\r\n      const result = getDisplacedEquipment(\r\n        equipment,\r\n        EngineType.STANDARD_FUSION,\r\n        EngineType.XL_FUSION,\r\n        GyroType.STANDARD,\r\n        GyroType.STANDARD\r\n      );\r\n\r\n      expect(result.affectedLocations).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('getEquipmentDisplacedByEngineChange()', () => {\r\n    it('should detect equipment displaced by engine change', () => {\r\n      const equipment = [createEquipment()];\r\n      const result = getEquipmentDisplacedByEngineChange(\r\n        equipment,\r\n        EngineType.STANDARD_FUSION,\r\n        EngineType.XL_FUSION,\r\n        GyroType.STANDARD\r\n      );\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.displacedEquipmentIds).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('getEquipmentDisplacedByGyroChange()', () => {\r\n    it('should detect equipment displaced by gyro change', () => {\r\n      const equipment = [createEquipment()];\r\n      const result = getEquipmentDisplacedByGyroChange(\r\n        equipment,\r\n        EngineType.STANDARD_FUSION,\r\n        GyroType.STANDARD,\r\n        GyroType.COMPACT\r\n      );\r\n\r\n      expect(result).toBeDefined();\r\n      expect(result.displacedEquipmentIds).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('applyDisplacement()', () => {\r\n    it('should return original equipment when no displacement', () => {\r\n      const equipment = [createEquipment()];\r\n      const result = applyDisplacement(equipment, []);\r\n\r\n      expect(result).toEqual(equipment);\r\n    });\r\n\r\n    it('should unallocate displaced equipment', () => {\r\n      const equipment = [\r\n        createEquipment({ instanceId: 'equip-1' }),\r\n        createEquipment({ instanceId: 'equip-2' }),\r\n      ];\r\n      const result = applyDisplacement(equipment, ['equip-1']);\r\n\r\n      expect(result[0].location).toBeUndefined();\r\n      expect(result[0].slots).toBeUndefined();\r\n      expect(result[1].location).toBeDefined();\r\n    });\r\n\r\n    it('should handle multiple displaced equipment', () => {\r\n      const equipment = [\r\n        createEquipment({ instanceId: 'equip-1' }),\r\n        createEquipment({ instanceId: 'equip-2' }),\r\n        createEquipment({ instanceId: 'equip-3' }),\r\n      ];\r\n      const result = applyDisplacement(equipment, ['equip-1', 'equip-3']);\r\n\r\n      expect(result[0].location).toBeUndefined();\r\n      expect(result[1].location).toBeDefined();\r\n      expect(result[2].location).toBeUndefined();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\engineCalculations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\formulaRegistry.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormulaDefinition' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Tests for Formula Registry\n */\n\nimport {\n  WEIGHT_FORMULAS,\n  MOVEMENT_FORMULAS,\n  SLOT_FORMULAS,\n  HEAT_SINK_FORMULAS,\n  ARMOR_FORMULAS,\n  getFormula,\n  getFormulasByCategory,\n  FormulaDefinition,\n} from '@/utils/construction/formulaRegistry';\n\ndescribe('Formula Registry', () => {\n  // ============================================================================\n  // WEIGHT_FORMULAS\n  // ============================================================================\n  describe('WEIGHT_FORMULAS', () => {\n    it('should contain engine formulas', () => {\n      const engineFormulas = WEIGHT_FORMULAS.filter(f => f.id.startsWith('engine.'));\n      expect(engineFormulas.length).toBeGreaterThan(0);\n    });\n\n    it('should contain gyro formulas', () => {\n      const gyroFormulas = WEIGHT_FORMULAS.filter(f => f.id.startsWith('gyro.'));\n      expect(gyroFormulas.length).toBeGreaterThan(0);\n    });\n\n    it('should contain structure formulas', () => {\n      const structureFormulas = WEIGHT_FORMULAS.filter(f => f.id.startsWith('structure.'));\n      expect(structureFormulas.length).toBeGreaterThan(0);\n    });\n\n    it('should have required properties', () => {\n      for (const formula of WEIGHT_FORMULAS) {\n        expect(formula.id).toBeDefined();\n        expect(formula.name).toBeDefined();\n        expect(formula.description).toBeDefined();\n        expect(formula.formula).toBeDefined();\n        expect(formula.source).toBeDefined();\n      }\n    });\n\n    it('should reference TechManual', () => {\n      for (const formula of WEIGHT_FORMULAS) {\n        expect(formula.source).toBe('TechManual');\n      }\n    });\n  });\n\n  // ============================================================================\n  // MOVEMENT_FORMULAS\n  // ============================================================================\n  describe('MOVEMENT_FORMULAS', () => {\n    it('should contain walk MP formula', () => {\n      const walkFormula = MOVEMENT_FORMULAS.find(f => f.id.includes('walk'));\n      expect(walkFormula).toBeDefined();\n    });\n\n    it('should contain run MP formula', () => {\n      const runFormula = MOVEMENT_FORMULAS.find(f => f.id.includes('run'));\n      expect(runFormula).toBeDefined();\n    });\n\n    it('should contain engine rating formula', () => {\n      const engineFormula = MOVEMENT_FORMULAS.find(f => f.id.includes('engine_rating'));\n      expect(engineFormula).toBeDefined();\n    });\n\n    it('should have required properties', () => {\n      for (const formula of MOVEMENT_FORMULAS) {\n        expect(formula.id).toBeDefined();\n        expect(formula.name).toBeDefined();\n        expect(formula.source).toBeDefined();\n      }\n    });\n  });\n\n  // ============================================================================\n  // SLOT_FORMULAS\n  // ============================================================================\n  describe('SLOT_FORMULAS', () => {\n    it('should contain engine slot formulas', () => {\n      const engineFormulas = SLOT_FORMULAS.filter(f => f.id.includes('engine'));\n      expect(engineFormulas.length).toBeGreaterThan(0);\n    });\n\n    it('should contain gyro slot formula', () => {\n      const gyroFormula = SLOT_FORMULAS.find(f => f.id.includes('gyro'));\n      expect(gyroFormula).toBeDefined();\n    });\n\n    it('should have required properties', () => {\n      for (const formula of SLOT_FORMULAS) {\n        expect(formula.id).toBeDefined();\n        expect(formula.name).toBeDefined();\n        expect(formula.source).toBeDefined();\n      }\n    });\n  });\n\n  // ============================================================================\n  // HEAT_SINK_FORMULAS\n  // ============================================================================\n  describe('HEAT_SINK_FORMULAS', () => {\n    it('should contain integral heat sinks formula', () => {\n      const integralFormula = HEAT_SINK_FORMULAS.find(f => f.id.includes('integral'));\n      expect(integralFormula).toBeDefined();\n    });\n\n    it('should contain dissipation formulas', () => {\n      const dissipationFormulas = HEAT_SINK_FORMULAS.filter(f => f.id.includes('dissipation'));\n      expect(dissipationFormulas.length).toBeGreaterThan(0);\n    });\n\n    it('should have required properties', () => {\n      for (const formula of HEAT_SINK_FORMULAS) {\n        expect(formula.id).toBeDefined();\n        expect(formula.name).toBeDefined();\n        expect(formula.source).toBeDefined();\n      }\n    });\n  });\n\n  // ============================================================================\n  // ARMOR_FORMULAS\n  // ============================================================================\n  describe('ARMOR_FORMULAS', () => {\n    it('should contain max armor formula', () => {\n      const maxFormula = ARMOR_FORMULAS.find(f => f.id.includes('max'));\n      expect(maxFormula).toBeDefined();\n    });\n\n    it('should have required properties', () => {\n      for (const formula of ARMOR_FORMULAS) {\n        expect(formula.id).toBeDefined();\n        expect(formula.name).toBeDefined();\n        expect(formula.source).toBeDefined();\n      }\n    });\n  });\n\n  // ============================================================================\n  // getFormula\n  // ============================================================================\n  describe('getFormula', () => {\n    it('should find weight formula by ID', () => {\n      const formula = getFormula('engine.standard');\n      expect(formula).toBeDefined();\n      expect(formula?.name).toContain('Engine');\n    });\n\n    it('should find movement formula by ID', () => {\n      const formula = getFormula('movement.walk');\n      expect(formula).toBeDefined();\n    });\n\n    it('should find slot formula by ID', () => {\n      const formula = getFormula('slots.gyro');\n      expect(formula).toBeDefined();\n    });\n\n    it('should find heat sink formula by ID', () => {\n      const formula = getFormula('heat_sinks.integral');\n      expect(formula).toBeDefined();\n    });\n\n    it('should find armor formula by ID', () => {\n      const formula = getFormula('armor.max.standard');\n      expect(formula).toBeDefined();\n    });\n\n    it('should return undefined for unknown ID', () => {\n      const formula = getFormula('unknown.formula');\n      expect(formula).toBeUndefined();\n    });\n  });\n\n  // ============================================================================\n  // getFormulasByCategory\n  // ============================================================================\n  describe('getFormulasByCategory', () => {\n    it('should return weight formulas', () => {\n      const formulas = getFormulasByCategory('weight');\n      expect(formulas).toBe(WEIGHT_FORMULAS);\n    });\n\n    it('should return movement formulas', () => {\n      const formulas = getFormulasByCategory('movement');\n      expect(formulas).toBe(MOVEMENT_FORMULAS);\n    });\n\n    it('should return slot formulas', () => {\n      const formulas = getFormulasByCategory('slots');\n      expect(formulas).toBe(SLOT_FORMULAS);\n    });\n\n    it('should return heat sink formulas', () => {\n      const formulas = getFormulasByCategory('heat_sinks');\n      expect(formulas).toBe(HEAT_SINK_FORMULAS);\n    });\n\n    it('should return armor formulas', () => {\n      const formulas = getFormulasByCategory('armor');\n      expect(formulas).toBe(ARMOR_FORMULAS);\n    });\n\n    it('should return empty array for invalid category', () => {\n      // @ts-expect-error Testing invalid category\n      const formulas = getFormulasByCategory('invalid');\n      expect(formulas).toEqual([]);\n    });\n  });\n\n  // ============================================================================\n  // Formula structure validation\n  // ============================================================================\n  describe('Formula structure', () => {\n    it('all formulas should have valid IDs', () => {\n      const allFormulas = [\n        ...WEIGHT_FORMULAS,\n        ...MOVEMENT_FORMULAS,\n        ...SLOT_FORMULAS,\n        ...HEAT_SINK_FORMULAS,\n        ...ARMOR_FORMULAS,\n      ];\n\n      for (const formula of allFormulas) {\n        expect(formula.id).toMatch(/^[a-z_\\.]+$/);\n      }\n    });\n\n    it('should have unique IDs', () => {\n      const allFormulas = [\n        ...WEIGHT_FORMULAS,\n        ...MOVEMENT_FORMULAS,\n        ...SLOT_FORMULAS,\n        ...HEAT_SINK_FORMULAS,\n        ...ARMOR_FORMULAS,\n      ];\n\n      const ids = allFormulas.map(f => f.id);\n      const uniqueIds = new Set(ids);\n      expect(uniqueIds.size).toBe(ids.length);\n    });\n\n    it('should have page references for TechManual formulas', () => {\n      const allFormulas = [\n        ...WEIGHT_FORMULAS,\n        ...MOVEMENT_FORMULAS,\n        ...SLOT_FORMULAS,\n        ...HEAT_SINK_FORMULAS,\n        ...ARMOR_FORMULAS,\n      ];\n\n      const techManualFormulas = allFormulas.filter(f => f.source === 'TechManual');\n      for (const formula of techManualFormulas) {\n        // Page reference should exist for TechManual sourced formulas\n        expect(formula.pageReference).toBeDefined();\n      }\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\gyroCalculations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\heatSinkCalculations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\movementCalculations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\slotOperations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\construction\\techBaseValidation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\equipment\\equipmentListUtils.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1338,1341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1338,1341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .tonnage on an `any` value.","line":35,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":35,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .tonnage on an `any` value.","line":35,"column":90,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":35,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .tonnage on an `any` value.","line":38,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":38,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .tonnage on an `any` value.","line":38,"column":90,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":38,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .engineWeight on an `any` value.","line":41,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":41,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .tonnage on an `any` value.","line":47,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":47,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":83,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":83,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `error` typed value.","line":85,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":85,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4157,4160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4157,4160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4228,4231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4228,4231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4298,4301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4298,4301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5387,5390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5387,5390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5458,5461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5458,5461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6824,6827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6824,6827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6895,6898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6895,6898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":190,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":190,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `error` typed value.","line":192,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":192,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":211,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8558,8561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8558,8561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8629,8632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8629,8632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":230,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":230,"endColumn":97},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12150,12153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12150,12153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":295,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12221,12224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12221,12224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  getJumpJetEquipmentId,\r\n  getJumpJetEquipment,\r\n  createJumpJetEquipmentList,\r\n  filterOutJumpJets,\r\n  createInternalStructureEquipmentList,\r\n  filterOutInternalStructure,\r\n  createArmorEquipmentList,\r\n  filterOutArmorSlots,\r\n  getHeatSinkEquipmentId,\r\n  getHeatSinkEquipment,\r\n  createHeatSinkEquipmentList,\r\n  filterOutHeatSinks,\r\n  getEnhancementEquipmentId,\r\n  getEnhancementEquipment,\r\n  calculateEnhancementWeight,\r\n  calculateEnhancementSlots,\r\n  createEnhancementEquipmentList,\r\n  filterOutEnhancementEquipment,\r\n} from '@/utils/equipment/equipmentListUtils';\r\nimport { JumpJetType } from '@/utils/construction/movementCalculations';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { MovementEnhancementType } from '@/types/construction/MovementEnhancement';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport { MechLocation } from '@/types/construction/CriticalSlotAllocation';\r\n\r\n// Mock EquipmentCalculatorService\r\njest.mock('@/services/equipment/EquipmentCalculatorService', () => ({\r\n  equipmentCalculatorService: {\r\n    calculateProperties: jest.fn((id: string, params: any) => {\r\n      if (id === 'masc-is') {\r\n        return { weight: Math.ceil(params.tonnage / 20), criticalSlots: Math.ceil(params.tonnage / 20) };\r\n      }\r\n      if (id === 'masc-clan') {\r\n        return { weight: Math.ceil(params.tonnage / 25), criticalSlots: Math.ceil(params.tonnage / 25) };\r\n      }\r\n      if (id === 'supercharger') {\r\n        return { weight: Math.ceil(params.engineWeight / 10) * 0.5, criticalSlots: 1 };\r\n      }\r\n      if (id === 'tsm') {\r\n        return { weight: 0, criticalSlots: 6 };\r\n      }\r\n      if (id === 'partial-wing') {\r\n        return { weight: params.tonnage * 0.05, criticalSlots: 6 };\r\n      }\r\n      return { weight: 0, criticalSlots: 0 };\r\n    }),\r\n  },\r\n  VARIABLE_EQUIPMENT: {\r\n    MASC_IS: 'masc-is',\r\n    MASC_CLAN: 'masc-clan',\r\n    SUPERCHARGER: 'supercharger',\r\n    TSM: 'tsm',\r\n    PARTIAL_WING: 'partial-wing',\r\n  },\r\n}));\r\n\r\ndescribe('equipmentListUtils', () => {\r\n  describe('Jump Jet Functions', () => {\r\n    it('should get correct jump jet ID for light mech', () => {\r\n      expect(getJumpJetEquipmentId(30, JumpJetType.STANDARD)).toBe('jump-jet-light');\r\n      expect(getJumpJetEquipmentId(55, JumpJetType.STANDARD)).toBe('jump-jet-light');\r\n    });\r\n\r\n    it('should get correct jump jet ID for medium mech', () => {\r\n      expect(getJumpJetEquipmentId(56, JumpJetType.STANDARD)).toBe('jump-jet-medium');\r\n      expect(getJumpJetEquipmentId(85, JumpJetType.STANDARD)).toBe('jump-jet-medium');\r\n    });\r\n\r\n    it('should get correct jump jet ID for heavy mech', () => {\r\n      expect(getJumpJetEquipmentId(86, JumpJetType.STANDARD)).toBe('jump-jet-heavy');\r\n      expect(getJumpJetEquipmentId(100, JumpJetType.STANDARD)).toBe('jump-jet-heavy');\r\n    });\r\n\r\n    it('should get correct improved jump jet ID', () => {\r\n      expect(getJumpJetEquipmentId(50, JumpJetType.IMPROVED)).toBe('improved-jump-jet-light'); // 50 <= 55\r\n    });\r\n\r\n    it('should get jump jet equipment', () => {\r\n      const equip = getJumpJetEquipment(50, JumpJetType.STANDARD);\r\n      expect(equip).toBeDefined();\r\n      expect(equip?.id).toBe('jump-jet-light'); // 50 <= 55\r\n    });\r\n\r\n    it('should create jump jet equipment list', () => {\r\n      const list = createJumpJetEquipmentList(50, 3, JumpJetType.STANDARD);\r\n      \r\n      expect(list).toHaveLength(3);\r\n      expect(list[0].equipmentId).toBe('jump-jet-light'); // 50 <= 55\r\n      expect(list[0].category).toBe(EquipmentCategory.MOVEMENT);\r\n      expect(list[0].isRemovable).toBe(false);\r\n    });\r\n\r\n    it('should return empty list for zero jump MP', () => {\r\n      const list = createJumpJetEquipmentList(50, 0, JumpJetType.STANDARD);\r\n      expect(list).toHaveLength(0);\r\n    });\r\n\r\n    it('should filter out jump jets', () => {\r\n      const equipment = [\r\n        { equipmentId: 'jump-jet-light', name: 'Jump Jet' } as any,\r\n        { equipmentId: 'medium-laser', name: 'Medium Laser' } as any,\r\n        { equipmentId: 'jump-jet-medium', name: 'Jump Jet' } as any,\r\n      ];\r\n      \r\n      const filtered = filterOutJumpJets(equipment);\r\n      expect(filtered).toHaveLength(1);\r\n      expect(filtered[0].equipmentId).toBe('medium-laser');\r\n    });\r\n  });\r\n\r\n  describe('Internal Structure Functions', () => {\r\n    it('should create internal structure equipment list', () => {\r\n      const list = createInternalStructureEquipmentList(InternalStructureType.ENDO_STEEL_IS);\r\n      \r\n      expect(list.length).toBeGreaterThan(0);\r\n      expect(list[0].equipmentId).toContain('internal-structure-slot');\r\n      expect(list[0].category).toBe(EquipmentCategory.STRUCTURAL);\r\n      expect(list[0].criticalSlots).toBe(1);\r\n      expect(list[0].isRemovable).toBe(false);\r\n    });\r\n\r\n    it('should return empty list for standard structure', () => {\r\n      const list = createInternalStructureEquipmentList(InternalStructureType.STANDARD);\r\n      expect(list).toHaveLength(0);\r\n    });\r\n\r\n    it('should filter out internal structure', () => {\r\n      const equipment = [\r\n        { equipmentId: 'internal-structure-slot-Endo Steel IS', name: 'Endo Steel' } as any,\r\n        { equipmentId: 'medium-laser', name: 'Medium Laser' } as any,\r\n      ];\r\n      \r\n      const filtered = filterOutInternalStructure(equipment);\r\n      expect(filtered).toHaveLength(1);\r\n      expect(filtered[0].equipmentId).toBe('medium-laser');\r\n    });\r\n  });\r\n\r\n  describe('Armor Functions', () => {\r\n    it('should create armor equipment list for Ferro-Fibrous', () => {\r\n      const list = createArmorEquipmentList(ArmorTypeEnum.FERRO_FIBROUS_IS);\r\n      \r\n      expect(list.length).toBeGreaterThan(0);\r\n      expect(list[0].equipmentId).toContain('armor-slot');\r\n      expect(list[0].category).toBe(EquipmentCategory.STRUCTURAL);\r\n      expect(list[0].criticalSlots).toBe(1);\r\n      expect(list[0].isRemovable).toBe(false);\r\n    });\r\n\r\n    it('should create stealth armor with fixed locations', () => {\r\n      const list = createArmorEquipmentList(ArmorTypeEnum.STEALTH);\r\n      \r\n      expect(list).toHaveLength(6);\r\n      expect(list[0].criticalSlots).toBe(2);\r\n      expect(list[0].location).toBeDefined();\r\n      expect(list[0].location).toBe(MechLocation.LEFT_ARM);\r\n    });\r\n\r\n    it('should return empty list for standard armor', () => {\r\n      const list = createArmorEquipmentList(ArmorTypeEnum.STANDARD);\r\n      expect(list).toHaveLength(0);\r\n    });\r\n\r\n    it('should filter out armor slots', () => {\r\n      const equipment = [\r\n        { equipmentId: 'armor-slot-Ferro-Fibrous', name: 'Ferro-Fibrous' } as any,\r\n        { equipmentId: 'medium-laser', name: 'Medium Laser' } as any,\r\n      ];\r\n      \r\n      const filtered = filterOutArmorSlots(equipment);\r\n      expect(filtered).toHaveLength(1);\r\n      expect(filtered[0].equipmentId).toBe('medium-laser');\r\n    });\r\n  });\r\n\r\n  describe('Heat Sink Functions', () => {\r\n    it('should get heat sink equipment ID', () => {\r\n      expect(getHeatSinkEquipmentId(HeatSinkType.SINGLE)).toBe('single-heat-sink');\r\n      expect(getHeatSinkEquipmentId(HeatSinkType.DOUBLE_IS)).toBe('double-heat-sink');\r\n      expect(getHeatSinkEquipmentId(HeatSinkType.DOUBLE_CLAN)).toBe('clan-double-heat-sink');\r\n      expect(getHeatSinkEquipmentId(HeatSinkType.COMPACT)).toBe('compact-heat-sink');\r\n      expect(getHeatSinkEquipmentId(HeatSinkType.LASER)).toBe('laser-heat-sink');\r\n    });\r\n\r\n    it('should get heat sink equipment', () => {\r\n      const equip = getHeatSinkEquipment(HeatSinkType.DOUBLE_IS);\r\n      expect(equip).toBeDefined();\r\n      expect(equip?.id).toBe('double-heat-sink');\r\n    });\r\n\r\n    it('should create heat sink equipment list', () => {\r\n      const list = createHeatSinkEquipmentList(HeatSinkType.DOUBLE_IS, 5);\r\n      \r\n      expect(list).toHaveLength(5);\r\n      expect(list[0].equipmentId).toBe('double-heat-sink');\r\n      expect(list[0].category).toBe(EquipmentCategory.MISC_EQUIPMENT);\r\n      expect(list[0].isRemovable).toBe(false);\r\n    });\r\n\r\n    it('should return empty list for zero external heat sinks', () => {\r\n      const list = createHeatSinkEquipmentList(HeatSinkType.DOUBLE_IS, 0);\r\n      expect(list).toHaveLength(0);\r\n    });\r\n\r\n    it('should filter out heat sinks', () => {\r\n      const equipment = [\r\n        { equipmentId: 'double-heat-sink', name: 'DHS' } as any,\r\n        { equipmentId: 'medium-laser', name: 'Medium Laser' } as any,\r\n      ];\r\n      \r\n      const filtered = filterOutHeatSinks(equipment);\r\n      expect(filtered).toHaveLength(1);\r\n      expect(filtered[0].equipmentId).toBe('medium-laser');\r\n    });\r\n  });\r\n\r\n  describe('Enhancement Functions', () => {\r\n    it('should get enhancement equipment ID', () => {\r\n      expect(getEnhancementEquipmentId(MovementEnhancementType.MASC, TechBase.INNER_SPHERE)).toBe('masc');\r\n      expect(getEnhancementEquipmentId(MovementEnhancementType.MASC, TechBase.CLAN)).toBe('clan-masc');\r\n      expect(getEnhancementEquipmentId(MovementEnhancementType.SUPERCHARGER, TechBase.INNER_SPHERE)).toBe('supercharger');\r\n      expect(getEnhancementEquipmentId(MovementEnhancementType.TSM, TechBase.INNER_SPHERE)).toBe('tsm');\r\n    });\r\n\r\n    it('should get enhancement equipment', () => {\r\n      const equip = getEnhancementEquipment(MovementEnhancementType.MASC, TechBase.INNER_SPHERE);\r\n      expect(equip).toBeDefined();\r\n    });\r\n\r\n    it('should calculate MASC weight for IS', () => {\r\n      const weight = calculateEnhancementWeight(MovementEnhancementType.MASC, 85, TechBase.INNER_SPHERE, 5);\r\n      expect(weight).toBe(5); // ceil(85/20) = 5\r\n    });\r\n\r\n    it('should calculate MASC weight for Clan', () => {\r\n      const weight = calculateEnhancementWeight(MovementEnhancementType.MASC, 85, TechBase.CLAN, 5);\r\n      expect(weight).toBe(4); // ceil(85/25) = 4\r\n    });\r\n\r\n    it('should calculate Supercharger weight', () => {\r\n      const weight = calculateEnhancementWeight(MovementEnhancementType.SUPERCHARGER, 85, TechBase.INNER_SPHERE, 5);\r\n      expect(weight).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should calculate TSM weight (zero)', () => {\r\n      const weight = calculateEnhancementWeight(MovementEnhancementType.TSM, 85, TechBase.INNER_SPHERE, 5);\r\n      expect(weight).toBe(0);\r\n    });\r\n\r\n    it('should calculate MASC slots for IS', () => {\r\n      const slots = calculateEnhancementSlots(MovementEnhancementType.MASC, 85, TechBase.INNER_SPHERE, 5);\r\n      expect(slots).toBe(5);\r\n    });\r\n\r\n    it('should calculate Supercharger slots (fixed 1)', () => {\r\n      const slots = calculateEnhancementSlots(MovementEnhancementType.SUPERCHARGER, 85, TechBase.INNER_SPHERE, 5);\r\n      expect(slots).toBe(1);\r\n    });\r\n\r\n    it('should calculate TSM slots (6)', () => {\r\n      const slots = calculateEnhancementSlots(MovementEnhancementType.TSM, 85, TechBase.INNER_SPHERE, 5);\r\n      expect(slots).toBe(6);\r\n    });\r\n\r\n    it('should create MASC equipment list', () => {\r\n      const list = createEnhancementEquipmentList(MovementEnhancementType.MASC, 85, TechBase.INNER_SPHERE, 5);\r\n      \r\n      expect(list).toHaveLength(1);\r\n      expect(list[0].equipmentId).toBe('masc');\r\n      expect(list[0].weight).toBeGreaterThan(0);\r\n      expect(list[0].isRemovable).toBe(false);\r\n    });\r\n\r\n    it('should create TSM equipment list with 6 slots', () => {\r\n      const list = createEnhancementEquipmentList(MovementEnhancementType.TSM, 85, TechBase.INNER_SPHERE, 5);\r\n      \r\n      expect(list).toHaveLength(6);\r\n      expect(list[0].equipmentId).toBe('tsm');\r\n      expect(list[0].criticalSlots).toBe(1);\r\n      expect(list[0].weight).toBe(0);\r\n    });\r\n\r\n    it('should return empty list for null enhancement', () => {\r\n      const list = createEnhancementEquipmentList(null, 85, TechBase.INNER_SPHERE, 5);\r\n      expect(list).toHaveLength(0);\r\n    });\r\n\r\n    it('should filter out enhancement equipment', () => {\r\n      const equipment = [\r\n        { equipmentId: 'masc', name: 'MASC' } as any,\r\n        { equipmentId: 'medium-laser', name: 'Medium Laser' } as any,\r\n      ];\r\n      \r\n      const filtered = filterOutEnhancementEquipment(equipment);\r\n      expect(filtered).toHaveLength(1);\r\n      expect(filtered[0].equipmentId).toBe('medium-laser');\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\physical\\criticalSlotUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\physical\\weightUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\rulesLevel\\rulesLevelUtils.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RULES_LEVEL_ORDER' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  getRulesLevelIndex,\r\n  compareRulesLevels,\r\n  isWithinRulesLevel,\r\n  getAllowedRulesLevels,\r\n  getMostRestrictiveLevel,\r\n  getLeastRestrictiveLevel,\r\n  filterByRulesLevel,\r\n  getRulesLevelDisplayName,\r\n  getRulesLevelDescription,\r\n  RULES_LEVEL_ORDER,\r\n} from '@/utils/rulesLevel/rulesLevelUtils';\r\nimport { RulesLevel } from '@/types/enums/RulesLevel';\r\n\r\ndescribe('rulesLevelUtils', () => {\r\n  describe('getRulesLevelIndex()', () => {\r\n    it('should return correct index for each level', () => {\r\n      expect(getRulesLevelIndex(RulesLevel.INTRODUCTORY)).toBe(0);\r\n      expect(getRulesLevelIndex(RulesLevel.STANDARD)).toBe(1);\r\n      expect(getRulesLevelIndex(RulesLevel.ADVANCED)).toBe(2);\r\n      expect(getRulesLevelIndex(RulesLevel.EXPERIMENTAL)).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe('compareRulesLevels()', () => {\r\n    it('should return negative when first is less restrictive', () => {\r\n      expect(compareRulesLevels(RulesLevel.INTRODUCTORY, RulesLevel.STANDARD)).toBeLessThan(0);\r\n    });\r\n\r\n    it('should return positive when first is more restrictive', () => {\r\n      expect(compareRulesLevels(RulesLevel.ADVANCED, RulesLevel.STANDARD)).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should return zero when equal', () => {\r\n      expect(compareRulesLevels(RulesLevel.STANDARD, RulesLevel.STANDARD)).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('isWithinRulesLevel()', () => {\r\n    it('should return true when level is at or below max', () => {\r\n      expect(isWithinRulesLevel(RulesLevel.INTRODUCTORY, RulesLevel.STANDARD)).toBe(true);\r\n      expect(isWithinRulesLevel(RulesLevel.STANDARD, RulesLevel.STANDARD)).toBe(true);\r\n    });\r\n\r\n    it('should return false when level exceeds max', () => {\r\n      expect(isWithinRulesLevel(RulesLevel.ADVANCED, RulesLevel.STANDARD)).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('getAllowedRulesLevels()', () => {\r\n    it('should return all levels at or below max', () => {\r\n      const allowed = getAllowedRulesLevels(RulesLevel.STANDARD);\r\n      expect(allowed).toContain(RulesLevel.INTRODUCTORY);\r\n      expect(allowed).toContain(RulesLevel.STANDARD);\r\n      expect(allowed).not.toContain(RulesLevel.ADVANCED);\r\n    });\r\n  });\r\n\r\n  describe('getMostRestrictiveLevel()', () => {\r\n    it('should return most restrictive level', () => {\r\n      const levels = [RulesLevel.INTRODUCTORY, RulesLevel.ADVANCED, RulesLevel.STANDARD];\r\n      expect(getMostRestrictiveLevel(levels)).toBe(RulesLevel.ADVANCED);\r\n    });\r\n\r\n    it('should return INTRODUCTORY for empty array', () => {\r\n      expect(getMostRestrictiveLevel([])).toBe(RulesLevel.INTRODUCTORY);\r\n    });\r\n  });\r\n\r\n  describe('getLeastRestrictiveLevel()', () => {\r\n    it('should return least restrictive level', () => {\r\n      const levels = [RulesLevel.ADVANCED, RulesLevel.INTRODUCTORY, RulesLevel.STANDARD];\r\n      expect(getLeastRestrictiveLevel(levels)).toBe(RulesLevel.INTRODUCTORY);\r\n    });\r\n\r\n    it('should return EXPERIMENTAL for empty array', () => {\r\n      expect(getLeastRestrictiveLevel([])).toBe(RulesLevel.EXPERIMENTAL);\r\n    });\r\n  });\r\n\r\n  describe('filterByRulesLevel()', () => {\r\n    it('should filter entities by max rules level', () => {\r\n      const entities = [\r\n        { rulesLevel: RulesLevel.INTRODUCTORY, name: 'A' },\r\n        { rulesLevel: RulesLevel.ADVANCED, name: 'B' },\r\n        { rulesLevel: RulesLevel.STANDARD, name: 'C' },\r\n      ];\r\n      \r\n      const filtered = filterByRulesLevel(entities, RulesLevel.STANDARD);\r\n      expect(filtered.length).toBe(2);\r\n      expect(filtered).toContainEqual(entities[0]);\r\n      expect(filtered).toContainEqual(entities[2]);\r\n    });\r\n  });\r\n\r\n  describe('getRulesLevelDisplayName()', () => {\r\n    it('should return display name', () => {\r\n      expect(getRulesLevelDisplayName(RulesLevel.STANDARD)).toBe(RulesLevel.STANDARD);\r\n    });\r\n  });\r\n\r\n  describe('getRulesLevelDescription()', () => {\r\n    it('should return description for each level', () => {\r\n      expect(getRulesLevelDescription(RulesLevel.INTRODUCTORY)).toContain('Basic rules');\r\n      expect(getRulesLevelDescription(RulesLevel.STANDARD)).toContain('Full BattleTech');\r\n      expect(getRulesLevelDescription(RulesLevel.ADVANCED)).toContain('Complex rules');\r\n      expect(getRulesLevelDescription(RulesLevel.EXPERIMENTAL)).toContain('Cutting-edge');\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\serialization\\DataIntegrityValidator.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\serialization\\UnitSerializer.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[507,510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[507,510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any`.","line":14,"column":48,"nodeType":"ObjectExpression","messageId":"unsafeReturn","endLine":68,"endColumn":4},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":72,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":72,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":80,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":80,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":84,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":84,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .formatVersion on an `any` value.","line":85,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":85,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":90,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":90,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":94,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":94,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .application on an `any` value.","line":95,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":95,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .application on an `any` value.","line":96,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":96,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":101,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":101,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":105,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":105,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .unit on an `any` value.","line":106,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":106,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .unit on an `any` value.","line":107,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":107,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .unit on an `any` value.","line":108,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":108,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":113,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":113,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":117,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":117,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .unit on an `any` value.","line":118,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":118,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .unit on an `any` value.","line":119,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":119,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":124,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":124,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":128,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":128,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .unit on an `any` value.","line":129,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":129,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .unit on an `any` value.","line":130,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":130,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":135,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":135,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3807,3810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3807,3810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":145,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":145,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":176,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":176,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'patch' is assigned a value but never used.","line":198,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":198,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":224,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":224,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":232,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":232,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":243,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":243,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":31,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  serializeUnit,\n  validateSerializedFormat,\n  getSerializedFormatVersion,\n  isFormatVersionSupported,\n  createUnitSerializer,\n} from '@/utils/serialization/UnitSerializer';\nimport { CURRENT_FORMAT_VERSION } from '@/types/unit/UnitSerialization';\nimport { TechBase } from '@/types/enums/TechBase';\nimport { RulesLevel } from '@/types/enums/RulesLevel';\nimport { MechConfiguration } from '@/types/unit/BattleMechInterfaces';\n\ndescribe('UnitSerializer', () => {\n  const createMockUnit = (overrides?: any) => ({\n    id: 'test-unit',\n    unitType: 'BattleMech',\n    configuration: MechConfiguration.BIPED,\n    techBase: TechBase.INNER_SPHERE,\n    rulesLevel: RulesLevel.STANDARD,\n    tonnage: 50,\n    metadata: {\n      chassis: 'Test',\n      model: 'TST-1',\n      variant: 'TST-1',\n      era: 'AGE_OF_WAR',\n      year: 2750,\n    },\n    engine: {\n      type: 'Standard Fusion',\n      rating: 250,\n    },\n    gyro: {\n      type: 'Standard',\n    },\n    cockpitType: 'Standard',\n    structure: {\n      type: 'Standard',\n    },\n    armorType: 'Standard',\n    armorAllocation: {\n      head: 9,\n      centerTorso: 16,\n      centerTorsoRear: 5,\n      leftTorso: 12,\n      leftTorsoRear: 4,\n      rightTorso: 12,\n      rightTorsoRear: 4,\n      leftArm: 8,\n      rightArm: 8,\n      leftLeg: 12,\n      rightLeg: 12,\n    },\n    heatSinks: {\n      type: 'Single',\n      total: 10,\n    },\n    movement: {\n      walkMP: 5,\n      jumpMP: 0,\n      jumpJetType: null,\n      hasMASC: false,\n      hasSupercharger: false,\n      hasTSM: false,\n    },\n    equipment: [],\n    criticalSlots: [],\n    ...overrides,\n  });\n\n  describe('serializeUnit()', () => {\n    it('should serialize unit to JSON', () => {\n      const unit = createMockUnit();\n      const result = serializeUnit(unit);\n      \n      expect(result.success).toBe(true);\n      expect(result.data).toBeDefined();\n    });\n\n    it('should include format version in envelope', () => {\n      const unit = createMockUnit();\n      const result = serializeUnit(unit);\n      \n      if (result.success && result.data) {\n        const envelope = JSON.parse(result.data);\n        expect(envelope.formatVersion).toBe(CURRENT_FORMAT_VERSION);\n      }\n    });\n\n    it('should include application info in envelope', () => {\n      const unit = createMockUnit();\n      const result = serializeUnit(unit);\n      \n      if (result.success && result.data) {\n        const envelope = JSON.parse(result.data);\n        expect(envelope.application).toBeDefined();\n        expect(envelope.application.name).toBe('BattleTech Editor');\n      }\n    });\n\n    it('should serialize unit metadata', () => {\n      const unit = createMockUnit();\n      const result = serializeUnit(unit);\n      \n      if (result.success && result.data) {\n        const envelope = JSON.parse(result.data);\n        expect(envelope.unit.chassis).toBe('Test');\n        expect(envelope.unit.model).toBe('TST-1');\n        expect(envelope.unit.variant).toBe('TST-1');\n      }\n    });\n\n    it('should serialize engine data', () => {\n      const unit = createMockUnit();\n      const result = serializeUnit(unit);\n      \n      if (result.success && result.data) {\n        const envelope = JSON.parse(result.data);\n        expect(envelope.unit.engine.type).toBe('Standard Fusion');\n        expect(envelope.unit.engine.rating).toBe(250);\n      }\n    });\n\n    it('should serialize armor allocation', () => {\n      const unit = createMockUnit();\n      const result = serializeUnit(unit);\n      \n      if (result.success && result.data) {\n        const envelope = JSON.parse(result.data);\n        expect(envelope.unit.armor.allocation.head).toBe(9);\n        expect(envelope.unit.armor.allocation.centerTorso).toBe(16);\n      }\n    });\n\n    it('should handle errors during serialization', () => {\n      const invalidUnit = null as any;\n      const result = serializeUnit(invalidUnit);\n      \n      expect(result.success).toBe(false);\n      expect(result.errors.length).toBeGreaterThan(0);\n    });\n  });\n\n  describe('validateSerializedFormat()', () => {\n    it('should validate correct format', () => {\n      const unit = createMockUnit();\n      const serialized = serializeUnit(unit);\n      \n      if (serialized.success && serialized.data) {\n        const validation = validateSerializedFormat(serialized.data);\n        expect(validation.isValid).toBe(true);\n      }\n    });\n\n    it('should reject invalid JSON', () => {\n      const validation = validateSerializedFormat('invalid json');\n      expect(validation.isValid).toBe(false);\n    });\n\n    it('should reject missing envelope', () => {\n      const validation = validateSerializedFormat('{}');\n      expect(validation.isValid).toBe(false);\n    });\n\n    it('should reject missing unit data', () => {\n      const envelope = {\n        formatVersion: CURRENT_FORMAT_VERSION,\n        application: { name: 'Test', version: '1.0.0' },\n      };\n      const validation = validateSerializedFormat(JSON.stringify(envelope));\n      expect(validation.isValid).toBe(false);\n    });\n  });\n\n  describe('getSerializedFormatVersion()', () => {\n    it('should extract format version from valid data', () => {\n      const unit = createMockUnit();\n      const serialized = serializeUnit(unit);\n      \n      if (serialized.success && serialized.data) {\n        const version = getSerializedFormatVersion(serialized.data);\n        expect(version).toBe(CURRENT_FORMAT_VERSION);\n      }\n    });\n\n    it('should return null for invalid data', () => {\n      const version = getSerializedFormatVersion('invalid');\n      expect(version).toBeNull();\n    });\n  });\n\n  describe('isFormatVersionSupported()', () => {\n    it('should support current format version', () => {\n      const supported = isFormatVersionSupported(CURRENT_FORMAT_VERSION);\n      expect(supported).toBe(true);\n    });\n\n    it('should support same major version', () => {\n      const [major, minor, patch] = CURRENT_FORMAT_VERSION.split('.');\n      const sameMajor = `${major}.${parseInt(minor) + 1}.0`;\n      const supported = isFormatVersionSupported(sameMajor);\n      expect(supported).toBe(true);\n    });\n\n    it('should not support different major version', () => {\n      const [major] = CURRENT_FORMAT_VERSION.split('.');\n      const differentMajor = `${parseInt(major) + 1}.0.0`;\n      const supported = isFormatVersionSupported(differentMajor);\n      expect(supported).toBe(false);\n    });\n  });\n\n  describe('createUnitSerializer()', () => {\n    it('should create serializer instance', () => {\n      const serializer = createUnitSerializer();\n      expect(serializer).toBeDefined();\n      expect(serializer.serialize).toBeDefined();\n      expect(serializer.deserialize).toBeDefined();\n      expect(serializer.validateFormat).toBeDefined();\n      expect(serializer.getFormatVersion).toBeDefined();\n    });\n\n    it('should serialize unit', () => {\n      const serializer = createUnitSerializer();\n      const unit = createMockUnit();\n      const result = serializer.serialize(unit);\n      \n      expect(result.success).toBe(true);\n    });\n\n    it('should validate format', () => {\n      const serializer = createUnitSerializer();\n      const unit = createMockUnit();\n      const serialized = serializer.serialize(unit);\n      \n      if (serialized.success && serialized.data) {\n        const validation = serializer.validateFormat(serialized.data);\n        expect(validation.isValid).toBe(true);\n      }\n    });\n\n    it('should get format version', () => {\n      const serializer = createUnitSerializer();\n      const unit = createMockUnit();\n      const serialized = serializer.serialize(unit);\n      \n      if (serialized.success && serialized.data) {\n        const version = serializer.getFormatVersion(serialized.data);\n        expect(version).toBe(CURRENT_FORMAT_VERSION);\n      }\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\techBaseValidation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\temporal\\availabilityUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\temporal\\eraUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\typeGuards.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\uuid.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\validation\\rules\\StandardValidationRules.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\unit\\utils\\weightClass\\weightClassUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\__tests__\\utils\\construction\\armorAutoAllocation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\common\\CategoryNavigation.tsx","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":22,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":22,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\n\ninterface CategoryNavigationProps {\n  selectedCategory: string | null;\n  onSelectCategory: (category: string | null) => void;\n}\n\nconst CategoryNavigation: React.FC<CategoryNavigationProps> = ({ selectedCategory, onSelectCategory }) => {\n  const [categories, setCategories] = useState<string[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchCategories = async () => {\n      setIsLoading(true);\n      setError(null);\n      try {\n        const response = await fetch('/api/meta/categories');\n        if (!response.ok) {\n          throw new Error(`Failed to fetch categories: ${response.statusText}`);\n        }\n        const data = await response.json();\n        setCategories(data);\n      } catch (err) {\n        console.error(err);\n        setError(err instanceof Error ? err.message : 'An unknown error occurred');\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchCategories();\n  }, []);\n\n  if (isLoading) {\n    return <div className=\"p-4\">Loading categories...</div>;\n  }\n\n  if (error) {\n    return <div className=\"p-4 text-red-500\">Error: {error}</div>;\n  }\n\n  return (\n    <nav className=\"p-4 bg-gray-100 w-full md:w-64 h-full\">\n      <h3 className=\"text-lg font-semibold mb-2\">Unit Categories</h3>\n      <ul>\n        {/* Option to select all/clear filter */}\n        <li key=\"all-categories\" className=\"mb-1\">\n          <button\n            onClick={() => onSelectCategory(null)}\n            className={`w-full text-left px-2 py-1 rounded ${\n              selectedCategory === null ? 'bg-blue-500 text-white' : 'hover:bg-gray-200'\n            }`}\n          >\n            All Units\n          </button>\n        </li>\n        {categories.map((category) => (\n          <li key={category} className=\"mb-1\">\n            <button\n              onClick={() => onSelectCategory(category)}\n              className={`w-full text-left px-2 py-1 rounded ${\n                selectedCategory === category ? 'bg-blue-500 text-white' : 'hover:bg-gray-200'\n              }`}\n            >\n              {category}\n            </button>\n          </li>\n        ))}\n      </ul>\n    </nav>\n  );\n};\n\nexport default CategoryNavigation;\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\common\\ControlledInput.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":38,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":38,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isFocused' is assigned a value but never used.","line":65,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":19},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":304,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":304,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'debounceMs' is assigned a value but never used. Allowed unused args must match /^_/u.","line":307,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":307,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":347,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":347,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10115,10118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10115,10118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":349,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10183,10186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10183,10186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":351,"column":10,"nodeType":"FunctionExpression","messageId":"missingReturnType","endLine":351,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Controlled Input Component - Real-time validation and state management\n * Implements the documented UI consistency patterns\n */\n\nimport React, { useState, useCallback, useEffect, useRef } from 'react'\n\nexport interface ValidationResult {\n  isValid: boolean\n  error?: string\n  warning?: string\n}\n\nexport interface ControlledInputProps<T = string> {\n  value: T\n  onChange: (value: T) => void\n  validation?: (value: T) => ValidationResult\n  onValidationChange?: (result: ValidationResult) => void\n  debounceMs?: number\n  placeholder?: string\n  label?: string\n  type?: 'text' | 'number' | 'email' | 'password'\n  disabled?: boolean\n  required?: boolean\n  className?: string\n  errorClassName?: string\n  warningClassName?: string\n  successClassName?: string\n  showValidation?: boolean\n  autoFocus?: boolean\n  onBlur?: () => void\n  onFocus?: () => void\n  onKeyDown?: (event: React.KeyboardEvent) => void\n  onKeyUp?: (event: React.KeyboardEvent) => void\n  onKeyPress?: (event: React.KeyboardEvent) => void\n}\n\nexport function ControlledInput<T = string>({\n  value,\n  onChange,\n  validation,\n  onValidationChange,\n  debounceMs = 300,\n  placeholder,\n  label,\n  type = 'text',\n  disabled = false,\n  required = false,\n  className = '',\n  errorClassName = 'border-red-500 focus:border-red-500 focus:ring-red-500',\n  warningClassName = 'border-yellow-500 focus:border-yellow-500 focus:ring-yellow-500',\n  successClassName = 'border-green-500 focus:border-green-500 focus:ring-green-500',\n  showValidation = true,\n  autoFocus = false,\n  onBlur,\n  onFocus,\n  onKeyDown,\n  onKeyUp,\n  onKeyPress,\n  ...props\n}: ControlledInputProps<T>) {\n  const [localValue, setLocalValue] = useState<T>(value)\n  const [validationResult, setValidationResult] = useState<ValidationResult>({ isValid: true })\n  const [isDirty, setIsDirty] = useState(false)\n  const [isFocused, setIsFocused] = useState(false)\n  const debounceTimeoutRef = useRef<NodeJS.Timeout | null>(null)\n  const inputRef = useRef<HTMLInputElement>(null)\n\n  // CRITICAL: Sync with external value changes\n  useEffect(() => {\n    setLocalValue(value)\n  }, [value])\n\n  // CRITICAL: Validate on value change\n  useEffect(() => {\n    if (validation) {\n      const result = validation(localValue)\n      setValidationResult(result)\n      \n      if (onValidationChange) {\n        onValidationChange(result)\n      }\n    }\n  }, [localValue, validation, onValidationChange])\n\n  // CRITICAL: Debounced onChange handler\n  const debouncedOnChange = useCallback((newValue: T) => {\n    if (debounceTimeoutRef.current) {\n      clearTimeout(debounceTimeoutRef.current)\n    }\n\n    debounceTimeoutRef.current = setTimeout(() => {\n      onChange(newValue)\n    }, debounceMs)\n  }, [onChange, debounceMs])\n\n  // CRITICAL: Handle input change\n  const handleChange = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = type === 'number' ? Number(event.target.value) as T : event.target.value as T\n    setLocalValue(newValue)\n    setIsDirty(true)\n    \n    // CRITICAL: Only call onChange if validation passes or no validation\n    if (!validation || validation(newValue).isValid) {\n      debouncedOnChange(newValue)\n    }\n  }, [type, validation, debouncedOnChange])\n\n  // CRITICAL: Handle input blur\n  const handleBlur = useCallback(() => {\n    setIsFocused(false)\n    \n    // CRITICAL: Force validation on blur\n    if (validation) {\n      const result = validation(localValue)\n      setValidationResult(result)\n      \n      if (onValidationChange) {\n        onValidationChange(result)\n      }\n    }\n    \n    // CRITICAL: Call onChange on blur if value is valid\n    if (!validation || validation(localValue).isValid) {\n      onChange(localValue)\n    }\n    \n    if (onBlur) {\n      onBlur()\n    }\n  }, [localValue, validation, onValidationChange, onChange, onBlur])\n\n  // CRITICAL: Handle input focus\n  const handleFocus = useCallback(() => {\n    setIsFocused(true)\n    if (onFocus) {\n      onFocus()\n    }\n  }, [onFocus])\n\n  // CRITICAL: Handle key events\n  const handleKeyDown = useCallback((event: React.KeyboardEvent) => {\n    if (onKeyDown) {\n      onKeyDown(event)\n    }\n  }, [onKeyDown])\n\n  const handleKeyUp = useCallback((event: React.KeyboardEvent) => {\n    if (onKeyUp) {\n      onKeyUp(event)\n    }\n  }, [onKeyUp])\n\n  const handleKeyPress = useCallback((event: React.KeyboardEvent) => {\n    if (onKeyPress) {\n      onKeyPress(event)\n    }\n  }, [onKeyPress])\n\n  // CRITICAL: Get dynamic styling based on validation state\n  const getInputClassName = useCallback((): string => {\n    const baseClasses = 'w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-opacity-50 transition-colors'\n    \n    if (disabled) {\n      return `${baseClasses} bg-gray-100 text-gray-500 cursor-not-allowed`\n    }\n    \n    if (!showValidation || !isDirty) {\n      return `${baseClasses} border-gray-300 focus:border-blue-500 focus:ring-blue-500 ${className}`\n    }\n    \n    if (!validationResult.isValid) {\n      return `${baseClasses} ${errorClassName} ${className}`\n    }\n    \n    if (validationResult.warning) {\n      return `${baseClasses} ${warningClassName} ${className}`\n    }\n    \n    if (isDirty && validationResult.isValid) {\n      return `${baseClasses} ${successClassName} ${className}`\n    }\n    \n    return `${baseClasses} border-gray-300 focus:border-blue-500 focus:ring-blue-500 ${className}`\n  }, [\n    disabled,\n    showValidation,\n    isDirty,\n    validationResult,\n    className,\n    errorClassName,\n    warningClassName,\n    successClassName\n  ])\n\n  // CRITICAL: Get validation message\n  const getValidationMessage = useCallback((): string | null => {\n    if (!showValidation || !isDirty) return null\n    \n    if (!validationResult.isValid && validationResult.error) {\n      return validationResult.error\n    }\n    \n    if (validationResult.warning) {\n      return validationResult.warning\n    }\n    \n    return null\n  }, [showValidation, isDirty, validationResult])\n\n  // CRITICAL: Get validation icon\n  const getValidationIcon = useCallback(() => {\n    if (!showValidation || !isDirty) return null\n    \n    if (!validationResult.isValid) {\n      return (\n        <svg className=\"h-5 w-5 text-red-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\n        </svg>\n      )\n    }\n    \n    if (validationResult.warning) {\n      return (\n        <svg className=\"h-5 w-5 text-yellow-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\n        </svg>\n      )\n    }\n    \n    if (validationResult.isValid) {\n      return (\n        <svg className=\"h-5 w-5 text-green-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n        </svg>\n      )\n    }\n    \n    return null\n  }, [showValidation, isDirty, validationResult])\n\n  // CRITICAL: Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (debounceTimeoutRef.current) {\n        clearTimeout(debounceTimeoutRef.current)\n      }\n    }\n  }, [])\n\n  return (\n    <div className=\"space-y-1\">\n      {label && (\n        <label className=\"block text-sm font-medium text-gray-700\">\n          {label}\n          {required && <span className=\"text-red-500 ml-1\">*</span>}\n        </label>\n      )}\n      \n      <div className=\"relative\">\n        <input\n          ref={inputRef}\n          type={type}\n          value={localValue as string}\n          onChange={handleChange}\n          onBlur={handleBlur}\n          onFocus={handleFocus}\n          onKeyDown={handleKeyDown}\n          onKeyUp={handleKeyUp}\n          onKeyPress={handleKeyPress}\n          placeholder={placeholder}\n          disabled={disabled}\n          required={required}\n          autoFocus={autoFocus}\n          className={getInputClassName()}\n          {...props}\n        />\n        \n        {/* CRITICAL: Validation icon */}\n        {getValidationIcon() && (\n          <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\n            {getValidationIcon()}\n          </div>\n        )}\n      </div>\n      \n      {/* CRITICAL: Validation message */}\n      {getValidationMessage() && (\n        <p className={`text-sm ${\n          !validationResult.isValid \n            ? 'text-red-600' \n            : validationResult.warning \n              ? 'text-yellow-600' \n              : 'text-green-600'\n        }`}>\n          {getValidationMessage()}\n        </p>\n      )}\n    </div>\n  )\n}\n\n// CRITICAL: Hook for controlled input state management\nexport function useControlledInput<T = string>(\n  initialValue: T,\n  validation?: (value: T) => ValidationResult,\n  debounceMs: number = 300\n) {\n  const [value, setValue] = useState<T>(initialValue)\n  const [validationResult, setValidationResult] = useState<ValidationResult>({ isValid: true })\n  const [isDirty, setIsDirty] = useState(false)\n\n  // CRITICAL: Validate on value change\n  useEffect(() => {\n    if (validation) {\n      const result = validation(value)\n      setValidationResult(result)\n    }\n  }, [value, validation])\n\n  // CRITICAL: Handle value change\n  const handleChange = useCallback((newValue: T) => {\n    setValue(newValue)\n    setIsDirty(true)\n  }, [])\n\n  // CRITICAL: Reset state\n  const reset = useCallback(() => {\n    setValue(initialValue)\n    setValidationResult({ isValid: true })\n    setIsDirty(false)\n  }, [initialValue])\n\n  return {\n    value,\n    validationResult,\n    isDirty,\n    handleChange,\n    reset,\n    isValid: validationResult.isValid,\n    error: validationResult.error,\n    warning: validationResult.warning\n  }\n}\n\n// CRITICAL: Higher-order component for easy controlled input wrapping\nexport function withControlledInput<P extends { value?: any }>(\n  Component: React.ComponentType<P>,\n  validation?: (value: any) => ValidationResult\n) {\n  return function WithControlledInput(props: P) {\n    const controlledProps = useControlledInput(props.value || '', validation)\n    \n    return (\n      <Component\n        {...props}\n        {...controlledProps}\n      />\n    )\n  }\n} ","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\common\\CustomDropdown.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":12,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":12,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect } from 'react';\n\ninterface CustomDropdownProps {\n  value: string;\n  options: string[];\n  onChange: (value: string) => void;\n  disabled?: boolean;\n  className?: string;\n  placeholder?: string;\n}\n\nexport default function CustomDropdown({\n  value,\n  options,\n  onChange,\n  disabled = false,\n  className = '',\n  placeholder = 'Select...'\n}: CustomDropdownProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleSelect = (option: string) => {\n    onChange(option);\n    setIsOpen(false);\n  };\n\n  return (\n    <div ref={dropdownRef} className=\"relative\">\n      <button\n        type=\"button\"\n        onClick={() => !disabled && setIsOpen(!isOpen)}\n        disabled={disabled}\n        className={`\n          w-full px-2 py-1 bg-slate-700 border border-slate-600 rounded text-sm text-slate-100\n          flex items-center justify-between\n          ${disabled ? 'opacity-50 cursor-not-allowed' : 'hover:border-slate-500 cursor-pointer'}\n          ${isOpen ? 'border-blue-500' : ''}\n          ${className}\n        `}\n      >\n        <span>{value || placeholder}</span>\n        <svg \n          className={`w-4 h-4 transition-transform ${isOpen ? 'rotate-180' : ''}`}\n          fill=\"none\" \n          stroke=\"currentColor\" \n          viewBox=\"0 0 24 24\"\n        >\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n        </svg>\n      </button>\n\n      {isOpen && (\n        <div className=\"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded shadow-lg max-h-60 overflow-auto\">\n          {options.map((option) => (\n            <button\n              key={option}\n              type=\"button\"\n              onClick={() => handleSelect(option)}\n              className={`\n                w-full px-3 py-2 text-left text-sm\n                ${option === value \n                  ? 'bg-blue-600 text-white' \n                  : 'text-slate-100 hover:bg-slate-700'\n                }\n              `}\n            >\n              {option}\n            </button>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\common\\ErrorBoundary.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'recoverableErrors' is assigned a value but never used.","line":75,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":128,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":128,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":129,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":129,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .push on an `any` value.","line":129,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":129,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":132,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":132,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":133,"column":9,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":133,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .splice on an `any` value.","line":133,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":133,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":133,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":133,"endColumn":45},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":282,"column":10,"nodeType":"FunctionExpression","messageId":"missingReturnType","endLine":282,"endColumn":36},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":295,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":295,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Error Boundary Component - Comprehensive error handling for BattleTech Customizer\n * Implements the documented error handling patterns\n */\n\nimport React, { Component, ErrorInfo, ReactNode } from 'react'\n\ninterface ErrorBoundaryState {\n  hasError: boolean\n  error?: Error\n  errorInfo?: ErrorInfo\n  errorId?: string\n  canRecover: boolean\n  recoveryAttempts: number\n}\n\ninterface ErrorBoundaryProps {\n  children: ReactNode\n  fallback?: ReactNode\n  onError?: (error: Error, errorInfo: ErrorInfo) => void\n  maxRecoveryAttempts?: number\n  componentName?: string\n}\n\nexport class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  private static readonly MAX_RECOVERY_ATTEMPTS = 3\n\n  constructor(props: ErrorBoundaryProps) {\n    super(props)\n    this.state = {\n      hasError: false,\n      canRecover: true,\n      recoveryAttempts: 0\n    }\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<ErrorBoundaryState> {\n    // CRITICAL: Generate unique error ID for tracking\n    const errorId = `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n    \n    // CRITICAL: Determine if error is recoverable\n    const canRecover = ErrorBoundary.isRecoverableError(error)\n    \n    return {\n      hasError: true,\n      error,\n      errorId,\n      canRecover,\n      recoveryAttempts: 0\n    }\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    // CRITICAL: Log error for debugging\n    console.error(`[ErrorBoundary] Error caught in ${this.props.componentName || 'component'}:`, error)\n    console.error('[ErrorBoundary] Error info:', errorInfo)\n    \n    // CRITICAL: Call custom error handler if provided\n    if (this.props.onError) {\n      this.props.onError(error, errorInfo)\n    }\n    \n    // CRITICAL: Log error with unique ID for tracking\n    this.logError(error, errorInfo)\n    \n    // CRITICAL: Update state with error info\n    this.setState({\n      errorInfo,\n      canRecover: ErrorBoundary.isRecoverableError(error)\n    })\n  }\n\n  private static isRecoverableError(error: Error): boolean {\n    // CRITICAL: Determine if error is recoverable based on error type\n    const recoverableErrors = [\n      'TypeError',\n      'ReferenceError',\n      'RangeError'\n    ]\n    \n    const nonRecoverableErrors = [\n      'SyntaxError',\n      'URIError'\n    ]\n    \n    // CRITICAL: Check error name\n    if (nonRecoverableErrors.includes(error.name)) {\n      return false\n    }\n    \n    // CRITICAL: Check error message for specific patterns\n    const nonRecoverablePatterns = [\n      'Maximum call stack size exceeded',\n      'Out of memory',\n      'Invalid JSON',\n      'Unexpected token'\n    ]\n    \n    const errorMessage = error.message.toLowerCase()\n    if (nonRecoverablePatterns.some(pattern => errorMessage.includes(pattern.toLowerCase()))) {\n      return false\n    }\n    \n    return true\n  }\n\n  private logError(error: Error, errorInfo: ErrorInfo): void {\n    // CRITICAL: Log error with comprehensive information\n    const errorLog = {\n      timestamp: new Date().toISOString(),\n      errorId: this.state.errorId,\n      componentName: this.props.componentName || 'Unknown',\n      errorName: error.name,\n      errorMessage: error.message,\n      errorStack: error.stack,\n      componentStack: errorInfo.componentStack,\n      userAgent: navigator.userAgent,\n      url: window.location.href,\n      recoveryAttempts: this.state.recoveryAttempts\n    }\n    \n    // CRITICAL: Send to error logging service (if available)\n    try {\n      // This would integrate with an error logging service\n      console.error('[ErrorBoundary] Error log:', errorLog)\n      \n      // CRITICAL: Store in localStorage for debugging\n      const errorLogs = JSON.parse(localStorage.getItem('errorLogs') || '[]')\n      errorLogs.push(errorLog)\n      \n      // CRITICAL: Keep only last 10 errors\n      if (errorLogs.length > 10) {\n        errorLogs.splice(0, errorLogs.length - 10)\n      }\n      \n      localStorage.setItem('errorLogs', JSON.stringify(errorLogs))\n    } catch (logError) {\n      console.error('[ErrorBoundary] Failed to log error:', logError)\n    }\n  }\n\n  private handleRecovery = (): void => {\n    const maxAttempts = this.props.maxRecoveryAttempts || ErrorBoundary.MAX_RECOVERY_ATTEMPTS\n    \n    if (this.state.recoveryAttempts >= maxAttempts) {\n      console.error('[ErrorBoundary] Maximum recovery attempts reached')\n      this.setState({ canRecover: false })\n      return\n    }\n    \n    console.log(`[ErrorBoundary] Attempting recovery (attempt ${this.state.recoveryAttempts + 1})`)\n    \n    // CRITICAL: Attempt recovery by resetting state\n    this.setState(prevState => ({\n      hasError: false,\n      error: undefined,\n      errorInfo: undefined,\n      recoveryAttempts: prevState.recoveryAttempts + 1\n    }))\n  }\n\n  private handleReset = (): void => {\n    console.log('[ErrorBoundary] Resetting component state')\n    \n    // CRITICAL: Reset to initial state\n    this.setState({\n      hasError: false,\n      error: undefined,\n      errorInfo: undefined,\n      errorId: undefined,\n      canRecover: true,\n      recoveryAttempts: 0\n    })\n  }\n\n  private handleReportError = (): void => {\n    // CRITICAL: Generate error report for user\n    const errorReport = {\n      errorId: this.state.errorId,\n      componentName: this.props.componentName || 'Unknown',\n      errorMessage: this.state.error?.message || 'Unknown error',\n      timestamp: new Date().toISOString(),\n      userAgent: navigator.userAgent,\n      url: window.location.href\n    }\n    \n    // CRITICAL: Copy error report to clipboard\n    try {\n      navigator.clipboard.writeText(JSON.stringify(errorReport, null, 2))\n      alert('Error report copied to clipboard. Please include this in your bug report.')\n    } catch (clipboardError) {\n      console.error('[ErrorBoundary] Failed to copy error report:', clipboardError)\n      alert('Failed to copy error report. Please take a screenshot of this error.')\n    }\n  }\n\n  render(): ReactNode {\n    if (this.state.hasError) {\n      // CRITICAL: Custom fallback UI if provided\n      if (this.props.fallback) {\n        return this.props.fallback\n      }\n      \n      // CRITICAL: Default error UI\n      return (\n        <div className=\"error-boundary bg-red-50 border border-red-200 rounded-lg p-6 m-4\">\n          <div className=\"flex items-center mb-4\">\n            <div className=\"flex-shrink-0\">\n              <svg className=\"h-8 w-8 text-red-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\n              </svg>\n            </div>\n            <div className=\"ml-3\">\n              <h3 className=\"text-lg font-medium text-red-800\">\n                Something went wrong\n              </h3>\n              <p className=\"text-sm text-red-600\">\n                Error ID: {this.state.errorId}\n              </p>\n            </div>\n          </div>\n          \n          <div className=\"mb-4\">\n            <p className=\"text-sm text-red-700\">\n              {this.state.error?.message || 'An unexpected error occurred'}\n            </p>\n            {this.props.componentName && (\n              <p className=\"text-xs text-red-600 mt-1\">\n                Component: {this.props.componentName}\n              </p>\n            )}\n          </div>\n          \n          <div className=\"flex space-x-3\">\n            {this.state.canRecover && (\n              <button\n                onClick={this.handleRecovery}\n                className=\"bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700 transition-colors\"\n              >\n                Try Again ({this.state.recoveryAttempts + 1}/{this.props.maxRecoveryAttempts || ErrorBoundary.MAX_RECOVERY_ATTEMPTS})\n              </button>\n            )}\n            \n            <button\n              onClick={this.handleReset}\n              className=\"bg-gray-600 text-white px-4 py-2 rounded text-sm hover:bg-gray-700 transition-colors\"\n            >\n              Reset\n            </button>\n            \n            <button\n              onClick={this.handleReportError}\n              className=\"bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-colors\"\n            >\n              Report Error\n            </button>\n          </div>\n          \n          {process.env.NODE_ENV === 'development' && this.state.error && (\n            <details className=\"mt-4\">\n              <summary className=\"text-sm text-red-600 cursor-pointer\">\n                Show Error Details (Development)\n              </summary>\n              <pre className=\"mt-2 text-xs text-red-800 bg-red-100 p-2 rounded overflow-auto max-h-40\">\n                {this.state.error.stack}\n              </pre>\n            </details>\n          )}\n        </div>\n      )\n    }\n    \n    return this.props.children\n  }\n}\n\n// CRITICAL: Higher-order component for easy error boundary wrapping\nexport function withErrorBoundary<P extends object>(\n  Component: React.ComponentType<P>,\n  errorBoundaryProps?: Omit<ErrorBoundaryProps, 'children'>\n) {\n  return function WithErrorBoundary(props: P) {\n    return (\n      <ErrorBoundary\n        componentName={Component.displayName || Component.name}\n        {...errorBoundaryProps}\n      >\n        <Component {...props} />\n      </ErrorBoundary>\n    )\n  }\n}\n\n// CRITICAL: Hook for error boundary context\nexport function useErrorBoundary() {\n  const [error, setError] = React.useState<Error | null>(null)\n  \n  const handleError = React.useCallback((error: Error, errorInfo: ErrorInfo) => {\n    console.error('[useErrorBoundary] Error caught:', error, errorInfo)\n    setError(error)\n  }, [])\n  \n  const clearError = React.useCallback(() => {\n    setError(null)\n  }, [])\n  \n  return {\n    error,\n    handleError,\n    clearError,\n    hasError: error !== null\n  }\n} ","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\common\\Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\common\\Pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\common\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\common\\SkeletonLoader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\CustomizerWithRouter.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":11,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CustomizerTabId' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DEFAULT_TAB' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isValidTabId' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabInfo' is defined but never used.","line":24,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasUnitStore' is defined but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hydrateOrCreateUnit' is defined but never used.","line":26,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TechBase' is defined but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":18},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":41,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":41,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customizer With Router\r\n * \r\n * Integrates URL routing with the unit customizer.\r\n * Handles navigation between units and tabs via URL.\r\n * \r\n * @spec openspec/specs/customizer-tabs/spec.md\r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport React, { useEffect, useState, useMemo, useCallback, useRef } from 'react';\r\nimport { DndProvider } from 'react-dnd';\r\nimport { HTML5Backend } from 'react-dnd-html5-backend';\r\n\r\n// Router\r\nimport { \r\n  useCustomizerRouter, \r\n  CustomizerTabId,\r\n  DEFAULT_TAB,\r\n  isValidTabId,\r\n} from '@/hooks/useCustomizerRouter';\r\n\r\n// Stores\r\nimport { useTabManagerStore, TabInfo } from '@/stores/useTabManagerStore';\r\nimport { UnitStoreProvider, ActiveTabInfo } from '@/stores/UnitStoreProvider';\r\nimport { hasUnitStore, hydrateOrCreateUnit } from '@/stores/unitStoreRegistry';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\n\r\n// Components\r\nimport { MultiUnitTabs } from '@/components/customizer/tabs';\r\nimport { UnitEditorWithRouting } from './UnitEditorWithRouting';\r\n\r\n// =============================================================================\r\n// Main Component\r\n// =============================================================================\r\n\r\n/**\r\n * Customizer with URL routing support\r\n * Runs only on client side (dynamically imported with SSR disabled)\r\n */\r\nexport default function CustomizerWithRouter() {\r\n  const [isHydrated, setIsHydrated] = useState(false);\r\n  \r\n  // Tab manager store (for multi-unit tabs)\r\n  const tabs = useTabManagerStore((s) => s.tabs);\r\n  const activeTabId = useTabManagerStore((s) => s.activeTabId);\r\n  const isLoading = useTabManagerStore((s) => s.isLoading);\r\n  const selectTab = useTabManagerStore((s) => s.selectTab);\r\n  \r\n  // URL router - pass activeTabId as fallback for index page navigation\r\n  // This enables tab switching even when on /customizer without unit ID in URL\r\n  const router = useCustomizerRouter({ fallbackUnitId: activeTabId });\r\n  \r\n  // Prevent sync loops\r\n  const isSyncingRef = useRef(false);\r\n  const lastSyncedRef = useRef<{ unitId: string | null; activeTabId: string | null }>({\r\n    unitId: null,\r\n    activeTabId: null,\r\n  });\r\n  \r\n  // Extract stable values from router to avoid dependency on router object\r\n  const routerUnitId = router.unitId;\r\n  const routerTabId = router.tabId;\r\n  const routerIsValid = router.isValid;\r\n  const routerIsIndex = router.isIndex;\r\n  const routerSyncUrl = router.syncUrl;\r\n  const routerNavigateToIndex = router.navigateToIndex;\r\n  \r\n  // Trigger hydration on mount\r\n  useEffect(() => {\r\n    useTabManagerStore.persist.rehydrate();\r\n    setIsHydrated(true);\r\n  }, []);\r\n  \r\n  // ==========================================================================\r\n  // URL -> State Sync (only when URL changes from external navigation)\r\n  // ==========================================================================\r\n  \r\n  useEffect(() => {\r\n    if (!isHydrated || isLoading) return;\r\n    if (isSyncingRef.current) return;\r\n    \r\n    // Skip if we just synced this combination\r\n    if (lastSyncedRef.current.unitId === routerUnitId && \r\n        lastSyncedRef.current.activeTabId === activeTabId) {\r\n      return;\r\n    }\r\n    \r\n    // If URL has a unit ID that differs from active tab\r\n    if (routerUnitId && routerIsValid && routerUnitId !== activeTabId) {\r\n      // Check if this unit exists in our tabs\r\n      const tabExists = tabs.some((t) => t.id === routerUnitId);\r\n      \r\n      if (tabExists) {\r\n        isSyncingRef.current = true;\r\n        selectTab(routerUnitId);\r\n        lastSyncedRef.current = { unitId: routerUnitId, activeTabId: routerUnitId };\r\n        // Reset sync flag after a tick\r\n        setTimeout(() => { isSyncingRef.current = false; }, 0);\r\n      } else {\r\n        // Unit doesn't exist in tabs - redirect to index\r\n        console.warn('Unit not found in tabs:', routerUnitId);\r\n        isSyncingRef.current = true;\r\n        routerNavigateToIndex();\r\n        setTimeout(() => { isSyncingRef.current = false; }, 0);\r\n      }\r\n    }\r\n  }, [isHydrated, isLoading, routerUnitId, routerIsValid, activeTabId, tabs, selectTab, routerNavigateToIndex]);\r\n  \r\n  // ==========================================================================\r\n  // State -> URL Sync (only when active tab changes from user action)\r\n  // ==========================================================================\r\n  \r\n  useEffect(() => {\r\n    if (!isHydrated || isLoading) return;\r\n    if (isSyncingRef.current) return;\r\n    if (!activeTabId) return;\r\n    \r\n    // Only sync if the URL doesn't match and we haven't just synced\r\n    if (routerUnitId !== activeTabId) {\r\n      // Skip if this is the same sync we just did\r\n      if (lastSyncedRef.current.unitId === activeTabId && \r\n          lastSyncedRef.current.activeTabId === activeTabId) {\r\n        return;\r\n      }\r\n      \r\n      isSyncingRef.current = true;\r\n      routerSyncUrl(activeTabId, routerTabId);\r\n      lastSyncedRef.current = { unitId: activeTabId, activeTabId };\r\n      setTimeout(() => { isSyncingRef.current = false; }, 0);\r\n    }\r\n  }, [isHydrated, isLoading, activeTabId, routerUnitId, routerTabId, routerSyncUrl]);\r\n  \r\n  // ==========================================================================\r\n  // Derive active tab info for provider\r\n  // ==========================================================================\r\n  \r\n  const activeTab: ActiveTabInfo | null = useMemo(() => {\r\n    if (!activeTabId || tabs.length === 0) {\r\n      return null;\r\n    }\r\n    const tab = tabs.find((t) => t.id === activeTabId);\r\n    return tab ?? null;\r\n  }, [tabs, activeTabId]);\r\n  \r\n  // ==========================================================================\r\n  // Render\r\n  // ==========================================================================\r\n  \r\n  // Show loading during initial hydration\r\n  if (!isHydrated || isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\r\n        <div className=\"text-slate-400\">Loading customizer...</div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Invalid unit ID in URL\r\n  if (!routerIsValid && !routerIsIndex) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\r\n        <div className=\"text-center text-slate-400 p-8\">\r\n          <p className=\"text-lg mb-2\">Invalid unit ID</p>\r\n          <p className=\"text-sm mb-4\">The requested unit could not be found.</p>\r\n          <button\r\n            onClick={routerNavigateToIndex}\r\n            className=\"px-4 py-2 bg-amber-500 text-slate-900 rounded hover:bg-amber-400 transition-colors\"\r\n          >\r\n            Go to Customizer\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <DndProvider backend={HTML5Backend}>\r\n      <div className=\"min-h-screen bg-slate-900 flex flex-col\">\r\n        {/* Multi-unit tabs at top */}\r\n        <MultiUnitTabs>\r\n          {/* UnitStoreProvider - activeTab passed as prop */}\r\n          <UnitStoreProvider\r\n            activeTab={activeTab}\r\n            fallback={\r\n              <div className=\"flex-1 flex items-center justify-center\">\r\n                <div className=\"text-center text-slate-400 p-8\">\r\n                  <p className=\"text-lg mb-2\">No unit selected</p>\r\n                  <p className=\"text-sm\">Click &quot;New Unit&quot; to create a new BattleMech</p>\r\n                </div>\r\n              </div>\r\n            }\r\n          >\r\n            {/* Unit editor with routing support */}\r\n            <UnitEditorWithRouting\r\n              activeTabId={routerTabId}\r\n              onTabChange={router.navigateToTab}\r\n            />\r\n          </UnitStoreProvider>\r\n        </MultiUnitTabs>\r\n      </div>\r\n    </DndProvider>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\UnitEditorWithRouting.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GlobalStatusBar' is defined but never used.","line":32,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StatusBarStats' is defined but never used.","line":32,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getPlacementRule' is defined but never used.","line":40,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":55},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":151,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":151,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Editor With Routing\r\n * \r\n * Unit editor content that uses URL-based tab navigation.\r\n * Receives active tab from router instead of local state.\r\n * Includes global loadout tray on right and status bar at bottom.\r\n * \r\n * @spec openspec/specs/customizer-tabs/spec.md\r\n * @spec openspec/specs/equipment-tray/spec.md\r\n */\r\n\r\nimport React, { useMemo, useState, useCallback } from 'react';\r\n\r\n// Stores\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { getTotalAllocatedArmor } from '@/stores/unitState';\r\n\r\n// Hooks\r\nimport { useUnitCalculations } from '@/hooks/useUnitCalculations';\r\nimport { useEquipmentCalculations } from '@/hooks/useEquipmentCalculations';\r\nimport { CustomizerTabId, VALID_TAB_IDS } from '@/hooks/useCustomizerRouter';\r\n\r\n// Components\r\nimport { CustomizerTabs, DEFAULT_CUSTOMIZER_TABS } from '@/components/customizer/tabs/CustomizerTabs';\r\nimport { StructureTab } from '@/components/customizer/tabs/StructureTab';\r\nimport { OverviewTab } from '@/components/customizer/tabs/OverviewTab';\r\nimport { ArmorTab } from '@/components/customizer/tabs/ArmorTab';\r\nimport { EquipmentTab } from '@/components/customizer/tabs/EquipmentTab';\r\nimport { CriticalSlotsTab } from '@/components/customizer/tabs/CriticalSlotsTab';\r\nimport { UnitInfoBanner, UnitStats } from '@/components/customizer/shared/UnitInfoBanner';\r\nimport { GlobalLoadoutTray, LoadoutEquipmentItem, AvailableLocation } from '@/components/customizer/equipment/GlobalLoadoutTray';\r\nimport { GlobalStatusBar, StatusBarStats } from '@/components/customizer/shared/GlobalStatusBar';\r\n\r\n// Equipment\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport { JUMP_JETS } from '@/types/equipment/MiscEquipmentTypes';\r\n\r\n// Types\r\nimport { MechLocation, LOCATION_SLOT_COUNTS } from '@/types/construction';\r\nimport { isValidLocationForEquipment, getPlacementRule } from '@/types/equipment/EquipmentPlacement';\r\nimport { EngineType, getEngineDefinition } from '@/types/construction/EngineType';\r\nimport { GyroType, getGyroDefinition } from '@/types/construction/GyroType';\r\nimport { TechBaseMode, isEffectivelyMixed } from '@/types/construction/TechBaseConfiguration';\r\nimport { calculateEnhancedMaxRunMP } from '@/utils/construction/movementCalculations';\r\n\r\n// Utils\r\nimport { ValidationStatus } from '@/utils/colors/statusColors';\r\nimport { getMaxTotalArmor } from '@/utils/construction/armorCalculations';\r\n\r\n// =============================================================================\r\n// Constants\r\n// =============================================================================\r\n\r\n/** Jump jet equipment IDs for category normalization */\r\nconst JUMP_JET_IDS = new Set(JUMP_JETS.map(jj => jj.id));\r\n\r\n/**\r\n * Get fixed slot indices for a location (occupied by system components)\r\n * These slots cannot have equipment assigned to them.\r\n */\r\nfunction getFixedSlotIndices(\r\n  location: MechLocation,\r\n  engineType: EngineType,\r\n  gyroType: GyroType\r\n): Set<number> {\r\n  const fixed = new Set<number>();\r\n  \r\n  switch (location) {\r\n    case MechLocation.HEAD:\r\n      // Life Support (0), Sensors (1), Cockpit (2), Sensors (4), Life Support (5)\r\n      // Slot 3 is the only assignable slot in head\r\n      fixed.add(0);\r\n      fixed.add(1);\r\n      fixed.add(2);\r\n      fixed.add(4);\r\n      fixed.add(5);\r\n      break;\r\n      \r\n    case MechLocation.CENTER_TORSO:\r\n      // Engine slots + Gyro slots\r\n      const engineDef = getEngineDefinition(engineType);\r\n      const gyroDef = getGyroDefinition(gyroType);\r\n      const engineSlots = engineDef?.ctSlots ?? 6;\r\n      const gyroSlots = gyroDef?.criticalSlots ?? 4;\r\n      // Engine takes first 3, then gyro, then remaining engine\r\n      for (let i = 0; i < Math.min(3, engineSlots); i++) {\r\n        fixed.add(i);\r\n      }\r\n      for (let i = 0; i < gyroSlots; i++) {\r\n        fixed.add(3 + i);\r\n      }\r\n      for (let i = 3; i < engineSlots; i++) {\r\n        fixed.add(3 + gyroSlots + (i - 3));\r\n      }\r\n      break;\r\n      \r\n    case MechLocation.LEFT_ARM:\r\n    case MechLocation.RIGHT_ARM:\r\n      // Actuators: Shoulder (0), Upper Arm (1), Lower Arm (2), Hand (3)\r\n      fixed.add(0);\r\n      fixed.add(1);\r\n      fixed.add(2);\r\n      fixed.add(3);\r\n      break;\r\n      \r\n    case MechLocation.LEFT_LEG:\r\n    case MechLocation.RIGHT_LEG:\r\n      // Actuators: Hip (0), Upper Leg (1), Lower Leg (2), Foot (3)\r\n      fixed.add(0);\r\n      fixed.add(1);\r\n      fixed.add(2);\r\n      fixed.add(3);\r\n      break;\r\n      \r\n    case MechLocation.LEFT_TORSO:\r\n    case MechLocation.RIGHT_TORSO: {\r\n      // XL/Light/XXL engines require side torso slots\r\n      const sideTorsoEngineDef = getEngineDefinition(engineType);\r\n      const sideTorsoSlots = sideTorsoEngineDef?.sideTorsoSlots ?? 0;\r\n      for (let i = 0; i < sideTorsoSlots; i++) {\r\n        fixed.add(i);\r\n      }\r\n      break;\r\n    }\r\n  }\r\n  \r\n  return fixed;\r\n}\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\ninterface UnitEditorWithRoutingProps {\r\n  /** Active tab ID from URL */\r\n  activeTabId: CustomizerTabId;\r\n  /** Called when user changes tabs */\r\n  onTabChange: (tabId: CustomizerTabId) => void;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\n/**\r\n * Unit editor content - rendered when UnitStoreProvider has a valid store\r\n * Shows tabbed interface with Structure, Armor, Weapons, etc.\r\n * Tab state is managed via URL routing.\r\n * Includes global loadout tray on right and status bar at bottom.\r\n */\r\nexport function UnitEditorWithRouting({\r\n  activeTabId,\r\n  onTabChange,\r\n}: UnitEditorWithRoutingProps) {\r\n  // Loadout tray state\r\n  const [isTrayExpanded, setIsTrayExpanded] = useState(true);\r\n  \r\n  // Equipment selection state (for critical slot assignment)\r\n  const [selectedEquipmentId, setSelectedEquipmentId] = useState<string | null>(null);\r\n  \r\n  // Access unit state from context\r\n  const unitName = useUnitStore((s) => s.name);\r\n  const tonnage = useUnitStore((s) => s.tonnage);\r\n  const techBaseMode = useUnitStore((s) => s.techBaseMode);\r\n  const componentTechBases = useUnitStore((s) => s.componentTechBases);\r\n  const engineType = useUnitStore((s) => s.engineType);\r\n  const engineRating = useUnitStore((s) => s.engineRating);\r\n  const gyroType = useUnitStore((s) => s.gyroType);\r\n  const internalStructureType = useUnitStore((s) => s.internalStructureType);\r\n  const cockpitType = useUnitStore((s) => s.cockpitType);\r\n  const heatSinkType = useUnitStore((s) => s.heatSinkType);\r\n  const heatSinkCount = useUnitStore((s) => s.heatSinkCount);\r\n  const armorType = useUnitStore((s) => s.armorType);\r\n  const armorTonnage = useUnitStore((s) => s.armorTonnage);\r\n  const armorAllocation = useUnitStore((s) => s.armorAllocation);\r\n  const equipment = useUnitStore((s) => s.equipment);\r\n  const jumpMP = useUnitStore((s) => s.jumpMP);\r\n  const jumpJetType = useUnitStore((s) => s.jumpJetType);\r\n  const enhancement = useUnitStore((s) => s.enhancement);\r\n  const removeEquipment = useUnitStore((s) => s.removeEquipment);\r\n  const clearAllEquipment = useUnitStore((s) => s.clearAllEquipment);\r\n  const clearEquipmentLocation = useUnitStore((s) => s.clearEquipmentLocation);\r\n  const updateEquipmentLocation = useUnitStore((s) => s.updateEquipmentLocation);\r\n  \r\n  // Calculate equipment totals\r\n  const equipmentCalcs = useEquipmentCalculations(equipment);\r\n  \r\n  // Calculate armor stats for display\r\n  const allocatedArmorPoints = useMemo(\r\n    () => getTotalAllocatedArmor(armorAllocation),\r\n    [armorAllocation]\r\n  );\r\n  const maxArmorPoints = useMemo(\r\n    () => getMaxTotalArmor(tonnage),\r\n    [tonnage]\r\n  );\r\n  \r\n  // Memoize component selections to avoid breaking hook memoization\r\n  const componentSelections = useMemo(() => ({\r\n    engineType,\r\n    engineRating,\r\n    gyroType,\r\n    internalStructureType,\r\n    cockpitType,\r\n    heatSinkType,\r\n    heatSinkCount,\r\n    armorType,\r\n    jumpMP,\r\n    jumpJetType,\r\n  }), [engineType, engineRating, gyroType, internalStructureType, cockpitType, heatSinkType, heatSinkCount, armorType, jumpMP, jumpJetType]);\r\n  \r\n  // Calculate unit stats (weight is based on armorTonnage, not allocated points)\r\n  const calculations = useUnitCalculations(\r\n    tonnage,\r\n    componentSelections,\r\n    armorTonnage\r\n  );\r\n  \r\n  // Build stats object for UnitInfoBanner\r\n  const totalWeight = calculations.totalStructuralWeight + equipmentCalcs.totalWeight;\r\n  const totalSlotsUsed = calculations.totalSystemSlots + equipmentCalcs.totalSlots;\r\n  \r\n  // Calculate max run MP with enhancement active\r\n  const maxRunMP = useMemo(() => {\r\n    if (!enhancement) return undefined;\r\n    return calculateEnhancedMaxRunMP(calculations.walkMP, enhancement);\r\n  }, [enhancement, calculations.walkMP]);\r\n\r\n  // Compute effective tech base mode (detect mixed even if not in mixed mode)\r\n  const effectiveTechBaseMode = useMemo(() => {\r\n    // If mode is explicitly MIXED, use it\r\n    if (techBaseMode === TechBaseMode.MIXED) {\r\n      return TechBaseMode.MIXED;\r\n    }\r\n    // Check if components actually have different tech bases\r\n    if (isEffectivelyMixed(componentTechBases)) {\r\n      return TechBaseMode.MIXED;\r\n    }\r\n    // Use the declared mode\r\n    return techBaseMode;\r\n  }, [techBaseMode, componentTechBases]);\r\n\r\n  const unitStats: UnitStats = useMemo(() => ({\r\n    name: unitName,\r\n    tonnage,\r\n    techBaseMode: effectiveTechBaseMode,\r\n    engineRating,\r\n    walkMP: calculations.walkMP,\r\n    runMP: calculations.runMP,\r\n    jumpMP: calculations.jumpMP,\r\n    maxRunMP,\r\n    weightUsed: totalWeight,\r\n    weightRemaining: tonnage - totalWeight,\r\n    armorPoints: allocatedArmorPoints,\r\n    maxArmorPoints: maxArmorPoints,\r\n    criticalSlotsUsed: totalSlotsUsed,\r\n    criticalSlotsTotal: 78,\r\n    heatGenerated: equipmentCalcs.totalHeat,\r\n    heatDissipation: calculations.totalHeatDissipation,\r\n    validationStatus: 'valid' as ValidationStatus, // TODO: Get from validation\r\n    errorCount: 0,\r\n    warningCount: 0,\r\n  }), [unitName, tonnage, effectiveTechBaseMode, engineRating, calculations, equipmentCalcs, totalWeight, totalSlotsUsed, allocatedArmorPoints, maxArmorPoints, maxRunMP]);\r\n  \r\n  // Convert equipment to LoadoutEquipmentItem format\r\n  // Normalize categories for consistent display (e.g., jump jets -> Movement)\r\n  const loadoutEquipment: LoadoutEquipmentItem[] = useMemo(() => {\r\n    return equipment.map((item) => {\r\n      // Normalize category: jump jets should be in Movement category\r\n      const normalizedCategory = JUMP_JET_IDS.has(item.equipmentId)\r\n        ? EquipmentCategory.MOVEMENT\r\n        : item.category;\r\n      \r\n      return {\r\n        instanceId: item.instanceId,\r\n        name: item.name,\r\n        category: normalizedCategory,\r\n        weight: item.weight,\r\n        criticalSlots: item.criticalSlots,\r\n        isAllocated: !!item.location,\r\n        location: item.location,\r\n        isRemovable: item.isRemovable,\r\n      };\r\n    });\r\n  }, [equipment]);\r\n  \r\n  // Handle equipment removal\r\n  const handleRemoveEquipment = useCallback((instanceId: string) => {\r\n    removeEquipment(instanceId);\r\n  }, [removeEquipment]);\r\n  \r\n  // Handle remove all equipment\r\n  const handleRemoveAllEquipment = useCallback(() => {\r\n    clearAllEquipment();\r\n  }, [clearAllEquipment]);\r\n  \r\n  // Toggle tray expansion\r\n  const handleToggleTray = useCallback(() => {\r\n    setIsTrayExpanded((prev) => !prev);\r\n  }, []);\r\n  \r\n  // Handle equipment selection for slot assignment\r\n  const handleSelectEquipment = useCallback((id: string | null) => {\r\n    setSelectedEquipmentId(id);\r\n  }, []);\r\n  \r\n  // Handle unassign equipment (clear its slot location)\r\n  const handleUnassignEquipment = useCallback((instanceId: string) => {\r\n    clearEquipmentLocation(instanceId);\r\n  }, [clearEquipmentLocation]);\r\n  \r\n  // Calculate available locations for the selected equipment\r\n  const availableLocations: AvailableLocation[] = useMemo(() => {\r\n    if (!selectedEquipmentId) return [];\r\n    \r\n    const selectedItem = equipment.find(e => e.instanceId === selectedEquipmentId);\r\n    if (!selectedItem) return [];\r\n    \r\n    const slotsNeeded = selectedItem.criticalSlots;\r\n    const locations: AvailableLocation[] = [];\r\n    \r\n    // Location labels for display\r\n    const locationLabels: Record<MechLocation, string> = {\r\n      [MechLocation.HEAD]: 'Head',\r\n      [MechLocation.CENTER_TORSO]: 'Center Torso',\r\n      [MechLocation.LEFT_TORSO]: 'Left Torso',\r\n      [MechLocation.RIGHT_TORSO]: 'Right Torso',\r\n      [MechLocation.LEFT_ARM]: 'Left Arm',\r\n      [MechLocation.RIGHT_ARM]: 'Right Arm',\r\n      [MechLocation.LEFT_LEG]: 'Left Leg',\r\n      [MechLocation.RIGHT_LEG]: 'Right Leg',\r\n    };\r\n    \r\n    // Check each location\r\n    const allLocations = Object.values(MechLocation) as MechLocation[];\r\n    for (const loc of allLocations) {\r\n      // Check location restrictions for this equipment\r\n      if (!isValidLocationForEquipment(selectedItem.equipmentId, loc)) {\r\n        // Location is forbidden for this equipment type\r\n        locations.push({\r\n          location: loc,\r\n          label: locationLabels[loc],\r\n          availableSlots: 0,\r\n          canFit: false,\r\n        });\r\n        continue;\r\n      }\r\n      \r\n      const totalSlots = LOCATION_SLOT_COUNTS[loc] || 0;\r\n      \r\n      // Get fixed slot indices (actuators, engine, gyro, etc.)\r\n      const fixedSlots = getFixedSlotIndices(loc, engineType, gyroType);\r\n      \r\n      // Get slots used by existing equipment\r\n      const usedSlotIndices = new Set<number>();\r\n      for (const eq of equipment) {\r\n        if (eq.location === loc && eq.slots) {\r\n          for (const slot of eq.slots) {\r\n            usedSlotIndices.add(slot);\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Calculate truly available slots (not fixed and not used by equipment)\r\n      let availableSlots = 0;\r\n      for (let i = 0; i < totalSlots; i++) {\r\n        if (!fixedSlots.has(i) && !usedSlotIndices.has(i)) {\r\n          availableSlots++;\r\n        }\r\n      }\r\n      \r\n      // Check if there's a contiguous range large enough\r\n      let maxContiguous = 0;\r\n      let currentContiguous = 0;\r\n      for (let i = 0; i < totalSlots; i++) {\r\n        if (!fixedSlots.has(i) && !usedSlotIndices.has(i)) {\r\n          currentContiguous++;\r\n          maxContiguous = Math.max(maxContiguous, currentContiguous);\r\n        } else {\r\n          currentContiguous = 0;\r\n        }\r\n      }\r\n      \r\n      locations.push({\r\n        location: loc,\r\n        label: locationLabels[loc],\r\n        availableSlots,\r\n        canFit: maxContiguous >= slotsNeeded,\r\n      });\r\n    }\r\n    \r\n    return locations;\r\n  }, [selectedEquipmentId, equipment, engineType, gyroType]);\r\n  \r\n  // Handle quick assign to a location\r\n  const handleQuickAssign = useCallback((instanceId: string, location: MechLocation) => {\r\n    const item = equipment.find(e => e.instanceId === instanceId);\r\n    if (!item) return;\r\n    \r\n    // Check location restrictions first\r\n    if (!isValidLocationForEquipment(item.equipmentId, location)) {\r\n      console.warn(`Cannot assign ${item.name} to ${location} - location restriction`);\r\n      return;\r\n    }\r\n    \r\n    // Find first contiguous empty slot range in the location\r\n    const totalSlots = LOCATION_SLOT_COUNTS[location] || 0;\r\n    const slotsNeeded = item.criticalSlots;\r\n    \r\n    // Get fixed slot indices (actuators, engine, gyro, etc.)\r\n    const fixedSlots = getFixedSlotIndices(location, engineType, gyroType);\r\n    \r\n    // Get slots already used by other equipment in this location\r\n    const usedSlotIndices = new Set<number>();\r\n    for (const eq of equipment) {\r\n      if (eq.location === location && eq.slots) {\r\n        for (const slot of eq.slots) {\r\n          usedSlotIndices.add(slot);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Find first available contiguous range (skipping fixed slots)\r\n    for (let start = 0; start <= totalSlots - slotsNeeded; start++) {\r\n      let canFit = true;\r\n      for (let i = 0; i < slotsNeeded; i++) {\r\n        const slotIdx = start + i;\r\n        if (fixedSlots.has(slotIdx) || usedSlotIndices.has(slotIdx)) {\r\n          canFit = false;\r\n          break;\r\n        }\r\n      }\r\n      if (canFit) {\r\n        const slots: number[] = [];\r\n        for (let i = 0; i < slotsNeeded; i++) {\r\n          slots.push(start + i);\r\n        }\r\n        updateEquipmentLocation(instanceId, location, slots);\r\n        setSelectedEquipmentId(null);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // No contiguous slots found (shouldn't happen if canFit was true)\r\n    console.warn('No contiguous slots found for quick assign');\r\n  }, [equipment, engineType, gyroType, updateEquipmentLocation]);\r\n  \r\n  // Handle tab change - delegate to router\r\n  const handleTabChange = (tabId: string) => {\r\n    if (VALID_TAB_IDS.includes(tabId as CustomizerTabId)) {\r\n      onTabChange(tabId as CustomizerTabId);\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n      {/* Unit Info Banner - at-a-glance stats */}\r\n      <div className=\"p-2 bg-slate-900 border-b border-slate-700\">\r\n        <UnitInfoBanner stats={unitStats} />\r\n      </div>\r\n      \r\n      {/* Main content area with tray */}\r\n      <div className=\"flex-1 flex overflow-hidden\">\r\n        {/* Left side: Tabs and content */}\r\n        <div className=\"flex-1 flex flex-col min-w-0 overflow-hidden\">\r\n          {/* Section tabs (Structure, Armor, Weapons, etc.) */}\r\n          <CustomizerTabs\r\n            tabs={DEFAULT_CUSTOMIZER_TABS}\r\n            activeTab={activeTabId}\r\n            onTabChange={handleTabChange}\r\n          />\r\n          \r\n          {/* Tab content */}\r\n          <div className=\"flex-1 overflow-auto\">\r\n            {activeTabId === 'overview' && <OverviewTab />}\r\n            {activeTabId === 'structure' && <StructureTab />}\r\n            {activeTabId === 'armor' && <ArmorTab />}\r\n            {activeTabId === 'weapons' && <PlaceholderTab name=\"Weapons\" />}\r\n            {activeTabId === 'equipment' && <EquipmentTab />}\r\n            {activeTabId === 'criticals' && (\r\n              <CriticalSlotsTab\r\n                selectedEquipmentId={selectedEquipmentId}\r\n                onSelectEquipment={handleSelectEquipment}\r\n              />\r\n            )}\r\n            {activeTabId === 'fluff' && <PlaceholderTab name=\"Fluff\" />}\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Right side: Global Loadout Tray */}\r\n        <GlobalLoadoutTray\r\n          equipment={loadoutEquipment}\r\n          equipmentCount={equipment.length}\r\n          onRemoveEquipment={handleRemoveEquipment}\r\n          onRemoveAllEquipment={handleRemoveAllEquipment}\r\n          isExpanded={isTrayExpanded}\r\n          onToggleExpand={handleToggleTray}\r\n          selectedEquipmentId={selectedEquipmentId}\r\n          onSelectEquipment={handleSelectEquipment}\r\n          onUnassignEquipment={handleUnassignEquipment}\r\n          onQuickAssign={handleQuickAssign}\r\n          availableLocations={availableLocations}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Placeholder Tab (for tabs not yet fully implemented)\r\n// =============================================================================\r\n\r\nfunction PlaceholderTab({ name }: { name: string }) {\r\n  return (\r\n    <div className=\"flex-1 flex items-center justify-center p-8\">\r\n      <div className=\"text-center text-slate-400\">\r\n        <h3 className=\"text-xl font-bold mb-2\">{name}</h3>\r\n        <p className=\"text-sm\">This section is under development</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\armor\\ArmorDiagram.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":43,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":43,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Armor Diagram Component\r\n * \r\n * SVG-based interactive armor visualization for BattleMechs.\r\n * \r\n * @spec openspec/specs/armor-diagram/spec.md\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport { ArmorLocation } from './ArmorLocation';\r\nimport { ArmorLegend } from './ArmorLegend';\r\nimport { MechLocation } from '@/types/construction';\r\n\r\n/**\r\n * Armor allocation data for a single location\r\n */\r\nexport interface LocationArmorData {\r\n  readonly location: MechLocation;\r\n  readonly current: number;\r\n  readonly maximum: number;\r\n  readonly rear?: number;\r\n  readonly rearMaximum?: number;\r\n}\r\n\r\ninterface ArmorDiagramProps {\r\n  /** Armor allocation for all locations */\r\n  armorData: LocationArmorData[];\r\n  /** Currently selected location */\r\n  selectedLocation: MechLocation | null;\r\n  /** Unallocated armor points */\r\n  unallocatedPoints: number;\r\n  /** Called when a location is clicked */\r\n  onLocationClick: (location: MechLocation) => void;\r\n  /** Called when auto-allocate is clicked */\r\n  onAutoAllocate?: () => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * SVG Mech armor diagram with interactive locations\r\n */\r\nexport function ArmorDiagram({\r\n  armorData,\r\n  selectedLocation,\r\n  unallocatedPoints,\r\n  onLocationClick,\r\n  onAutoAllocate,\r\n  className = '',\r\n}: ArmorDiagramProps) {\r\n  const [hoveredLocation, setHoveredLocation] = useState<MechLocation | null>(null);\r\n  \r\n  const getArmorData = (location: MechLocation): LocationArmorData | undefined => {\r\n    return armorData.find((d) => d.location === location);\r\n  };\r\n  \r\n  const isOverAllocated = unallocatedPoints < 0;\r\n  \r\n  return (\r\n    <div className={`bg-slate-800 rounded-lg border border-slate-700 p-4 ${className}`}>\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold text-white\">Armor Allocation</h3>\r\n        {onAutoAllocate && (\r\n          <button\r\n            onClick={onAutoAllocate}\r\n            className={`px-3 py-1.5 text-sm font-medium rounded transition-colors ${\r\n              isOverAllocated\r\n                ? 'bg-red-600 hover:bg-red-500 text-white'\r\n                : 'bg-amber-600 hover:bg-amber-500 text-white'\r\n            }`}\r\n          >\r\n            Auto-Allocate ({unallocatedPoints} pts)\r\n          </button>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Diagram */}\r\n      <div className=\"relative\">\r\n        <svg\r\n          viewBox=\"0 0 300 400\"\r\n          className=\"w-full max-w-[300px] mx-auto\"\r\n          style={{ height: 'auto' }}\r\n        >\r\n          {/* Head */}\r\n          <ArmorLocation\r\n            location={MechLocation.HEAD}\r\n            x={120}\r\n            y={10}\r\n            width={60}\r\n            height={50}\r\n            data={getArmorData(MechLocation.HEAD)}\r\n            isSelected={selectedLocation === MechLocation.HEAD}\r\n            isHovered={hoveredLocation === MechLocation.HEAD}\r\n            onClick={() => onLocationClick(MechLocation.HEAD)}\r\n            onHover={(h) => setHoveredLocation(h ? MechLocation.HEAD : null)}\r\n            locationType=\"head\"\r\n          />\r\n          \r\n          {/* Center Torso */}\r\n          <ArmorLocation\r\n            location={MechLocation.CENTER_TORSO}\r\n            x={105}\r\n            y={65}\r\n            width={90}\r\n            height={100}\r\n            data={getArmorData(MechLocation.CENTER_TORSO)}\r\n            isSelected={selectedLocation === MechLocation.CENTER_TORSO}\r\n            isHovered={hoveredLocation === MechLocation.CENTER_TORSO}\r\n            onClick={() => onLocationClick(MechLocation.CENTER_TORSO)}\r\n            onHover={(h) => setHoveredLocation(h ? MechLocation.CENTER_TORSO : null)}\r\n            locationType=\"torso\"\r\n            showRear\r\n          />\r\n          \r\n          {/* Left Torso */}\r\n          <ArmorLocation\r\n            location={MechLocation.LEFT_TORSO}\r\n            x={35}\r\n            y={105}\r\n            width={65}\r\n            height={100}\r\n            data={getArmorData(MechLocation.LEFT_TORSO)}\r\n            isSelected={selectedLocation === MechLocation.LEFT_TORSO}\r\n            isHovered={hoveredLocation === MechLocation.LEFT_TORSO}\r\n            onClick={() => onLocationClick(MechLocation.LEFT_TORSO)}\r\n            onHover={(h) => setHoveredLocation(h ? MechLocation.LEFT_TORSO : null)}\r\n            locationType=\"torso\"\r\n            showRear\r\n          />\r\n          \r\n          {/* Right Torso */}\r\n          <ArmorLocation\r\n            location={MechLocation.RIGHT_TORSO}\r\n            x={200}\r\n            y={105}\r\n            width={65}\r\n            height={100}\r\n            data={getArmorData(MechLocation.RIGHT_TORSO)}\r\n            isSelected={selectedLocation === MechLocation.RIGHT_TORSO}\r\n            isHovered={hoveredLocation === MechLocation.RIGHT_TORSO}\r\n            onClick={() => onLocationClick(MechLocation.RIGHT_TORSO)}\r\n            onHover={(h) => setHoveredLocation(h ? MechLocation.RIGHT_TORSO : null)}\r\n            locationType=\"torso\"\r\n            showRear\r\n          />\r\n          \r\n          {/* Left Arm */}\r\n          <ArmorLocation\r\n            location={MechLocation.LEFT_ARM}\r\n            x={5}\r\n            y={115}\r\n            width={25}\r\n            height={120}\r\n            data={getArmorData(MechLocation.LEFT_ARM)}\r\n            isSelected={selectedLocation === MechLocation.LEFT_ARM}\r\n            isHovered={hoveredLocation === MechLocation.LEFT_ARM}\r\n            onClick={() => onLocationClick(MechLocation.LEFT_ARM)}\r\n            onHover={(h) => setHoveredLocation(h ? MechLocation.LEFT_ARM : null)}\r\n            locationType=\"limb\"\r\n          />\r\n          \r\n          {/* Right Arm */}\r\n          <ArmorLocation\r\n            location={MechLocation.RIGHT_ARM}\r\n            x={270}\r\n            y={115}\r\n            width={25}\r\n            height={120}\r\n            data={getArmorData(MechLocation.RIGHT_ARM)}\r\n            isSelected={selectedLocation === MechLocation.RIGHT_ARM}\r\n            isHovered={hoveredLocation === MechLocation.RIGHT_ARM}\r\n            onClick={() => onLocationClick(MechLocation.RIGHT_ARM)}\r\n            onHover={(h) => setHoveredLocation(h ? MechLocation.RIGHT_ARM : null)}\r\n            locationType=\"limb\"\r\n          />\r\n          \r\n          {/* Left Leg */}\r\n          <ArmorLocation\r\n            location={MechLocation.LEFT_LEG}\r\n            x={55}\r\n            y={210}\r\n            width={45}\r\n            height={130}\r\n            data={getArmorData(MechLocation.LEFT_LEG)}\r\n            isSelected={selectedLocation === MechLocation.LEFT_LEG}\r\n            isHovered={hoveredLocation === MechLocation.LEFT_LEG}\r\n            onClick={() => onLocationClick(MechLocation.LEFT_LEG)}\r\n            onHover={(h) => setHoveredLocation(h ? MechLocation.LEFT_LEG : null)}\r\n            locationType=\"limb\"\r\n          />\r\n          \r\n          {/* Right Leg */}\r\n          <ArmorLocation\r\n            location={MechLocation.RIGHT_LEG}\r\n            x={200}\r\n            y={210}\r\n            width={45}\r\n            height={130}\r\n            data={getArmorData(MechLocation.RIGHT_LEG)}\r\n            isSelected={selectedLocation === MechLocation.RIGHT_LEG}\r\n            isHovered={hoveredLocation === MechLocation.RIGHT_LEG}\r\n            onClick={() => onLocationClick(MechLocation.RIGHT_LEG)}\r\n            onHover={(h) => setHoveredLocation(h ? MechLocation.RIGHT_LEG : null)}\r\n            locationType=\"limb\"\r\n          />\r\n        </svg>\r\n      </div>\r\n      \r\n      {/* Legend */}\r\n      <ArmorLegend className=\"mt-4\" />\r\n      \r\n      {/* Instructions */}\r\n      <p className=\"text-xs text-slate-400 text-center mt-2\">\r\n        Click a location to edit armor values\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\armor\\ArmorLegend.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":19,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":19,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Armor Legend Component\r\n * \r\n * Color legend for the armor diagram.\r\n * \r\n * @spec openspec/specs/armor-diagram/spec.md\r\n */\r\n\r\nimport React from 'react';\r\n\r\ninterface ArmorLegendProps {\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Legend for armor diagram colors\r\n */\r\nexport function ArmorLegend({ className = '' }: ArmorLegendProps) {\r\n  const items = [\r\n    { color: 'bg-green-600', label: 'Head' },\r\n    { color: 'bg-amber-600', label: 'Torso/Limbs' },\r\n    { color: 'bg-amber-800', label: 'Rear Armor' },\r\n    { color: 'bg-blue-600', label: 'Selected' },\r\n  ];\r\n  \r\n  return (\r\n    <div className={`flex flex-wrap justify-center gap-4 ${className}`}>\r\n      {items.map(({ color, label }) => (\r\n        <div key={label} className=\"flex items-center gap-1.5\">\r\n          <div className={`w-3 h-3 rounded ${color}`} />\r\n          <span className=\"text-xs text-slate-400\">{label}</span>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\armor\\ArmorLocation.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getArmorLocationColorClass' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":36},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":82,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":82,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Armor Location Component\r\n * \r\n * Individual clickable location in the armor diagram.\r\n * \r\n * @spec openspec/specs/armor-diagram/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { MechLocation } from '@/types/construction';\r\nimport { LocationArmorData } from './ArmorDiagram';\r\nimport { getArmorLocationColorClass } from '@/utils/colors/statusColors';\r\n\r\ninterface ArmorLocationProps {\r\n  /** Mech location */\r\n  location: MechLocation;\r\n  /** SVG x position */\r\n  x: number;\r\n  /** SVG y position */\r\n  y: number;\r\n  /** SVG width */\r\n  width: number;\r\n  /** SVG height */\r\n  height: number;\r\n  /** Armor data for this location */\r\n  data?: LocationArmorData;\r\n  /** Is this location selected */\r\n  isSelected: boolean;\r\n  /** Is this location hovered */\r\n  isHovered: boolean;\r\n  /** Click handler */\r\n  onClick: () => void;\r\n  /** Hover handler */\r\n  onHover: (isHovered: boolean) => void;\r\n  /** Location type for coloring */\r\n  locationType: 'head' | 'torso' | 'limb';\r\n  /** Show rear armor section */\r\n  showRear?: boolean;\r\n}\r\n\r\n/**\r\n * Get fill color for a location based on state\r\n */\r\nfunction getLocationFill(\r\n  locationType: 'head' | 'torso' | 'limb' | 'rear',\r\n  isSelected: boolean,\r\n  isHovered: boolean\r\n): string {\r\n  if (isSelected) {\r\n    return '#2563eb'; // blue-600\r\n  }\r\n  if (isHovered) {\r\n    if (locationType === 'head') return '#22c55e'; // green-500\r\n    if (locationType === 'rear') return '#92400e'; // amber-800 lighter\r\n    return '#f59e0b'; // amber-500\r\n  }\r\n  if (locationType === 'head') return '#16a34a'; // green-600\r\n  if (locationType === 'rear') return '#92400e'; // amber-800\r\n  return '#d97706'; // amber-600\r\n}\r\n\r\n/**\r\n * Get short location label\r\n */\r\nfunction getLocationLabel(location: MechLocation): string {\r\n  switch (location) {\r\n    case MechLocation.HEAD: return 'HD';\r\n    case MechLocation.CENTER_TORSO: return 'CT';\r\n    case MechLocation.LEFT_TORSO: return 'LT';\r\n    case MechLocation.RIGHT_TORSO: return 'RT';\r\n    case MechLocation.LEFT_ARM: return 'LA';\r\n    case MechLocation.RIGHT_ARM: return 'RA';\r\n    case MechLocation.LEFT_LEG: return 'LL';\r\n    case MechLocation.RIGHT_LEG: return 'RL';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Individual armor location in the diagram\r\n */\r\nexport function ArmorLocation({\r\n  location,\r\n  x,\r\n  y,\r\n  width,\r\n  height,\r\n  data,\r\n  isSelected,\r\n  isHovered,\r\n  onClick,\r\n  onHover,\r\n  locationType,\r\n  showRear = false,\r\n}: ArmorLocationProps) {\r\n  const label = getLocationLabel(location);\r\n  const mainFill = getLocationFill(locationType, isSelected, isHovered);\r\n  const rearFill = getLocationFill('rear', isSelected, isHovered);\r\n  \r\n  const mainHeight = showRear ? height * 0.7 : height;\r\n  const rearHeight = showRear ? height * 0.3 : 0;\r\n  const rearY = y + mainHeight;\r\n  \r\n  return (\r\n    <g\r\n      role=\"button\"\r\n      tabIndex={0}\r\n      aria-label={`${location} armor: ${data?.current ?? 0} points${showRear ? `, rear: ${data?.rear ?? 0} points` : ''}`}\r\n      aria-pressed={isSelected}\r\n      className=\"cursor-pointer focus:outline-none\"\r\n      onClick={onClick}\r\n      onKeyDown={(e) => {\r\n        if (e.key === 'Enter' || e.key === ' ') {\r\n          e.preventDefault();\r\n          onClick();\r\n        }\r\n      }}\r\n      onMouseEnter={() => onHover(true)}\r\n      onMouseLeave={() => onHover(false)}\r\n      onFocus={() => onHover(true)}\r\n      onBlur={() => onHover(false)}\r\n    >\r\n      {/* Main section */}\r\n      <rect\r\n        x={x}\r\n        y={y}\r\n        width={width}\r\n        height={mainHeight}\r\n        rx={4}\r\n        fill={mainFill}\r\n        stroke={isSelected ? '#60a5fa' : '#475569'}\r\n        strokeWidth={isSelected ? 2 : 1}\r\n        className=\"transition-colors\"\r\n      />\r\n      \r\n      {/* Main armor value */}\r\n      <text\r\n        x={x + width / 2}\r\n        y={y + mainHeight / 2 + 4}\r\n        textAnchor=\"middle\"\r\n        className=\"fill-white text-sm font-bold\"\r\n        style={{ fontSize: width < 40 ? '10px' : '12px' }}\r\n      >\r\n        {data?.current ?? 0}\r\n      </text>\r\n      \r\n      {/* Location label */}\r\n      <text\r\n        x={x + width / 2}\r\n        y={y + 12}\r\n        textAnchor=\"middle\"\r\n        className=\"fill-white/70 font-medium\"\r\n        style={{ fontSize: '8px' }}\r\n      >\r\n        {label}\r\n      </text>\r\n      \r\n      {/* Rear section (for torso locations) */}\r\n      {showRear && (\r\n        <>\r\n          <rect\r\n            x={x}\r\n            y={rearY}\r\n            width={width}\r\n            height={rearHeight}\r\n            rx={4}\r\n            fill={rearFill}\r\n            stroke={isSelected ? '#60a5fa' : '#475569'}\r\n            strokeWidth={isSelected ? 2 : 1}\r\n            className=\"transition-colors\"\r\n          />\r\n          \r\n          {/* Rear armor value */}\r\n          <text\r\n            x={x + width / 2}\r\n            y={rearY + rearHeight / 2 + 4}\r\n            textAnchor=\"middle\"\r\n            className=\"fill-white text-xs font-bold\"\r\n            style={{ fontSize: '10px' }}\r\n          >\r\n            {data?.rear ?? 0}\r\n          </text>\r\n          \r\n          {/* Rear label */}\r\n          <text\r\n            x={x + width / 2}\r\n            y={rearY + 10}\r\n            textAnchor=\"middle\"\r\n            className=\"fill-white/70\"\r\n            style={{ fontSize: '6px' }}\r\n          >\r\n            R\r\n          </text>\r\n        </>\r\n      )}\r\n    </g>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\armor\\LocationArmorEditor.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":64,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":64,"endColumn":36},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'data'. Either include it or remove the dependency array. Mutable values like 'data.current' aren't valid dependencies because mutating them doesn't re-render the component.","line":97,"column":6,"nodeType":"ArrayExpression","endLine":97,"endColumn":61,"suggestions":[{"desc":"Update the dependencies array to be: [maxArmor, showRear, totalPool, data, onChange]","fix":{"range":[3104,3159],"text":"[maxArmor, showRear, totalPool, data, onChange]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'data'. Either include it or remove the dependency array. Mutable values like 'data.current' aren't valid dependencies because mutating them doesn't re-render the component.","line":112,"column":6,"nodeType":"ArrayExpression","endLine":112,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [maxArmor, data, onChange]","fix":{"range":[3776,3810],"text":"[maxArmor, data, onChange]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Location Armor Editor Component\r\n * \r\n * Compact panel for editing armor values on a selected location.\r\n * Full control over total, front, and rear armor values.\r\n * Visual split slider shows front (orange) vs rear (blue).\r\n * \r\n * @spec openspec/specs/armor-diagram/spec.md\r\n */\r\n\r\nimport React, { useCallback, useMemo } from 'react';\r\nimport { MechLocation } from '@/types/construction/CriticalSlotAllocation';\r\nimport { LocationArmorData } from './ArmorDiagram';\r\nimport { getMaxArmorForLocation } from '@/utils/construction/armorCalculations';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\ninterface LocationArmorEditorProps {\r\n  /** The location being edited */\r\n  location: MechLocation;\r\n  /** Current armor data for the location */\r\n  data: LocationArmorData;\r\n  /** Unit tonnage (for max calculations) */\r\n  tonnage: number;\r\n  /** Read-only mode */\r\n  readOnly?: boolean;\r\n  /** Called when armor values change */\r\n  onChange: (front: number, rear?: number) => void;\r\n  /** Called when closing the editor */\r\n  onClose: () => void;\r\n}\r\n\r\n// =============================================================================\r\n// Helper Functions\r\n// =============================================================================\r\n\r\n/**\r\n * Check if a location has rear armor\r\n */\r\nfunction hasRearArmor(location: MechLocation): boolean {\r\n  return [\r\n    MechLocation.CENTER_TORSO,\r\n    MechLocation.LEFT_TORSO,\r\n    MechLocation.RIGHT_TORSO,\r\n  ].includes(location);\r\n}\r\n\r\n/**\r\n * Get display name for location\r\n */\r\nfunction getLocationName(location: MechLocation): string {\r\n  return location;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\n/**\r\n * Compact editor panel for a single armor location\r\n */\r\nexport function LocationArmorEditor({\r\n  location,\r\n  data,\r\n  tonnage,\r\n  readOnly = false,\r\n  onChange,\r\n  onClose,\r\n}: LocationArmorEditorProps) {\r\n  const showRear = hasRearArmor(location);\r\n  const maxArmor = useMemo(\r\n    () => getMaxArmorForLocation(tonnage, location),\r\n    [tonnage, location]\r\n  );\r\n  \r\n  // Total armor pool for this location\r\n  const totalPool = data.current + (data.rear ?? 0);\r\n  \r\n  // Calculate percentages for the split slider\r\n  const frontPercent = totalPool > 0 ? (data.current / totalPool) * 100 : 75;\r\n  const rearPercent = totalPool > 0 ? ((data.rear ?? 0) / totalPool) * 100 : 25;\r\n  \r\n  // Handlers\r\n  const handleTotalChange = useCallback((value: number) => {\r\n    const newTotal = Math.max(0, Math.min(value, maxArmor));\r\n    if (showRear) {\r\n      // Maintain front/rear ratio when changing total\r\n      const currentRatio = totalPool > 0 ? data.current / totalPool : 0.75;\r\n      const newFront = Math.round(newTotal * currentRatio);\r\n      const newRear = newTotal - newFront;\r\n      onChange(newFront, newRear);\r\n    } else {\r\n      onChange(newTotal);\r\n    }\r\n  }, [maxArmor, onChange, showRear, totalPool, data.current]);\r\n  \r\n  const handleFrontChange = useCallback((value: number) => {\r\n    const rear = data.rear ?? 0;\r\n    // Front can go from 0 to maxArmor - rear\r\n    const maxFront = maxArmor - rear;\r\n    const newFront = Math.max(0, Math.min(value, maxFront));\r\n    onChange(newFront, showRear ? rear : undefined);\r\n  }, [maxArmor, onChange, showRear, data.rear]);\r\n  \r\n  const handleRearChange = useCallback((value: number) => {\r\n    // Rear can go from 0 to maxArmor - front\r\n    const maxRear = maxArmor - data.current;\r\n    const newRear = Math.max(0, Math.min(value, maxRear));\r\n    onChange(data.current, newRear);\r\n  }, [maxArmor, onChange, data.current]);\r\n  \r\n  // Handle split slider - adjusts front within current total pool\r\n  const handleSplitChange = useCallback((value: number) => {\r\n    if (totalPool === 0) return;\r\n    const newFront = Math.max(0, Math.min(value, totalPool));\r\n    const newRear = totalPool - newFront;\r\n    onChange(newFront, newRear);\r\n  }, [totalPool, onChange]);\r\n  \r\n  // Common styles\r\n  const inputClass = \"w-12 px-1 py-0.5 bg-slate-700 border border-slate-600 rounded text-white text-xs text-center [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\";\r\n  const labelClass = \"text-[10px] font-medium uppercase w-10\";\r\n  const sliderClass = \"flex-1 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer\";\r\n\r\n  return (\r\n    <div className=\"bg-slate-800 rounded-lg border border-slate-700 p-3\">\r\n      {/* Header Row */}\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <h4 className=\"text-sm font-semibold text-white\">{getLocationName(location)}</h4>\r\n        <button\r\n          onClick={onClose}\r\n          className=\"p-0.5 hover:bg-slate-700 rounded transition-colors\"\r\n          aria-label=\"Close editor\"\r\n        >\r\n          <svg className=\"w-3.5 h-3.5 text-slate-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      \r\n      {/* Total row with slider */}\r\n      <div className=\"flex items-center gap-2 mb-2\">\r\n        <span className={`${labelClass} text-slate-300`}>Total</span>\r\n        <input\r\n          type=\"range\"\r\n          min={0}\r\n          max={maxArmor}\r\n          value={totalPool}\r\n          onChange={(e) => handleTotalChange(parseInt(e.target.value, 10))}\r\n          disabled={readOnly}\r\n          className={`${sliderClass} accent-slate-400`}\r\n        />\r\n        <input\r\n          type=\"number\"\r\n          value={totalPool}\r\n          onChange={(e) => handleTotalChange(parseInt(e.target.value, 10) || 0)}\r\n          disabled={readOnly}\r\n          min={0}\r\n          max={maxArmor}\r\n          className={inputClass}\r\n        />\r\n        <span className=\"text-[10px] text-slate-500\">/{maxArmor}</span>\r\n      </div>\r\n      \r\n      {showRear && (\r\n        <>\r\n          {/* Split slider with visual front/rear display */}\r\n          <div className=\"mb-2\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className={`${labelClass} text-slate-300`}>Split</span>\r\n              {/* Custom visual split bar */}\r\n              <div className=\"flex-1 relative\">\r\n                {/* Background bar showing front (orange) and rear (blue) */}\r\n                <div className=\"h-3 rounded overflow-hidden flex\">\r\n                  <div \r\n                    className=\"bg-amber-500 transition-all\"\r\n                    style={{ width: `${frontPercent}%` }}\r\n                  />\r\n                  <div \r\n                    className=\"bg-sky-500 transition-all\"\r\n                    style={{ width: `${rearPercent}%` }}\r\n                  />\r\n                </div>\r\n                {/* Invisible range input for interaction */}\r\n                <input\r\n                  type=\"range\"\r\n                  min={0}\r\n                  max={totalPool}\r\n                  value={data.current}\r\n                  onChange={(e) => handleSplitChange(parseInt(e.target.value, 10))}\r\n                  disabled={readOnly || totalPool === 0}\r\n                  className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Front/Rear number inputs */}\r\n          <div className=\"flex items-center gap-3\">\r\n            {/* Front */}\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <span className={`${labelClass} text-amber-400`}>Front</span>\r\n              <input\r\n                type=\"number\"\r\n                value={data.current}\r\n                onChange={(e) => handleFrontChange(parseInt(e.target.value, 10) || 0)}\r\n                disabled={readOnly}\r\n                min={0}\r\n                max={maxArmor - (data.rear ?? 0)}\r\n                className={inputClass}\r\n              />\r\n            </div>\r\n            \r\n            {/* Rear */}\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <span className={`${labelClass} text-sky-400`}>Rear</span>\r\n              <input\r\n                type=\"number\"\r\n                value={data.rear ?? 0}\r\n                onChange={(e) => handleRearChange(parseInt(e.target.value, 10) || 0)}\r\n                disabled={readOnly}\r\n                min={0}\r\n                max={maxArmor - data.current}\r\n                className={inputClass}\r\n              />\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\armor\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\critical-slots\\CriticalSlotToolbar.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":29,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":29,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Critical Slot Toolbar Component\r\n * \r\n * Toolbar with auto-mode toggles and manual actions.\r\n * \r\n * @spec openspec/specs/critical-slots-display/spec.md\r\n */\r\n\r\nimport React from 'react';\r\n\r\ninterface CriticalSlotToolbarProps {\r\n  /** Auto-fill unhittables toggle state */\r\n  autoFillUnhittables: boolean;\r\n  /** Show placement preview toggle state */\r\n  showPlacementPreview: boolean;\r\n  /** Toggle auto-fill */\r\n  onAutoFillToggle: () => void;\r\n  /** Toggle preview */\r\n  onPreviewToggle: () => void;\r\n  /** Toolbar action handler */\r\n  onAction: (action: 'fill' | 'compact' | 'sort' | 'reset') => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Toolbar for critical slot management\r\n */\r\nexport function CriticalSlotToolbar({\r\n  autoFillUnhittables,\r\n  showPlacementPreview,\r\n  onAutoFillToggle,\r\n  onPreviewToggle,\r\n  onAction,\r\n  className = '',\r\n}: CriticalSlotToolbarProps) {\r\n  return (\r\n    <div className={`flex items-center justify-between px-3 py-2 ${className}`}>\r\n      {/* Auto-mode toggles */}\r\n      <div className=\"flex items-center gap-4\">\r\n        <label className=\"flex items-center gap-2 text-sm text-slate-300 cursor-pointer\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={autoFillUnhittables}\r\n            onChange={onAutoFillToggle}\r\n            className=\"w-4 h-4 rounded border-slate-600 bg-slate-700 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-800\"\r\n          />\r\n          <span>Auto Fill</span>\r\n        </label>\r\n        \r\n        <label className=\"flex items-center gap-2 text-sm text-slate-300 cursor-pointer\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={showPlacementPreview}\r\n            onChange={onPreviewToggle}\r\n            className=\"w-4 h-4 rounded border-slate-600 bg-slate-700 text-amber-500 focus:ring-amber-500 focus:ring-offset-slate-800\"\r\n          />\r\n          <span>Preview</span>\r\n        </label>\r\n      </div>\r\n      \r\n      {/* Action buttons */}\r\n      <div className=\"flex items-center gap-2\">\r\n        <ToolbarButton\r\n          label=\"Fill\"\r\n          title=\"Fill empty slots with unhittables\"\r\n          onClick={() => onAction('fill')}\r\n        />\r\n        <ToolbarButton\r\n          label=\"Compact\"\r\n          title=\"Compact equipment to top of locations\"\r\n          onClick={() => onAction('compact')}\r\n        />\r\n        <ToolbarButton\r\n          label=\"Sort\"\r\n          title=\"Sort equipment by size\"\r\n          onClick={() => onAction('sort')}\r\n        />\r\n        <ToolbarButton\r\n          label=\"Reset\"\r\n          title=\"Remove all placed equipment\"\r\n          onClick={() => onAction('reset')}\r\n          variant=\"danger\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface ToolbarButtonProps {\r\n  label: string;\r\n  title: string;\r\n  onClick: () => void;\r\n  variant?: 'default' | 'danger';\r\n}\r\n\r\nfunction ToolbarButton({ label, title, onClick, variant = 'default' }: ToolbarButtonProps) {\r\n  const colorClasses = variant === 'danger'\r\n    ? 'text-red-400 hover:text-red-300 hover:bg-red-900/30'\r\n    : 'text-slate-400 hover:text-white hover:bg-slate-700';\r\n  \r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      title={title}\r\n      className={`px-2 py-1 text-xs font-medium rounded transition-colors ${colorClasses}`}\r\n    >\r\n      {label}\r\n    </button>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\critical-slots\\CriticalSlotsDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":74,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":74,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Critical Slots Display Component\r\n * \r\n * Grid display of all mech locations with critical slots.\r\n * \r\n * @spec openspec/specs/critical-slots-display/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { LocationGrid } from './LocationGrid';\r\nimport { CriticalSlotToolbar } from './CriticalSlotToolbar';\r\nimport { MechLocation } from '@/types/construction';\r\n\r\n/**\r\n * Critical slot content data\r\n */\r\nexport interface SlotContent {\r\n  /** Slot index (0-based) */\r\n  index: number;\r\n  /** Content type */\r\n  type: 'empty' | 'system' | 'equipment';\r\n  /** Display name */\r\n  name?: string;\r\n  /** Equipment ID if equipment */\r\n  equipmentId?: string;\r\n  /** Is first slot of multi-slot equipment */\r\n  isFirstSlot?: boolean;\r\n  /** Is last slot of multi-slot equipment */\r\n  isLastSlot?: boolean;\r\n  /** Total slots this equipment occupies */\r\n  totalSlots?: number;\r\n  /** Can be removed */\r\n  isRemovable?: boolean;\r\n}\r\n\r\n/**\r\n * Location data for the display\r\n */\r\nexport interface LocationData {\r\n  location: MechLocation;\r\n  slots: SlotContent[];\r\n}\r\n\r\ninterface CriticalSlotsDisplayProps {\r\n  /** Location data for all locations */\r\n  locations: LocationData[];\r\n  /** Currently selected equipment ID */\r\n  selectedEquipmentId?: string;\r\n  /** Slots that can accept the selected equipment */\r\n  assignableSlots?: { location: MechLocation; slots: number[] }[];\r\n  /** Auto-fill unhittables mode */\r\n  autoFillUnhittables: boolean;\r\n  /** Show placement preview */\r\n  showPlacementPreview: boolean;\r\n  /** Called when a slot is clicked */\r\n  onSlotClick: (location: MechLocation, slotIndex: number) => void;\r\n  /** Called when equipment is dropped on a slot */\r\n  onEquipmentDrop: (location: MechLocation, slotIndex: number, equipmentId: string) => void;\r\n  /** Called when equipment is removed */\r\n  onEquipmentRemove: (location: MechLocation, slotIndex: number) => void;\r\n  /** Called when auto-fill toggle changes */\r\n  onAutoFillToggle: () => void;\r\n  /** Called when preview toggle changes */\r\n  onPreviewToggle: () => void;\r\n  /** Called when toolbar action is clicked */\r\n  onToolbarAction: (action: 'fill' | 'compact' | 'sort' | 'reset') => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Critical slots display grid\r\n */\r\nexport function CriticalSlotsDisplay({\r\n  locations,\r\n  selectedEquipmentId,\r\n  assignableSlots,\r\n  autoFillUnhittables,\r\n  showPlacementPreview,\r\n  onSlotClick,\r\n  onEquipmentDrop,\r\n  onEquipmentRemove,\r\n  onAutoFillToggle,\r\n  onPreviewToggle,\r\n  onToolbarAction,\r\n  className = '',\r\n}: CriticalSlotsDisplayProps) {\r\n  // Organize locations into rows for the grid\r\n  const getLocationData = (loc: MechLocation) => \r\n    locations.find((l) => l.location === loc);\r\n  \r\n  const getAssignableSlots = (loc: MechLocation) =>\r\n    assignableSlots?.find((a) => a.location === loc)?.slots || [];\r\n  \r\n  return (\r\n    <div className={`bg-slate-800 rounded-lg border border-slate-700 ${className}`}>\r\n      {/* Toolbar */}\r\n      <CriticalSlotToolbar\r\n        autoFillUnhittables={autoFillUnhittables}\r\n        showPlacementPreview={showPlacementPreview}\r\n        onAutoFillToggle={onAutoFillToggle}\r\n        onPreviewToggle={onPreviewToggle}\r\n        onAction={onToolbarAction}\r\n        className=\"border-b border-slate-700\"\r\n      />\r\n      \r\n      {/* Grid layout - MegaMekLab style with 5 columns */}\r\n      <div className=\"p-4\">\r\n        <div className=\"flex gap-2 items-start\">\r\n          {/* Column 1: Left Arm */}\r\n          <div className=\"flex flex-col\" style={{ marginTop: '40px' }}>\r\n            <LocationGrid\r\n              location={MechLocation.LEFT_ARM}\r\n              data={getLocationData(MechLocation.LEFT_ARM)}\r\n              selectedEquipmentId={selectedEquipmentId}\r\n              assignableSlots={getAssignableSlots(MechLocation.LEFT_ARM)}\r\n              onSlotClick={(i) => onSlotClick(MechLocation.LEFT_ARM, i)}\r\n              onEquipmentDrop={(i, e) => onEquipmentDrop(MechLocation.LEFT_ARM, i, e)}\r\n              onEquipmentRemove={(i) => onEquipmentRemove(MechLocation.LEFT_ARM, i)}\r\n            />\r\n          </div>\r\n          \r\n          {/* Column 2: Left Torso + Left Leg stacked */}\r\n          <div className=\"flex flex-col gap-2\" style={{ marginTop: '40px' }}>\r\n            <LocationGrid\r\n              location={MechLocation.LEFT_TORSO}\r\n              data={getLocationData(MechLocation.LEFT_TORSO)}\r\n              selectedEquipmentId={selectedEquipmentId}\r\n              assignableSlots={getAssignableSlots(MechLocation.LEFT_TORSO)}\r\n              onSlotClick={(i) => onSlotClick(MechLocation.LEFT_TORSO, i)}\r\n              onEquipmentDrop={(i, e) => onEquipmentDrop(MechLocation.LEFT_TORSO, i, e)}\r\n              onEquipmentRemove={(i) => onEquipmentRemove(MechLocation.LEFT_TORSO, i)}\r\n            />\r\n            <LocationGrid\r\n              location={MechLocation.LEFT_LEG}\r\n              data={getLocationData(MechLocation.LEFT_LEG)}\r\n              selectedEquipmentId={selectedEquipmentId}\r\n              assignableSlots={getAssignableSlots(MechLocation.LEFT_LEG)}\r\n              onSlotClick={(i) => onSlotClick(MechLocation.LEFT_LEG, i)}\r\n              onEquipmentDrop={(i, e) => onEquipmentDrop(MechLocation.LEFT_LEG, i, e)}\r\n              onEquipmentRemove={(i) => onEquipmentRemove(MechLocation.LEFT_LEG, i)}\r\n            />\r\n          </div>\r\n          \r\n          {/* Column 3: Head + Center Torso stacked */}\r\n          <div className=\"flex flex-col gap-2\">\r\n            <LocationGrid\r\n              location={MechLocation.HEAD}\r\n              data={getLocationData(MechLocation.HEAD)}\r\n              selectedEquipmentId={selectedEquipmentId}\r\n              assignableSlots={getAssignableSlots(MechLocation.HEAD)}\r\n              onSlotClick={(i) => onSlotClick(MechLocation.HEAD, i)}\r\n              onEquipmentDrop={(i, e) => onEquipmentDrop(MechLocation.HEAD, i, e)}\r\n              onEquipmentRemove={(i) => onEquipmentRemove(MechLocation.HEAD, i)}\r\n            />\r\n            <LocationGrid\r\n              location={MechLocation.CENTER_TORSO}\r\n              data={getLocationData(MechLocation.CENTER_TORSO)}\r\n              selectedEquipmentId={selectedEquipmentId}\r\n              assignableSlots={getAssignableSlots(MechLocation.CENTER_TORSO)}\r\n              onSlotClick={(i) => onSlotClick(MechLocation.CENTER_TORSO, i)}\r\n              onEquipmentDrop={(i, e) => onEquipmentDrop(MechLocation.CENTER_TORSO, i, e)}\r\n              onEquipmentRemove={(i) => onEquipmentRemove(MechLocation.CENTER_TORSO, i)}\r\n            />\r\n          </div>\r\n          \r\n          {/* Column 4: Right Torso + Right Leg stacked */}\r\n          <div className=\"flex flex-col gap-2\" style={{ marginTop: '40px' }}>\r\n            <LocationGrid\r\n              location={MechLocation.RIGHT_TORSO}\r\n              data={getLocationData(MechLocation.RIGHT_TORSO)}\r\n              selectedEquipmentId={selectedEquipmentId}\r\n              assignableSlots={getAssignableSlots(MechLocation.RIGHT_TORSO)}\r\n              onSlotClick={(i) => onSlotClick(MechLocation.RIGHT_TORSO, i)}\r\n              onEquipmentDrop={(i, e) => onEquipmentDrop(MechLocation.RIGHT_TORSO, i, e)}\r\n              onEquipmentRemove={(i) => onEquipmentRemove(MechLocation.RIGHT_TORSO, i)}\r\n            />\r\n            <LocationGrid\r\n              location={MechLocation.RIGHT_LEG}\r\n              data={getLocationData(MechLocation.RIGHT_LEG)}\r\n              selectedEquipmentId={selectedEquipmentId}\r\n              assignableSlots={getAssignableSlots(MechLocation.RIGHT_LEG)}\r\n              onSlotClick={(i) => onSlotClick(MechLocation.RIGHT_LEG, i)}\r\n              onEquipmentDrop={(i, e) => onEquipmentDrop(MechLocation.RIGHT_LEG, i, e)}\r\n              onEquipmentRemove={(i) => onEquipmentRemove(MechLocation.RIGHT_LEG, i)}\r\n            />\r\n          </div>\r\n          \r\n          {/* Column 5: Right Arm */}\r\n          <div className=\"flex flex-col\" style={{ marginTop: '40px' }}>\r\n            <LocationGrid\r\n              location={MechLocation.RIGHT_ARM}\r\n              data={getLocationData(MechLocation.RIGHT_ARM)}\r\n              selectedEquipmentId={selectedEquipmentId}\r\n              assignableSlots={getAssignableSlots(MechLocation.RIGHT_ARM)}\r\n              onSlotClick={(i) => onSlotClick(MechLocation.RIGHT_ARM, i)}\r\n              onEquipmentDrop={(i, e) => onEquipmentDrop(MechLocation.RIGHT_ARM, i, e)}\r\n              onEquipmentRemove={(i) => onEquipmentRemove(MechLocation.RIGHT_ARM, i)}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\critical-slots\\DraggableEquipment.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":33,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":33,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Draggable Equipment Component\r\n * \r\n * Equipment item that can be dragged to critical slots.\r\n * \r\n * @spec openspec/specs/critical-slots-display/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { \r\n  classifyEquipment, \r\n  getEquipmentColors \r\n} from '@/utils/colors/equipmentColors';\r\n\r\ninterface DraggableEquipmentProps {\r\n  /** Equipment ID */\r\n  id: string;\r\n  /** Equipment name */\r\n  name: string;\r\n  /** Number of critical slots */\r\n  criticalSlots: number;\r\n  /** Is selected */\r\n  isSelected?: boolean;\r\n  /** Click handler */\r\n  onClick?: () => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Draggable equipment item for the unallocated panel\r\n */\r\nexport function DraggableEquipment({\r\n  id,\r\n  name,\r\n  criticalSlots,\r\n  isSelected = false,\r\n  onClick,\r\n  className = '',\r\n}: DraggableEquipmentProps) {\r\n  const colorType = classifyEquipment(name);\r\n  const colors = getEquipmentColors(colorType);\r\n  \r\n  const handleDragStart = (e: React.DragEvent) => {\r\n    e.dataTransfer.setData('text/equipment-id', id);\r\n    e.dataTransfer.effectAllowed = 'move';\r\n  };\r\n  \r\n  return (\r\n    <div\r\n      draggable\r\n      onDragStart={handleDragStart}\r\n      onClick={onClick}\r\n      className={`\r\n        flex items-center justify-between px-2 py-1.5 rounded border cursor-grab\r\n        transition-all\r\n        ${colors.bg} ${colors.border} ${colors.text}\r\n        ${isSelected ? 'ring-2 ring-yellow-400 ring-offset-1 ring-offset-slate-900' : ''}\r\n        hover:brightness-110 active:cursor-grabbing\r\n        ${className}\r\n      `}\r\n    >\r\n      <span className=\"truncate text-sm\">{name}</span>\r\n      <span className=\"flex items-center gap-1 ml-2 flex-shrink-0\">\r\n        <span className=\"text-xs opacity-75\">{criticalSlots} slot{criticalSlots !== 1 ? 's' : ''}</span>\r\n        {isSelected && (\r\n          <span className=\"text-yellow-400\"></span>\r\n        )}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\critical-slots\\LocationGrid.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":58,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":58,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Location Grid Component\r\n * \r\n * Grid of critical slots for a single location.\r\n * Matches MegaMekLab's visual style with full location names.\r\n * \r\n * @spec openspec/specs/critical-slots-display/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { SlotRow } from './SlotRow';\r\nimport { MechLocation, LOCATION_SLOT_COUNTS } from '@/types/construction';\r\nimport { LocationData, SlotContent } from './CriticalSlotsDisplay';\r\n\r\n/**\r\n * Get full location name\r\n */\r\nfunction getLocationLabel(location: MechLocation): string {\r\n  switch (location) {\r\n    case MechLocation.HEAD: return 'Head';\r\n    case MechLocation.CENTER_TORSO: return 'Center Torso';\r\n    case MechLocation.LEFT_TORSO: return 'Left Torso';\r\n    case MechLocation.RIGHT_TORSO: return 'Right Torso';\r\n    case MechLocation.LEFT_ARM: return 'Left Arm';\r\n    case MechLocation.RIGHT_ARM: return 'Right Arm';\r\n    case MechLocation.LEFT_LEG: return 'Left Leg';\r\n    case MechLocation.RIGHT_LEG: return 'Right Leg';\r\n    default: return '';\r\n  }\r\n}\r\n\r\ninterface LocationGridProps {\r\n  /** Location */\r\n  location: MechLocation;\r\n  /** Location data */\r\n  data?: LocationData;\r\n  /** Currently selected equipment ID */\r\n  selectedEquipmentId?: string;\r\n  /** Slots that can accept selected equipment */\r\n  assignableSlots: number[];\r\n  /** Called when slot is clicked */\r\n  onSlotClick: (slotIndex: number) => void;\r\n  /** Called when equipment is dropped */\r\n  onEquipmentDrop: (slotIndex: number, equipmentId: string) => void;\r\n  /** Called when equipment is removed */\r\n  onEquipmentRemove: (slotIndex: number) => void;\r\n  /** Called when equipment drag starts from a slot */\r\n  onEquipmentDragStart?: (equipmentId: string) => void;\r\n  /** Use compact layout */\r\n  compact?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Grid of slots for a single location\r\n */\r\nexport function LocationGrid({\r\n  location,\r\n  data,\r\n  selectedEquipmentId,\r\n  assignableSlots,\r\n  onSlotClick,\r\n  onEquipmentDrop,\r\n  onEquipmentRemove,\r\n  onEquipmentDragStart,\r\n  compact = false,\r\n  className = '',\r\n}: LocationGridProps) {\r\n  const slotCount = LOCATION_SLOT_COUNTS[location];\r\n  const label = getLocationLabel(location);\r\n  \r\n  // Create slot data for all slots\r\n  const slots: SlotContent[] = Array.from({ length: slotCount }, (_, i) => {\r\n    const existing = data?.slots.find((s) => s.index === i);\r\n    return existing || { index: i, type: 'empty' as const };\r\n  });\r\n  \r\n  return (\r\n    <div \r\n      className={`\r\n        bg-slate-900 border border-slate-600 w-36\r\n        ${className}\r\n      `}\r\n    >\r\n      {/* Location header */}\r\n      <div className=\"px-2 py-1.5 border-b border-slate-600 bg-slate-800 text-center\">\r\n        <span className=\"text-sm font-medium text-slate-200\">{label}</span>\r\n      </div>\r\n      \r\n      {/* Slots */}\r\n      <div className=\"p-0.5\">\r\n        {slots.map((slot) => (\r\n          <SlotRow\r\n            key={slot.index}\r\n            slot={slot}\r\n            isAssignable={assignableSlots.includes(slot.index)}\r\n            isSelected={!!(selectedEquipmentId && slot.equipmentId === selectedEquipmentId)}\r\n            compact={compact}\r\n            onClick={() => onSlotClick(slot.index)}\r\n            onDrop={(equipmentId) => onEquipmentDrop(slot.index, equipmentId)}\r\n            onRemove={() => onEquipmentRemove(slot.index)}\r\n            onDragStart={onEquipmentDragStart}\r\n          />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\critical-slots\\SlotRow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\critical-slots\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\dialogs\\ImportUnitDialog.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":41,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":41,"endColumn":33},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":270,"column":32,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9821,9855],"text":"\r\n                  A unit named &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9821,9855],"text":"\r\n                  A unit named &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9821,9855],"text":"\r\n                  A unit named &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9821,9855],"text":"\r\n                  A unit named &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":1,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":270,"column":76,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9898,9933],"text":"&quot; already exists.\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9898,9933],"text":"&ldquo; already exists.\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9898,9933],"text":"&#34; already exists.\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9898,9933],"text":"&rdquo; already exists.\r\n                "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Import Unit Dialog Component\r\n * \r\n * Dialog for importing units from JSON files.\r\n * Handles file selection, validation, and conflict resolution.\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport React, { useState, useCallback } from 'react';\r\nimport { ModalOverlay } from './ModalOverlay';\r\nimport { customUnitApiService, ISaveResult } from '@/services/units/CustomUnitApiService';\r\nimport { ISerializedUnitEnvelope } from '@/types/persistence/UnitPersistence';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface ImportUnitDialogProps {\r\n  /** Whether dialog is open */\r\n  isOpen: boolean;\r\n  /** Called when import succeeds */\r\n  onImportSuccess: (unitId: string, unitName: string) => void;\r\n  /** Called when dialog is closed */\r\n  onClose: () => void;\r\n}\r\n\r\ntype ImportState = 'idle' | 'validating' | 'conflict' | 'importing' | 'success' | 'error';\r\n\r\ninterface ParsedUnit {\r\n  chassis: string;\r\n  variant: string;\r\n  data: ISerializedUnitEnvelope | Record<string, unknown>;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\nexport function ImportUnitDialog({\r\n  isOpen,\r\n  onImportSuccess,\r\n  onClose,\r\n}: ImportUnitDialogProps) {\r\n  // State\r\n  const [state, setState] = useState<ImportState>('idle');\r\n  const [parsedUnit, setParsedUnit] = useState<ParsedUnit | null>(null);\r\n  const [suggestedName, setSuggestedName] = useState<string | null>(null);\r\n  const [useAlternateName, setUseAlternateName] = useState(false);\r\n  const [alternateName, setAlternateName] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [dragActive, setDragActive] = useState(false);\r\n  \r\n  // Reset state when dialog opens/closes\r\n  React.useEffect(() => {\r\n    if (!isOpen) {\r\n      setState('idle');\r\n      setParsedUnit(null);\r\n      setSuggestedName(null);\r\n      setUseAlternateName(false);\r\n      setAlternateName('');\r\n      setError(null);\r\n    }\r\n  }, [isOpen]);\r\n  \r\n  // Parse and validate file\r\n  const parseFile = useCallback(async (file: File) => {\r\n    setState('validating');\r\n    setError(null);\r\n    \r\n    try {\r\n      const text = await file.text();\r\n      const data = JSON.parse(text) as ISerializedUnitEnvelope | Record<string, unknown>;\r\n      \r\n      // Extract unit data (handle envelope vs raw format)\r\n      let unitData: Record<string, unknown>;\r\n      if ('formatVersion' in data && 'unit' in data) {\r\n        unitData = (data as ISerializedUnitEnvelope).unit;\r\n      } else {\r\n        unitData = data as Record<string, unknown>;\r\n      }\r\n      \r\n      // Validate required fields\r\n      const chassis = unitData.chassis as string | undefined;\r\n      const variant = (unitData.variant || unitData.model) as string | undefined;\r\n      \r\n      if (!chassis) {\r\n        throw new Error('Missing required field: chassis');\r\n      }\r\n      if (!variant) {\r\n        throw new Error('Missing required field: variant or model');\r\n      }\r\n      \r\n      setParsedUnit({ chassis, variant, data });\r\n      setState('idle');\r\n      \r\n      return { chassis, variant, data };\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to parse file';\r\n      setError(message);\r\n      setState('error');\r\n      setParsedUnit(null);\r\n      return null;\r\n    }\r\n  }, []);\r\n  \r\n  // Handle file selection\r\n  const handleFileSelect = useCallback(async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    \r\n    await parseFile(file);\r\n    \r\n    // Reset input\r\n    e.target.value = '';\r\n  }, [parseFile]);\r\n  \r\n  // Handle drag and drop\r\n  const handleDrag = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    if (e.type === 'dragenter' || e.type === 'dragover') {\r\n      setDragActive(true);\r\n    } else if (e.type === 'dragleave') {\r\n      setDragActive(false);\r\n    }\r\n  }, []);\r\n  \r\n  const handleDrop = useCallback(async (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setDragActive(false);\r\n    \r\n    const file = e.dataTransfer.files?.[0];\r\n    if (!file) return;\r\n    \r\n    if (!file.name.endsWith('.json')) {\r\n      setError('Please drop a JSON file');\r\n      return;\r\n    }\r\n    \r\n    await parseFile(file);\r\n  }, [parseFile]);\r\n  \r\n  // Handle import\r\n  const handleImport = useCallback(async () => {\r\n    if (!parsedUnit) return;\r\n    \r\n    setState('importing');\r\n    setError(null);\r\n    \r\n    try {\r\n      let result: ISaveResult;\r\n      \r\n      if (useAlternateName && alternateName.trim()) {\r\n        // Import with alternate variant name\r\n        const data = parsedUnit.data as Record<string, unknown>;\r\n        let modifiedData: Record<string, unknown>;\r\n        \r\n        if ('unit' in data && typeof data.unit === 'object' && data.unit !== null) {\r\n          // Envelope format - modify the nested unit\r\n          modifiedData = {\r\n            ...data,\r\n            unit: { ...(data.unit as Record<string, unknown>), variant: alternateName.trim() },\r\n          };\r\n        } else {\r\n          // Direct unit format\r\n          modifiedData = { ...data, variant: alternateName.trim() };\r\n        }\r\n        result = await customUnitApiService.importUnit(modifiedData);\r\n      } else {\r\n        result = await customUnitApiService.importUnit(parsedUnit.data);\r\n      }\r\n      \r\n      if (result.success && result.id) {\r\n        setState('success');\r\n        const finalName = useAlternateName && alternateName.trim()\r\n          ? `${parsedUnit.chassis} ${alternateName.trim()}`\r\n          : `${parsedUnit.chassis} ${parsedUnit.variant}`;\r\n        onImportSuccess(result.id, finalName);\r\n      } else if (result.requiresRename && result.suggestedName) {\r\n        setState('conflict');\r\n        setSuggestedName(result.suggestedName.suggestedVariant);\r\n        setAlternateName(result.suggestedName.suggestedVariant);\r\n      } else {\r\n        throw new Error(result.error || 'Import failed');\r\n      }\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Import failed';\r\n      setError(message);\r\n      setState('error');\r\n    }\r\n  }, [parsedUnit, useAlternateName, alternateName, onImportSuccess]);\r\n  \r\n  return (\r\n    <ModalOverlay\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      className=\"w-full max-w-lg mx-4\"\r\n    >\r\n      {/* Header */}\r\n      <div className={cs.dialog.header}>\r\n        <h3 className={cs.dialog.headerTitle}>Import Unit</h3>\r\n        <button onClick={onClose} className={cs.dialog.closeBtn}>\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      \r\n      {/* Content */}\r\n      <div className={cs.dialog.content}>\r\n        {/* Drop zone */}\r\n        <div\r\n          onDragEnter={handleDrag}\r\n          onDragLeave={handleDrag}\r\n          onDragOver={handleDrag}\r\n          onDrop={handleDrop}\r\n          className={`${cs.dialog.dropzone} ${dragActive ? cs.dialog.dropzoneActive : ''}`}\r\n        >\r\n          <input\r\n            type=\"file\"\r\n            accept=\".json\"\r\n            onChange={handleFileSelect}\r\n            className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n          />\r\n          <svg className=\"w-10 h-10 mx-auto mb-3 text-slate-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\r\n          </svg>\r\n          <p className=\"text-slate-300\">\r\n            Drag and drop a JSON file here, or{' '}\r\n            <span className=\"text-blue-400 underline\">click to browse</span>\r\n          </p>\r\n          <p className=\"text-sm text-slate-500 mt-1\">\r\n            Supports .json files exported from this editor\r\n          </p>\r\n        </div>\r\n        \r\n        {/* Parsed unit info */}\r\n        {parsedUnit && (\r\n          <div className={cs.dialog.infoPanel}>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"text-white font-medium\">\r\n                  {parsedUnit.chassis} {parsedUnit.variant}\r\n                </div>\r\n                <div className=\"text-sm text-slate-400\">\r\n                  Ready to import\r\n                </div>\r\n              </div>\r\n              <svg className=\"w-6 h-6 text-green-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Conflict resolution */}\r\n        {state === 'conflict' && suggestedName && (\r\n          <div className={`${cs.dialog.warningPanel} space-y-3`}>\r\n            <div className=\"flex items-start gap-2\">\r\n              <svg className=\"w-5 h-5 text-amber-400 mt-0.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n              </svg>\r\n              <div>\r\n                <div className=\"text-amber-400 font-medium\">Name Conflict</div>\r\n                <div className=\"text-sm text-amber-200/80\">\r\n                  A unit named \"{parsedUnit?.chassis} {parsedUnit?.variant}\" already exists.\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"pl-7\">\r\n              <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={useAlternateName}\r\n                  onChange={(e) => setUseAlternateName(e.target.checked)}\r\n                  className=\"w-4 h-4 rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800\"\r\n                />\r\n                <span className=\"text-sm text-slate-300\">\r\n                  Import with alternate name\r\n                </span>\r\n              </label>\r\n              \r\n              {useAlternateName && (\r\n                <input\r\n                  type=\"text\"\r\n                  value={alternateName}\r\n                  onChange={(e) => setAlternateName(e.target.value)}\r\n                  placeholder=\"New variant name\"\r\n                  className={`mt-2 ${cs.dialog.input}`}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Error message */}\r\n        {error && (\r\n          <div className={cs.dialog.errorPanel}>\r\n            <div className=\"flex items-center gap-2 text-red-400\">\r\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              {error}\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Loading state */}\r\n        {(state === 'validating' || state === 'importing') && (\r\n          <div className=\"flex items-center justify-center gap-2 text-slate-400 py-4\">\r\n            <svg className=\"w-5 h-5 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n              <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\r\n              <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\" />\r\n            </svg>\r\n            {state === 'validating' ? 'Validating...' : 'Importing...'}\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Footer */}\r\n      <div className={cs.dialog.footer}>\r\n        <button onClick={onClose} className={cs.dialog.btnGhost}>\r\n          Cancel\r\n        </button>\r\n        <button\r\n          onClick={handleImport}\r\n          disabled={!parsedUnit || state === 'validating' || state === 'importing'}\r\n          className={`min-w-[100px] ${cs.dialog.btnPrimary}`}\r\n        >\r\n          Import\r\n        </button>\r\n      </div>\r\n    </ModalOverlay>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\dialogs\\ModalOverlay.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":27,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":27,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Modal Overlay Component\r\n * \r\n * Reusable modal overlay with backdrop and centering.\r\n * \r\n * @spec openspec/specs/confirmation-dialogs/spec.md\r\n */\r\n\r\nimport React, { useEffect, useRef } from 'react';\r\n\r\ninterface ModalOverlayProps {\r\n  /** Whether modal is open */\r\n  isOpen: boolean;\r\n  /** Called when overlay is clicked or escape is pressed */\r\n  onClose: () => void;\r\n  /** Prevent closing (e.g., during operation) */\r\n  preventClose?: boolean;\r\n  /** Modal content */\r\n  children: React.ReactNode;\r\n  /** Additional CSS classes for the modal container */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Modal overlay with focus trapping\r\n */\r\nexport function ModalOverlay({\r\n  isOpen,\r\n  onClose,\r\n  preventClose = false,\r\n  children,\r\n  className = '',\r\n}: ModalOverlayProps) {\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  \r\n  // Handle escape key\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape' && !preventClose) {\r\n        onClose();\r\n      }\r\n    };\r\n    \r\n    if (isOpen) {\r\n      document.addEventListener('keydown', handleKeyDown);\r\n      // Prevent body scroll\r\n      document.body.style.overflow = 'hidden';\r\n    }\r\n    \r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n      document.body.style.overflow = '';\r\n    };\r\n  }, [isOpen, onClose, preventClose]);\r\n  \r\n  // Focus trap\r\n  useEffect(() => {\r\n    if (isOpen && modalRef.current) {\r\n      const focusableElements = modalRef.current.querySelectorAll<HTMLElement>(\r\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n      );\r\n      const firstElement = focusableElements[0];\r\n      const lastElement = focusableElements[focusableElements.length - 1];\r\n      \r\n      const handleTabKey = (e: KeyboardEvent) => {\r\n        if (e.key !== 'Tab') return;\r\n        \r\n        if (e.shiftKey && document.activeElement === firstElement) {\r\n          e.preventDefault();\r\n          lastElement?.focus();\r\n        } else if (!e.shiftKey && document.activeElement === lastElement) {\r\n          e.preventDefault();\r\n          firstElement?.focus();\r\n        }\r\n      };\r\n      \r\n      document.addEventListener('keydown', handleTabKey);\r\n      firstElement?.focus();\r\n      \r\n      return () => {\r\n        document.removeEventListener('keydown', handleTabKey);\r\n      };\r\n    }\r\n  }, [isOpen]);\r\n  \r\n  if (!isOpen) return null;\r\n  \r\n  const handleOverlayClick = (e: React.MouseEvent) => {\r\n    if (e.target === e.currentTarget && !preventClose) {\r\n      onClose();\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60\"\r\n      onClick={handleOverlayClick}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        className={`bg-slate-800 rounded-lg border border-slate-700 shadow-xl ${className}`}\r\n        role=\"dialog\"\r\n        aria-modal=\"true\"\r\n      >\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\dialogs\\OverwriteConfirmDialog.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":37,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":37,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'newUnitName' is defined but never used. Allowed unused args must match /^_/u.","line":39,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Overwrite Confirmation Dialog Component\r\n * \r\n * Confirms whether the user wants to overwrite an existing custom unit\r\n * or save with a new name instead.\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { ModalOverlay } from './ModalOverlay';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface OverwriteConfirmDialogProps {\r\n  /** Whether dialog is open */\r\n  isOpen: boolean;\r\n  /** Name of the unit being saved */\r\n  newUnitName: string;\r\n  /** Name of the existing unit that would be overwritten */\r\n  existingUnitName: string;\r\n  /** Called when user chooses to overwrite */\r\n  onOverwrite: () => void;\r\n  /** Called when user chooses to save as new (different name) */\r\n  onSaveAsNew: () => void;\r\n  /** Called when user cancels */\r\n  onCancel: () => void;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\nexport function OverwriteConfirmDialog({\r\n  isOpen,\r\n  newUnitName,\r\n  existingUnitName,\r\n  onOverwrite,\r\n  onSaveAsNew,\r\n  onCancel,\r\n}: OverwriteConfirmDialogProps) {\r\n  return (\r\n    <ModalOverlay\r\n      isOpen={isOpen}\r\n      onClose={onCancel}\r\n      className=\"w-full max-w-md mx-4\"\r\n    >\r\n      {/* Header */}\r\n      <div className={cs.dialog.header}>\r\n        <h3 className={cs.dialog.headerTitle}>Unit Already Exists</h3>\r\n        <button onClick={onCancel} className={cs.dialog.closeBtn}>\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      \r\n      {/* Content */}\r\n      <div className=\"p-4\">\r\n        <div className=\"flex items-start gap-4\">\r\n          {/* Warning icon */}\r\n          <div className={cs.dialog.warningIcon}>\r\n            <svg className=\"w-6 h-6 text-amber-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n            </svg>\r\n          </div>\r\n          \r\n          {/* Message */}\r\n          <div className=\"flex-1\">\r\n            <p className=\"text-slate-300\">\r\n              A custom unit with this name already exists:\r\n            </p>\r\n            <p className=\"text-white font-medium mt-2 p-2 bg-slate-700/50 rounded\">\r\n              {existingUnitName}\r\n            </p>\r\n            <p className=\"text-slate-400 mt-3 text-sm\">\r\n              Would you like to overwrite the existing unit or save with a different name?\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Footer */}\r\n      <div className={cs.dialog.footer}>\r\n        <button onClick={onCancel} className={cs.dialog.btnGhost}>\r\n          Cancel\r\n        </button>\r\n        <button onClick={onSaveAsNew} className={cs.dialog.btnSecondary}>\r\n          Save As New\r\n        </button>\r\n        <button onClick={onOverwrite} className={cs.dialog.btnWarning}>\r\n          Overwrite\r\n        </button>\r\n      </div>\r\n    </ModalOverlay>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\dialogs\\ResetConfirmationDialog.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":72,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":72,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Reset Confirmation Dialog Component\r\n * \r\n * Multi-step confirmation dialog for reset operations.\r\n * \r\n * @spec openspec/specs/confirmation-dialogs/spec.md\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport { ModalOverlay } from './ModalOverlay';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\n/**\r\n * Reset option configuration\r\n */\r\nexport interface ResetOption {\r\n  /** Option identifier */\r\n  id: string;\r\n  /** Option title */\r\n  title: string;\r\n  /** Option description */\r\n  description: string;\r\n  /** What will be removed */\r\n  removes: string[];\r\n  /** What will be preserved */\r\n  preserves: string[];\r\n}\r\n\r\n/**\r\n * Default reset options\r\n */\r\nexport const DEFAULT_RESET_OPTIONS: ResetOption[] = [\r\n  {\r\n    id: 'equipment',\r\n    title: 'Reset Equipment Only',\r\n    description: 'Remove all mounted equipment and return to unallocated pool',\r\n    removes: ['Weapon placements', 'Equipment placements', 'Ammunition placements'],\r\n    preserves: ['Structure type', 'Armor allocation', 'Engine and gyro', 'Heat sinks'],\r\n  },\r\n  {\r\n    id: 'armor',\r\n    title: 'Reset Armor & Equipment',\r\n    description: 'Reset armor allocation and all equipment',\r\n    removes: ['All equipment', 'Armor allocation'],\r\n    preserves: ['Structure type', 'Engine and gyro', 'Base configuration'],\r\n  },\r\n  {\r\n    id: 'full',\r\n    title: 'Full Reset',\r\n    description: 'Reset to base chassis with no equipment',\r\n    removes: ['All equipment', 'Armor', 'Heat sinks', 'All modifications'],\r\n    preserves: ['Tonnage', 'Tech base', 'Basic chassis'],\r\n  },\r\n];\r\n\r\ntype DialogStep = 'select' | 'confirm' | 'progress' | 'result';\r\n\r\ninterface ResetConfirmationDialogProps {\r\n  /** Whether dialog is open */\r\n  isOpen: boolean;\r\n  /** Called when dialog is closed */\r\n  onClose: () => void;\r\n  /** Called when reset is confirmed */\r\n  onConfirm: (optionId: string) => Promise<void>;\r\n  /** Reset options */\r\n  options?: ResetOption[];\r\n}\r\n\r\n/**\r\n * Reset confirmation dialog with multiple options\r\n */\r\nexport function ResetConfirmationDialog({\r\n  isOpen,\r\n  onClose,\r\n  onConfirm,\r\n  options = DEFAULT_RESET_OPTIONS,\r\n}: ResetConfirmationDialogProps) {\r\n  const [step, setStep] = useState<DialogStep>('select');\r\n  const [selectedOption, setSelectedOption] = useState<ResetOption>(options[0]);\r\n  const [progress, setProgress] = useState(0);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  const handleClose = () => {\r\n    if (step !== 'progress') {\r\n      setStep('select');\r\n      setProgress(0);\r\n      setError(null);\r\n      onClose();\r\n    }\r\n  };\r\n  \r\n  const handleContinue = () => {\r\n    setStep('confirm');\r\n  };\r\n  \r\n  const handleConfirm = async () => {\r\n    setStep('progress');\r\n    setProgress(0);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Simulate progress\r\n      const progressInterval = setInterval(() => {\r\n        setProgress((p) => Math.min(p + 10, 90));\r\n      }, 100);\r\n      \r\n      await onConfirm(selectedOption.id);\r\n      \r\n      clearInterval(progressInterval);\r\n      setProgress(100);\r\n      setStep('result');\r\n      \r\n      // Auto-close on success\r\n      setTimeout(() => {\r\n        handleClose();\r\n      }, 2000);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Reset failed');\r\n      setStep('result');\r\n    }\r\n  };\r\n  \r\n  const handleBack = () => {\r\n    setStep('select');\r\n  };\r\n  \r\n  return (\r\n    <ModalOverlay\r\n      isOpen={isOpen}\r\n      onClose={handleClose}\r\n      preventClose={step === 'progress'}\r\n      className=\"w-full max-w-lg mx-4\"\r\n    >\r\n      {/* Header */}\r\n      <div className={cs.dialog.header}>\r\n        <h2 className={cs.dialog.headerTitle}>Reset Configuration</h2>\r\n        {step !== 'progress' && (\r\n          <button onClick={handleClose} className={cs.dialog.closeBtn}>\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Content */}\r\n      <div className=\"p-4\">\r\n        {/* Step: Select Option */}\r\n        {step === 'select' && (\r\n          <div className=\"space-y-4\">\r\n            <p className=\"text-sm text-slate-400\">Choose what to reset:</p>\r\n            \r\n            {options.map((option) => (\r\n              <button\r\n                key={option.id}\r\n                onClick={() => setSelectedOption(option)}\r\n                className={`w-full p-4 rounded-lg border text-left transition-colors ${\r\n                  selectedOption.id === option.id\r\n                    ? 'border-blue-500 bg-blue-900/20'\r\n                    : 'border-slate-600 hover:border-slate-500'\r\n                }`}\r\n              >\r\n                <div className=\"font-medium text-white\">{option.title}</div>\r\n                <div className=\"text-sm text-slate-400 mt-1\">{option.description}</div>\r\n              </button>\r\n            ))}\r\n            \r\n            {/* Impact preview */}\r\n            <div className=\"grid grid-cols-2 gap-4 mt-4 pt-4 border-t border-slate-700\">\r\n              <div>\r\n                <h4 className=\"text-sm font-medium text-red-400 mb-2\">What Gets Removed</h4>\r\n                <ul className=\"space-y-1\">\r\n                  {selectedOption.removes.map((item, i) => (\r\n                    <li key={i} className=\"text-sm text-slate-300 flex items-center gap-2\">\r\n                      <span className=\"text-red-400\"></span>\r\n                      {item}\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n              <div>\r\n                <h4 className=\"text-sm font-medium text-green-400 mb-2\">What Gets Preserved</h4>\r\n                <ul className=\"space-y-1\">\r\n                  {selectedOption.preserves.map((item, i) => (\r\n                    <li key={i} className=\"text-sm text-slate-300 flex items-center gap-2\">\r\n                      <span className=\"text-green-400\"></span>\r\n                      {item}\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Step: Confirm */}\r\n        {step === 'confirm' && (\r\n          <div className=\"py-6 text-center\">\r\n            <div className=\"text-4xl mb-4\"></div>\r\n            <h3 className=\"text-lg font-medium text-white mb-2\">Are you sure?</h3>\r\n            <p className=\"text-slate-400\">\r\n              This will {selectedOption.title.toLowerCase()}. This action cannot be undone.\r\n            </p>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Step: Progress */}\r\n        {step === 'progress' && (\r\n          <div className=\"py-6\">\r\n            <div className=\"text-center mb-4\">\r\n              <div className=\"text-slate-400\">Resetting...</div>\r\n            </div>\r\n            <div className=\"w-full bg-slate-700 rounded-full h-2\">\r\n              <div\r\n                className=\"bg-amber-500 h-2 rounded-full transition-all\"\r\n                style={{ width: `${progress}%` }}\r\n              />\r\n            </div>\r\n            <div className=\"text-center mt-2 text-sm text-slate-400\">\r\n              {progress}%\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {/* Step: Result */}\r\n        {step === 'result' && (\r\n          <div className=\"py-6 text-center\">\r\n            {error ? (\r\n              <>\r\n                <div className=\"text-4xl mb-4\"></div>\r\n                <h3 className=\"text-lg font-medium text-red-400 mb-2\">Reset Failed</h3>\r\n                <p className=\"text-slate-400\">{error}</p>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <div className=\"text-4xl mb-4\"></div>\r\n                <h3 className=\"text-lg font-medium text-green-400 mb-2\">Reset Complete</h3>\r\n                <p className=\"text-slate-400\">Configuration has been reset successfully.</p>\r\n              </>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Footer */}\r\n      <div className={cs.dialog.footer}>\r\n        {step === 'select' && (\r\n          <>\r\n            <button onClick={handleClose} className={cs.dialog.btnGhost}>\r\n              Cancel\r\n            </button>\r\n            <button onClick={handleContinue} className={cs.dialog.btnDanger}>\r\n              Continue with Reset\r\n            </button>\r\n          </>\r\n        )}\r\n        \r\n        {step === 'confirm' && (\r\n          <>\r\n            <button onClick={handleBack} className={cs.dialog.btnGhost}>\r\n              Back\r\n            </button>\r\n            <button onClick={handleConfirm} className={cs.dialog.btnDanger}>\r\n              Confirm Reset\r\n            </button>\r\n          </>\r\n        )}\r\n        \r\n        {step === 'result' && error && (\r\n          <button onClick={handleClose} className={cs.dialog.btnGhost}>\r\n            Close\r\n          </button>\r\n        )}\r\n      </div>\r\n    </ModalOverlay>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\dialogs\\SaveUnitDialog.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":46,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":46,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Save Unit Dialog Component\r\n * \r\n * Dialog for saving a unit with Chassis and Variant name inputs.\r\n * Validates against canonical and custom units to prevent conflicts.\r\n * \r\n * - Canonical unit conflicts are BLOCKED (cannot save)\r\n * - Custom unit conflicts offer overwrite option\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { ModalOverlay } from './ModalOverlay';\r\nimport {\r\n  unitNameValidator,\r\n  INameValidationResult,\r\n} from '@/services/units/UnitNameValidator';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface SaveUnitDialogProps {\r\n  /** Whether dialog is open */\r\n  isOpen: boolean;\r\n  /** Initial chassis name */\r\n  initialChassis: string;\r\n  /** Initial variant name */\r\n  initialVariant: string;\r\n  /** Current unit ID (for excluding from conflict check during updates) */\r\n  currentUnitId?: string;\r\n  /** Called when save is confirmed */\r\n  onSave: (chassis: string, variant: string, overwriteId?: string) => void;\r\n  /** Called when dialog is cancelled */\r\n  onCancel: () => void;\r\n}\r\n\r\ntype ValidationStatus = 'idle' | 'validating' | 'valid' | 'canonical-conflict' | 'custom-conflict' | 'error';\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\nexport function SaveUnitDialog({\r\n  isOpen,\r\n  initialChassis,\r\n  initialVariant,\r\n  currentUnitId,\r\n  onSave,\r\n  onCancel,\r\n}: SaveUnitDialogProps) {\r\n  // Form state\r\n  const [chassis, setChassis] = useState(initialChassis);\r\n  const [variant, setVariant] = useState(initialVariant);\r\n  \r\n  // Validation state\r\n  const [status, setStatus] = useState<ValidationStatus>('idle');\r\n  const [validationResult, setValidationResult] = useState<INameValidationResult | null>(null);\r\n  const [validationDebounce, setValidationDebounce] = useState<NodeJS.Timeout | null>(null);\r\n  \r\n  // Reset form when dialog opens\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setChassis(initialChassis);\r\n      setVariant(initialVariant);\r\n      setStatus('idle');\r\n      setValidationResult(null);\r\n    }\r\n  }, [isOpen, initialChassis, initialVariant]);\r\n  \r\n  // Validate name with debounce\r\n  const validateName = useCallback(async (chassisValue: string, variantValue: string) => {\r\n    if (!chassisValue.trim() || !variantValue.trim()) {\r\n      setStatus('idle');\r\n      setValidationResult(null);\r\n      return;\r\n    }\r\n    \r\n    setStatus('validating');\r\n    \r\n    try {\r\n      const result = await unitNameValidator.validateUnitName(\r\n        chassisValue,\r\n        variantValue,\r\n        currentUnitId\r\n      );\r\n      \r\n      setValidationResult(result);\r\n      \r\n      if (result.isCanonicalConflict) {\r\n        setStatus('canonical-conflict');\r\n      } else if (result.isCustomConflict) {\r\n        setStatus('custom-conflict');\r\n      } else if (result.isValid) {\r\n        setStatus('valid');\r\n      } else {\r\n        setStatus('error');\r\n      }\r\n    } catch (error) {\r\n      console.error('Validation error:', error);\r\n      setStatus('error');\r\n      setValidationResult({\r\n        isValid: false,\r\n        isCanonicalConflict: false,\r\n        isCustomConflict: false,\r\n        errorMessage: 'Failed to validate name',\r\n      });\r\n    }\r\n  }, [currentUnitId]);\r\n  \r\n  // Handle input changes with debounced validation\r\n  const handleChassisChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = e.target.value;\r\n    setChassis(value);\r\n    \r\n    // Clear existing debounce\r\n    if (validationDebounce) {\r\n      clearTimeout(validationDebounce);\r\n    }\r\n    \r\n    // Debounce validation\r\n    const timeout = setTimeout(() => {\r\n      validateName(value, variant);\r\n    }, 300);\r\n    setValidationDebounce(timeout);\r\n  };\r\n  \r\n  const handleVariantChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = e.target.value;\r\n    setVariant(value);\r\n    \r\n    // Clear existing debounce\r\n    if (validationDebounce) {\r\n      clearTimeout(validationDebounce);\r\n    }\r\n    \r\n    // Debounce validation\r\n    const timeout = setTimeout(() => {\r\n      validateName(chassis, value);\r\n    }, 300);\r\n    setValidationDebounce(timeout);\r\n  };\r\n  \r\n  // Handle save action\r\n  const handleSave = () => {\r\n    if (status === 'canonical-conflict') {\r\n      // Cannot save - blocked\r\n      return;\r\n    }\r\n    \r\n    if (status === 'custom-conflict' && validationResult?.conflictingUnitId) {\r\n      // Save with overwrite\r\n      onSave(chassis.trim(), variant.trim(), validationResult.conflictingUnitId);\r\n    } else {\r\n      // Save as new\r\n      onSave(chassis.trim(), variant.trim());\r\n    }\r\n  };\r\n  \r\n  // Handle save as new (different name to avoid conflict)\r\n  const handleSaveAsNew = () => {\r\n    if (!validationResult?.suggestedName) return;\r\n    \r\n    // Parse suggested name back into chassis/variant\r\n    // Suggested name format is \"Chassis Variant\"\r\n    const suggested = validationResult.suggestedName;\r\n    const spaceIndex = suggested.indexOf(' ');\r\n    if (spaceIndex > 0) {\r\n      const suggestedVariant = suggested.substring(spaceIndex + 1);\r\n      setVariant(suggestedVariant);\r\n      validateName(chassis, suggestedVariant);\r\n    }\r\n  };\r\n  \r\n  // Auto-suggest unique name\r\n  const handleAutoSuggest = async () => {\r\n    try {\r\n      const suggested = await unitNameValidator.generateUniqueName(chassis, variant);\r\n      setVariant(suggested.variant);\r\n      validateName(chassis, suggested.variant);\r\n    } catch (error) {\r\n      console.error('Failed to generate unique name:', error);\r\n    }\r\n  };\r\n  \r\n  // Determine button states\r\n  const isValidating = status === 'validating';\r\n  const canSave = (status === 'valid' || status === 'custom-conflict') && !isValidating;\r\n  const isBlocked = status === 'canonical-conflict';\r\n  const hasConflict = status === 'custom-conflict' || status === 'canonical-conflict';\r\n  \r\n  // Get status indicator\r\n  const getStatusIndicator = () => {\r\n    switch (status) {\r\n      case 'validating':\r\n        return (\r\n          <div className=\"flex items-center gap-2 text-slate-400\">\r\n            <svg className=\"w-4 h-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n              <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\r\n              <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\r\n            </svg>\r\n            <span className=\"text-sm\">Checking availability...</span>\r\n          </div>\r\n        );\r\n      case 'valid':\r\n        return (\r\n          <div className=\"flex items-center gap-2 text-green-400\">\r\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n            </svg>\r\n            <span className=\"text-sm\">Name is available</span>\r\n          </div>\r\n        );\r\n      case 'canonical-conflict':\r\n        return (\r\n          <div className=\"flex items-center gap-2 text-red-400\">\r\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n            <span className=\"text-sm\">{validationResult?.errorMessage || 'Conflicts with official unit'}</span>\r\n          </div>\r\n        );\r\n      case 'custom-conflict':\r\n        return (\r\n          <div className=\"flex items-center gap-2 text-amber-400\">\r\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n            </svg>\r\n            <span className=\"text-sm\">Conflicts with existing custom unit</span>\r\n          </div>\r\n        );\r\n      case 'error':\r\n        return (\r\n          <div className=\"flex items-center gap-2 text-red-400\">\r\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <span className=\"text-sm\">{validationResult?.errorMessage || 'Invalid name'}</span>\r\n          </div>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <ModalOverlay\r\n      isOpen={isOpen}\r\n      onClose={onCancel}\r\n      className=\"w-full max-w-lg mx-4\"\r\n    >\r\n      {/* Header */}\r\n      <div className={cs.dialog.header}>\r\n        <h3 className={cs.dialog.headerTitle}>Save Unit</h3>\r\n        <button onClick={onCancel} className={cs.dialog.closeBtn}>\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      \r\n      {/* Form */}\r\n      <div className={cs.dialog.content}>\r\n        {/* Chassis input */}\r\n        <div>\r\n          <label htmlFor=\"chassis\" className=\"block text-sm font-medium text-slate-300 mb-1\">\r\n            Chassis Name\r\n          </label>\r\n          <input\r\n            id=\"chassis\"\r\n            type=\"text\"\r\n            value={chassis}\r\n            onChange={handleChassisChange}\r\n            placeholder=\"e.g., Atlas, Timber Wolf\"\r\n            className={`${cs.dialog.input} ${\r\n              isBlocked \r\n                ? 'border-red-500 focus:ring-red-500' \r\n                : status === 'custom-conflict'\r\n                  ? 'border-amber-500 focus:ring-amber-500'\r\n                  : ''\r\n            }`}\r\n          />\r\n        </div>\r\n        \r\n        {/* Variant input */}\r\n        <div>\r\n          <label htmlFor=\"variant\" className=\"block text-sm font-medium text-slate-300 mb-1\">\r\n            Variant Designation\r\n          </label>\r\n          <div className=\"flex gap-2\">\r\n            <input\r\n              id=\"variant\"\r\n              type=\"text\"\r\n              value={variant}\r\n              onChange={handleVariantChange}\r\n              placeholder=\"e.g., AS7-D, Prime\"\r\n              className={`flex-1 ${cs.dialog.input} ${\r\n                isBlocked \r\n                  ? 'border-red-500 focus:ring-red-500' \r\n                  : status === 'custom-conflict'\r\n                    ? 'border-amber-500 focus:ring-amber-500'\r\n                    : ''\r\n              }`}\r\n            />\r\n            {hasConflict && (\r\n              <button\r\n                onClick={handleAutoSuggest}\r\n                className={cs.dialog.btnSecondary}\r\n                title=\"Suggest unique name\"\r\n              >\r\n                Suggest\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Validation status */}\r\n        <div className=\"min-h-[24px]\">\r\n          {getStatusIndicator()}\r\n        </div>\r\n        \r\n        {/* Preview */}\r\n        {chassis.trim() && variant.trim() && (\r\n          <div className={cs.dialog.infoPanel}>\r\n            <div className=\"text-xs text-slate-400 mb-1\">Full Unit Name:</div>\r\n            <div className=\"text-white font-medium\">\r\n              {unitNameValidator.buildFullName(chassis.trim(), variant.trim())}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Footer */}\r\n      <div className={cs.dialog.footer}>\r\n        <button onClick={onCancel} className={cs.dialog.btnGhost}>\r\n          Cancel\r\n        </button>\r\n        \r\n        {status === 'custom-conflict' && validationResult?.suggestedName && (\r\n          <button onClick={handleSaveAsNew} className={cs.dialog.btnSecondary}>\r\n            Save As New\r\n          </button>\r\n        )}\r\n        \r\n        <button\r\n          onClick={handleSave}\r\n          disabled={!canSave}\r\n          className={`min-w-[100px] ${\r\n            canSave\r\n              ? status === 'custom-conflict'\r\n                ? cs.dialog.btnWarning\r\n                : cs.dialog.btnPrimary\r\n              : cs.dialog.btnPrimary\r\n          }`}\r\n        >\r\n          {status === 'custom-conflict' ? 'Overwrite' : 'Save'}\r\n        </button>\r\n      </div>\r\n    </ModalOverlay>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\dialogs\\UnitLoadDialog.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":50,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":50,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Load Dialog Component\r\n * \r\n * Dialog for loading existing units (canonical or custom) into a new tab.\r\n * Provides search and filtering capabilities.\r\n * \r\n * @spec openspec/specs/customizer-toolbar/spec.md\r\n */\r\n\r\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { ModalOverlay } from './ModalOverlay';\r\nimport { canonicalUnitService } from '@/services/units/CanonicalUnitService';\r\nimport { customUnitApiService } from '@/services/units/CustomUnitApiService';\r\nimport { IUnitIndexEntry, UnitType } from '@/services/common/types';\r\nimport { ICustomUnitIndexEntry } from '@/types/persistence/UnitPersistence';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { WeightClass } from '@/types/enums/WeightClass';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\n/**\r\n * Source of the unit being loaded\r\n */\r\nexport type LoadUnitSource = 'canonical' | 'custom';\r\n\r\nexport interface UnitLoadDialogProps {\r\n  /** Whether dialog is open */\r\n  isOpen: boolean;\r\n  /** Called when a unit is selected for loading */\r\n  onLoadUnit: (unit: IUnitIndexEntry, source: LoadUnitSource) => void;\r\n  /** Called when dialog is cancelled */\r\n  onCancel: () => void;\r\n}\r\n\r\ntype UnitSource = 'all' | 'canonical' | 'custom';\r\n\r\ninterface UnitWithSource extends IUnitIndexEntry {\r\n  source: 'canonical' | 'custom';\r\n  currentVersion?: number;\r\n  year?: number;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\nexport function UnitLoadDialog({\r\n  isOpen,\r\n  onLoadUnit,\r\n  onCancel,\r\n}: UnitLoadDialogProps) {\r\n  // Search and filter state\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [techBaseFilter, setTechBaseFilter] = useState<TechBase | 'all'>('all');\r\n  const [weightClassFilter, setWeightClassFilter] = useState<WeightClass | 'all'>('all');\r\n  const [sourceFilter, setSourceFilter] = useState<UnitSource>('all');\r\n  \r\n  // Data state\r\n  const [canonicalUnits, setCanonicalUnits] = useState<IUnitIndexEntry[]>([]);\r\n  const [customUnits, setCustomUnits] = useState<ICustomUnitIndexEntry[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [selectedUnit, setSelectedUnit] = useState<UnitWithSource | null>(null);\r\n  \r\n  // Load units when dialog opens\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    \r\n    setIsLoading(true);\r\n    setSelectedUnit(null);\r\n    setSearchQuery('');\r\n    \r\n    Promise.all([\r\n      canonicalUnitService.getIndex(),\r\n      customUnitApiService.list(),\r\n    ]).then(([canonical, custom]) => {\r\n      setCanonicalUnits([...canonical]);\r\n      setCustomUnits([...custom]);\r\n      setIsLoading(false);\r\n    }).catch((error) => {\r\n      console.error('Failed to load units:', error);\r\n      setIsLoading(false);\r\n    });\r\n  }, [isOpen]);\r\n  \r\n  // Combine and filter units\r\n  const filteredUnits = useMemo(() => {\r\n    // Combine with source tagging\r\n    const allUnits: UnitWithSource[] = [\r\n      ...(sourceFilter !== 'custom' ? canonicalUnits.map(u => ({ ...u, source: 'canonical' as const })) : []),\r\n      ...(sourceFilter !== 'canonical' ? customUnits.map(u => ({ \r\n        id: u.id,\r\n        chassis: u.chassis,\r\n        variant: u.variant,\r\n        tonnage: u.tonnage,\r\n        techBase: u.techBase,\r\n        era: u.era,\r\n        weightClass: u.weightClass,\r\n        unitType: u.unitType as UnitType, // Cast string to UnitType\r\n        name: `${u.chassis} ${u.variant}`,\r\n        filePath: '', // Custom units don't have file paths\r\n        source: 'custom' as const,\r\n        currentVersion: u.currentVersion,\r\n      })) : []),\r\n    ];\r\n    \r\n    // Apply filters\r\n    return allUnits.filter(unit => {\r\n      // Search query\r\n      if (searchQuery) {\r\n        const query = searchQuery.toLowerCase();\r\n        const name = `${unit.chassis} ${unit.variant}`.toLowerCase();\r\n        if (!name.includes(query)) {\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      // Tech base filter\r\n      if (techBaseFilter !== 'all' && unit.techBase !== techBaseFilter) {\r\n        return false;\r\n      }\r\n      \r\n      // Weight class filter\r\n      if (weightClassFilter !== 'all' && unit.weightClass !== weightClassFilter) {\r\n        return false;\r\n      }\r\n      \r\n      return true;\r\n    }).sort((a, b) => {\r\n      // Sort: custom first, then by name\r\n      if (a.source !== b.source) {\r\n        return a.source === 'custom' ? -1 : 1;\r\n      }\r\n      return `${a.chassis} ${a.variant}`.localeCompare(`${b.chassis} ${b.variant}`);\r\n    });\r\n  }, [canonicalUnits, customUnits, searchQuery, techBaseFilter, weightClassFilter, sourceFilter]);\r\n  \r\n  // Handle load\r\n  const handleLoad = useCallback(() => {\r\n    if (selectedUnit) {\r\n      onLoadUnit(selectedUnit, selectedUnit.source);\r\n    }\r\n  }, [selectedUnit, onLoadUnit]);\r\n  \r\n  // Handle double-click to load immediately\r\n  const handleDoubleClick = useCallback((unit: UnitWithSource) => {\r\n    onLoadUnit(unit, unit.source);\r\n  }, [onLoadUnit]);\r\n  \r\n  return (\r\n    <ModalOverlay\r\n      isOpen={isOpen}\r\n      onClose={onCancel}\r\n      className=\"w-full max-w-3xl mx-4 max-h-[80vh] flex flex-col\"\r\n    >\r\n      {/* Header */}\r\n      <div className={cs.dialog.header}>\r\n        <h3 className={cs.dialog.headerTitle}>Load Unit from Library</h3>\r\n        <button onClick={onCancel} className={cs.dialog.closeBtn}>\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      \r\n      {/* Search and filters */}\r\n      <div className=\"p-4 border-b border-slate-700 space-y-3\">\r\n        {/* Search input */}\r\n        <div className=\"relative\">\r\n          <svg className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n          </svg>\r\n          <input\r\n            type=\"text\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            placeholder=\"Search by chassis or variant...\"\r\n            className={cs.dialog.inputSearch}\r\n          />\r\n        </div>\r\n        \r\n        {/* Filters */}\r\n        <div className=\"flex gap-3 flex-wrap\">\r\n          <select\r\n            value={sourceFilter}\r\n            onChange={(e) => setSourceFilter(e.target.value as UnitSource)}\r\n            className={cs.dialog.selectFilter}\r\n          >\r\n            <option value=\"all\">All Sources</option>\r\n            <option value=\"custom\">Custom Only</option>\r\n            <option value=\"canonical\">Official Only</option>\r\n          </select>\r\n          \r\n          <select\r\n            value={techBaseFilter}\r\n            onChange={(e) => setTechBaseFilter(e.target.value as TechBase | 'all')}\r\n            className={cs.dialog.selectFilter}\r\n          >\r\n            <option value=\"all\">All Tech Bases</option>\r\n            <option value={TechBase.INNER_SPHERE}>Inner Sphere</option>\r\n            <option value={TechBase.CLAN}>Clan</option>\r\n          </select>\r\n          \r\n          <select\r\n            value={weightClassFilter}\r\n            onChange={(e) => setWeightClassFilter(e.target.value as WeightClass | 'all')}\r\n            className={cs.dialog.selectFilter}\r\n          >\r\n            <option value=\"all\">All Weight Classes</option>\r\n            <option value={WeightClass.LIGHT}>Light (20-35t)</option>\r\n            <option value={WeightClass.MEDIUM}>Medium (40-55t)</option>\r\n            <option value={WeightClass.HEAVY}>Heavy (60-75t)</option>\r\n            <option value={WeightClass.ASSAULT}>Assault (80-100t)</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Unit table */}\r\n      <div className=\"flex-1 overflow-auto min-h-0\">\r\n        {isLoading ? (\r\n          <div className={cs.dialog.loading}>\r\n            <svg className=\"w-6 h-6 animate-spin mr-2\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n              <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\r\n              <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\r\n            </svg>\r\n            Loading units...\r\n          </div>\r\n        ) : filteredUnits.length === 0 ? (\r\n          <div className={cs.dialog.empty}>\r\n            <div className=\"text-center\">\r\n              <svg className={cs.dialog.emptyIcon} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              <p>No units found</p>\r\n              <p className=\"text-sm mt-1\">Try adjusting your search or filters</p>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <table className={cs.dialog.table}>\r\n            <thead className={cs.dialog.tableHeader}>\r\n              <tr>\r\n                <th className=\"px-3 py-2 font-medium\">Chassis</th>\r\n                <th className=\"px-3 py-2 font-medium\">Model</th>\r\n                <th className=\"px-3 py-2 font-medium text-right\">Weight</th>\r\n                <th className=\"px-3 py-2 font-medium text-right\">Year</th>\r\n                <th className=\"px-3 py-2 font-medium\">Tech</th>\r\n                <th className=\"px-3 py-2 font-medium\">Source</th>\r\n                <th className=\"w-8\"></th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className={cs.dialog.tableBody}>\r\n              {filteredUnits.map((unit) => (\r\n                <tr\r\n                  key={unit.id}\r\n                  onClick={() => setSelectedUnit(unit)}\r\n                  onDoubleClick={() => handleDoubleClick(unit)}\r\n                  className={`${cs.dialog.tableRow} ${\r\n                    selectedUnit?.id === unit.id ? cs.dialog.tableRowSelected : ''\r\n                  }`}\r\n                >\r\n                  <td className=\"px-3 py-1.5 text-white\">{unit.chassis}</td>\r\n                  <td className=\"px-3 py-1.5 text-slate-300\">\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      {unit.variant}\r\n                      {unit.source === 'custom' && unit.currentVersion && unit.currentVersion > 1 && (\r\n                        <span className=\"px-1 py-0.5 text-[10px] bg-blue-500/20 text-blue-400 rounded leading-none\">\r\n                          v{unit.currentVersion}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"px-3 py-1.5 text-slate-400 text-right tabular-nums\">{unit.tonnage} t</td>\r\n                  <td className=\"px-3 py-1.5 text-slate-400 text-right tabular-nums\">\r\n                    {unit.year ?? '-'}\r\n                  </td>\r\n                  <td className=\"px-3 py-1.5 text-slate-400\">\r\n                    {unit.techBase === TechBase.INNER_SPHERE ? 'IS' \r\n                      : unit.techBase === TechBase.CLAN ? 'Clan' \r\n                      : 'Mix'}\r\n                  </td>\r\n                  <td className=\"px-3 py-1.5\">\r\n                    {unit.source === 'custom' ? (\r\n                      <span className=\"text-amber-400\">Custom</span>\r\n                    ) : (\r\n                      <span className=\"text-slate-400\">{unit.era}</span>\r\n                    )}\r\n                  </td>\r\n                  <td className=\"px-2 py-1.5 text-right\">\r\n                    {selectedUnit?.id === unit.id && (\r\n                      <svg className=\"w-4 h-4 text-blue-400 inline-block\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                        <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\r\n                      </svg>\r\n                    )}\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Footer */}\r\n      <div className={cs.dialog.footerBetween}>\r\n        <span className=\"text-sm text-slate-400\">\r\n          {filteredUnits.length} unit{filteredUnits.length !== 1 ? 's' : ''} found\r\n        </span>\r\n        <div className=\"flex items-center gap-2\">\r\n          <button onClick={onCancel} className={cs.dialog.btnGhost}>\r\n            Cancel\r\n          </button>\r\n          <button\r\n            onClick={handleLoad}\r\n            disabled={!selectedUnit}\r\n            className={cs.dialog.btnPrimary}\r\n          >\r\n            Load Unit\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </ModalOverlay>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\dialogs\\UnsavedChangesDialog.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":35,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":35,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unsaved Changes Dialog Component\r\n * \r\n * Confirmation dialog for closing tabs with unsaved changes.\r\n * Matches MegaMekLab's \"Save Unit Before Proceeding?\" dialog style.\r\n * \r\n * @spec openspec/specs/multi-unit-tabs/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { ModalOverlay } from './ModalOverlay';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\ninterface UnsavedChangesDialogProps {\r\n  /** Whether dialog is open */\r\n  isOpen: boolean;\r\n  /** Unit name */\r\n  unitName: string;\r\n  /** Called when dialog is closed (Cancel) */\r\n  onClose: () => void;\r\n  /** Called when user confirms discard (No - don't save) */\r\n  onDiscard: () => void;\r\n  /** Called when user chooses to save (Yes - save first) */\r\n  onSave?: () => void;\r\n}\r\n\r\n/**\r\n * Unsaved changes warning dialog\r\n * \r\n * Three options like MegaMekLab:\r\n * - Yes: Save the unit first, then proceed\r\n * - No: Discard changes and proceed\r\n * - Cancel: Go back, don't close\r\n */\r\nexport function UnsavedChangesDialog({\r\n  isOpen,\r\n  unitName,\r\n  onClose,\r\n  onDiscard,\r\n  onSave,\r\n}: UnsavedChangesDialogProps) {\r\n  return (\r\n    <ModalOverlay\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      className=\"w-full max-w-md mx-4\"\r\n    >\r\n      {/* Header */}\r\n      <div className={cs.dialog.header}>\r\n        <h3 className={cs.dialog.headerTitle}>Save Unit Before Proceeding?</h3>\r\n        <button onClick={onClose} className={cs.dialog.closeBtn}>\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      \r\n      {/* Content */}\r\n      <div className=\"p-4\">\r\n        <div className=\"flex items-start gap-4\">\r\n          {/* Warning icon */}\r\n          <div className={cs.dialog.warningIcon}>\r\n            <svg className=\"w-6 h-6 text-amber-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n            </svg>\r\n          </div>\r\n          \r\n          {/* Message */}\r\n          <div className=\"flex-1\">\r\n            <p className=\"text-slate-300\">\r\n              All unsaved changes in the current unit will be discarded.\r\n            </p>\r\n            <p className=\"text-slate-400 mt-1\">\r\n              Save the unit first?\r\n            </p>\r\n            {unitName && (\r\n              <p className=\"text-slate-500 text-sm mt-2 font-mono\">\r\n                Unit: {unitName}\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Footer - Yes/No/Cancel buttons like MegaMekLab */}\r\n      <div className={cs.dialog.footer}>\r\n        {onSave && (\r\n          <button onClick={onSave} className={`min-w-[80px] ${cs.dialog.btnPrimary}`}>\r\n            Yes\r\n          </button>\r\n        )}\r\n        <button onClick={onDiscard} className={`min-w-[80px] ${cs.dialog.btnSecondary}`}>\r\n          No\r\n        </button>\r\n        <button onClick={onClose} className={`min-w-[80px] ${cs.dialog.btnGhost} bg-slate-700 hover:bg-slate-600 rounded`}>\r\n          Cancel\r\n        </button>\r\n      </div>\r\n    </ModalOverlay>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\dialogs\\VersionHistoryDialog.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":38,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":38,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Version History Dialog Component\r\n * \r\n * Dialog for viewing unit version history and reverting to previous versions.\r\n * \r\n * @spec openspec/specs/unit-versioning/spec.md\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { ModalOverlay } from './ModalOverlay';\r\nimport { customUnitApiService, IVersionWithData } from '@/services/units/CustomUnitApiService';\r\nimport { IVersionMetadata } from '@/types/persistence/UnitPersistence';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface VersionHistoryDialogProps {\r\n  /** Whether dialog is open */\r\n  isOpen: boolean;\r\n  /** Unit ID to show history for */\r\n  unitId: string;\r\n  /** Unit name for display */\r\n  unitName: string;\r\n  /** Current version number */\r\n  currentVersion: number;\r\n  /** Called when a version is selected for revert */\r\n  onRevert: (version: number) => void;\r\n  /** Called when dialog is closed */\r\n  onClose: () => void;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\nexport function VersionHistoryDialog({\r\n  isOpen,\r\n  unitId,\r\n  unitName,\r\n  currentVersion,\r\n  onRevert,\r\n  onClose,\r\n}: VersionHistoryDialogProps) {\r\n  // State\r\n  const [versions, setVersions] = useState<readonly IVersionMetadata[]>([]);\r\n  const [selectedVersion, setSelectedVersion] = useState<number | null>(null);\r\n  const [previewData, setPreviewData] = useState<IVersionWithData | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isLoadingPreview, setIsLoadingPreview] = useState(false);\r\n  const [isReverting, setIsReverting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Load version history when dialog opens\r\n  useEffect(() => {\r\n    if (!isOpen || !unitId) return;\r\n    \r\n    setIsLoading(true);\r\n    setError(null);\r\n    setSelectedVersion(null);\r\n    setPreviewData(null);\r\n    \r\n    customUnitApiService.getVersionHistory(unitId)\r\n      .then(setVersions)\r\n      .catch(err => {\r\n        console.error('Failed to load version history:', err);\r\n        setError('Failed to load version history');\r\n      })\r\n      .finally(() => setIsLoading(false));\r\n  }, [isOpen, unitId]);\r\n  \r\n  // Load version preview when selection changes\r\n  useEffect(() => {\r\n    if (!selectedVersion || !unitId) {\r\n      setPreviewData(null);\r\n      return;\r\n    }\r\n    \r\n    setIsLoadingPreview(true);\r\n    \r\n    customUnitApiService.getVersion(unitId, selectedVersion)\r\n      .then(setPreviewData)\r\n      .catch(err => {\r\n        console.error('Failed to load version preview:', err);\r\n        setPreviewData(null);\r\n      })\r\n      .finally(() => setIsLoadingPreview(false));\r\n  }, [unitId, selectedVersion]);\r\n  \r\n  // Handle revert\r\n  const handleRevert = useCallback(async () => {\r\n    if (!selectedVersion || selectedVersion === currentVersion) return;\r\n    \r\n    setIsReverting(true);\r\n    try {\r\n      const result = await customUnitApiService.revert(unitId, selectedVersion);\r\n      \r\n      if (result.success) {\r\n        onRevert(selectedVersion);\r\n        onClose();\r\n      } else {\r\n        setError(result.error || 'Failed to revert');\r\n      }\r\n    } catch (err) {\r\n      console.error('Revert error:', err);\r\n      setError('Failed to revert to selected version');\r\n    } finally {\r\n      setIsReverting(false);\r\n    }\r\n  }, [unitId, selectedVersion, currentVersion, onRevert, onClose]);\r\n  \r\n  // Format date for display\r\n  const formatDate = (isoString: string) => {\r\n    const date = new Date(isoString);\r\n    return date.toLocaleString(undefined, {\r\n      dateStyle: 'medium',\r\n      timeStyle: 'short',\r\n    });\r\n  };\r\n  \r\n  return (\r\n    <ModalOverlay\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      className=\"w-full max-w-4xl mx-4 max-h-[80vh] flex flex-col\"\r\n    >\r\n      {/* Header */}\r\n      <div className={cs.dialog.header}>\r\n        <div>\r\n          <h3 className={cs.dialog.headerTitle}>Version History</h3>\r\n          <p className={cs.dialog.headerSubtitle}>{unitName}</p>\r\n        </div>\r\n        <button onClick={onClose} className={cs.dialog.closeBtn}>\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      \r\n      {/* Content */}\r\n      <div className=\"flex-1 flex overflow-hidden min-h-0\">\r\n        {/* Version list */}\r\n        <div className=\"w-1/3 border-r border-slate-700 overflow-auto\">\r\n          {isLoading ? (\r\n            <div className={cs.dialog.loading}>\r\n              <svg className=\"w-6 h-6 animate-spin mr-2\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\r\n                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\" />\r\n              </svg>\r\n              Loading...\r\n            </div>\r\n          ) : error ? (\r\n            <div className=\"p-4 text-red-400 text-center\">\r\n              <svg className=\"w-8 h-8 mx-auto mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n              </svg>\r\n              {error}\r\n            </div>\r\n          ) : versions.length === 0 ? (\r\n            <div className=\"p-4 text-slate-400 text-center\">\r\n              No version history\r\n            </div>\r\n          ) : (\r\n            <div className=\"divide-y divide-slate-700\">\r\n              {versions.map((version) => (\r\n                <button\r\n                  key={version.version}\r\n                  onClick={() => setSelectedVersion(version.version)}\r\n                  className={`w-full p-3 text-left transition-colors border-l-2 ${\r\n                    selectedVersion === version.version\r\n                      ? 'bg-blue-600/20 border-blue-500'\r\n                      : 'hover:bg-slate-700/50 border-transparent'\r\n                  }`}\r\n                >\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className=\"text-white font-medium\">v{version.version}</span>\r\n                      {version.version === currentVersion && (\r\n                        <span className=\"px-1.5 py-0.5 text-xs bg-green-500/20 text-green-400 rounded\">\r\n                          Current\r\n                        </span>\r\n                      )}\r\n                      {version.revertSource && (\r\n                        <span className=\"px-1.5 py-0.5 text-xs bg-amber-500/20 text-amber-400 rounded\">\r\n                          Reverted\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-xs text-slate-400 mt-1\">\r\n                    {formatDate(version.savedAt)}\r\n                  </div>\r\n                  {version.notes && (\r\n                    <div className=\"text-xs text-slate-500 mt-1 truncate\">\r\n                      {version.notes}\r\n                    </div>\r\n                  )}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Preview panel */}\r\n        <div className=\"flex-1 overflow-auto p-4\">\r\n          {selectedVersion === null ? (\r\n            <div className={`${cs.dialog.empty} h-full`}>\r\n              <div className=\"text-center\">\r\n                <svg className={cs.dialog.emptyIcon} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                <p>Select a version to preview</p>\r\n              </div>\r\n            </div>\r\n          ) : isLoadingPreview ? (\r\n            <div className={`${cs.dialog.loading} h-full`}>\r\n              <svg className=\"w-6 h-6 animate-spin mr-2\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\r\n                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\" />\r\n              </svg>\r\n              Loading preview...\r\n            </div>\r\n          ) : previewData ? (\r\n            (() => {\r\n              // Extract values with type assertions for safe rendering\r\n              const unitData = previewData.data;\r\n              const tonnageStr = String(unitData.tonnage ?? 'N/A');\r\n              const techBaseStr = String(unitData.techBase ?? 'N/A');\r\n              const eraStr = String(unitData.era ?? 'N/A');\r\n              const rulesLevelStr = String((unitData as Record<string, unknown>).rulesLevel ?? 'N/A');\r\n              const equipmentArr = (unitData as Record<string, unknown>).equipment as unknown[] | undefined;\r\n              const equipmentCount = equipmentArr?.length ?? 0;\r\n              \r\n              return (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <h4 className=\"text-white font-medium\">Version {previewData.version} Details</h4>\r\n                    <span className=\"text-sm text-slate-400\">\r\n                      Saved {formatDate(previewData.savedAt)}\r\n                    </span>\r\n                  </div>\r\n                  \r\n                  {previewData.notes && (\r\n                    <div className={cs.dialog.infoPanel}>\r\n                      <div className=\"text-xs text-slate-400 mb-1\">Notes:</div>\r\n                      <div className=\"text-white\">{previewData.notes}</div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {previewData.revertSource && (\r\n                    <div className={cs.dialog.warningPanel}>\r\n                      <div className=\"text-amber-400 text-sm\">\r\n                        This version was created by reverting from version {previewData.revertSource}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Unit summary */}\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className={cs.dialog.infoPanel}>\r\n                      <div className=\"text-xs text-slate-400 mb-1\">Tonnage</div>\r\n                      <div className=\"text-white\">{tonnageStr}t</div>\r\n                    </div>\r\n                    <div className={cs.dialog.infoPanel}>\r\n                      <div className=\"text-xs text-slate-400 mb-1\">Tech Base</div>\r\n                      <div className=\"text-white\">{techBaseStr}</div>\r\n                    </div>\r\n                    <div className={cs.dialog.infoPanel}>\r\n                      <div className=\"text-xs text-slate-400 mb-1\">Era</div>\r\n                      <div className=\"text-white\">{eraStr}</div>\r\n                    </div>\r\n                    <div className={cs.dialog.infoPanel}>\r\n                      <div className=\"text-xs text-slate-400 mb-1\">Rules Level</div>\r\n                      <div className=\"text-white\">{rulesLevelStr}</div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Equipment count if available */}\r\n                  {equipmentArr && (\r\n                    <div className={cs.dialog.infoPanel}>\r\n                      <div className=\"text-xs text-slate-400 mb-1\">Equipment</div>\r\n                      <div className=\"text-white\">\r\n                        {equipmentCount} items\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })()\r\n          ) : (\r\n            <div className={`${cs.dialog.empty} h-full`}>\r\n              Failed to load preview\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Footer */}\r\n      <div className={cs.dialog.footerBetween}>\r\n        <span className=\"text-sm text-slate-400\">\r\n          {versions.length} version{versions.length !== 1 ? 's' : ''} available\r\n        </span>\r\n        <div className=\"flex items-center gap-2\">\r\n          <button onClick={onClose} className={cs.dialog.btnGhost}>\r\n            Close\r\n          </button>\r\n          <button\r\n            onClick={handleRevert}\r\n            disabled={!selectedVersion || selectedVersion === currentVersion || isReverting}\r\n            className={`min-w-[120px] ${\r\n              selectedVersion && selectedVersion !== currentVersion && !isReverting\r\n                ? cs.dialog.btnWarning\r\n                : cs.dialog.btnPrimary\r\n            }`}\r\n          >\r\n            {isReverting ? (\r\n              <span className=\"flex items-center gap-2\">\r\n                <svg className=\"w-4 h-4 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\r\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\" />\r\n                </svg>\r\n                Reverting...\r\n              </span>\r\n            ) : (\r\n              `Revert to v${selectedVersion || '?'}`\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </ModalOverlay>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\dialogs\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\equipment\\CategoryToggleBar.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":87,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":87,"endColumn":34},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":162,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":162,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Category Toggle Bar Component\r\n * \r\n * Toggle button filters for equipment categories.\r\n * Replaces dropdown with scannable buttons like MekLab.\r\n * \r\n * @spec openspec/changes/unify-equipment-tab/specs/equipment-browser/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport { categoryToColorType, getEquipmentColors } from '@/utils/colors/equipmentColors';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\ninterface CategoryToggleBarProps {\r\n  /** Currently active categories */\r\n  activeCategories: Set<EquipmentCategory>;\r\n  /** Called when category is selected. isMultiSelect is true when Ctrl+click. */\r\n  onSelectCategory: (category: EquipmentCategory, isMultiSelect: boolean) => void;\r\n  /** Called to show all categories */\r\n  onShowAll: () => void;\r\n  /** Is \"Show All\" currently active */\r\n  showAll: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\ninterface HideToggleBarProps {\r\n  /** Hide prototype equipment */\r\n  hidePrototype: boolean;\r\n  /** Hide one-shot equipment */\r\n  hideOneShot: boolean;\r\n  /** Hide unavailable equipment (tech base/era incompatible) */\r\n  hideUnavailable: boolean;\r\n  /** Toggle handlers */\r\n  onTogglePrototype: () => void;\r\n  onToggleOneShot: () => void;\r\n  onToggleUnavailable: () => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n// =============================================================================\r\n// Category Configuration\r\n// =============================================================================\r\n\r\ninterface CategoryConfig {\r\n  category: EquipmentCategory;\r\n  label: string;\r\n  shortLabel: string;\r\n}\r\n\r\n/**\r\n * Primary category buttons displayed in the filter bar.\r\n * \"Other\" is treated as a combined category that includes both\r\n * MISC_EQUIPMENT and ELECTRONICS (catch-all for non-weapon/ammo items).\r\n */\r\nconst CATEGORY_CONFIGS: CategoryConfig[] = [\r\n  { category: EquipmentCategory.ENERGY_WEAPON, label: 'Energy', shortLabel: 'Energy' },\r\n  { category: EquipmentCategory.BALLISTIC_WEAPON, label: 'Ballistic', shortLabel: 'Ball' },\r\n  { category: EquipmentCategory.MISSILE_WEAPON, label: 'Missile', shortLabel: 'Msl' },\r\n  { category: EquipmentCategory.ARTILLERY, label: 'Artillery', shortLabel: 'Art' },\r\n  { category: EquipmentCategory.PHYSICAL_WEAPON, label: 'Physical', shortLabel: 'Phys' },\r\n  { category: EquipmentCategory.AMMUNITION, label: 'Ammo', shortLabel: 'Ammo' },\r\n  { category: EquipmentCategory.MISC_EQUIPMENT, label: 'Other', shortLabel: 'Other' },\r\n];\r\n\r\n/**\r\n * Categories that should be included when \"Other\" (MISC_EQUIPMENT) is toggled.\r\n * This makes \"Other\" a catch-all for anything not in primary weapon/ammo categories.\r\n */\r\nexport const OTHER_COMBINED_CATEGORIES: readonly EquipmentCategory[] = [\r\n  EquipmentCategory.MISC_EQUIPMENT,\r\n  EquipmentCategory.ELECTRONICS,\r\n];\r\n\r\n// =============================================================================\r\n// Category Toggle Bar\r\n// =============================================================================\r\n\r\n/**\r\n * Toggle buttons for filtering equipment by category\r\n */\r\nexport function CategoryToggleBar({\r\n  activeCategories,\r\n  onSelectCategory,\r\n  onShowAll,\r\n  showAll,\r\n  className = '',\r\n}: CategoryToggleBarProps) {\r\n  /**\r\n   * Handle category button click\r\n   * Regular click = exclusive select (only this category)\r\n   * Ctrl+click = toggle (add/remove for multi-select)\r\n   */\r\n  const handleCategoryClick = (category: EquipmentCategory, event: React.MouseEvent) => {\r\n    const isMultiSelect = event.ctrlKey || event.metaKey; // metaKey for Mac Command key\r\n    onSelectCategory(category, isMultiSelect);\r\n  };\r\n\r\n  return (\r\n    <div className={`flex flex-wrap items-center gap-1 ${className}`}>\r\n      <span className=\"text-xs text-slate-400 mr-1\">Show:</span>\r\n      \r\n      {/* Category toggles */}\r\n      {CATEGORY_CONFIGS.map(({ category, label }) => {\r\n        // For \"Other\" (MISC_EQUIPMENT), check if any of the combined categories are active\r\n        const isActive = showAll || (\r\n          category === EquipmentCategory.MISC_EQUIPMENT\r\n            ? OTHER_COMBINED_CATEGORIES.some(cat => activeCategories.has(cat))\r\n            : activeCategories.has(category)\r\n        );\r\n        const colorType = categoryToColorType(category);\r\n        const colors = getEquipmentColors(colorType);\r\n        \r\n        return (\r\n          <button\r\n            key={category}\r\n            onClick={(e) => handleCategoryClick(category, e)}\r\n            className={`\r\n              px-2 py-0.5 text-xs rounded transition-colors\r\n              ${isActive\r\n                ? `${colors.bg} ${colors.text} ring-1 ${colors.border}`\r\n                : 'bg-slate-700 text-slate-400 hover:text-white hover:bg-slate-600'\r\n              }\r\n            `}\r\n            title={`${label} (Ctrl+click to multi-select)`}\r\n          >\r\n            {label}\r\n          </button>\r\n        );\r\n      })}\r\n      \r\n      {/* Show All button */}\r\n      <button\r\n        onClick={onShowAll}\r\n        className={`\r\n          px-2 py-0.5 text-xs rounded transition-colors ml-1\r\n          ${showAll\r\n            ? 'bg-amber-600 text-white ring-1 ring-amber-500'\r\n            : 'bg-slate-700 text-slate-400 hover:text-white hover:bg-slate-600'\r\n          }\r\n        `}\r\n        title=\"Show all categories\"\r\n      >\r\n        Show All\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Hide Toggle Bar\r\n// =============================================================================\r\n\r\n/**\r\n * Toggle buttons for hiding equipment types\r\n */\r\nexport function HideToggleBar({\r\n  hidePrototype,\r\n  hideOneShot,\r\n  hideUnavailable,\r\n  onTogglePrototype,\r\n  onToggleOneShot,\r\n  onToggleUnavailable,\r\n  className = '',\r\n}: HideToggleBarProps) {\r\n  return (\r\n    <div className={`flex flex-wrap items-center gap-1 ${className}`}>\r\n      <span className=\"text-xs text-slate-400 mr-1\">Hide:</span>\r\n      \r\n      <ToggleButton\r\n        label=\"Prototype\"\r\n        isActive={hidePrototype}\r\n        onClick={onTogglePrototype}\r\n      />\r\n      \r\n      <ToggleButton\r\n        label=\"One-Shot\"\r\n        isActive={hideOneShot}\r\n        onClick={onToggleOneShot}\r\n      />\r\n      \r\n      <ToggleButton\r\n        label=\"Unavailable\"\r\n        isActive={hideUnavailable}\r\n        onClick={onToggleUnavailable}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Helper Components\r\n// =============================================================================\r\n\r\ninterface ToggleButtonProps {\r\n  label: string;\r\n  isActive: boolean;\r\n  onClick: () => void;\r\n}\r\n\r\nfunction ToggleButton({ label, isActive, onClick }: ToggleButtonProps) {\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      className={`\r\n        px-2 py-0.5 text-xs rounded transition-colors\r\n        ${isActive\r\n          ? 'bg-red-900/50 text-red-300 ring-1 ring-red-700'\r\n          : 'bg-slate-700 text-slate-400 hover:text-white hover:bg-slate-600'\r\n        }\r\n      `}\r\n      title={`${isActive ? 'Show' : 'Hide'} ${label.toLowerCase()}`}\r\n    >\r\n      {label}\r\n    </button>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Exports\r\n// =============================================================================\r\n\r\nexport default CategoryToggleBar;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\equipment\\EquipmentBrowser.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":28,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":28,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Equipment Browser Component\r\n * \r\n * Searchable, filterable equipment catalog with toggle button filters.\r\n * \r\n * @spec openspec/specs/equipment-browser/spec.md\r\n * @spec openspec/changes/unify-equipment-tab/specs/equipment-browser/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { EquipmentRow } from './EquipmentRow';\r\nimport { CategoryToggleBar, HideToggleBar } from './CategoryToggleBar';\r\nimport { useEquipmentBrowser } from '@/hooks/useEquipmentBrowser';\r\nimport { SortColumn } from '@/stores/useEquipmentStore';\r\nimport { IEquipmentItem } from '@/types/equipment';\r\nimport { PaginationButtons } from '@/components/ui/Button';\r\n\r\ninterface EquipmentBrowserProps {\r\n  /** Called when equipment is added to unit */\r\n  onAddEquipment: (equipment: IEquipmentItem) => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Equipment browser with toggle button filtering and pagination\r\n */\r\nexport function EquipmentBrowser({\r\n  onAddEquipment,\r\n  className = '',\r\n}: EquipmentBrowserProps) {\r\n  const {\r\n    paginatedEquipment,\r\n    isLoading,\r\n    error,\r\n    unitYear,\r\n    unitTechBase,\r\n    currentPage,\r\n    totalPages,\r\n    totalItems,\r\n    search,\r\n    activeCategories,\r\n    showAllCategories,\r\n    hidePrototype,\r\n    hideOneShot,\r\n    hideUnavailable,\r\n    sortColumn,\r\n    sortDirection,\r\n    setSearch,\r\n    selectCategory,\r\n    showAll,\r\n    toggleHidePrototype,\r\n    toggleHideOneShot,\r\n    toggleHideUnavailable,\r\n    clearFilters,\r\n    setPage,\r\n    setSort,\r\n    refresh,\r\n  } = useEquipmentBrowser();\r\n  \r\n  if (error) {\r\n    return (\r\n      <div className={`bg-slate-800 rounded-lg border border-slate-700 p-4 ${className}`}>\r\n        <div className=\"text-center py-8\">\r\n          <div className=\"text-red-400 mb-2\">Failed to load equipment</div>\r\n          <p className=\"text-sm text-slate-400 mb-4\">{error}</p>\r\n          <button\r\n            onClick={refresh}\r\n            className=\"px-4 py-2 bg-amber-600 hover:bg-amber-500 text-white rounded transition-colors\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className={`bg-slate-800 rounded-lg border border-slate-700 flex flex-col ${className}`}>\r\n      {/* Header */}\r\n      <div className=\"px-4 py-3 border-b border-slate-700\">\r\n        <h3 className=\"text-lg font-semibold text-white\">Equipment Database</h3>\r\n      </div>\r\n      \r\n      {/* Toggle Filters */}\r\n      <div className=\"px-4 py-2 space-y-2 border-b border-slate-700 bg-slate-800/50\">\r\n        {/* Category toggles */}\r\n        <CategoryToggleBar\r\n          activeCategories={activeCategories}\r\n          onSelectCategory={selectCategory}\r\n          onShowAll={showAll}\r\n          showAll={showAllCategories}\r\n        />\r\n        \r\n        {/* Hide toggles */}\r\n        <HideToggleBar\r\n          hidePrototype={hidePrototype}\r\n          hideOneShot={hideOneShot}\r\n          hideUnavailable={hideUnavailable}\r\n          onTogglePrototype={toggleHidePrototype}\r\n          onToggleOneShot={toggleHideOneShot}\r\n          onToggleUnavailable={toggleHideUnavailable}\r\n        />\r\n        \r\n        {/* Unit context info - shows when filtering by availability */}\r\n        {hideUnavailable && (unitYear || unitTechBase) && (\r\n          <div className=\"flex items-center gap-2 text-xs text-slate-400 px-1\">\r\n            <span className=\"text-slate-500\">Filtering:</span>\r\n            {unitYear && (\r\n              <span className=\"bg-slate-700 px-2 py-0.5 rounded\">Year  {unitYear}</span>\r\n            )}\r\n            {unitTechBase && (\r\n              <span className=\"bg-slate-700 px-2 py-0.5 rounded\">{unitTechBase}</span>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Text filter */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"text-xs text-slate-400\">Filter:</span>\r\n          <div className=\"flex-1 relative\">\r\n            <input\r\n              type=\"text\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              placeholder=\"Search equipment...\"\r\n              className=\"w-full px-3 py-1.5 text-sm bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-amber-500\"\r\n            />\r\n            {search && (\r\n              <button\r\n                onClick={() => setSearch('')}\r\n                className=\"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white\"\r\n                title=\"Clear search\"\r\n              >\r\n                \r\n              </button>\r\n            )}\r\n          </div>\r\n          {(search || !showAllCategories || hidePrototype || hideOneShot) && (\r\n            <button\r\n              onClick={clearFilters}\r\n              className=\"px-2 py-1 text-xs bg-slate-700 hover:bg-slate-600 text-slate-300 rounded transition-colors\"\r\n            >\r\n              Clear All\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Table */}\r\n      <div className=\"flex-1 overflow-auto\">\r\n        {isLoading ? (\r\n          <div className=\"p-8 text-center\">\r\n            <div className=\"animate-pulse text-slate-400\">Loading equipment...</div>\r\n          </div>\r\n        ) : (\r\n          <table className=\"w-full\">\r\n            <thead className=\"sticky top-0 bg-slate-800\">\r\n              <tr className=\"text-left text-xs text-slate-400 uppercase border-b border-slate-700\">\r\n                <SortableHeader\r\n                  label=\"Name\"\r\n                  column=\"name\"\r\n                  currentColumn={sortColumn}\r\n                  direction={sortDirection}\r\n                  onSort={setSort}\r\n                />\r\n                <th className=\"px-2 py-2\">Dmg</th>\r\n                <th className=\"px-2 py-2\">Heat</th>\r\n                <th className=\"px-2 py-2\">Range</th>\r\n                <SortableHeader\r\n                  label=\"Weight\"\r\n                  column=\"weight\"\r\n                  currentColumn={sortColumn}\r\n                  direction={sortDirection}\r\n                  onSort={setSort}\r\n                />\r\n                <SortableHeader\r\n                  label=\"Crit\"\r\n                  column=\"criticalSlots\"\r\n                  currentColumn={sortColumn}\r\n                  direction={sortDirection}\r\n                  onSort={setSort}\r\n                />\r\n                <th className=\"px-2 py-2 w-16\">Action</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {paginatedEquipment.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={7} className=\"px-3 py-8 text-center text-slate-400\">\r\n                    No equipment found\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                paginatedEquipment.map((equipment) => (\r\n                  <EquipmentRow\r\n                    key={equipment.id}\r\n                    equipment={equipment}\r\n                    onAdd={() => onAddEquipment(equipment)}\r\n                    compact\r\n                  />\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Pagination */}\r\n      <div className=\"px-4 py-2 border-t border-slate-700 flex items-center justify-between\">\r\n        <div className=\"text-xs text-slate-400\">\r\n          {paginatedEquipment.length} of {totalItems}\r\n        </div>\r\n        <PaginationButtons\r\n          currentPage={currentPage}\r\n          totalPages={totalPages}\r\n          onPageChange={setPage}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Sortable table header\r\n */\r\ninterface SortableHeaderProps {\r\n  label: string;\r\n  column: SortColumn;\r\n  currentColumn: SortColumn;\r\n  direction: 'asc' | 'desc';\r\n  onSort: (column: SortColumn) => void;\r\n}\r\n\r\nfunction SortableHeader({\r\n  label,\r\n  column,\r\n  currentColumn,\r\n  direction,\r\n  onSort,\r\n}: SortableHeaderProps) {\r\n  const isActive = column === currentColumn;\r\n  \r\n  return (\r\n    <th\r\n      className=\"px-2 py-2 cursor-pointer hover:text-white transition-colors\"\r\n      onClick={() => onSort(column)}\r\n    >\r\n      <span className=\"flex items-center gap-1\">\r\n        {label}\r\n        {isActive && (\r\n          <span className=\"text-amber-400 text-[10px]\">\r\n            {direction === 'asc' ? '' : ''}\r\n          </span>\r\n        )}\r\n      </span>\r\n    </th>\r\n  );\r\n}\r\n\r\nexport default EquipmentBrowser;\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\equipment\\EquipmentFilters.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":49,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":49,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Equipment Filters Component\r\n * \r\n * Filter controls for the equipment browser.\r\n * \r\n * @spec openspec/specs/equipment-browser/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { TechBase, ALL_TECH_BASES } from '@/types/enums/TechBase';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\ninterface EquipmentFiltersProps {\r\n  /** Current search query */\r\n  search: string;\r\n  /** Current tech base filter */\r\n  techBase: TechBase | null;\r\n  /** Current category filter */\r\n  category: EquipmentCategory | null;\r\n  /** Search change handler */\r\n  onSearchChange: (search: string) => void;\r\n  /** Tech base change handler */\r\n  onTechBaseChange: (techBase: TechBase | null) => void;\r\n  /** Category change handler */\r\n  onCategoryChange: (category: EquipmentCategory | null) => void;\r\n  /** Clear all filters */\r\n  onClear: () => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Equipment categories for filtering\r\n */\r\nconst FILTER_CATEGORIES: { value: EquipmentCategory; label: string }[] = [\r\n  { value: EquipmentCategory.ENERGY_WEAPON, label: 'Energy Weapons' },\r\n  { value: EquipmentCategory.BALLISTIC_WEAPON, label: 'Ballistic Weapons' },\r\n  { value: EquipmentCategory.MISSILE_WEAPON, label: 'Missile Weapons' },\r\n  { value: EquipmentCategory.AMMUNITION, label: 'Ammunition' },\r\n  { value: EquipmentCategory.ELECTRONICS, label: 'Electronics' },\r\n  { value: EquipmentCategory.PHYSICAL_WEAPON, label: 'Physical Weapons' },\r\n  { value: EquipmentCategory.MISC_EQUIPMENT, label: 'Misc Equipment' },\r\n];\r\n\r\n/**\r\n * Equipment filter controls\r\n */\r\nexport function EquipmentFilters({\r\n  search,\r\n  techBase,\r\n  category,\r\n  onSearchChange,\r\n  onTechBaseChange,\r\n  onCategoryChange,\r\n  onClear,\r\n  className = '',\r\n}: EquipmentFiltersProps) {\r\n  const hasFilters = search || techBase || category;\r\n  \r\n  return (\r\n    <div className={`${cs.filter.bar} ${className}`}>\r\n      {/* Search */}\r\n      <div className={cs.filter.input}>\r\n        <input\r\n          type=\"text\"\r\n          value={search}\r\n          onChange={(e) => onSearchChange(e.target.value)}\r\n          placeholder=\"Search equipment...\"\r\n        />\r\n      </div>\r\n      \r\n      {/* Tech Base */}\r\n      <div>\r\n        <select\r\n          value={techBase || ''}\r\n          onChange={(e) => onTechBaseChange(e.target.value as TechBase || null)}\r\n          className={cs.filter.select}\r\n        >\r\n          <option value=\"\">All Tech</option>\r\n          {ALL_TECH_BASES.map((tb) => (\r\n            <option key={tb} value={tb}>\r\n              {tb}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n      \r\n      {/* Category */}\r\n      <div>\r\n        <select\r\n          value={category || ''}\r\n          onChange={(e) => onCategoryChange(e.target.value as EquipmentCategory || null)}\r\n          className={cs.filter.select}\r\n        >\r\n          <option value=\"\">All Categories</option>\r\n          {FILTER_CATEGORIES.map(({ value, label }) => (\r\n            <option key={value} value={value}>\r\n              {label}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n      \r\n      {/* Clear */}\r\n      {hasFilters && (\r\n        <button onClick={onClear} className={cs.filter.clearBtn}>\r\n          Clear\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\equipment\\EquipmentRow.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EquipmentCategory' is defined but never used.","line":10,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":27,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":27,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rangeMin' is assigned a value but never used.","line":27,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[778,781],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[778,781],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .rangeMin on an `any` value.","line":27,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":27,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":28,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":28,"endColumn":51},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[829,832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[829,832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .rangeShort on an `any` value.","line":28,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":28,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":29,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":29,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[883,886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[883,886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .rangeMedium on an `any` value.","line":29,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":29,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":30,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":30,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[936,939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[936,939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .rangeLong on an `any` value.","line":30,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":30,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":45,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":45,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1265,1268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1265,1268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .damage on an `any` value.","line":45,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":45,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":57,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":57,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1556,1559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1556,1559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .heat on an `any` value.","line":57,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":57,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Equipment Row Component\r\n * \r\n * Table row for equipment in the browser.\r\n * \r\n * @spec openspec/specs/equipment-browser/spec.md\r\n */\r\n\r\nimport React, { memo } from 'react';\r\nimport { IEquipmentItem, EquipmentCategory } from '@/types/equipment';\r\nimport { categoryToColorType, getEquipmentColors } from '@/utils/colors/equipmentColors';\r\n\r\ninterface EquipmentRowProps {\r\n  /** Equipment item data */\r\n  equipment: IEquipmentItem;\r\n  /** Called when add button is clicked */\r\n  onAdd: () => void;\r\n  /** Compact mode - fewer columns, smaller text */\r\n  compact?: boolean;\r\n}\r\n\r\n/**\r\n * Format range display (short/medium/long)\r\n */\r\nfunction formatRange(equipment: IEquipmentItem): string {\r\n  // Check if equipment has range properties\r\n  const rangeMin = (equipment as any).rangeMin;\r\n  const rangeShort = (equipment as any).rangeShort;\r\n  const rangeMedium = (equipment as any).rangeMedium;\r\n  const rangeLong = (equipment as any).rangeLong;\r\n  \r\n  if (rangeShort && rangeMedium && rangeLong) {\r\n    return `${rangeShort}/${rangeMedium}/${rangeLong}`;\r\n  }\r\n  if (rangeLong) {\r\n    return `${rangeLong}`;\r\n  }\r\n  return '-';\r\n}\r\n\r\n/**\r\n * Get damage display\r\n */\r\nfunction formatDamage(equipment: IEquipmentItem): string {\r\n  const damage = (equipment as any).damage;\r\n  if (damage !== undefined && damage !== null) {\r\n    return String(damage);\r\n  }\r\n  return '-';\r\n}\r\n\r\n/**\r\n * Get heat display\r\n */\r\nfunction formatHeat(equipment: IEquipmentItem): string {\r\n  // Heat is only on weapon types, access via any cast\r\n  const heat = (equipment as any).heat;\r\n  if (heat !== undefined && heat !== null && heat > 0) {\r\n    return String(heat);\r\n  }\r\n  return '-';\r\n}\r\n\r\n/**\r\n * Equipment table row\r\n * Memoized for performance when rendering large lists\r\n */\r\nexport const EquipmentRow = memo(function EquipmentRow({\r\n  equipment,\r\n  onAdd,\r\n  compact = false,\r\n}: EquipmentRowProps) {\r\n  const colorType = categoryToColorType(equipment.category);\r\n  const colors = getEquipmentColors(colorType);\r\n  \r\n  if (compact) {\r\n    // Compact layout - fewer columns, MekLab-style\r\n    return (\r\n      <tr className=\"border-t border-slate-700/30 hover:bg-slate-700/30 transition-colors text-xs\">\r\n        {/* Name with category color indicator */}\r\n        <td className=\"px-2 py-1.5\">\r\n          <div className=\"flex items-center gap-1.5\">\r\n            <span className={`w-1.5 h-1.5 rounded-sm flex-shrink-0 ${colors.bg}`} />\r\n            <span className=\"text-white truncate\" title={equipment.name}>\r\n              {equipment.name}\r\n            </span>\r\n          </div>\r\n        </td>\r\n        \r\n        {/* Damage */}\r\n        <td className=\"px-2 py-1.5 text-slate-300 text-center\">\r\n          {formatDamage(equipment)}\r\n        </td>\r\n        \r\n        {/* Heat */}\r\n        <td className=\"px-2 py-1.5 text-slate-300 text-center\">\r\n          {formatHeat(equipment)}\r\n        </td>\r\n        \r\n        {/* Range */}\r\n        <td className=\"px-2 py-1.5 text-slate-400 text-center\">\r\n          {formatRange(equipment)}\r\n        </td>\r\n        \r\n        {/* Weight */}\r\n        <td className=\"px-2 py-1.5 text-slate-300 text-right\">\r\n          {equipment.weight}\r\n        </td>\r\n        \r\n        {/* Critical Slots */}\r\n        <td className=\"px-2 py-1.5 text-slate-300 text-center\">\r\n          {equipment.criticalSlots}\r\n        </td>\r\n        \r\n        {/* Add button */}\r\n        <td className=\"px-2 py-1.5\">\r\n          <button\r\n            onClick={onAdd}\r\n            className=\"w-full px-1.5 py-0.5 text-[10px] bg-amber-600 hover:bg-amber-500 text-white rounded transition-colors\"\r\n            title={`Add ${equipment.name}`}\r\n          >\r\n            Add\r\n          </button>\r\n        </td>\r\n      </tr>\r\n    );\r\n  }\r\n  \r\n  // Standard layout\r\n  return (\r\n    <tr className=\"border-t border-slate-700/50 hover:bg-slate-700/30 transition-colors\">\r\n      {/* Name */}\r\n      <td className=\"px-3 py-2\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className={`w-2 h-2 rounded-sm ${colors.bg}`} />\r\n          <span className=\"text-white\">{equipment.name}</span>\r\n        </div>\r\n      </td>\r\n      \r\n      {/* Damage */}\r\n      <td className=\"px-3 py-2 text-slate-300 text-center\">\r\n        {formatDamage(equipment)}\r\n      </td>\r\n      \r\n      {/* Heat */}\r\n      <td className=\"px-3 py-2 text-slate-300 text-center\">\r\n        {formatHeat(equipment)}\r\n      </td>\r\n      \r\n      {/* Range */}\r\n      <td className=\"px-3 py-2 text-slate-400 text-center\">\r\n        {formatRange(equipment)}\r\n      </td>\r\n      \r\n      {/* Weight */}\r\n      <td className=\"px-3 py-2 text-slate-300 text-right\">\r\n        {equipment.weight}t\r\n      </td>\r\n      \r\n      {/* Critical Slots */}\r\n      <td className=\"px-3 py-2 text-slate-300 text-center\">\r\n        {equipment.criticalSlots}\r\n      </td>\r\n      \r\n      {/* Add button */}\r\n      <td className=\"px-3 py-2\">\r\n        <button\r\n          onClick={onAdd}\r\n          className=\"px-2 py-1 text-xs bg-amber-600 hover:bg-amber-500 text-white rounded transition-colors\"\r\n        >\r\n          Add\r\n        </button>\r\n      </td>\r\n    </tr>\r\n  );\r\n});\r\n\r\nexport default EquipmentRow;\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\equipment\\GlobalLoadoutTray.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onUnassign' is defined but never used. Allowed unused args must match /^_/u.","line":273,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":273,"endColumn":89},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":467,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":467,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Global Loadout Tray Component\r\n * \r\n * Persistent sidebar showing unit's equipment in Allocated/Unallocated sections.\r\n * Supports equipment selection for critical slot assignment workflow.\r\n * Includes context menu for quick assignment to valid locations.\r\n * \r\n * @spec openspec/changes/unify-equipment-tab/specs/equipment-tray/spec.md\r\n */\r\n\r\nimport React, { useState, useCallback, useMemo, useRef, useEffect } from 'react';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport { categoryToColorType, getEquipmentColors } from '@/utils/colors/equipmentColors';\r\nimport { MechLocation } from '@/types/construction';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface LoadoutEquipmentItem {\r\n  instanceId: string;\r\n  name: string;\r\n  category: EquipmentCategory;\r\n  weight: number;\r\n  criticalSlots: number;\r\n  isAllocated: boolean;\r\n  location?: string;\r\n  isRemovable: boolean;\r\n}\r\n\r\n/** Location with available slot info for context menu */\r\nexport interface AvailableLocation {\r\n  location: MechLocation;\r\n  label: string;\r\n  availableSlots: number;\r\n  canFit: boolean;\r\n}\r\n\r\ninterface GlobalLoadoutTrayProps {\r\n  equipment: LoadoutEquipmentItem[];\r\n  equipmentCount: number;\r\n  onRemoveEquipment: (instanceId: string) => void;\r\n  onRemoveAllEquipment: () => void;\r\n  isExpanded: boolean;\r\n  onToggleExpand: () => void;\r\n  /** Currently selected equipment for slot assignment */\r\n  selectedEquipmentId?: string | null;\r\n  /** Called when equipment is selected for slot assignment */\r\n  onSelectEquipment?: (instanceId: string | null) => void;\r\n  /** Called to unassign equipment from its slot (back to unallocated) */\r\n  onUnassignEquipment?: (instanceId: string) => void;\r\n  /** Called for quick assignment to a specific location */\r\n  onQuickAssign?: (instanceId: string, location: MechLocation) => void;\r\n  /** Available locations with slot info for the currently selected equipment */\r\n  availableLocations?: AvailableLocation[];\r\n  className?: string;\r\n}\r\n\r\n// =============================================================================\r\n// Category Configuration\r\n// =============================================================================\r\n\r\nconst CATEGORY_ORDER: EquipmentCategory[] = [\r\n  EquipmentCategory.ENERGY_WEAPON,\r\n  EquipmentCategory.BALLISTIC_WEAPON,\r\n  EquipmentCategory.MISSILE_WEAPON,\r\n  EquipmentCategory.ARTILLERY,\r\n  EquipmentCategory.AMMUNITION,\r\n  EquipmentCategory.ELECTRONICS,\r\n  EquipmentCategory.PHYSICAL_WEAPON,\r\n  EquipmentCategory.MOVEMENT,\r\n  EquipmentCategory.STRUCTURAL,\r\n  EquipmentCategory.MISC_EQUIPMENT,\r\n];\r\n\r\nconst CATEGORY_LABELS: Record<EquipmentCategory, string> = {\r\n  [EquipmentCategory.ENERGY_WEAPON]: 'Energy',\r\n  [EquipmentCategory.BALLISTIC_WEAPON]: 'Ballistic',\r\n  [EquipmentCategory.MISSILE_WEAPON]: 'Missile',\r\n  [EquipmentCategory.ARTILLERY]: 'Artillery',\r\n  [EquipmentCategory.CAPITAL_WEAPON]: 'Capital',\r\n  [EquipmentCategory.AMMUNITION]: 'Ammo',\r\n  [EquipmentCategory.ELECTRONICS]: 'Electronics',\r\n  [EquipmentCategory.PHYSICAL_WEAPON]: 'Physical',\r\n  [EquipmentCategory.MOVEMENT]: 'Movement',\r\n  [EquipmentCategory.STRUCTURAL]: 'Structural',\r\n  [EquipmentCategory.MISC_EQUIPMENT]: 'Misc',\r\n};\r\n\r\n// =============================================================================\r\n// Helper Functions\r\n// =============================================================================\r\n\r\nfunction groupByCategory(equipment: LoadoutEquipmentItem[]): Map<EquipmentCategory, LoadoutEquipmentItem[]> {\r\n  const groups = new Map<EquipmentCategory, LoadoutEquipmentItem[]>();\r\n  for (const item of equipment) {\r\n    const existing = groups.get(item.category) || [];\r\n    existing.push(item);\r\n    groups.set(item.category, existing);\r\n  }\r\n  return groups;\r\n}\r\n\r\n// =============================================================================\r\n// Common Styles\r\n// =============================================================================\r\n\r\n/** \r\n * Shared styles for consistent row heights, text sizes, padding, and gaps.\r\n * All row types use h-7 (28px) height with px-2 padding (except main header which uses px-3).\r\n */\r\nconst trayStyles = {\r\n  // Padding - single source of truth\r\n  padding: {\r\n    /** All content rows (equipment, category, section headers) */\r\n    row: 'px-2',\r\n    /** Main tray header only */\r\n    header: 'px-3',\r\n  },\r\n  \r\n  // Text sizes - single source of truth\r\n  text: {\r\n    /** Primary text (equipment names, section titles) */\r\n    primary: 'text-xs',\r\n    /** Secondary text (weight, crits, counts) */\r\n    secondary: 'text-[10px]',\r\n    /** Tertiary text (icons, small labels) */\r\n    tertiary: 'text-[9px]',\r\n  },\r\n  \r\n  // Standard gap for row content\r\n  gap: 'gap-1.5',\r\n  \r\n  // Composed row styles - all use h-7 height\r\n  /** Standard row height for all items */\r\n  row: 'h-7 flex items-center',\r\n  /** Equipment item row */\r\n  equipmentRow: 'px-2 h-7 flex items-center gap-1.5 transition-all group rounded-md border border-slate-700/30 my-0.5',\r\n  /** Category header row */\r\n  categoryRow: 'px-2 h-7 bg-slate-800/50 flex items-center gap-1.5',\r\n  /** Section header row */\r\n  sectionRow: 'w-full h-7 flex items-center justify-between px-2 gap-1.5 hover:bg-slate-700/50 transition-colors bg-slate-700/30',\r\n  \r\n  /** Category dot indicator */\r\n  categoryDot: 'w-2 h-2 rounded-sm',\r\n  /** Action button base */\r\n  actionButton: 'opacity-0 group-hover:opacity-100 transition-opacity px-0.5',\r\n} as const;\r\n\r\n/** Convert location names to shorthand (e.g., \"Right Torso\" -> \"RT\") */\r\nfunction getLocationShorthand(location: string): string {\r\n  const shortcuts: Record<string, string> = {\r\n    'Head': 'HD',\r\n    'Center Torso': 'CT',\r\n    'Left Torso': 'LT',\r\n    'Right Torso': 'RT',\r\n    'Left Arm': 'LA',\r\n    'Right Arm': 'RA',\r\n    'Left Leg': 'LL',\r\n    'Right Leg': 'RL',\r\n  };\r\n  return shortcuts[location] || location;\r\n}\r\n\r\n// =============================================================================\r\n// Context Menu Component\r\n// =============================================================================\r\n\r\ninterface ContextMenuProps {\r\n  x: number;\r\n  y: number;\r\n  item: LoadoutEquipmentItem;\r\n  availableLocations: AvailableLocation[];\r\n  onQuickAssign: (location: MechLocation) => void;\r\n  onUnassign: () => void;\r\n  onClose: () => void;\r\n}\r\n\r\nfunction ContextMenu({ x, y, item, availableLocations, onQuickAssign, onUnassign, onClose }: ContextMenuProps) {\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n  \r\n  // Close on click outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (e: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\r\n        onClose();\r\n      }\r\n    };\r\n    const handleEscape = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') onClose();\r\n    };\r\n    \r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    document.addEventListener('keydown', handleEscape);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n      document.removeEventListener('keydown', handleEscape);\r\n    };\r\n  }, [onClose]);\r\n  \r\n  // Adjust position to keep menu on screen\r\n  const adjustedX = Math.min(x, window.innerWidth - 200);\r\n  const adjustedY = Math.min(y, window.innerHeight - 300);\r\n  \r\n  const validLocations = availableLocations.filter(loc => loc.canFit);\r\n  \r\n  return (\r\n    <div\r\n      ref={menuRef}\r\n      className=\"fixed z-50 bg-slate-800 border border-slate-600 rounded-lg shadow-xl py-1 min-w-[160px]\"\r\n      style={{ left: adjustedX, top: adjustedY }}\r\n    >\r\n      {/* Header */}\r\n      <div className={`${trayStyles.padding.header} py-1.5 border-b border-slate-700 ${trayStyles.text.primary} text-slate-400`}>\r\n        {item.name} ({item.criticalSlots} slot {item.criticalSlots !== 1 ? 's' : ''})\r\n      </div>\r\n      \r\n      {/* Unassign option for all allocated items */}\r\n      {item.isAllocated && (\r\n        <>\r\n          <button\r\n            onClick={() => { onUnassign(); onClose(); }}\r\n            className={`w-full text-left ${trayStyles.padding.header} py-1.5 ${trayStyles.text.primary} text-amber-400 hover:bg-slate-700 transition-colors`}\r\n          >\r\n            Unassign from {item.location}\r\n          </button>\r\n          <div className=\"border-t border-slate-700 my-1\" />\r\n        </>\r\n      )}\r\n      \r\n      {/* Quick assign options */}\r\n      {!item.isAllocated && validLocations.length > 0 && (\r\n        <>\r\n          <div className={`${trayStyles.padding.header} py-1 ${trayStyles.text.secondary} text-slate-500 uppercase tracking-wider`}>\r\n            Quick Assign\r\n          </div>\r\n          {validLocations.map(loc => (\r\n            <button\r\n              key={loc.location}\r\n              onClick={() => { onQuickAssign(loc.location); onClose(); }}\r\n              className={`w-full text-left ${trayStyles.padding.header} py-1.5 ${trayStyles.text.primary} text-slate-200 hover:bg-slate-700 transition-colors flex justify-between`}\r\n            >\r\n              <span>Add to {loc.label}</span>\r\n              <span className={`text-slate-500 ${trayStyles.text.secondary}`}>{loc.availableSlots} free</span>\r\n            </button>\r\n          ))}\r\n        </>\r\n      )}\r\n      \r\n      {/* No valid locations message */}\r\n      {!item.isAllocated && validLocations.length === 0 && (\r\n        <div className={`${trayStyles.padding.header} py-2 ${trayStyles.text.primary} text-slate-500 italic`}>\r\n          No locations with {item.criticalSlots} contiguous slots\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Equipment Item Component\r\n// =============================================================================\r\n\r\ninterface EquipmentItemProps {\r\n  item: LoadoutEquipmentItem;\r\n  isSelected: boolean;\r\n  onSelect: () => void;\r\n  onRemove: () => void;\r\n  onContextMenu: (e: React.MouseEvent) => void;\r\n  onUnassign?: () => void;\r\n}\r\n\r\nfunction EquipmentItem({ item, isSelected, onSelect, onRemove, onContextMenu, onUnassign }: EquipmentItemProps) {\r\n  const colorType = categoryToColorType(item.category);\r\n  const colors = getEquipmentColors(colorType);\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  \r\n  // Unallocated items can be dragged to critical slots\r\n  const canDrag = !item.isAllocated;\r\n  \r\n  const handleDragStart = (e: React.DragEvent) => {\r\n    if (!canDrag) {\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n    e.dataTransfer.setData('text/equipment-id', item.instanceId);\r\n    e.dataTransfer.effectAllowed = 'move';\r\n    setIsDragging(true);\r\n    // Select the item when drag starts so assignable slots are highlighted\r\n    onSelect();\r\n  };\r\n  \r\n  const handleDragEnd = () => {\r\n    setIsDragging(false);\r\n  };\r\n  \r\n  // Unified inline single-line layout for both allocated and unallocated items\r\n  return (\r\n    <div\r\n      draggable={canDrag}\r\n      onDragStart={handleDragStart}\r\n      onDragEnd={handleDragEnd}\r\n      className={`\r\n        ${trayStyles.equipmentRow}\r\n        ${colors.bg}\r\n        ${canDrag ? 'cursor-grab active:cursor-grabbing' : 'cursor-pointer'}\r\n        ${isDragging ? 'opacity-50' : ''}\r\n        ${isSelected\r\n          ? 'ring-1 ring-amber-400 ring-inset brightness-110'\r\n          : 'hover:brightness-110'\r\n        }\r\n      `}\r\n      onClick={onSelect}\r\n      onContextMenu={onContextMenu}\r\n      title={canDrag ? 'Drag to critical slot or click to select' : 'Right-click to unassign'}\r\n    >\r\n      <div className={`flex items-center ${trayStyles.gap} w-full`}>\r\n        {/* Name */}\r\n        <span className={`truncate flex-1 text-white ${trayStyles.text.primary} drop-shadow-sm`}>\r\n          {item.name}\r\n        </span>\r\n        {/* Info + action inline */}\r\n        <span className={`text-white/50 ${trayStyles.text.secondary} whitespace-nowrap`}>\r\n          {item.weight}t | {item.criticalSlots} slot{item.criticalSlots !== 1 ? 's' : ''}\r\n          {item.isAllocated && item.location && (\r\n            <span className=\"text-white/80\"> | {getLocationShorthand(item.location)}</span>\r\n          )}\r\n          {/* Remove/Lock icon */}\r\n          <span\r\n            onClick={item.isRemovable ? (e) => { e.stopPropagation(); onRemove(); } : undefined}\r\n            className={`inline-block w-3 ml-0.5 text-center align-middle font-bold ${\r\n              item.isRemovable \r\n                ? `${trayStyles.text.secondary} text-black hover:text-red-400 cursor-pointer transition-colors` \r\n                : `${trayStyles.text.tertiary} text-white/30`\r\n            }`}\r\n            title={item.isRemovable ? \"Remove from unit\" : \"Managed by configuration\"}\r\n          >\r\n            {item.isRemovable ? '' : ''}\r\n          </span>\r\n        </span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Allocation Section Component\r\n// =============================================================================\r\n\r\ninterface AllocationSectionProps {\r\n  title: string;\r\n  count: number;\r\n  isExpanded: boolean;\r\n  onToggle: () => void;\r\n  children: React.ReactNode;\r\n  titleColor?: string;\r\n  /** Is this section a drop zone */\r\n  isDropZone?: boolean;\r\n  /** Called when equipment is dropped on this section */\r\n  onDrop?: (equipmentId: string) => void;\r\n}\r\n\r\nfunction AllocationSection({ \r\n  title, \r\n  count, \r\n  isExpanded, \r\n  onToggle, \r\n  children, \r\n  titleColor = 'text-slate-300',\r\n  isDropZone = false,\r\n  onDrop,\r\n}: AllocationSectionProps) {\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  \r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    if (!isDropZone) return;\r\n    e.preventDefault();\r\n    setIsDragOver(true);\r\n  };\r\n  \r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    // Only trigger if leaving the section, not child elements\r\n    if (!e.currentTarget.contains(e.relatedTarget as Node)) {\r\n      setIsDragOver(false);\r\n    }\r\n  };\r\n  \r\n  const handleDrop = (e: React.DragEvent) => {\r\n    if (!isDropZone) return;\r\n    e.preventDefault();\r\n    setIsDragOver(false);\r\n    const equipmentId = e.dataTransfer.getData('text/equipment-id');\r\n    if (equipmentId && onDrop) {\r\n      onDrop(equipmentId);\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div \r\n      className={`border-b border-slate-600 transition-all ${isDragOver ? 'ring-2 ring-amber-400 ring-inset bg-amber-900/20' : ''}`}\r\n      onDragOver={handleDragOver}\r\n      onDragLeave={handleDragLeave}\r\n      onDrop={handleDrop}\r\n    >\r\n      <button\r\n        onClick={onToggle}\r\n        className={trayStyles.sectionRow}\r\n      >\r\n        <span className={`${trayStyles.text.primary} font-medium ${titleColor}`}>{title}</span>\r\n        <span className={`flex items-center ${trayStyles.gap}`}>\r\n          <span className={`${trayStyles.text.secondary} text-slate-400`}>({count})</span>\r\n          <span className={`${trayStyles.text.tertiary} text-slate-500 transition-transform ${isExpanded ? 'rotate-180' : ''}`}>\r\n            \r\n          </span>\r\n        </span>\r\n      </button>\r\n      {isExpanded && <div>{children}</div>}\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Category Group Component\r\n// =============================================================================\r\n\r\ninterface CategoryGroupProps {\r\n  category: EquipmentCategory;\r\n  items: LoadoutEquipmentItem[];\r\n  selectedId?: string | null;\r\n  onSelect: (id: string | null) => void;\r\n  onRemove: (id: string) => void;\r\n  onUnassign?: (id: string) => void;\r\n  onContextMenu: (e: React.MouseEvent, item: LoadoutEquipmentItem) => void;\r\n}\r\n\r\nfunction CategoryGroup({ category, items, selectedId, onSelect, onRemove, onUnassign, onContextMenu }: CategoryGroupProps) {\r\n  const colorType = categoryToColorType(category);\r\n  const colors = getEquipmentColors(colorType);\r\n  const label = CATEGORY_LABELS[category] || category;\r\n  \r\n  return (\r\n    <div>\r\n      <div className={trayStyles.categoryRow}>\r\n        <span className={`${trayStyles.categoryDot} ${colors.bg}`} />\r\n        <span className={`${trayStyles.text.secondary} font-medium text-slate-400 uppercase tracking-wide`}>{label}</span>\r\n        <span className={`${trayStyles.text.secondary} text-slate-500`}>({items.length})</span>\r\n      </div>\r\n      {items.map(item => (\r\n        <EquipmentItem\r\n          key={item.instanceId}\r\n          item={item}\r\n          isSelected={selectedId === item.instanceId}\r\n          onSelect={() => onSelect(selectedId === item.instanceId ? null : item.instanceId)}\r\n          onRemove={() => onRemove(item.instanceId)}\r\n          onUnassign={onUnassign ? () => onUnassign(item.instanceId) : undefined}\r\n          onContextMenu={(e) => onContextMenu(e, item)}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Main Component\r\n// =============================================================================\r\n\r\nexport function GlobalLoadoutTray({\r\n  equipment,\r\n  equipmentCount,\r\n  onRemoveEquipment,\r\n  onRemoveAllEquipment,\r\n  isExpanded,\r\n  onToggleExpand,\r\n  selectedEquipmentId,\r\n  onSelectEquipment,\r\n  onUnassignEquipment,\r\n  onQuickAssign,\r\n  availableLocations = [],\r\n  className = '',\r\n}: GlobalLoadoutTrayProps) {\r\n  // Section expansion state\r\n  const [unallocatedExpanded, setUnallocatedExpanded] = useState(true);\r\n  const [allocatedExpanded, setAllocatedExpanded] = useState(true);\r\n  \r\n  // Context menu state\r\n  const [contextMenu, setContextMenu] = useState<{\r\n    x: number;\r\n    y: number;\r\n    item: LoadoutEquipmentItem;\r\n  } | null>(null);\r\n  \r\n  // Split equipment by allocation\r\n  const { unallocated, allocated } = useMemo(() => {\r\n    const unalloc: LoadoutEquipmentItem[] = [];\r\n    const alloc: LoadoutEquipmentItem[] = [];\r\n    for (const item of equipment) {\r\n      if (item.isAllocated) {\r\n        alloc.push(item);\r\n      } else {\r\n        unalloc.push(item);\r\n      }\r\n    }\r\n    return { unallocated: unalloc, allocated: alloc };\r\n  }, [equipment]);\r\n  \r\n  // Group by category\r\n  const unallocatedByCategory = useMemo(() => groupByCategory(unallocated), [unallocated]);\r\n  const allocatedByCategory = useMemo(() => groupByCategory(allocated), [allocated]);\r\n  \r\n  // Handle selection\r\n  const handleSelect = useCallback((id: string | null) => {\r\n    onSelectEquipment?.(id);\r\n  }, [onSelectEquipment]);\r\n  \r\n  // Handle context menu\r\n  const handleContextMenu = useCallback((e: React.MouseEvent, item: LoadoutEquipmentItem) => {\r\n    e.preventDefault();\r\n    // Select the item when right-clicking\r\n    onSelectEquipment?.(item.instanceId);\r\n    setContextMenu({ x: e.clientX, y: e.clientY, item });\r\n  }, [onSelectEquipment]);\r\n  \r\n  // Handle quick assign from context menu\r\n  const handleQuickAssign = useCallback((location: MechLocation) => {\r\n    if (contextMenu) {\r\n      onQuickAssign?.(contextMenu.item.instanceId, location);\r\n      onSelectEquipment?.(null);\r\n    }\r\n  }, [contextMenu, onQuickAssign, onSelectEquipment]);\r\n  \r\n  // Handle unassign\r\n  const handleUnassign = useCallback((instanceId: string) => {\r\n    onUnassignEquipment?.(instanceId);\r\n  }, [onUnassignEquipment]);\r\n  \r\n  // Handle drop to unallocate (drag from slot to tray)\r\n  const handleDropToUnallocated = useCallback((equipmentId: string) => {\r\n    // Find the item being dropped\r\n    const item = equipment.find(e => e.instanceId === equipmentId);\r\n    if (item?.isAllocated) {\r\n      onUnassignEquipment?.(equipmentId);\r\n    }\r\n  }, [equipment, onUnassignEquipment]);\r\n  \r\n  // Handle remove all (only removable items)\r\n  const removableCount = equipment.filter(e => e.isRemovable).length;\r\n  const handleRemoveAll = useCallback(() => {\r\n    if (removableCount === 0) return;\r\n    if (window.confirm(`Remove all ${removableCount} removable equipment items?`)) {\r\n      onRemoveAllEquipment();\r\n      onSelectEquipment?.(null);\r\n    }\r\n  }, [removableCount, onRemoveAllEquipment, onSelectEquipment]);\r\n  \r\n  // Collapsed state\r\n  if (!isExpanded) {\r\n    return (\r\n      <div className={`bg-slate-800 border-l border-slate-700 flex flex-col items-center py-2 ${className}`}\r\n           style={{ width: '40px' }}>\r\n        <button\r\n          onClick={onToggleExpand}\r\n          className=\"flex flex-col items-center gap-1 text-slate-400 hover:text-white transition-colors p-2\"\r\n          title=\"Expand loadout\"\r\n        >\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 19l-7-7 7-7m8 14l-7-7 7-7\" />\r\n          </svg>\r\n          {equipmentCount > 0 && (\r\n            <span className=\"bg-amber-600 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[20px] text-center\">\r\n              {equipmentCount}\r\n            </span>\r\n          )}\r\n          <span className=\"text-xs [writing-mode:vertical-rl] rotate-180 mt-2\">Loadout</span>\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Expanded state\r\n  return (\r\n    <>\r\n      <div className={`bg-slate-800 border-l border-slate-700 flex flex-col ${className}`}\r\n           style={{ width: '260px' }}>\r\n        {/* Header */}\r\n        <div className=\"flex-shrink-0 border-b border-slate-600\">\r\n          <div className={`flex items-center justify-between ${trayStyles.padding.header} py-2`}>\r\n            <div className={`flex items-center ${trayStyles.gap}`}>\r\n              <h3 className={`font-semibold text-white ${trayStyles.text.primary}`}>Loadout</h3>\r\n              <span className={`bg-slate-700 text-slate-300 ${trayStyles.text.secondary} rounded-full px-1.5 py-0.5`}>\r\n                {equipmentCount}\r\n              </span>\r\n            </div>\r\n            <button\r\n              onClick={onToggleExpand}\r\n              className=\"text-slate-400 hover:text-white transition-colors p-1\"\r\n              title=\"Collapse\"\r\n            >\r\n              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 5l7 7-7 7M5 5l7 7-7 7\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n          \r\n          {/* Quick actions */}\r\n          {removableCount > 0 && (\r\n            <div className={`${trayStyles.padding.header} pb-2`}>\r\n              <button\r\n                onClick={handleRemoveAll}\r\n                className={`w-full px-2 py-1 ${trayStyles.text.primary} bg-red-900/40 hover:bg-red-900/60 rounded text-red-300 transition-colors`}\r\n              >\r\n                Clear All ({removableCount})\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Equipment List */}\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          {equipment.length === 0 ? (\r\n            <div className=\"p-4 text-center text-slate-500\">\r\n              <div className=\"text-2xl mb-2\"></div>\r\n              <div className={trayStyles.text.primary}>No equipment</div>\r\n              <div className={`${trayStyles.text.secondary} mt-1`}>Add from Equipment tab</div>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              {/* Unallocated Section - also serves as drop zone for unallocation */}\r\n              <AllocationSection\r\n                title=\"Unallocated\"\r\n                count={unallocated.length}\r\n                isExpanded={unallocatedExpanded}\r\n                onToggle={() => setUnallocatedExpanded(!unallocatedExpanded)}\r\n                titleColor=\"text-amber-400\"\r\n                isDropZone={true}\r\n                onDrop={handleDropToUnallocated}\r\n              >\r\n                {unallocated.length === 0 ? (\r\n                  <div className={`${trayStyles.padding.row} py-1 text-center text-slate-500 ${trayStyles.text.tertiary}`}>\r\n                    Drag here to unassign\r\n                  </div>\r\n                ) : (\r\n                  CATEGORY_ORDER.map(category => {\r\n                    const items = unallocatedByCategory.get(category);\r\n                    if (!items || items.length === 0) return null;\r\n                    return (\r\n                      <CategoryGroup\r\n                        key={category}\r\n                        category={category}\r\n                        items={items}\r\n                        selectedId={selectedEquipmentId}\r\n                        onSelect={handleSelect}\r\n                        onRemove={onRemoveEquipment}\r\n                        onContextMenu={handleContextMenu}\r\n                      />\r\n                    );\r\n                  })\r\n                )}\r\n              </AllocationSection>\r\n              \r\n              {/* Allocated Section */}\r\n              {allocated.length > 0 && (\r\n                <AllocationSection\r\n                  title=\"Allocated\"\r\n                  count={allocated.length}\r\n                  isExpanded={allocatedExpanded}\r\n                  onToggle={() => setAllocatedExpanded(!allocatedExpanded)}\r\n                  titleColor=\"text-green-400\"\r\n                >\r\n                  {CATEGORY_ORDER.map(category => {\r\n                    const items = allocatedByCategory.get(category);\r\n                    if (!items || items.length === 0) return null;\r\n                    return (\r\n                      <CategoryGroup\r\n                        key={category}\r\n                        category={category}\r\n                        items={items}\r\n                        selectedId={selectedEquipmentId}\r\n                        onSelect={handleSelect}\r\n                        onRemove={onRemoveEquipment}\r\n                        onUnassign={handleUnassign}\r\n                        onContextMenu={handleContextMenu}\r\n                      />\r\n                    );\r\n                  })}\r\n                </AllocationSection>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Selection info footer */}\r\n        {selectedEquipmentId && (\r\n          <div className={`flex-shrink-0 ${trayStyles.padding.header} py-2 border-t border-slate-600 bg-slate-700/50`}>\r\n            <div className={`${trayStyles.text.secondary} text-slate-400`}>\r\n              Selected for placement\r\n            </div>\r\n            <div className={`${trayStyles.text.primary} text-amber-400 font-medium truncate`}>\r\n              {equipment.find(e => e.instanceId === selectedEquipmentId)?.name}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Context Menu Portal */}\r\n      {contextMenu && (\r\n        <ContextMenu\r\n          x={contextMenu.x}\r\n          y={contextMenu.y}\r\n          item={contextMenu.item}\r\n          availableLocations={availableLocations}\r\n          onQuickAssign={handleQuickAssign}\r\n          onUnassign={() => {\r\n            handleUnassign(contextMenu.item.instanceId);\r\n            setContextMenu(null);\r\n          }}\r\n          onClose={() => setContextMenu(null)}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default GlobalLoadoutTray;\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\equipment\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\shared\\ColorLegend.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":39,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":39,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Color Legend Component\r\n * \r\n * Collapsible color reference panel explaining the color system.\r\n * \r\n * @spec openspec/specs/color-system/spec.md\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport { SLOT_COLORS, SystemComponentType } from '@/utils/colors/slotColors';\r\nimport { EQUIPMENT_COLORS, EquipmentColorType } from '@/utils/colors/equipmentColors';\r\nimport { TECH_BASE_COLORS } from '@/utils/colors/techBaseColors';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\n\r\ninterface ColorLegendProps {\r\n  /** Initially expanded */\r\n  defaultExpanded?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\ninterface ColorSwatchProps {\r\n  bgClass: string;\r\n  label: string;\r\n}\r\n\r\nfunction ColorSwatch({ bgClass, label }: ColorSwatchProps) {\r\n  return (\r\n    <div className=\"flex items-center gap-2\">\r\n      <div className={`w-4 h-4 rounded ${bgClass} border border-slate-600`} />\r\n      <span className=\"text-xs text-slate-300\">{label}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Collapsible color reference panel\r\n */\r\nexport function ColorLegend({\r\n  defaultExpanded = false,\r\n  className = '',\r\n}: ColorLegendProps) {\r\n  const [isExpanded, setIsExpanded] = useState(defaultExpanded);\r\n  \r\n  const systemComponents: { type: SystemComponentType; label: string }[] = [\r\n    { type: 'engine', label: 'Engine' },\r\n    { type: 'gyro', label: 'Gyro' },\r\n    { type: 'actuator', label: 'Actuators' },\r\n    { type: 'cockpit', label: 'Cockpit/Sensors' },\r\n    { type: 'empty', label: 'Empty Slot' },\r\n  ];\r\n  \r\n  const equipmentTypes: { type: EquipmentColorType; label: string }[] = [\r\n    { type: 'weapon', label: 'Weapons' },\r\n    { type: 'ammunition', label: 'Ammunition' },\r\n    { type: 'heatsink', label: 'Heat Sinks' },\r\n    { type: 'electronics', label: 'Electronics' },\r\n    { type: 'physical', label: 'Physical Weapons' },\r\n    { type: 'misc', label: 'Other Equipment' },\r\n  ];\r\n  \r\n  const techBases = [\r\n    { techBase: TechBase.INNER_SPHERE, label: 'Inner Sphere' },\r\n    { techBase: TechBase.CLAN, label: 'Clan' },\r\n  ];\r\n  \r\n  return (\r\n    <div className={`bg-slate-800 rounded-lg border border-slate-700 ${className}`}>\r\n      <button\r\n        onClick={() => setIsExpanded(!isExpanded)}\r\n        className=\"w-full flex items-center justify-between px-3 py-2 text-sm text-slate-300 hover:text-white transition-colors\"\r\n      >\r\n        <span className=\"font-medium\">Color Legend</span>\r\n        <span className={`transform transition-transform ${isExpanded ? 'rotate-180' : ''}`}>\r\n          \r\n        </span>\r\n      </button>\r\n      \r\n      {isExpanded && (\r\n        <div className=\"px-3 pb-3 space-y-4 border-t border-slate-700 pt-3\">\r\n          {/* System Components */}\r\n          <div>\r\n            <h4 className=\"text-xs font-semibold text-slate-400 uppercase mb-2\">\r\n              System Components\r\n            </h4>\r\n            <div className=\"grid grid-cols-2 gap-1\">\r\n              {systemComponents.map(({ type, label }) => (\r\n                <ColorSwatch\r\n                  key={type}\r\n                  bgClass={SLOT_COLORS[type].bg}\r\n                  label={label}\r\n                />\r\n              ))}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Equipment Types */}\r\n          <div>\r\n            <h4 className=\"text-xs font-semibold text-slate-400 uppercase mb-2\">\r\n              Equipment Types\r\n            </h4>\r\n            <div className=\"grid grid-cols-2 gap-1\">\r\n              {equipmentTypes.map(({ type, label }) => (\r\n                <ColorSwatch\r\n                  key={type}\r\n                  bgClass={EQUIPMENT_COLORS[type].bg}\r\n                  label={label}\r\n                />\r\n              ))}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Tech Base */}\r\n          <div>\r\n            <h4 className=\"text-xs font-semibold text-slate-400 uppercase mb-2\">\r\n              Tech Base\r\n            </h4>\r\n            <div className=\"grid grid-cols-2 gap-1\">\r\n              {techBases.map(({ techBase, label }) => (\r\n                <ColorSwatch\r\n                  key={techBase}\r\n                  bgClass={TECH_BASE_COLORS[techBase].bg}\r\n                  label={label}\r\n                />\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\shared\\GlobalStatusBar.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":47,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":47,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Global Status Bar Component\r\n * \r\n * Displays capacity utilization at the bottom of the customizer,\r\n * visible across all tabs.\r\n * \r\n * @spec openspec/changes/unify-equipment-tab/specs/equipment-tray/spec.md\r\n */\r\n\r\nimport React from 'react';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface StatusBarStats {\r\n  /** Current weight used (tons) */\r\n  weightUsed: number;\r\n  /** Maximum weight (tonnage) */\r\n  weightMax: number;\r\n  /** Weight remaining */\r\n  weightRemaining: number;\r\n  /** Critical slots used */\r\n  slotsUsed: number;\r\n  /** Total critical slots available */\r\n  slotsTotal: number;\r\n  /** Heat generated by weapons */\r\n  heatGenerated: number;\r\n  /** Heat dissipation from heat sinks */\r\n  heatDissipation: number;\r\n}\r\n\r\ninterface GlobalStatusBarProps {\r\n  /** Status bar statistics */\r\n  stats: StatusBarStats;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\n/**\r\n * Global status bar showing weight, slots, and heat capacity\r\n */\r\nexport function GlobalStatusBar({ stats, className = '' }: GlobalStatusBarProps) {\r\n  const isOverWeight = stats.weightRemaining < 0;\r\n  const isOverSlots = stats.slotsUsed > stats.slotsTotal;\r\n  const isOverHeat = stats.heatGenerated > stats.heatDissipation;\r\n  \r\n  return (\r\n    <div className={`bg-slate-800 border-t border-slate-700 px-4 py-2 ${className}`}>\r\n      <div className=\"flex items-center justify-between gap-6 text-sm\">\r\n        {/* Weight */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"text-slate-400\">Weight:</span>\r\n          <span className={isOverWeight ? 'text-red-400 font-medium' : 'text-white'}>\r\n            {stats.weightUsed.toFixed(1)} / {stats.weightMax}t\r\n          </span>\r\n          <span className={`text-xs ${isOverWeight ? 'text-red-400' : 'text-green-400'}`}>\r\n            ({isOverWeight ? '' : '+'}{stats.weightRemaining.toFixed(1)}t rem)\r\n          </span>\r\n        </div>\r\n        \r\n        {/* Divider */}\r\n        <div className=\"h-4 w-px bg-slate-600\" />\r\n        \r\n        {/* Slots */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"text-slate-400\">Free Slots:</span>\r\n          <span className={isOverSlots ? 'text-red-400 font-medium' : 'text-white'}>\r\n            {stats.slotsUsed} / {stats.slotsTotal}\r\n          </span>\r\n          {isOverSlots && (\r\n            <span className=\"text-xs text-red-400\">\r\n              (over by {stats.slotsUsed - stats.slotsTotal})\r\n            </span>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Divider */}\r\n        <div className=\"h-4 w-px bg-slate-600\" />\r\n        \r\n        {/* Heat */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"text-slate-400\">Heat:</span>\r\n          <span className={isOverHeat ? 'text-amber-400 font-medium' : 'text-white'}>\r\n            {stats.heatGenerated} / {stats.heatDissipation}\r\n          </span>\r\n          {isOverHeat && (\r\n            <span className=\"text-xs text-amber-400\">\r\n              (+{stats.heatGenerated - stats.heatDissipation} buildup)\r\n            </span>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Spacer to push warnings to right */}\r\n        <div className=\"flex-1\" />\r\n        \r\n        {/* Capacity warnings */}\r\n        {(isOverWeight || isOverSlots) && (\r\n          <div className=\"flex items-center gap-2 text-xs\">\r\n            <span className=\"text-red-400\"></span>\r\n            <span className=\"text-red-400\">\r\n              {isOverWeight && 'Over Weight'}\r\n              {isOverWeight && isOverSlots && '  '}\r\n              {isOverSlots && 'Over Slots'}\r\n            </span>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default GlobalStatusBar;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\shared\\StatCell.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":34,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":34,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Stat Cell Component\r\n * \r\n * Displays a single statistic with label and value.\r\n * \r\n * @spec openspec/specs/unit-info-banner/spec.md\r\n */\r\n\r\nimport React from 'react';\r\n\r\ninterface StatCellProps {\r\n  /** Stat label */\r\n  label: string;\r\n  /** Stat value */\r\n  value: string | number;\r\n  /** Optional unit suffix */\r\n  unit?: string;\r\n  /** Color variant */\r\n  variant?: 'default' | 'warning' | 'error' | 'success';\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\nconst variantStyles = {\r\n  default: 'text-slate-100',\r\n  warning: 'text-yellow-400',\r\n  error: 'text-red-400',\r\n  success: 'text-green-400',\r\n};\r\n\r\n/**\r\n * Individual stat cell for unit info displays\r\n */\r\nexport function StatCell({\r\n  label,\r\n  value,\r\n  unit,\r\n  variant = 'default',\r\n  className = '',\r\n}: StatCellProps) {\r\n  return (\r\n    <div className={`flex flex-col items-center ${className}`}>\r\n      <span className=\"text-xs text-slate-400 uppercase tracking-wide\">\r\n        {label}\r\n      </span>\r\n      <span className={`text-lg font-bold ${variantStyles[variant]}`}>\r\n        {value}\r\n        {unit && <span className=\"text-sm font-normal text-slate-400 ml-0.5\">{unit}</span>}\r\n      </span>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\shared\\TechBaseBadge.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":26,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":26,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tech Base Badge Component\r\n * \r\n * Displays tech base mode with appropriate color coding.\r\n * Supports IS, Clan, and Mixed tech display.\r\n * \r\n * @spec openspec/specs/color-system/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { TechBaseMode, TECH_BASE_MODE_LABELS } from '@/types/construction/TechBaseConfiguration';\r\nimport { getTechBaseModeColors, getTechBaseModeShortName } from '@/utils/colors/techBaseColors';\r\n\r\ninterface TechBaseBadgeProps {\r\n  /** Tech base mode to display (IS/Clan/Mixed) */\r\n  techBaseMode: TechBaseMode;\r\n  /** Use short name (IS/Clan/Mixed) instead of full name */\r\n  short?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Tech base badge with color coding\r\n */\r\nexport function TechBaseBadge({\r\n  techBaseMode,\r\n  short = true,\r\n  className = '',\r\n}: TechBaseBadgeProps) {\r\n  const colors = getTechBaseModeColors(techBaseMode);\r\n  const badgeClass = `${colors.badge} px-2 py-0.5 rounded text-xs font-medium`;\r\n  const displayText = short ? getTechBaseModeShortName(techBaseMode) : TECH_BASE_MODE_LABELS[techBaseMode];\r\n  \r\n  return (\r\n    <span className={`${badgeClass} ${className}`}>\r\n      {displayText}\r\n    </span>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\shared\\TechBaseConfiguration.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":218,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":218,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tech Base Configuration Component\r\n * \r\n * Combined panel showing component selections and tech base toggles.\r\n * Supports Inner Sphere, Clan, and Mixed Tech modes.\r\n * \r\n * @spec Based on BattleTech TechManual mixed tech rules\r\n */\r\n\r\nimport React from 'react';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport {\r\n  TechBaseMode,\r\n  TechBaseComponent,\r\n  IComponentTechBases,\r\n  TECH_BASE_COMPONENT_LABELS,\r\n  TECH_BASE_COMPONENT_DESCRIPTIONS,\r\n} from '@/types/construction/TechBaseConfiguration';\r\n\r\n// =============================================================================\r\n// Style Constants\r\n// =============================================================================\r\n\r\nconst styles = {\r\n  // Base button styles\r\n  button: {\r\n    base: 'px-2 py-1 text-xs font-medium transition-colors',\r\n    baseLarge: 'px-4 py-2 text-sm font-medium transition-colors',\r\n    inactive: 'bg-slate-700 text-slate-400 hover:bg-slate-600 hover:text-slate-300',\r\n    disabled: 'opacity-50 cursor-not-allowed',\r\n    enabled: 'cursor-pointer',\r\n    borderLeft: 'border-l border-slate-600',\r\n  },\r\n  \r\n  // Tech base colors (active state)\r\n  techBase: {\r\n    innerSphere: 'bg-green-600 text-white',\r\n    clan: 'bg-red-600 text-white',\r\n    mixed: 'bg-purple-600 text-white',\r\n  },\r\n  \r\n  // Container styles\r\n  container: {\r\n    panel: 'bg-slate-800 rounded-lg border border-slate-700 overflow-hidden',\r\n    header: 'px-4 py-3 border-b border-slate-700 bg-slate-800',\r\n    buttonGroup: 'inline-flex rounded-md overflow-hidden border border-slate-600',\r\n    rowEven: 'bg-slate-800',\r\n    rowOdd: 'bg-slate-800/50',\r\n  },\r\n  \r\n  // Text styles\r\n  text: {\r\n    title: 'text-lg font-semibold text-white',\r\n    subtitle: 'text-xs text-slate-400 mt-0.5',\r\n    label: 'text-sm font-medium text-slate-200',\r\n    value: 'text-sm text-white',\r\n    valueMuted: 'text-sm text-slate-400',\r\n  },\r\n} as const;\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\n/**\r\n * Current values for each component category\r\n */\r\nexport interface IComponentValues {\r\n  chassis: string;      // e.g., \"Standard\", \"Endo Steel\"\r\n  gyro: string;         // e.g., \"Standard\", \"XL\", \"Compact\"\r\n  engine: string;       // e.g., \"Standard Fusion 200\", \"XL 300\"\r\n  heatsink: string;     // e.g., \"Single\", \"Double\"\r\n  targeting: string;    // e.g., \"None\", \"Standard\", \"C3\"\r\n  myomer: string;       // e.g., \"Standard\", \"TSM\", \"Industrial\"\r\n  movement: string;     // e.g., \"None\", \"Jump Jets\", \"MASC\"\r\n  armor: string;        // e.g., \"Standard\", \"Ferro-Fibrous\"\r\n}\r\n\r\n/**\r\n * Default placeholder values\r\n */\r\nexport const DEFAULT_COMPONENT_VALUES: IComponentValues = {\r\n  chassis: 'Standard',\r\n  gyro: 'Standard',\r\n  engine: 'Not Selected',\r\n  heatsink: 'Single',\r\n  targeting: 'None',\r\n  myomer: 'Standard',\r\n  movement: 'None',\r\n  armor: 'Standard',\r\n};\r\n\r\n// =============================================================================\r\n// Helper Functions\r\n// =============================================================================\r\n\r\nfunction getModeButtonClass(isActive: boolean, isDisabled: boolean): string {\r\n  return [\r\n    styles.button.baseLarge,\r\n    isActive ? '' : styles.button.inactive,\r\n    isDisabled ? styles.button.disabled : styles.button.enabled,\r\n  ].filter(Boolean).join(' ');\r\n}\r\n\r\nfunction getSegmentButtonClass(isActive: boolean, isDisabled: boolean): string {\r\n  return [\r\n    styles.button.base,\r\n    isActive ? '' : styles.button.inactive,\r\n    isDisabled ? styles.button.disabled : styles.button.enabled,\r\n  ].filter(Boolean).join(' ');\r\n}\r\n\r\n// =============================================================================\r\n// Props Interfaces\r\n// =============================================================================\r\n\r\ninterface TechBaseConfigurationProps {\r\n  mode: TechBaseMode;\r\n  components: IComponentTechBases;\r\n  componentValues?: Partial<IComponentValues>;\r\n  onModeChange: (mode: TechBaseMode) => void;\r\n  onComponentChange: (component: TechBaseComponent, techBase: TechBase) => void;\r\n  readOnly?: boolean;\r\n  className?: string;\r\n}\r\n\r\ninterface SegmentedButtonProps {\r\n  value: TechBase;\r\n  onChange: (value: TechBase) => void;\r\n  disabled?: boolean;\r\n  size?: 'small' | 'normal';\r\n}\r\n\r\ninterface ComponentRowProps {\r\n  component: TechBaseComponent;\r\n  techBase: TechBase;\r\n  currentValue: string;\r\n  onChange: (techBase: TechBase) => void;\r\n  disabled: boolean;\r\n  isOdd: boolean;\r\n}\r\n\r\n// =============================================================================\r\n// Sub-Components\r\n// =============================================================================\r\n\r\nfunction TechBaseSegmentedButton({ value, onChange, disabled = false, size = 'normal' }: SegmentedButtonProps) {\r\n  const isIS = value === TechBase.INNER_SPHERE;\r\n  const isClan = value === TechBase.CLAN;\r\n  const buttonClass = size === 'small' ? getSegmentButtonClass : getModeButtonClass;\r\n\r\n  return (\r\n    <div className={styles.container.buttonGroup}>\r\n      <button\r\n        type=\"button\"\r\n        onClick={() => onChange(TechBase.INNER_SPHERE)}\r\n        disabled={disabled}\r\n        className={`${buttonClass(isIS, disabled)} ${isIS ? styles.techBase.innerSphere : ''}`}\r\n      >\r\n        IS\r\n      </button>\r\n      <button\r\n        type=\"button\"\r\n        onClick={() => onChange(TechBase.CLAN)}\r\n        disabled={disabled}\r\n        className={`${buttonClass(isClan, disabled)} ${styles.button.borderLeft} ${isClan ? styles.techBase.clan : ''}`}\r\n      >\r\n        Clan\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ComponentRow({ component, techBase, currentValue, onChange, disabled, isOdd }: ComponentRowProps) {\r\n  const rowBg = isOdd ? styles.container.rowOdd : styles.container.rowEven;\r\n  const opacity = disabled ? 'opacity-60' : '';\r\n  const valueClass = currentValue === 'None' || currentValue === 'Not Selected' \r\n    ? styles.text.valueMuted \r\n    : styles.text.value;\r\n\r\n  return (\r\n    <div\r\n      className={`flex items-center justify-between px-4 py-2 ${rowBg} ${opacity}`}\r\n      title={TECH_BASE_COMPONENT_DESCRIPTIONS[component]}\r\n    >\r\n      {/* Component Label */}\r\n      <div className={`${styles.text.label} w-24 flex-shrink-0`}>\r\n        {TECH_BASE_COMPONENT_LABELS[component]}\r\n      </div>\r\n      \r\n      {/* Current Value */}\r\n      <div className={`${valueClass} flex-1 text-center`}>\r\n        {currentValue}\r\n      </div>\r\n      \r\n      {/* Tech Base Toggle */}\r\n      <div className=\"flex-shrink-0\">\r\n        <TechBaseSegmentedButton\r\n          value={techBase}\r\n          onChange={onChange}\r\n          disabled={disabled}\r\n          size=\"small\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Main Component\r\n// =============================================================================\r\n\r\nconst COMPONENT_ORDER: TechBaseComponent[] = [\r\n  TechBaseComponent.CHASSIS, TechBaseComponent.GYRO, TechBaseComponent.ENGINE, TechBaseComponent.HEATSINK,\r\n  TechBaseComponent.TARGETING, TechBaseComponent.MYOMER, TechBaseComponent.MOVEMENT, TechBaseComponent.ARMOR,\r\n];\r\n\r\nexport function TechBaseConfiguration({\r\n  mode,\r\n  components,\r\n  componentValues = {},\r\n  onModeChange,\r\n  onComponentChange,\r\n  readOnly = false,\r\n  className = '',\r\n}: TechBaseConfigurationProps) {\r\n  const isMixed = mode === TechBaseMode.MIXED;\r\n  const isIS = mode === TechBaseMode.INNER_SPHERE;\r\n  const isClan = mode === TechBaseMode.CLAN;\r\n  \r\n  // Merge with defaults\r\n  const values: IComponentValues = { ...DEFAULT_COMPONENT_VALUES, ...componentValues };\r\n\r\n  return (\r\n    <div className={`${styles.container.panel} ${className}`}>\r\n      {/* Header */}\r\n      <div className={styles.container.header}>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h3 className={styles.text.title}>Configuration</h3>\r\n            <p className={styles.text.subtitle}>Component settings and tech base</p>\r\n          </div>\r\n          \r\n          {/* Mode Selector */}\r\n          <div className={styles.container.buttonGroup}>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => onModeChange(TechBaseMode.INNER_SPHERE)}\r\n              disabled={readOnly}\r\n              title=\"All components use Inner Sphere technology\"\r\n              className={`${getModeButtonClass(isIS, readOnly)} ${isIS ? styles.techBase.innerSphere : ''}`}\r\n            >\r\n              Inner Sphere\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => onModeChange(TechBaseMode.CLAN)}\r\n              disabled={readOnly}\r\n              title=\"All components use Clan technology\"\r\n              className={`${getModeButtonClass(isClan, readOnly)} ${styles.button.borderLeft} ${isClan ? styles.techBase.clan : ''}`}\r\n            >\r\n              Clan\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => onModeChange(TechBaseMode.MIXED)}\r\n              disabled={readOnly}\r\n              title=\"Configure each component's tech base individually\"\r\n              className={`${getModeButtonClass(isMixed, readOnly)} ${styles.button.borderLeft} ${isMixed ? styles.techBase.mixed : ''}`}\r\n            >\r\n              Mixed\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Column Headers */}\r\n      <div className=\"flex items-center justify-between px-4 py-2 border-b border-slate-700 text-xs font-medium text-slate-500 uppercase tracking-wider\">\r\n        <div className=\"w-24 flex-shrink-0\">Component</div>\r\n        <div className=\"flex-1 text-center\">Selection</div>\r\n        <div className=\"w-[88px] text-center flex-shrink-0\">Tech Base</div>\r\n      </div>\r\n\r\n      {/* Component Rows */}\r\n      <div className=\"divide-y divide-slate-700/50\">\r\n        {COMPONENT_ORDER.map((component, index) => (\r\n          <ComponentRow\r\n            key={component}\r\n            component={component}\r\n            techBase={components[component]}\r\n            currentValue={values[component]}\r\n            onChange={(techBase) => onComponentChange(component, techBase)}\r\n            disabled={readOnly || !isMixed}\r\n            isOdd={index % 2 === 1}\r\n          />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\shared\\UnitInfoBanner.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":182,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":182,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Info Banner Component\r\n * \r\n * At-a-glance unit statistics display with \"current / max\" format\r\n * for capacity-based stats like MegaMekLab's status bar.\r\n * \r\n * @spec openspec/specs/unit-info-banner/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { TechBaseBadge } from './TechBaseBadge';\r\nimport { ValidationBadge } from './ValidationBadge';\r\nimport { TechBaseMode } from '@/types/construction/TechBaseConfiguration';\r\nimport { ValidationStatus } from '@/utils/colors/statusColors';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface UnitStats {\r\n  /** Unit name/variant */\r\n  name: string;\r\n  /** Tonnage (max weight) */\r\n  tonnage: number;\r\n  /** Tech base mode (IS/Clan/Mixed) */\r\n  techBaseMode: TechBaseMode;\r\n  /** Engine rating */\r\n  engineRating: number;\r\n  /** Walk MP */\r\n  walkMP: number;\r\n  /** Run MP */\r\n  runMP: number;\r\n  /** Jump MP */\r\n  jumpMP: number;\r\n  /** Max Run MP with enhancement active (MASC/TSM/Supercharger) */\r\n  maxRunMP?: number;\r\n  /** Current weight used */\r\n  weightUsed: number;\r\n  /** Remaining weight (calculated: tonnage - weightUsed) */\r\n  weightRemaining: number;\r\n  /** Total armor points allocated */\r\n  armorPoints: number;\r\n  /** Maximum armor points possible */\r\n  maxArmorPoints: number;\r\n  /** Critical slots currently used */\r\n  criticalSlotsUsed: number;\r\n  /** Total critical slots available (78 for standard mech) */\r\n  criticalSlotsTotal: number;\r\n  /** Total heat generated by weapons/equipment */\r\n  heatGenerated: number;\r\n  /** Total heat dissipation from heat sinks */\r\n  heatDissipation: number;\r\n  /** Battle Value (optional) */\r\n  battleValue?: number;\r\n  /** Validation status */\r\n  validationStatus: ValidationStatus;\r\n  /** Number of validation errors */\r\n  errorCount: number;\r\n  /** Number of validation warnings */\r\n  warningCount: number;\r\n}\r\n\r\ninterface UnitInfoBannerProps {\r\n  /** Unit statistics */\r\n  stats: UnitStats;\r\n  /** On reset button click */\r\n  onReset?: () => void;\r\n  /** On debug button click */\r\n  onDebug?: () => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n// =============================================================================\r\n// Styles\r\n// =============================================================================\r\n\r\nconst styles = {\r\n  label: 'text-[10px] font-medium text-slate-400 uppercase tracking-wider',\r\n  value: {\r\n    normal: 'text-white',\r\n    warning: 'text-amber-400',\r\n    error: 'text-red-400',\r\n    success: 'text-green-400',\r\n    engine: 'text-orange-500', // Matches engine color from slotColors\r\n  },\r\n  muted: 'text-slate-500',\r\n} as const;\r\n\r\n// =============================================================================\r\n// Helper Components\r\n// =============================================================================\r\n\r\ninterface CapacityStatProps {\r\n  label: string;\r\n  current: number | string;\r\n  max: number | string;\r\n  unit?: string;\r\n  status?: 'normal' | 'warning' | 'error' | 'success';\r\n}\r\n\r\n/**\r\n * Displays a stat in \"current / max\" format with color coding\r\n */\r\nfunction CapacityStat({ label, current, max, unit = '', status = 'normal' }: CapacityStatProps) {\r\n  const valueColor = styles.value[status];\r\n  \r\n  return (\r\n    <div className=\"flex flex-col items-center gap-0.5\">\r\n      <span className={styles.label}>{label}</span>\r\n      <div className=\"flex items-baseline gap-1\">\r\n        <span className={`text-lg font-bold ${valueColor}`}>\r\n          {current}{unit}\r\n        </span>\r\n        <span className={styles.muted}>/</span>\r\n        <span className={`text-sm ${styles.muted}`}>\r\n          {max}{unit}\r\n        </span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface SimpleStatProps {\r\n  label: string;\r\n  value: number | string;\r\n  status?: 'normal' | 'warning' | 'error' | 'success' | 'engine';\r\n}\r\n\r\n/**\r\n * Displays a simple single-value stat\r\n */\r\nfunction SimpleStat({ label, value, status = 'normal' }: SimpleStatProps) {\r\n  const valueColor = styles.value[status];\r\n  \r\n  return (\r\n    <div className=\"flex flex-col items-center gap-0.5\">\r\n      <span className={styles.label}>{label}</span>\r\n      <span className={`text-lg font-bold ${valueColor}`}>{value}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MovementStatProps {\r\n  walkMP: number;\r\n  runMP: number;\r\n  jumpMP: number;\r\n  maxRunMP?: number;\r\n}\r\n\r\n/**\r\n * Displays movement in compact format: 5 / 8 [10] / 5\r\n * Shows Walk / Run [MaxRun] / Jump\r\n */\r\nfunction MovementStat({ walkMP, runMP, jumpMP, maxRunMP }: MovementStatProps) {\r\n  const hasEnhancement = maxRunMP && maxRunMP > runMP;\r\n  \r\n  return (\r\n    <div className=\"flex flex-col items-center gap-0.5\">\r\n      <span className={styles.label}>WALK / RUN / JUMP</span>\r\n      <div className=\"flex items-baseline gap-1\">\r\n        <span className=\"text-lg font-bold text-white\">{walkMP}</span>\r\n        <span className={styles.muted}>/</span>\r\n        <span className=\"text-lg font-bold text-white\">{runMP}</span>\r\n        {hasEnhancement && (\r\n          <span className=\"text-lg font-bold text-white\">[{maxRunMP}]</span>\r\n        )}\r\n        <span className={styles.muted}>/</span>\r\n        <span className=\"text-lg font-bold text-white\">{jumpMP}</span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Main Component\r\n// =============================================================================\r\n\r\n/**\r\n * Unit information banner with stats display in \"current / max\" format\r\n */\r\nexport function UnitInfoBanner({\r\n  stats,\r\n  onReset,\r\n  onDebug,\r\n  className = '',\r\n}: UnitInfoBannerProps) {\r\n  // Calculate status colors\r\n  const weightStatus: 'normal' | 'warning' | 'error' = \r\n    stats.weightUsed > stats.tonnage ? 'error' :\r\n    stats.weightRemaining < 0.5 ? 'warning' : 'normal';\r\n  \r\n  const slotsStatus: 'normal' | 'warning' | 'error' = \r\n    stats.criticalSlotsUsed > stats.criticalSlotsTotal ? 'error' : 'normal';\r\n  \r\n  const heatStatus: 'normal' | 'warning' | 'error' | 'success' = \r\n    stats.heatGenerated > stats.heatDissipation ? 'error' :\r\n    stats.heatGenerated === stats.heatDissipation ? 'warning' : 'success';\r\n  \r\n  return (\r\n    <div className={`bg-slate-800 border border-slate-700 rounded-lg ${className}`}>\r\n      {/* Responsive container using flex-wrap for adaptive layout */}\r\n      <div className=\"flex flex-wrap items-stretch\">\r\n        {/* Section 1: Identity + Validation - takes minimum space needed */}\r\n        <div className=\"px-4 py-2 border-b sm:border-b-0 sm:border-r border-slate-700 min-w-fit\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div>\r\n              <h2 className=\"text-lg font-bold text-white whitespace-nowrap\">{stats.name}</h2>\r\n              <div className=\"flex items-center gap-2 mt-0.5\">\r\n                <span className=\"text-sm text-slate-400\">{stats.tonnage} tons</span>\r\n                <TechBaseBadge techBaseMode={stats.techBaseMode} />\r\n                <ValidationBadge \r\n                  status={stats.validationStatus}\r\n                  label={stats.validationStatus === 'valid' ? 'Valid' : \r\n                        `${stats.errorCount} errors, ${stats.warningCount} warnings`}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Section 2: Movement Stats */}\r\n        <div className=\"px-4 py-2 flex items-center justify-center gap-4 border-b sm:border-b-0 sm:border-r border-slate-700 min-w-fit\">\r\n          <MovementStat \r\n            walkMP={stats.walkMP} \r\n            runMP={stats.runMP} \r\n            jumpMP={stats.jumpMP}\r\n            maxRunMP={stats.maxRunMP}\r\n          />\r\n        </div>\r\n        \r\n        {/* Section 3: Capacity Stats - grows to fill available space */}\r\n        <div className=\"flex-1 px-4 py-2 flex items-center justify-around gap-2 border-b sm:border-b-0 sm:border-r border-slate-700 min-w-[340px]\">\r\n          <SimpleStat \r\n            label=\"ENGINE\"\r\n            value={stats.engineRating}\r\n            status=\"engine\"\r\n          />\r\n          <CapacityStat\r\n            label=\"WEIGHT\"\r\n            current={stats.weightUsed.toFixed(1)}\r\n            max={stats.tonnage.toFixed(1)}\r\n            unit=\"t\"\r\n            status={weightStatus}\r\n          />\r\n          <CapacityStat\r\n            label=\"ARMOR\"\r\n            current={stats.armorPoints}\r\n            max={stats.maxArmorPoints}\r\n            status=\"normal\"\r\n          />\r\n          <CapacityStat\r\n            label=\"SLOTS\"\r\n            current={stats.criticalSlotsUsed}\r\n            max={stats.criticalSlotsTotal}\r\n            status={slotsStatus}\r\n          />\r\n          <CapacityStat\r\n            label=\"HEAT\"\r\n            current={stats.heatGenerated}\r\n            max={stats.heatDissipation}\r\n            status={heatStatus}\r\n          />\r\n        </div>\r\n        \r\n        {/* Section 4: Optional Actions (only render if actions exist) */}\r\n        {(onReset || onDebug) && (\r\n          <div className=\"px-4 py-2 flex items-center justify-center gap-3 min-w-fit\">\r\n            {onReset && (\r\n              <button\r\n                onClick={onReset}\r\n                className=\"px-3 py-1.5 text-sm bg-slate-700 hover:bg-slate-600 text-slate-300 rounded transition-colors\"\r\n              >\r\n                Reset\r\n              </button>\r\n            )}\r\n            {onDebug && (\r\n              <button\r\n                onClick={onDebug}\r\n                className=\"px-3 py-1.5 text-sm bg-slate-700 hover:bg-slate-600 text-slate-300 rounded transition-colors\"\r\n              >\r\n                Debug\r\n              </button>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\shared\\ValidationBadge.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":26,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":26,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Validation Badge Component\r\n * \r\n * Displays validation status with appropriate color coding.\r\n * \r\n * @spec openspec/specs/color-system/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { ValidationStatus, getValidationColors } from '@/utils/colors/statusColors';\r\n\r\ninterface ValidationBadgeProps {\r\n  /** Validation status */\r\n  status: ValidationStatus;\r\n  /** Optional label text */\r\n  label?: string;\r\n  /** Show icon */\r\n  showIcon?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Validation status badge with color coding\r\n */\r\nexport function ValidationBadge({\r\n  status,\r\n  label,\r\n  showIcon = true,\r\n  className = '',\r\n}: ValidationBadgeProps) {\r\n  const colors = getValidationColors(status);\r\n  \r\n  return (\r\n    <span\r\n      className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${colors.bg} ${colors.text} border ${colors.border} ${className}`}\r\n    >\r\n      {showIcon && <span>{colors.icon}</span>}\r\n      {label && <span>{label}</span>}\r\n    </span>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\shared\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\styles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\ArmorTab.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":49,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":49,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Armor Tab Component\r\n * \r\n * Configuration of armor type, tonnage, and per-location allocation.\r\n * Uses tonnage-first workflow where user sets armor tonnage, then\r\n * distributes available points to locations.\r\n * \r\n * @spec openspec/specs/armor-system/spec.md\r\n * @spec openspec/specs/armor-diagram/spec.md\r\n */\r\n\r\nimport React, { useCallback, useMemo, useState } from 'react';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { useTechBaseSync } from '@/hooks/useTechBaseSync';\r\nimport { ArmorTypeEnum, getArmorDefinition } from '@/types/construction/ArmorType';\r\nimport { MechLocation } from '@/types/construction/CriticalSlotAllocation';\r\nimport { ArmorDiagram, LocationArmorData } from '../armor/ArmorDiagram';\r\nimport { LocationArmorEditor } from '../armor/LocationArmorEditor';\r\nimport {\r\n  calculateArmorPoints,\r\n  getMaxArmorForLocation,\r\n  getMaxTotalArmor,\r\n  getArmorCriticalSlots,\r\n} from '@/utils/construction/armorCalculations';\r\nimport { ceilToHalfTon } from '@/utils/physical/weightUtils';\r\nimport { getTotalAllocatedArmor } from '@/stores/unitState';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\ninterface ArmorTabProps {\r\n  /** Read-only mode */\r\n  readOnly?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\n/**\r\n * Armor configuration tab\r\n * \r\n * Uses useUnitStore() to access the current unit's state.\r\n */\r\nexport function ArmorTab({\r\n  readOnly = false,\r\n  className = '',\r\n}: ArmorTabProps) {\r\n  // Get unit state from context\r\n  const tonnage = useUnitStore((s) => s.tonnage);\r\n  const componentTechBases = useUnitStore((s) => s.componentTechBases);\r\n  const armorType = useUnitStore((s) => s.armorType);\r\n  const armorTonnage = useUnitStore((s) => s.armorTonnage);\r\n  const armorAllocation = useUnitStore((s) => s.armorAllocation);\r\n  \r\n  // Get actions from context\r\n  const setArmorType = useUnitStore((s) => s.setArmorType);\r\n  const setArmorTonnage = useUnitStore((s) => s.setArmorTonnage);\r\n  const setLocationArmor = useUnitStore((s) => s.setLocationArmor);\r\n  const autoAllocateArmor = useUnitStore((s) => s.autoAllocateArmor);\r\n  const maximizeArmor = useUnitStore((s) => s.maximizeArmor);\r\n  \r\n  // Get filtered armor options based on tech base\r\n  const { filteredOptions } = useTechBaseSync(componentTechBases);\r\n  \r\n  // Selected location for editing\r\n  const [selectedLocation, setSelectedLocation] = useState<MechLocation | null>(null);\r\n  \r\n  // Calculate derived values\r\n  const armorDef = useMemo(() => getArmorDefinition(armorType), [armorType]);\r\n  const pointsPerTon = armorDef?.pointsPerTon ?? 16;\r\n  const availablePoints = useMemo(\r\n    () => calculateArmorPoints(armorTonnage, armorType),\r\n    [armorTonnage, armorType]\r\n  );\r\n  const allocatedPoints = useMemo(\r\n    () => getTotalAllocatedArmor(armorAllocation),\r\n    [armorAllocation]\r\n  );\r\n  const maxTotalArmor = useMemo(() => getMaxTotalArmor(tonnage), [tonnage]);\r\n  const armorSlots = useMemo(() => getArmorCriticalSlots(armorType), [armorType]);\r\n  \r\n  // Calculate max useful tonnage (ceiling to half-ton of max points / points per ton)\r\n  const maxUsefulTonnage = useMemo(\r\n    () => ceilToHalfTon(maxTotalArmor / pointsPerTon),\r\n    [maxTotalArmor, pointsPerTon]\r\n  );\r\n  \r\n  // Calculate unallocated and wasted points\r\n  const unallocatedPoints = availablePoints - allocatedPoints;\r\n  const wastedPoints = Math.max(0, availablePoints - maxTotalArmor);\r\n  \r\n  // Points delta for Auto-Allocate button:\r\n  // - Negative when allocated > available (need to remove points)\r\n  // - Positive when can allocate more (capped at max armor remaining)\r\n  const pointsDelta = unallocatedPoints < 0\r\n    ? unallocatedPoints // Show negative as-is (over-allocated)\r\n    : Math.min(unallocatedPoints, maxTotalArmor - allocatedPoints); // Cap at max allocatable\r\n  \r\n  // Convert allocation to diagram format\r\n  const armorData: LocationArmorData[] = useMemo(() => [\r\n    {\r\n      location: MechLocation.HEAD,\r\n      current: armorAllocation[MechLocation.HEAD],\r\n      maximum: getMaxArmorForLocation(tonnage, MechLocation.HEAD),\r\n    },\r\n    {\r\n      location: MechLocation.CENTER_TORSO,\r\n      current: armorAllocation[MechLocation.CENTER_TORSO],\r\n      maximum: getMaxArmorForLocation(tonnage, MechLocation.CENTER_TORSO),\r\n      rear: armorAllocation.centerTorsoRear,\r\n      rearMaximum: getMaxArmorForLocation(tonnage, MechLocation.CENTER_TORSO) - armorAllocation[MechLocation.CENTER_TORSO],\r\n    },\r\n    {\r\n      location: MechLocation.LEFT_TORSO,\r\n      current: armorAllocation[MechLocation.LEFT_TORSO],\r\n      maximum: getMaxArmorForLocation(tonnage, MechLocation.LEFT_TORSO),\r\n      rear: armorAllocation.leftTorsoRear,\r\n      rearMaximum: getMaxArmorForLocation(tonnage, MechLocation.LEFT_TORSO) - armorAllocation[MechLocation.LEFT_TORSO],\r\n    },\r\n    {\r\n      location: MechLocation.RIGHT_TORSO,\r\n      current: armorAllocation[MechLocation.RIGHT_TORSO],\r\n      maximum: getMaxArmorForLocation(tonnage, MechLocation.RIGHT_TORSO),\r\n      rear: armorAllocation.rightTorsoRear,\r\n      rearMaximum: getMaxArmorForLocation(tonnage, MechLocation.RIGHT_TORSO) - armorAllocation[MechLocation.RIGHT_TORSO],\r\n    },\r\n    {\r\n      location: MechLocation.LEFT_ARM,\r\n      current: armorAllocation[MechLocation.LEFT_ARM],\r\n      maximum: getMaxArmorForLocation(tonnage, MechLocation.LEFT_ARM),\r\n    },\r\n    {\r\n      location: MechLocation.RIGHT_ARM,\r\n      current: armorAllocation[MechLocation.RIGHT_ARM],\r\n      maximum: getMaxArmorForLocation(tonnage, MechLocation.RIGHT_ARM),\r\n    },\r\n    {\r\n      location: MechLocation.LEFT_LEG,\r\n      current: armorAllocation[MechLocation.LEFT_LEG],\r\n      maximum: getMaxArmorForLocation(tonnage, MechLocation.LEFT_LEG),\r\n    },\r\n    {\r\n      location: MechLocation.RIGHT_LEG,\r\n      current: armorAllocation[MechLocation.RIGHT_LEG],\r\n      maximum: getMaxArmorForLocation(tonnage, MechLocation.RIGHT_LEG),\r\n    },\r\n  ], [tonnage, armorAllocation]);\r\n  \r\n  // Get selected location data\r\n  const selectedLocationData = useMemo(() => {\r\n    if (!selectedLocation) return null;\r\n    return armorData.find(d => d.location === selectedLocation) ?? null;\r\n  }, [selectedLocation, armorData]);\r\n  \r\n  // Handlers\r\n  const handleArmorTypeChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setArmorType(e.target.value as ArmorTypeEnum);\r\n  }, [setArmorType]);\r\n  \r\n  const handleArmorTonnageChange = useCallback((newTonnage: number) => {\r\n    // Clamp between 0 and max useful tonnage\r\n    setArmorTonnage(Math.max(0, Math.min(newTonnage, maxUsefulTonnage)));\r\n  }, [setArmorTonnage, maxUsefulTonnage]);\r\n  \r\n  const handleLocationClick = useCallback((location: MechLocation) => {\r\n    setSelectedLocation(prev => prev === location ? null : location);\r\n  }, []);\r\n  \r\n  const handleLocationArmorChange = useCallback((front: number, rear?: number) => {\r\n    if (!selectedLocation) return;\r\n    setLocationArmor(selectedLocation, front, rear);\r\n  }, [selectedLocation, setLocationArmor]);\r\n  \r\n  const handleAutoAllocate = useCallback(() => {\r\n    autoAllocateArmor();\r\n  }, [autoAllocateArmor]);\r\n  \r\n  const handleMaximize = useCallback(() => {\r\n    maximizeArmor();\r\n  }, [maximizeArmor]);\r\n  \r\n  return (\r\n    <div className={`${cs.layout.tabContent} ${className}`}>\r\n      {/* Compact Summary Bar */}\r\n      <div className={cs.panel.summary}>\r\n        <div className=\"flex items-center justify-between gap-6\">\r\n          <div className=\"flex items-center gap-6 text-sm\">\r\n            <div className={cs.layout.statRow}>\r\n              <span className={cs.text.label}>Type:</span>\r\n              <span className={cs.text.value}>{armorDef?.name ?? 'Standard'}</span>\r\n            </div>\r\n            <div className={cs.layout.statRow}>\r\n              <span className={cs.text.label}>Points/Ton:</span>\r\n              <span className={cs.text.value}>{pointsPerTon}</span>\r\n            </div>\r\n            <div className={cs.layout.statRow}>\r\n              <span className={cs.text.label}>Slots:</span>\r\n              <span className={cs.text.value}>{armorSlots}</span>\r\n            </div>\r\n          </div>\r\n          <div className={`flex items-center gap-4 ${cs.layout.dividerV}`}>\r\n            <div className={cs.layout.statRow}>\r\n              <span className={`text-sm ${cs.text.label}`}>Tonnage:</span>\r\n              <span className=\"text-lg font-bold text-amber-400\">{armorTonnage}t</span>\r\n            </div>\r\n            <div className={cs.layout.statRow}>\r\n              <span className={`text-sm ${cs.text.label}`}>Points:</span>\r\n              <span className={`text-lg font-bold ${unallocatedPoints < 0 ? 'text-red-400' : 'text-green-400'}`}>\r\n                {allocatedPoints} / {availablePoints}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Two-column layout */}\r\n      <div className={cs.layout.twoColumn}>\r\n        \r\n        {/* LEFT: Location Editor (when selected) + Armor Configuration */}\r\n        <div className=\"space-y-4\">\r\n          {/* Location Editor - shown at top when a location is selected */}\r\n          {selectedLocation && selectedLocationData && (\r\n            <LocationArmorEditor\r\n              location={selectedLocation}\r\n              data={selectedLocationData}\r\n              tonnage={tonnage}\r\n              readOnly={readOnly}\r\n              onChange={handleLocationArmorChange}\r\n              onClose={() => setSelectedLocation(null)}\r\n            />\r\n          )}\r\n          \r\n          {/* Armor Configuration */}\r\n          <div className={cs.panel.main}>\r\n            <h3 className={cs.text.sectionTitle}>Armor Configuration</h3>\r\n            \r\n            <div className=\"space-y-4\">\r\n              {/* Armor Type */}\r\n              <div className={cs.layout.field}>\r\n                <div className={cs.layout.rowBetween}>\r\n                  <label className={cs.text.label}>Armor Type</label>\r\n                  <span className={cs.text.secondary}>{armorSlots} slots</span>\r\n                </div>\r\n                <select \r\n                  className={cs.select.compact}\r\n                  disabled={readOnly}\r\n                  value={armorType}\r\n                  onChange={handleArmorTypeChange}\r\n                >\r\n                  {filteredOptions.armors.map((armor) => (\r\n                    <option key={armor.type} value={armor.type}>\r\n                      {armor.name} ({armor.pointsPerTon} pts/ton)\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              \r\n              {/* Armor Tonnage */}\r\n              <div className={cs.layout.field}>\r\n                <label className={cs.text.label}>Armor Tonnage</label>\r\n                <div className={cs.layout.rowGap}>\r\n                  <button\r\n                    onClick={() => handleArmorTonnageChange(armorTonnage - 0.5)}\r\n                    disabled={readOnly || armorTonnage <= 0}\r\n                    className={cs.button.stepper}\r\n                  >\r\n                    \r\n                  </button>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={armorTonnage}\r\n                    onChange={(e) => handleArmorTonnageChange(parseFloat(e.target.value) || 0)}\r\n                    disabled={readOnly}\r\n                    min={0}\r\n                    step={0.5}\r\n                    className={`w-20 ${cs.input.compact} text-center ${cs.input.noSpinners}`}\r\n                  />\r\n                  <button\r\n                    onClick={() => handleArmorTonnageChange(armorTonnage + 0.5)}\r\n                    disabled={readOnly || armorTonnage >= maxUsefulTonnage}\r\n                    className={cs.button.stepper}\r\n                  >\r\n                    +\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Quick Actions */}\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={handleMaximize}\r\n                  disabled={readOnly || armorTonnage >= maxUsefulTonnage}\r\n                  className={cs.button.actionFull}\r\n                >\r\n                  Maximize Tonnage\r\n                </button>\r\n              </div>\r\n              \r\n              {/* Summary Stats */}\r\n              <div className={`${cs.layout.divider} space-y-2`}>\r\n                <div className={`${cs.layout.rowBetween} text-sm`}>\r\n                  <span className={cs.text.label}>Unallocated Armor Points</span>\r\n                  <span className={`font-medium ${unallocatedPoints < 0 ? 'text-red-400' : unallocatedPoints > 0 ? 'text-amber-400' : 'text-green-400'}`}>\r\n                    {unallocatedPoints}\r\n                  </span>\r\n                </div>\r\n                <div className={`${cs.layout.rowBetween} text-sm`}>\r\n                  <span className={cs.text.label}>Allocated Armor Points</span>\r\n                  <span className={cs.text.value}>{allocatedPoints}</span>\r\n                </div>\r\n                <div className={`${cs.layout.rowBetween} text-sm`}>\r\n                  <span className={cs.text.label}>Total Armor Points</span>\r\n                  <span className={cs.text.value}>{availablePoints}</span>\r\n                </div>\r\n                <div className={`${cs.layout.rowBetween} text-sm`}>\r\n                  <span className={cs.text.label}>Maximum Possible Armor Points</span>\r\n                  <span className=\"font-medium text-slate-300\">{maxTotalArmor}</span>\r\n                </div>\r\n                {wastedPoints > 0 && (\r\n                  <div className={`${cs.layout.rowBetween} text-sm`}>\r\n                    <span className={cs.text.label}>Wasted Armor Points</span>\r\n                    <span className={cs.text.valueWarning}>{wastedPoints}</span>\r\n                  </div>\r\n                )}\r\n                <div className={`${cs.layout.rowBetween} text-sm pt-2 border-t border-slate-600`}>\r\n                  <span className={cs.text.label}>Points Per Ton</span>\r\n                  <span className=\"font-medium text-slate-300\">{pointsPerTon.toFixed(2)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* RIGHT: Armor Diagram */}\r\n        <div className=\"space-y-4\">\r\n          <ArmorDiagram\r\n            armorData={armorData}\r\n            selectedLocation={selectedLocation}\r\n            unallocatedPoints={pointsDelta}\r\n            onLocationClick={handleLocationClick}\r\n            onAutoAllocate={handleAutoAllocate}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\CriticalSlotsTab.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":302,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":302,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Critical Slots Tab Component\r\n * \r\n * Displays the critical slots grid for assigning equipment to locations.\r\n * Layout matches MegaMekLab's diagram style with proper humanoid mech positioning.\r\n * Equipment selection is managed via the global loadout tray.\r\n * \r\n * @spec openspec/specs/critical-slots-display/spec.md\r\n * @spec openspec/specs/critical-slot-allocation/spec.md\r\n */\r\n\r\nimport React, { useMemo, useCallback, useEffect, useRef } from 'react';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { useCustomizerStore } from '@/stores/useCustomizerStore';\r\nimport { LocationData, SlotContent } from '../critical-slots';\r\nimport { LocationGrid } from '../critical-slots/LocationGrid';\r\nimport { MechLocation, LOCATION_SLOT_COUNTS } from '@/types/construction';\r\nimport { IMountedEquipmentInstance } from '@/stores/unitState';\r\nimport { SystemComponentType } from '@/utils/colors/slotColors';\r\nimport { EngineType, getEngineDefinition } from '@/types/construction/EngineType';\r\nimport { GyroType, getGyroDefinition } from '@/types/construction/GyroType';\r\nimport { isValidLocationForEquipment } from '@/types/equipment/EquipmentPlacement';\r\nimport {\r\n  fillUnhittableSlots,\r\n  compactEquipmentSlots,\r\n  sortEquipmentBySize,\r\n  getUnallocatedUnhittables,\r\n} from '@/utils/construction/slotOperations';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\ninterface CriticalSlotsTabProps {\r\n  /** Read-only mode */\r\n  readOnly?: boolean;\r\n  /** Currently selected equipment ID (from loadout tray) */\r\n  selectedEquipmentId?: string | null;\r\n  /** Called when selection should change */\r\n  onSelectEquipment?: (id: string | null) => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\ninterface FixedComponent {\r\n  name: string;\r\n  type: SystemComponentType;\r\n  slots: number;\r\n}\r\n\r\n// =============================================================================\r\n// Constants\r\n// =============================================================================\r\n\r\nconst ARM_ACTUATORS: FixedComponent[] = [\r\n  { name: 'Shoulder', type: 'actuator', slots: 1 },\r\n  { name: 'Upper Arm', type: 'actuator', slots: 1 },\r\n  { name: 'Lower Arm', type: 'actuator', slots: 1 },\r\n  { name: 'Hand', type: 'actuator', slots: 1 },\r\n];\r\n\r\nconst LEG_ACTUATORS: FixedComponent[] = [\r\n  { name: 'Hip', type: 'actuator', slots: 1 },\r\n  { name: 'Upper Leg', type: 'actuator', slots: 1 },\r\n  { name: 'Lower Leg', type: 'actuator', slots: 1 },\r\n  { name: 'Foot', type: 'actuator', slots: 1 },\r\n];\r\n\r\n// =============================================================================\r\n// Helpers\r\n// =============================================================================\r\n\r\nfunction getEngineSlots(engineType: EngineType): number {\r\n  const def = getEngineDefinition(engineType);\r\n  return def?.ctSlots ?? 6;\r\n}\r\n\r\nfunction getGyroSlots(gyroType: GyroType): number {\r\n  const def = getGyroDefinition(gyroType);\r\n  return def?.criticalSlots ?? 4;\r\n}\r\n\r\nfunction getEngineSideTorsoSlots(engineType: EngineType): number {\r\n  const def = getEngineDefinition(engineType);\r\n  return def?.sideTorsoSlots ?? 0;\r\n}\r\n\r\nfunction buildLocationSlots(\r\n  location: MechLocation,\r\n  engineType: EngineType,\r\n  gyroType: GyroType,\r\n  equipment: readonly IMountedEquipmentInstance[],\r\n): SlotContent[] {\r\n  const slotCount = LOCATION_SLOT_COUNTS[location] || 6;\r\n  const slots: SlotContent[] = [];\r\n  \r\n  const locationEquipment = equipment.filter(e => e.location === location);\r\n  const filledSlots = new Map<number, { equipment: IMountedEquipmentInstance; position: 'first' | 'middle' | 'last' | 'only' }>();\r\n  \r\n  for (const eq of locationEquipment) {\r\n    if (eq.slots && eq.slots.length > 0) {\r\n      for (let i = 0; i < eq.slots.length; i++) {\r\n        const slotIdx = eq.slots[i];\r\n        let position: 'first' | 'middle' | 'last' | 'only' = 'only';\r\n        if (eq.slots.length > 1) {\r\n          if (i === 0) position = 'first';\r\n          else if (i === eq.slots.length - 1) position = 'last';\r\n          else position = 'middle';\r\n        }\r\n        filledSlots.set(slotIdx, { equipment: eq, position });\r\n      }\r\n    }\r\n  }\r\n  \r\n  switch (location) {\r\n    case MechLocation.HEAD:\r\n      slots.push({ index: 0, type: 'system', name: 'Life Support' });\r\n      slots.push({ index: 1, type: 'system', name: 'Sensors' });\r\n      slots.push({ index: 2, type: 'system', name: 'Standard Cockpit' });\r\n      slots.push(filledSlots.has(3) \r\n        ? createEquipmentSlot(3, filledSlots.get(3)!)\r\n        : { index: 3, type: 'empty' }\r\n      );\r\n      slots.push({ index: 4, type: 'system', name: 'Sensors' });\r\n      slots.push({ index: 5, type: 'system', name: 'Life Support' });\r\n      break;\r\n      \r\n    case MechLocation.CENTER_TORSO:\r\n      const engineSlots = getEngineSlots(engineType);\r\n      for (let i = 0; i < Math.min(3, engineSlots); i++) {\r\n        slots.push({ index: i, type: 'system', name: 'Engine' });\r\n      }\r\n      const gyroSlots = getGyroSlots(gyroType);\r\n      for (let i = 0; i < gyroSlots; i++) {\r\n        slots.push({ index: 3 + i, type: 'system', name: 'Standard Gyro' });\r\n      }\r\n      for (let i = 3; i < engineSlots; i++) {\r\n        slots.push({ index: 3 + gyroSlots + (i - 3), type: 'system', name: 'Engine' });\r\n      }\r\n      const ctUsed = engineSlots + gyroSlots;\r\n      for (let i = ctUsed; i < slotCount; i++) {\r\n        if (filledSlots.has(i)) {\r\n          slots.push(createEquipmentSlot(i, filledSlots.get(i)!));\r\n        } else {\r\n          slots.push({ index: i, type: 'empty' });\r\n        }\r\n      }\r\n      break;\r\n      \r\n    case MechLocation.LEFT_TORSO:\r\n    case MechLocation.RIGHT_TORSO: {\r\n      // XL/Light/XXL engines require side torso slots\r\n      const sideTorsoSlots = getEngineSideTorsoSlots(engineType);\r\n      \r\n      // Engine slots first\r\n      for (let i = 0; i < sideTorsoSlots; i++) {\r\n        slots.push({ index: i, type: 'system', name: 'Engine' });\r\n      }\r\n      \r\n      // Remaining slots (equipment or empty)\r\n      for (let i = sideTorsoSlots; i < slotCount; i++) {\r\n        if (filledSlots.has(i)) {\r\n          slots.push(createEquipmentSlot(i, filledSlots.get(i)!));\r\n        } else {\r\n          slots.push({ index: i, type: 'empty' });\r\n        }\r\n      }\r\n      break;\r\n    }\r\n      \r\n    case MechLocation.LEFT_ARM:\r\n    case MechLocation.RIGHT_ARM:\r\n      for (let i = 0; i < ARM_ACTUATORS.length; i++) {\r\n        slots.push({ index: i, type: 'system', name: ARM_ACTUATORS[i].name });\r\n      }\r\n      for (let i = ARM_ACTUATORS.length; i < slotCount; i++) {\r\n        if (filledSlots.has(i)) {\r\n          slots.push(createEquipmentSlot(i, filledSlots.get(i)!));\r\n        } else {\r\n          slots.push({ index: i, type: 'empty' });\r\n        }\r\n      }\r\n      break;\r\n      \r\n    case MechLocation.LEFT_LEG:\r\n    case MechLocation.RIGHT_LEG:\r\n      for (let i = 0; i < LEG_ACTUATORS.length; i++) {\r\n        slots.push({ index: i, type: 'system', name: LEG_ACTUATORS[i].name });\r\n      }\r\n      for (let i = LEG_ACTUATORS.length; i < slotCount; i++) {\r\n        if (filledSlots.has(i)) {\r\n          slots.push(createEquipmentSlot(i, filledSlots.get(i)!));\r\n        } else {\r\n          slots.push({ index: i, type: 'empty' });\r\n        }\r\n      }\r\n      break;\r\n      \r\n    default:\r\n      for (let i = 0; i < slotCount; i++) {\r\n        slots.push({ index: i, type: 'empty' });\r\n      }\r\n  }\r\n  \r\n  return slots;\r\n}\r\n\r\nfunction createEquipmentSlot(\r\n  index: number, \r\n  data: { equipment: IMountedEquipmentInstance; position: 'first' | 'middle' | 'last' | 'only' }\r\n): SlotContent {\r\n  const { equipment, position } = data;\r\n  return {\r\n    index,\r\n    type: 'equipment',\r\n    name: equipment.name,\r\n    equipmentId: equipment.instanceId,\r\n    isFirstSlot: position === 'first' || position === 'only',\r\n    isLastSlot: position === 'last' || position === 'only',\r\n    totalSlots: equipment.criticalSlots,\r\n    isRemovable: equipment.isRemovable,\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// Toolbar Component\r\n// =============================================================================\r\n\r\ninterface ToolbarProps {\r\n  autoFillUnhittables: boolean;\r\n  autoCompact: boolean;\r\n  autoSort: boolean;\r\n  onAutoFillToggle: () => void;\r\n  onAutoCompactToggle: () => void;\r\n  onAutoSortToggle: () => void;\r\n  onFill: () => void;\r\n  onCompact: () => void;\r\n  onSort: () => void;\r\n  onReset: () => void;\r\n  readOnly: boolean;\r\n}\r\n\r\nfunction CriticalSlotsToolbar({\r\n  autoFillUnhittables,\r\n  autoCompact,\r\n  autoSort,\r\n  onAutoFillToggle,\r\n  onAutoCompactToggle,\r\n  onAutoSortToggle,\r\n  onFill,\r\n  onCompact,\r\n  onSort,\r\n  onReset,\r\n  readOnly,\r\n}: ToolbarProps) {\r\n  const toggleBtnClass = (active: boolean) => `\r\n    px-3 py-1.5 text-sm font-medium rounded border transition-colors\r\n    ${active \r\n      ? 'bg-teal-600 border-teal-500 text-white' \r\n      : 'bg-slate-700 border-slate-600 text-slate-300 hover:bg-slate-600'\r\n    }\r\n    ${readOnly ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\r\n  `;\r\n  \r\n  const actionBtnClass = `\r\n    px-4 py-1.5 text-sm font-medium rounded border transition-colors\r\n    bg-slate-600 border-slate-500 text-white hover:bg-slate-500\r\n    ${readOnly ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\r\n  `;\r\n  \r\n  return (\r\n    <div className=\"flex items-center gap-2 p-3 bg-slate-800 border-b border-slate-700\">\r\n      <button onClick={onAutoFillToggle} disabled={readOnly} className={toggleBtnClass(autoFillUnhittables)}>\r\n        Auto Fill Unhittables\r\n      </button>\r\n      <button onClick={onAutoCompactToggle} disabled={readOnly} className={toggleBtnClass(autoCompact)}>\r\n        Auto Compact\r\n      </button>\r\n      <button onClick={onAutoSortToggle} disabled={readOnly} className={toggleBtnClass(autoSort)}>\r\n        Auto Sort\r\n      </button>\r\n      \r\n      <div className=\"w-px h-6 bg-slate-600 mx-2\" />\r\n      \r\n      <button onClick={onFill} disabled={readOnly} className={actionBtnClass}>Fill</button>\r\n      <button onClick={onCompact} disabled={readOnly} className={actionBtnClass}>Compact</button>\r\n      <button onClick={onSort} disabled={readOnly} className={actionBtnClass}>Sort</button>\r\n      \r\n      <div className=\"flex-1\" />\r\n      \r\n      <button onClick={onReset} disabled={readOnly} className={`${actionBtnClass} bg-slate-700 hover:bg-red-600`}>\r\n        Reset\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// Main Component\r\n// =============================================================================\r\n\r\nexport function CriticalSlotsTab({\r\n  readOnly = false,\r\n  selectedEquipmentId,\r\n  onSelectEquipment,\r\n  className = '',\r\n}: CriticalSlotsTabProps) {\r\n  // Unit state\r\n  const equipment = useUnitStore((s) => s.equipment);\r\n  const engineType = useUnitStore((s) => s.engineType);\r\n  const gyroType = useUnitStore((s) => s.gyroType);\r\n  const updateEquipmentLocation = useUnitStore((s) => s.updateEquipmentLocation);\r\n  const bulkUpdateEquipmentLocations = useUnitStore((s) => s.bulkUpdateEquipmentLocations);\r\n  const clearEquipmentLocation = useUnitStore((s) => s.clearEquipmentLocation);\r\n  \r\n  // UI state\r\n  const autoModeSettings = useCustomizerStore((s) => s.autoModeSettings);\r\n  const toggleAutoFillUnhittables = useCustomizerStore((s) => s.toggleAutoFillUnhittables);\r\n  const toggleAutoCompact = useCustomizerStore((s) => s.toggleAutoCompact);\r\n  const toggleAutoSort = useCustomizerStore((s) => s.toggleAutoSort);\r\n  \r\n  // Get selected equipment item\r\n  const selectedEquipment = useMemo(() => {\r\n    if (!selectedEquipmentId) return null;\r\n    return equipment.find(e => e.instanceId === selectedEquipmentId) || null;\r\n  }, [equipment, selectedEquipmentId]);\r\n  \r\n  // Build location data\r\n  const getLocationData = useCallback((location: MechLocation): LocationData => ({\r\n    location,\r\n    slots: buildLocationSlots(location, engineType, gyroType, equipment),\r\n  }), [equipment, engineType, gyroType]);\r\n  \r\n  // Calculate assignable slots for selected equipment\r\n  const getAssignableSlots = useCallback((location: MechLocation): number[] => {\r\n    if (!selectedEquipment || readOnly) {\r\n      return [];\r\n    }\r\n    \r\n    // Check location restrictions (e.g., jump jets can only go in torsos/legs)\r\n    if (!isValidLocationForEquipment(selectedEquipment.equipmentId, location)) {\r\n      return [];\r\n    }\r\n    \r\n    const locData = getLocationData(location);\r\n    const emptySlots = locData.slots\r\n      .filter(s => s.type === 'empty')\r\n      .map(s => s.index);\r\n    \r\n    const slotsNeeded = selectedEquipment.criticalSlots;\r\n    const assignable: number[] = [];\r\n    \r\n    // Find all valid starting positions for contiguous slots\r\n    for (let i = 0; i <= emptySlots.length - slotsNeeded; i++) {\r\n      let contiguous = true;\r\n      for (let j = 1; j < slotsNeeded; j++) {\r\n        if (emptySlots[i + j] !== emptySlots[i + j - 1] + 1) {\r\n          contiguous = false;\r\n          break;\r\n        }\r\n      }\r\n      if (contiguous) {\r\n        assignable.push(emptySlots[i]);\r\n      }\r\n    }\r\n    \r\n    return assignable;\r\n  }, [selectedEquipment, readOnly, getLocationData]);\r\n  \r\n  // Handlers\r\n  const handleSlotClick = useCallback((location: MechLocation, slotIndex: number) => {\r\n    if (readOnly) return;\r\n    \r\n    const locData = getLocationData(location);\r\n    const clickedSlot = locData.slots.find(s => s.index === slotIndex);\r\n    \r\n    // Case 1: Clicked on equipment slot - select it for reassignment\r\n    if (clickedSlot?.type === 'equipment' && clickedSlot.equipmentId) {\r\n      // If clicking same equipment that's already selected, deselect\r\n      if (selectedEquipment?.instanceId === clickedSlot.equipmentId) {\r\n        onSelectEquipment?.(null);\r\n      } else {\r\n        // Select this equipment for reassignment\r\n        onSelectEquipment?.(clickedSlot.equipmentId);\r\n      }\r\n      return;\r\n    }\r\n    \r\n    // Case 2: Clicked on empty slot with equipment selected - place it\r\n    if (selectedEquipment && clickedSlot?.type === 'empty') {\r\n      const assignable = getAssignableSlots(location);\r\n      if (!assignable.includes(slotIndex)) return;\r\n      \r\n      const slots: number[] = [];\r\n      for (let i = 0; i < selectedEquipment.criticalSlots; i++) {\r\n        slots.push(slotIndex + i);\r\n      }\r\n      \r\n      updateEquipmentLocation(selectedEquipment.instanceId, location, slots);\r\n      onSelectEquipment?.(null); // Clear selection after assignment\r\n    }\r\n  }, [readOnly, selectedEquipment, getLocationData, getAssignableSlots, updateEquipmentLocation, onSelectEquipment]);\r\n  \r\n  const handleEquipmentDrop = useCallback((location: MechLocation, slotIndex: number, equipmentId: string) => {\r\n    if (readOnly) return;\r\n    const eq = equipment.find(e => e.instanceId === equipmentId);\r\n    if (!eq) return;\r\n    \r\n    // Validate location restrictions (e.g., jump jets can only go in torsos/legs)\r\n    if (!isValidLocationForEquipment(eq.equipmentId, location)) {\r\n      return;\r\n    }\r\n    \r\n    // Validate there are enough contiguous empty slots starting at slotIndex\r\n    const locData = getLocationData(location);\r\n    const slotsNeeded = eq.criticalSlots;\r\n    \r\n    // Check if all required slots are empty\r\n    for (let i = 0; i < slotsNeeded; i++) {\r\n      const targetSlot = locData.slots.find(s => s.index === slotIndex + i);\r\n      if (!targetSlot || targetSlot.type !== 'empty') {\r\n        return; // Not enough contiguous empty slots\r\n      }\r\n    }\r\n    \r\n    const slots: number[] = [];\r\n    for (let i = 0; i < slotsNeeded; i++) {\r\n      slots.push(slotIndex + i);\r\n    }\r\n    updateEquipmentLocation(equipmentId, location, slots);\r\n    onSelectEquipment?.(null); // Clear selection after successful drop\r\n  }, [readOnly, equipment, getLocationData, updateEquipmentLocation, onSelectEquipment]);\r\n  \r\n  const handleEquipmentRemove = useCallback((location: MechLocation, slotIndex: number) => {\r\n    if (readOnly) return;\r\n    const locData = getLocationData(location);\r\n    const slot = locData.slots.find(s => s.index === slotIndex);\r\n    // Allow unassigning ALL equipment (isRemovable only controls deletion from unit)\r\n    if (!slot || slot.type !== 'equipment' || !slot.equipmentId) return;\r\n    clearEquipmentLocation(slot.equipmentId);\r\n  }, [readOnly, getLocationData, clearEquipmentLocation]);\r\n  \r\n  const handleReset = useCallback(() => {\r\n    if (readOnly) return;\r\n    // Reset clears ALL equipment locations (isRemovable only controls deletion)\r\n    for (const eq of equipment) {\r\n      if (eq.location !== undefined) {\r\n        clearEquipmentLocation(eq.instanceId);\r\n      }\r\n    }\r\n  }, [readOnly, equipment, clearEquipmentLocation]);\r\n  \r\n  // Fill: Distribute unallocated unhittables evenly\r\n  const handleFill = useCallback(() => {\r\n    if (readOnly) return;\r\n    const result = fillUnhittableSlots(equipment, engineType, gyroType);\r\n    if (result.assignments.length > 0) {\r\n      bulkUpdateEquipmentLocations(result.assignments);\r\n    }\r\n  }, [readOnly, equipment, engineType, gyroType, bulkUpdateEquipmentLocations]);\r\n  \r\n  // Compact: Move equipment to lowest slot indices\r\n  const handleCompact = useCallback(() => {\r\n    if (readOnly) return;\r\n    const result = compactEquipmentSlots(equipment, engineType, gyroType);\r\n    if (result.assignments.length > 0) {\r\n      bulkUpdateEquipmentLocations(result.assignments);\r\n    }\r\n  }, [readOnly, equipment, engineType, gyroType, bulkUpdateEquipmentLocations]);\r\n  \r\n  // Sort: Reorder by size (largest first), then compact\r\n  const handleSort = useCallback(() => {\r\n    if (readOnly) return;\r\n    const result = sortEquipmentBySize(equipment, engineType, gyroType);\r\n    if (result.assignments.length > 0) {\r\n      bulkUpdateEquipmentLocations(result.assignments);\r\n    }\r\n  }, [readOnly, equipment, engineType, gyroType, bulkUpdateEquipmentLocations]);\r\n  \r\n  // Track if we're currently running an auto operation to prevent loops\r\n  const isAutoRunning = useRef(false);\r\n  \r\n  // Count of unallocated unhittables for change detection\r\n  const unallocatedUnhittableCount = useMemo(() => {\r\n    return getUnallocatedUnhittables(equipment).length;\r\n  }, [equipment]);\r\n  \r\n  // Auto Fill effect - runs when unallocated unhittables exist and toggle is enabled\r\n  useEffect(() => {\r\n    if (readOnly || isAutoRunning.current) return;\r\n    if (!autoModeSettings.autoFillUnhittables) return;\r\n    if (unallocatedUnhittableCount === 0) return;\r\n    \r\n    isAutoRunning.current = true;\r\n    \r\n    // Small delay to batch rapid changes (e.g., when structure type changes adds many slots)\r\n    const timer = setTimeout(() => {\r\n      const result = fillUnhittableSlots(equipment, engineType, gyroType);\r\n      if (result.assignments.length > 0) {\r\n        bulkUpdateEquipmentLocations(result.assignments);\r\n      }\r\n      isAutoRunning.current = false;\r\n    }, 100);\r\n    \r\n    return () => {\r\n      clearTimeout(timer);\r\n      isAutoRunning.current = false;\r\n    };\r\n  }, [unallocatedUnhittableCount, autoModeSettings.autoFillUnhittables, readOnly, equipment, engineType, gyroType, bulkUpdateEquipmentLocations]);\r\n  \r\n  // Create a fingerprint of current equipment placements for change detection\r\n  const placementFingerprint = useMemo(() => {\r\n    return equipment\r\n      .filter(eq => eq.location !== undefined)\r\n      .map(eq => `${eq.instanceId}:${eq.location}:${(eq.slots || []).join(',')}`)\r\n      .sort()\r\n      .join('|');\r\n  }, [equipment]);\r\n  \r\n  // Auto trigger effect - runs sort/compact when placements change\r\n  useEffect(() => {\r\n    if (readOnly || isAutoRunning.current) return;\r\n    \r\n    // Check if any auto mode is enabled\r\n    if (!autoModeSettings.autoSort && !autoModeSettings.autoCompact) return;\r\n    \r\n    // Only process if there's placed equipment\r\n    const placedEquipment = equipment.filter(eq => eq.location !== undefined);\r\n    if (placedEquipment.length === 0) return;\r\n    \r\n    // Run the appropriate auto operation\r\n    isAutoRunning.current = true;\r\n    \r\n    // Small delay to batch rapid changes\r\n    const timer = setTimeout(() => {\r\n      let result;\r\n      if (autoModeSettings.autoSort) {\r\n        result = sortEquipmentBySize(equipment, engineType, gyroType);\r\n      } else if (autoModeSettings.autoCompact) {\r\n        result = compactEquipmentSlots(equipment, engineType, gyroType);\r\n      }\r\n      \r\n      if (result && result.assignments.length > 0) {\r\n        // Check if the assignments would actually change anything\r\n        const wouldChange = result.assignments.some(assignment => {\r\n          const eq = equipment.find(e => e.instanceId === assignment.instanceId);\r\n          if (!eq) return false;\r\n          if (eq.location !== assignment.location) return true;\r\n          const currentSlots = eq.slots || [];\r\n          if (currentSlots.length !== assignment.slots.length) return true;\r\n          return currentSlots.some((s, i) => s !== assignment.slots[i]);\r\n        });\r\n        \r\n        if (wouldChange) {\r\n          bulkUpdateEquipmentLocations(result.assignments);\r\n        }\r\n      }\r\n      \r\n      isAutoRunning.current = false;\r\n    }, 50);\r\n    \r\n    return () => {\r\n      clearTimeout(timer);\r\n      isAutoRunning.current = false;\r\n    };\r\n  }, [placementFingerprint, readOnly, autoModeSettings, equipment, engineType, gyroType, bulkUpdateEquipmentLocations]);\r\n  \r\n  // Handle drag start from a slot - select the equipment to highlight valid targets\r\n  const handleEquipmentDragStart = useCallback((equipmentId: string) => {\r\n    onSelectEquipment?.(equipmentId);\r\n  }, [onSelectEquipment]);\r\n  \r\n  // Render location grid helper\r\n  const renderLocation = (location: MechLocation) => (\r\n    <LocationGrid\r\n      key={location}\r\n      location={location}\r\n      data={getLocationData(location)}\r\n      selectedEquipmentId={selectedEquipmentId || undefined}\r\n      assignableSlots={getAssignableSlots(location)}\r\n      onSlotClick={(i) => handleSlotClick(location, i)}\r\n      onEquipmentDrop={(i, e) => handleEquipmentDrop(location, i, e)}\r\n      onEquipmentRemove={(i) => handleEquipmentRemove(location, i)}\r\n      onEquipmentDragStart={handleEquipmentDragStart}\r\n    />\r\n  );\r\n  \r\n  return (\r\n    <div className={`flex flex-col h-full bg-slate-900 ${className}`}>\r\n      {/* Toolbar */}\r\n      <CriticalSlotsToolbar\r\n        autoFillUnhittables={autoModeSettings.autoFillUnhittables}\r\n        autoCompact={autoModeSettings.autoCompact}\r\n        autoSort={autoModeSettings.autoSort}\r\n        onAutoFillToggle={toggleAutoFillUnhittables}\r\n        onAutoCompactToggle={toggleAutoCompact}\r\n        onAutoSortToggle={toggleAutoSort}\r\n        onFill={handleFill}\r\n        onCompact={handleCompact}\r\n        onSort={handleSort}\r\n        onReset={handleReset}\r\n        readOnly={readOnly}\r\n      />\r\n      \r\n      {/* Mech diagram - MegaMekLab-style 5-column layout */}\r\n      <div className=\"flex-1 p-4 overflow-auto\">\r\n        <div className=\"flex gap-3 items-start justify-center\">\r\n          {/* Column 1: Left Arm (offset down to align with torso body) */}\r\n          <div className=\"flex flex-col\" style={{ marginTop: '136px' }}>\r\n            {renderLocation(MechLocation.LEFT_ARM)}\r\n          </div>\r\n          \r\n          {/* Column 2: Left Torso + Left Leg stacked */}\r\n          <div className=\"flex flex-col\" style={{ marginTop: '40px' }}>\r\n            {renderLocation(MechLocation.LEFT_TORSO)}\r\n            <div className=\"mt-16\">\r\n              {renderLocation(MechLocation.LEFT_LEG)}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Column 3: Head + Center Torso stacked */}\r\n          <div className=\"flex flex-col gap-3\">\r\n            {renderLocation(MechLocation.HEAD)}\r\n            {renderLocation(MechLocation.CENTER_TORSO)}\r\n          </div>\r\n          \r\n          {/* Column 4: Right Torso + Right Leg stacked */}\r\n          <div className=\"flex flex-col\" style={{ marginTop: '40px' }}>\r\n            {renderLocation(MechLocation.RIGHT_TORSO)}\r\n            <div className=\"mt-16\">\r\n              {renderLocation(MechLocation.RIGHT_LEG)}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Column 5: Right Arm (offset down to align with torso body) */}\r\n          <div className=\"flex flex-col\" style={{ marginTop: '136px' }}>\r\n            {renderLocation(MechLocation.RIGHT_ARM)}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Selection hint bar at bottom */}\r\n      {selectedEquipment && (\r\n        <div className=\"flex-shrink-0 px-4 py-2 bg-slate-800 border-t border-slate-700 text-center\">\r\n          <span className=\"text-sm text-slate-300\">\r\n            Select a slot for: <span className=\"text-amber-400 font-medium\">{selectedEquipment.name}</span>\r\n            <span className=\"text-slate-500 ml-2\">({selectedEquipment.criticalSlots} slot{selectedEquipment.criticalSlots !== 1 ? 's' : ''})</span>\r\n          </span>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CriticalSlotsTab;\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\CustomizerTabs.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":9,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":9,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":46},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":57,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":57,"endColumn":31},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":105,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":105,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customizer Tabs Component\r\n * \r\n * Tabbed navigation for unit configuration sections.\r\n * \r\n * @spec openspec/specs/customizer-tabs/spec.md\r\n */\r\n\r\nimport React, { useState, useRef, useCallback } from 'react';\r\nimport { useTabKeyboardNavigation } from '@/hooks/useKeyboardNavigation';\r\n\r\n/**\r\n * Customizer tab configuration\r\n */\r\nexport interface CustomizerTabConfig {\r\n  /** Tab identifier */\r\n  id: string;\r\n  /** Tab label */\r\n  label: string;\r\n  /** Icon (optional) */\r\n  icon?: React.ReactNode;\r\n  /** Is tab disabled */\r\n  disabled?: boolean;\r\n}\r\n\r\ninterface CustomizerTabsProps {\r\n  /** Tab configurations */\r\n  tabs: CustomizerTabConfig[];\r\n  /** Currently active tab ID */\r\n  activeTab: string;\r\n  /** Called when tab changes */\r\n  onTabChange: (tabId: string) => void;\r\n  /** Read-only mode */\r\n  readOnly?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Default customizer tabs\r\n * \r\n * @spec openspec/specs/customizer-tabs/spec.md\r\n * Note: Weapons tab merged into Equipment tab per unify-equipment-tab change\r\n */\r\nexport const DEFAULT_CUSTOMIZER_TABS: CustomizerTabConfig[] = [\r\n  { id: 'overview', label: 'Overview' },\r\n  { id: 'structure', label: 'Structure' },\r\n  { id: 'armor', label: 'Armor' },\r\n  { id: 'equipment', label: 'Equipment' },\r\n  { id: 'criticals', label: 'Critical Slots' },\r\n  { id: 'fluff', label: 'Fluff' },\r\n];\r\n\r\n/**\r\n * Customizer section tabs\r\n */\r\nexport function CustomizerTabs({\r\n  tabs,\r\n  activeTab,\r\n  onTabChange,\r\n  readOnly = false,\r\n  className = '',\r\n}: CustomizerTabsProps) {\r\n  const handleKeyDown = useTabKeyboardNavigation(tabs, activeTab, onTabChange);\r\n  \r\n  return (\r\n    <div \r\n      className={`flex bg-slate-800 border-b border-slate-700 ${className}`}\r\n      role=\"tablist\"\r\n      aria-label=\"Unit configuration tabs\"\r\n      onKeyDown={handleKeyDown}\r\n    >\r\n      {tabs.map((tab) => (\r\n        <button\r\n          key={tab.id}\r\n          role=\"tab\"\r\n          aria-selected={tab.id === activeTab}\r\n          aria-controls={`tabpanel-${tab.id}`}\r\n          tabIndex={tab.id === activeTab ? 0 : -1}\r\n          onClick={() => !tab.disabled && onTabChange(tab.id)}\r\n          disabled={tab.disabled}\r\n          className={`\r\n            flex items-center gap-2 px-4 py-2.5 text-sm font-medium\r\n            border-b-2 transition-colors\r\n            focus:outline-none focus:ring-2 focus:ring-amber-400 focus:ring-inset\r\n            ${tab.id === activeTab\r\n              ? 'text-amber-400 border-amber-400'\r\n              : 'text-slate-400 border-transparent hover:text-white hover:border-slate-500'\r\n            }\r\n            ${tab.disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\r\n            ${readOnly ? 'pointer-events-none' : ''}\r\n          `}\r\n        >\r\n          {tab.icon}\r\n          <span>{tab.label}</span>\r\n        </button>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Hook for managing customizer tab state\r\n */\r\nexport function useCustomizerTabs(\r\n  initialTab: string = 'overview',\r\n  tabs: CustomizerTabConfig[] = DEFAULT_CUSTOMIZER_TABS\r\n) {\r\n  const [activeTab, setActiveTab] = useState(initialTab);\r\n  \r\n  const currentTab = tabs.find((t) => t.id === activeTab) || tabs[0];\r\n  \r\n  return {\r\n    tabs,\r\n    activeTab,\r\n    currentTab,\r\n    setActiveTab,\r\n  };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\EquipmentTab.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":37,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":37,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Equipment Tab Component\r\n * \r\n * Full-width equipment browser for adding equipment to the unit.\r\n * The loadout tray is now a global component visible across all tabs.\r\n * \r\n * @spec openspec/specs/equipment-browser/spec.md\r\n * @spec openspec/changes/unify-equipment-tab/specs/customizer-tabs/spec.md\r\n */\r\n\r\nimport React, { useCallback } from 'react';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { EquipmentBrowser } from '../equipment/EquipmentBrowser';\r\nimport { IEquipmentItem } from '@/types/equipment';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\ninterface EquipmentTabProps {\r\n  /** Read-only mode */\r\n  readOnly?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n// =============================================================================\r\n// Main Component\r\n// =============================================================================\r\n\r\n/**\r\n * Equipment configuration tab\r\n * \r\n * Full-width equipment browser. The loadout tray with mounted equipment\r\n * is now a global sidebar visible across all tabs.\r\n */\r\nexport function EquipmentTab({\r\n  readOnly = false,\r\n  className = '',\r\n}: EquipmentTabProps) {\r\n  // Get unit state from context\r\n  const addEquipment = useUnitStore((s) => s.addEquipment);\r\n  \r\n  // Handle adding equipment\r\n  const handleAddEquipment = useCallback((item: IEquipmentItem) => {\r\n    if (readOnly) return;\r\n    addEquipment(item);\r\n  }, [addEquipment, readOnly]);\r\n  \r\n  return (\r\n    <div className={`flex flex-col h-full p-4 ${className}`}>\r\n      {/* Full-width Equipment Browser */}\r\n      <EquipmentBrowser\r\n        onAddEquipment={handleAddEquipment}\r\n        className=\"flex-1 min-h-0\"\r\n      />\r\n      \r\n      {readOnly && (\r\n        <div className=\"mt-4 bg-blue-900/30 border border-blue-700 rounded-lg p-4 text-blue-300 text-sm\">\r\n          This unit is in read-only mode. Changes cannot be made.\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default EquipmentTab;\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\FluffTab.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":25,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":25,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Fluff Tab Component\r\n * \r\n * Non-mechanical unit information (history, description, manufacturer).\r\n * \r\n * @spec openspec/specs/customizer-tabs/spec.md\r\n */\r\n\r\nimport React from 'react';\r\n\r\ninterface FluffTabProps {\r\n  /** Unit chassis name */\r\n  chassis?: string;\r\n  /** Unit model/variant */\r\n  model?: string;\r\n  /** Read-only mode */\r\n  readOnly?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Fluff (lore/description) configuration tab\r\n */\r\nexport function FluffTab({\r\n  chassis = '',\r\n  model = '',\r\n  readOnly = false,\r\n  className = '',\r\n}: FluffTabProps) {\r\n  return (\r\n    <div className={`space-y-6 p-4 ${className}`}>\r\n      {/* Unit Identity */}\r\n      <div className=\"bg-slate-800 rounded-lg border border-slate-700 p-4\">\r\n        <h3 className=\"text-lg font-semibold text-white mb-4\">Unit Identity</h3>\r\n        \r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm text-slate-400 mb-1\">Chassis Name</label>\r\n            <input\r\n              type=\"text\"\r\n              defaultValue={chassis}\r\n              placeholder=\"e.g., Atlas\"\r\n              disabled={readOnly}\r\n              className=\"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-500 disabled:opacity-50\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm text-slate-400 mb-1\">Model/Variant</label>\r\n            <input\r\n              type=\"text\"\r\n              defaultValue={model}\r\n              placeholder=\"e.g., AS7-D\"\r\n              disabled={readOnly}\r\n              className=\"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-500 disabled:opacity-50\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Manufacturing Info */}\r\n      <div className=\"bg-slate-800 rounded-lg border border-slate-700 p-4\">\r\n        <h3 className=\"text-lg font-semibold text-white mb-4\">Manufacturing</h3>\r\n        \r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm text-slate-400 mb-1\">Manufacturer</label>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"e.g., Defiance Industries\"\r\n              disabled={readOnly}\r\n              className=\"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-500 disabled:opacity-50\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm text-slate-400 mb-1\">Primary Factory</label>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"e.g., Hesperus II\"\r\n              disabled={readOnly}\r\n              className=\"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-500 disabled:opacity-50\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm text-slate-400 mb-1\">Introduction Year</label>\r\n            <input\r\n              type=\"number\"\r\n              placeholder=\"e.g., 3025\"\r\n              disabled={readOnly}\r\n              className=\"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-500 disabled:opacity-50\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm text-slate-400 mb-1\">Cost (C-Bills)</label>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Calculated automatically\"\r\n              disabled\r\n              className=\"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded text-slate-400\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Role/Notes */}\r\n      <div className=\"bg-slate-800 rounded-lg border border-slate-700 p-4\">\r\n        <h3 className=\"text-lg font-semibold text-white mb-4\">Role & Description</h3>\r\n        \r\n        <div className=\"space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm text-slate-400 mb-1\">Combat Role</label>\r\n            <select \r\n              className=\"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white\"\r\n              disabled={readOnly}\r\n            >\r\n              <option value=\"\">-- Select Role --</option>\r\n              <option>Ambusher</option>\r\n              <option>Brawler</option>\r\n              <option>Fire Support</option>\r\n              <option>Juggernaut</option>\r\n              <option>Missile Boat</option>\r\n              <option>Scout</option>\r\n              <option>Skirmisher</option>\r\n              <option>Sniper</option>\r\n              <option>Striker</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <div>\r\n            <label className=\"block text-sm text-slate-400 mb-1\">Notes</label>\r\n            <textarea\r\n              rows={4}\r\n              placeholder=\"Add notes about this unit variant...\"\r\n              disabled={readOnly}\r\n              className=\"w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded text-white placeholder-slate-500 disabled:opacity-50 resize-none\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Quirks (placeholder) */}\r\n      <div className=\"bg-slate-800 rounded-lg border border-slate-700 p-4\">\r\n        <h3 className=\"text-lg font-semibold text-white mb-4\">Quirks</h3>\r\n        \r\n        <div className=\"text-center py-6 text-slate-400\">\r\n          <p>Quirks system coming soon</p>\r\n          <p className=\"text-sm mt-2\">Positive and negative design quirks can be added here</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\MultiUnitTabs.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabInfo' is defined but never used.","line":19,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":53},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":59,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":59,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoadingUnit' is assigned a value but never used.","line":83,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'store' is assigned a value but never used.","line":298,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":298,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Multi-Unit Tabs Component\r\n * \r\n * Browser-like tabs for editing multiple units.\r\n * Uses the new TabManagerStore for tab lifecycle management.\r\n * Integrates with URL routing for shareable links.\r\n * \r\n * @spec openspec/specs/multi-unit-tabs/spec.md\r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport React, { useCallback, useMemo, useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport { TabBar } from './TabBar';\r\nimport { NewTabModal } from './NewTabModal';\r\nimport { UnsavedChangesDialog } from '@/components/customizer/dialogs/UnsavedChangesDialog';\r\nimport { SaveUnitDialog } from '@/components/customizer/dialogs/SaveUnitDialog';\r\nimport { UnitLoadDialog, LoadUnitSource } from '@/components/customizer/dialogs/UnitLoadDialog';\r\nimport { useTabManagerStore, UNIT_TEMPLATES, TabInfo } from '@/stores/useTabManagerStore';\r\nimport { IUnitIndexEntry } from '@/services/common/types';\r\nimport { getUnitStore, createUnitFromFullState } from '@/stores/unitStoreRegistry';\r\nimport { customUnitApiService } from '@/services/units/CustomUnitApiService';\r\nimport { unitLoaderService } from '@/services/units/UnitLoaderService';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { DEFAULT_TAB } from '@/hooks/useCustomizerRouter';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\ninterface MultiUnitTabsProps {\r\n  /** Content to render for the active tab */\r\n  children: React.ReactNode;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\ninterface CloseDialogState {\r\n  isOpen: boolean;\r\n  tabId: string | null;\r\n  tabName: string;\r\n}\r\n\r\ninterface SaveDialogState {\r\n  isOpen: boolean;\r\n  tabId: string | null;\r\n  chassis: string;\r\n  variant: string;\r\n  closeAfterSave: boolean;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\n/**\r\n * Multi-unit tab container with tab bar and content area\r\n */\r\nexport function MultiUnitTabs({\r\n  children,\r\n  className = '',\r\n}: MultiUnitTabsProps) {\r\n  const router = useRouter();\r\n  \r\n  // Close dialog state\r\n  const [closeDialog, setCloseDialog] = useState<CloseDialogState>({\r\n    isOpen: false,\r\n    tabId: null,\r\n    tabName: '',\r\n  });\r\n  \r\n  // Save dialog state\r\n  const [saveDialog, setSaveDialog] = useState<SaveDialogState>({\r\n    isOpen: false,\r\n    tabId: null,\r\n    chassis: '',\r\n    variant: '',\r\n    closeAfterSave: false,\r\n  });\r\n  \r\n  // Load dialog state\r\n  const [isLoadDialogOpen, setIsLoadDialogOpen] = useState(false);\r\n  const [isLoadingUnit, setIsLoadingUnit] = useState(false);\r\n  \r\n  // Use individual selectors for primitives and stable references\r\n  // This avoids creating new objects on each render\r\n  const tabs = useTabManagerStore((s) => s.tabs);\r\n  const activeTabId = useTabManagerStore((s) => s.activeTabId);\r\n  const isLoading = useTabManagerStore((s) => s.isLoading);\r\n  const isNewTabModalOpen = useTabManagerStore((s) => s.isNewTabModalOpen);\r\n  \r\n  // Actions are stable references from the store\r\n  const storeSelectTab = useTabManagerStore((s) => s.selectTab);\r\n  const storeCloseTab = useTabManagerStore((s) => s.closeTab);\r\n  const renameTab = useTabManagerStore((s) => s.renameTab);\r\n  const createTab = useTabManagerStore((s) => s.createTab);\r\n  const openNewTabModal = useTabManagerStore((s) => s.openNewTabModal);\r\n  const closeNewTabModal = useTabManagerStore((s) => s.closeNewTabModal);\r\n  \r\n  // Select tab with URL navigation\r\n  const selectTab = useCallback((tabId: string) => {\r\n    storeSelectTab(tabId);\r\n    // Navigate to the unit URL\r\n    router.push(`/customizer/${tabId}/${DEFAULT_TAB}`, undefined, { shallow: true });\r\n  }, [storeSelectTab, router]);\r\n  \r\n  // Actually close the tab and navigate\r\n  const performCloseTab = useCallback((tabId: string) => {\r\n    // Close the tab in the store\r\n    storeCloseTab(tabId);\r\n    \r\n    // Get updated state after closing\r\n    const newState = useTabManagerStore.getState();\r\n    \r\n    if (newState.tabs.length === 0) {\r\n      // All tabs closed - navigate to index (empty state)\r\n      router.push('/customizer', undefined, { shallow: true });\r\n    } else if (newState.activeTabId && newState.activeTabId !== tabId) {\r\n      // A different tab is now active - navigate to it\r\n      router.push(`/customizer/${newState.activeTabId}/${DEFAULT_TAB}`, undefined, { shallow: true });\r\n    }\r\n  }, [storeCloseTab, router]);\r\n  \r\n  // Close tab with unsaved changes check\r\n  const closeTab = useCallback((tabId: string) => {\r\n    // Check if the unit has unsaved changes\r\n    const unitStore = getUnitStore(tabId);\r\n    const isModified = unitStore?.getState().isModified ?? false;\r\n    const tabInfo = tabs.find((t) => t.id === tabId);\r\n    \r\n    if (isModified) {\r\n      // Show confirmation dialog\r\n      setCloseDialog({\r\n        isOpen: true,\r\n        tabId,\r\n        tabName: tabInfo?.name ?? 'Unknown Unit',\r\n      });\r\n    } else {\r\n      // No unsaved changes, close directly\r\n      performCloseTab(tabId);\r\n    }\r\n  }, [tabs, performCloseTab]);\r\n  \r\n  // Dialog handlers\r\n  const handleCloseDialogCancel = useCallback(() => {\r\n    setCloseDialog({ isOpen: false, tabId: null, tabName: '' });\r\n  }, []);\r\n  \r\n  const handleCloseDialogDiscard = useCallback(() => {\r\n    if (closeDialog.tabId) {\r\n      performCloseTab(closeDialog.tabId);\r\n    }\r\n    setCloseDialog({ isOpen: false, tabId: null, tabName: '' });\r\n  }, [closeDialog.tabId, performCloseTab]);\r\n  \r\n  const handleCloseDialogSave = useCallback(() => {\r\n    // Get unit data for save dialog\r\n    if (closeDialog.tabId) {\r\n      const unitStore = getUnitStore(closeDialog.tabId);\r\n      if (unitStore) {\r\n        const state = unitStore.getState();\r\n        // Close the unsaved changes dialog and open save dialog\r\n        setCloseDialog({ isOpen: false, tabId: null, tabName: '' });\r\n        setSaveDialog({\r\n          isOpen: true,\r\n          tabId: closeDialog.tabId,\r\n          chassis: state.name || 'New Mech',\r\n          variant: '', // User needs to provide variant\r\n          closeAfterSave: true,\r\n        });\r\n        return;\r\n      }\r\n    }\r\n    setCloseDialog({ isOpen: false, tabId: null, tabName: '' });\r\n  }, [closeDialog.tabId]);\r\n  \r\n  // Handle save dialog cancel\r\n  const handleSaveDialogCancel = useCallback(() => {\r\n    setSaveDialog({\r\n      isOpen: false,\r\n      tabId: null,\r\n      chassis: '',\r\n      variant: '',\r\n      closeAfterSave: false,\r\n    });\r\n  }, []);\r\n  \r\n  // Handle save dialog save\r\n  const handleSaveDialogSave = useCallback(async (\r\n    chassis: string,\r\n    variant: string,\r\n    overwriteId?: string\r\n  ) => {\r\n    if (!saveDialog.tabId) return;\r\n    \r\n    const unitStore = getUnitStore(saveDialog.tabId);\r\n    if (!unitStore) return;\r\n    \r\n    const state = unitStore.getState();\r\n    \r\n    try {\r\n      // Build the unit data for saving\r\n      const unitData = {\r\n        id: overwriteId || saveDialog.tabId,\r\n        chassis,\r\n        variant,\r\n        tonnage: state.tonnage,\r\n        techBase: state.techBase,\r\n        era: 'SUCCESSION_WARS', // TODO: Get from state when available\r\n        unitType: 'BattleMech' as const,\r\n        // Add other unit data as needed\r\n        engineType: state.engineType,\r\n        engineRating: state.engineRating,\r\n        gyroType: state.gyroType,\r\n        internalStructureType: state.internalStructureType,\r\n        cockpitType: state.cockpitType,\r\n        heatSinkType: state.heatSinkType,\r\n        heatSinkCount: state.heatSinkCount,\r\n        armorType: state.armorType,\r\n        armorAllocation: state.armorAllocation,\r\n      };\r\n      \r\n      // Save the unit using the API\r\n      let result;\r\n      if (overwriteId) {\r\n        // Update existing unit\r\n        result = await customUnitApiService.save(overwriteId, unitData as never);\r\n      } else {\r\n        // Create new unit\r\n        result = await customUnitApiService.create(unitData as never, chassis, variant);\r\n      }\r\n      \r\n      if (!result.success) {\r\n        console.error('Failed to save unit:', result.error);\r\n        // TODO: Show error toast/notification\r\n        return;\r\n      }\r\n      \r\n      // Mark as not modified\r\n      state.markModified(false);\r\n      \r\n      // Update tab name to match saved name\r\n      renameTab(saveDialog.tabId, `${chassis} ${variant}`);\r\n      \r\n      // Close save dialog\r\n      const shouldClose = saveDialog.closeAfterSave;\r\n      const tabIdToClose = saveDialog.tabId;\r\n      \r\n      setSaveDialog({\r\n        isOpen: false,\r\n        tabId: null,\r\n        chassis: '',\r\n        variant: '',\r\n        closeAfterSave: false,\r\n      });\r\n      \r\n      // Close tab if requested\r\n      if (shouldClose) {\r\n        performCloseTab(tabIdToClose);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to save unit:', error);\r\n      // TODO: Show error toast/notification\r\n    }\r\n  }, [saveDialog.tabId, saveDialog.closeAfterSave, renameTab, performCloseTab]);\r\n  \r\n  // Open load dialog\r\n  const openLoadDialog = useCallback(() => {\r\n    setIsLoadDialogOpen(true);\r\n  }, []);\r\n  \r\n  // Handle unit load from dialog\r\n  const handleLoadUnit = useCallback(async (unit: IUnitIndexEntry, source: LoadUnitSource) => {\r\n    setIsLoadingUnit(true);\r\n    \r\n    try {\r\n      // Load full unit data from the appropriate source\r\n      const result = await unitLoaderService.loadUnit(unit.id, source);\r\n      \r\n      if (!result.success || !result.state) {\r\n        console.error('Failed to load unit:', result.error);\r\n        // Fallback to creating blank unit with basic info\r\n        const baseTemplate = UNIT_TEMPLATES.find(t => t.tonnage === unit.tonnage) || UNIT_TEMPLATES[1];\r\n        const template = {\r\n          ...baseTemplate,\r\n          name: `${unit.chassis} ${unit.variant}`,\r\n          tonnage: unit.tonnage,\r\n          techBase: unit.techBase,\r\n        };\r\n        const newTabId = createTab(template);\r\n        router.push(`/customizer/${newTabId}/${DEFAULT_TAB}`, undefined, { shallow: true });\r\n        setIsLoadDialogOpen(false);\r\n        setIsLoadingUnit(false);\r\n        return;\r\n      }\r\n      \r\n      // Create a store from the full loaded state\r\n      const store = createUnitFromFullState(result.state);\r\n      const newTabId = result.state.id;\r\n      \r\n      // Register the tab with the tab manager\r\n      useTabManagerStore.getState().addTab({\r\n        id: newTabId,\r\n        name: result.state.name,\r\n        tonnage: result.state.tonnage,\r\n        techBase: result.state.techBase,\r\n      });\r\n      \r\n      // Navigate to the new unit\r\n      router.push(`/customizer/${newTabId}/${DEFAULT_TAB}`, undefined, { shallow: true });\r\n      \r\n      // Close the dialog\r\n      setIsLoadDialogOpen(false);\r\n    } catch (error) {\r\n      console.error('Error loading unit:', error);\r\n      // TODO: Show error toast/notification\r\n    } finally {\r\n      setIsLoadingUnit(false);\r\n    }\r\n  }, [createTab, router]);\r\n  \r\n  // Create unit from template with URL navigation\r\n  const createNewUnit = useCallback((tonnage: number, techBase: TechBase = TechBase.INNER_SPHERE) => {\r\n    const template = UNIT_TEMPLATES.find(t => t.tonnage === tonnage) || UNIT_TEMPLATES[1];\r\n    const templateWithTechBase = { ...template, techBase };\r\n    const newTabId = createTab(templateWithTechBase);\r\n    // Navigate to the new unit URL\r\n    router.push(`/customizer/${newTabId}/${DEFAULT_TAB}`, undefined, { shallow: true });\r\n    return newTabId;\r\n  }, [createTab, router]);\r\n  \r\n  // Transform tabs to format expected by TabBar\r\n  // Read name and isModified directly from unit stores for live updates\r\n  const tabBarTabs = useMemo(() => \r\n    tabs.map((tab) => {\r\n      const unitStore = getUnitStore(tab.id);\r\n      const state = unitStore?.getState();\r\n      return {\r\n        id: tab.id,\r\n        // Use name from unit store for live updates when chassis/model changes\r\n        name: state?.name ?? tab.name,\r\n        isModified: state?.isModified ?? false,\r\n      };\r\n    }),\r\n    [tabs]\r\n  );\r\n  \r\n  // Keyboard shortcuts: Ctrl+N (new unit), Ctrl+O (load unit)\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // Check for Ctrl (or Cmd on Mac) modifier\r\n      if (e.ctrlKey || e.metaKey) {\r\n        if (e.key === 'n' || e.key === 'N') {\r\n          e.preventDefault();\r\n          openNewTabModal();\r\n        } else if (e.key === 'o' || e.key === 'O') {\r\n          e.preventDefault();\r\n          openLoadDialog();\r\n        }\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [openNewTabModal, openLoadDialog]);\r\n  \r\n  // Loading state - show while Zustand is hydrating\r\n  if (isLoading) {\r\n    return (\r\n      <div className={`flex items-center justify-center h-full ${className}`}>\r\n        <div className=\"text-slate-400\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Empty state - no tabs\r\n  if (tabs.length === 0) {\r\n    return (\r\n      <div className={`flex flex-col items-center justify-center h-full ${className}`}>\r\n        <div className=\"text-center max-w-md\">\r\n          {/* Icon */}\r\n          <div className=\"w-20 h-20 mx-auto mb-6 bg-slate-800 rounded-2xl flex items-center justify-center\">\r\n            <svg className=\"w-10 h-10 text-slate-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z\" />\r\n            </svg>\r\n          </div>\r\n          \r\n          <h2 className=\"text-2xl font-bold text-white mb-2\">No Units Open</h2>\r\n          <p className=\"text-slate-400 mb-8\">Create a new BattleMech from scratch or load an existing unit from the library.</p>\r\n          \r\n          {/* Quick action buttons - using same icons as toolbar */}\r\n          <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\r\n            <button\r\n              onClick={openNewTabModal}\r\n              className=\"flex items-center justify-center gap-2 px-6 py-3 bg-amber-600 hover:bg-amber-500 text-white font-medium rounded-lg transition-colors\"\r\n            >\r\n              {/* Document icon - same as toolbar */}\r\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n              </svg>\r\n              New Unit\r\n            </button>\r\n            \r\n            <button\r\n              onClick={openLoadDialog}\r\n              className=\"flex items-center justify-center gap-2 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white font-medium rounded-lg transition-colors\"\r\n            >\r\n              {/* Folder icon - same as toolbar */}\r\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z\" />\r\n              </svg>\r\n              Load from Library\r\n            </button>\r\n          </div>\r\n        </div>\r\n        \r\n        <NewTabModal\r\n          isOpen={isNewTabModalOpen}\r\n          onClose={closeNewTabModal}\r\n          onCreateUnit={createNewUnit}\r\n        />\r\n        \r\n        {/* Load unit dialog - also available from empty state */}\r\n        <UnitLoadDialog\r\n          isOpen={isLoadDialogOpen}\r\n          onLoadUnit={handleLoadUnit}\r\n          onCancel={() => setIsLoadDialogOpen(false)}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className={`flex flex-col h-full ${className}`}>\r\n      {/* Tab bar */}\r\n      <TabBar\r\n        tabs={tabBarTabs}\r\n        activeTabId={activeTabId}\r\n        onSelectTab={selectTab}\r\n        onCloseTab={closeTab}\r\n        onRenameTab={renameTab}\r\n        onNewTab={openNewTabModal}\r\n        onLoadUnit={openLoadDialog}\r\n      />\r\n      \r\n      {/* Tab content */}\r\n      <div className=\"flex-1 min-h-0 overflow-hidden\">\r\n        {children}\r\n      </div>\r\n      \r\n      {/* New tab modal */}\r\n      <NewTabModal\r\n        isOpen={isNewTabModalOpen}\r\n        onClose={closeNewTabModal}\r\n        onCreateUnit={createNewUnit}\r\n      />\r\n      \r\n      {/* Unsaved changes dialog */}\r\n      <UnsavedChangesDialog\r\n        isOpen={closeDialog.isOpen}\r\n        unitName={closeDialog.tabName}\r\n        onClose={handleCloseDialogCancel}\r\n        onDiscard={handleCloseDialogDiscard}\r\n        onSave={handleCloseDialogSave}\r\n      />\r\n      \r\n      {/* Save unit dialog */}\r\n      <SaveUnitDialog\r\n        isOpen={saveDialog.isOpen}\r\n        initialChassis={saveDialog.chassis}\r\n        initialVariant={saveDialog.variant}\r\n        currentUnitId={saveDialog.tabId ?? undefined}\r\n        onSave={handleSaveDialogSave}\r\n        onCancel={handleSaveDialogCancel}\r\n      />\r\n      \r\n      {/* Load unit dialog */}\r\n      <UnitLoadDialog\r\n        isOpen={isLoadDialogOpen}\r\n        onLoadUnit={handleLoadUnit}\r\n        onCancel={() => setIsLoadDialogOpen(false)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\NewTabModal.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":27,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":27,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * New Tab Modal Component\r\n * \r\n * Modal dialog for creating new unit tabs.\r\n * \r\n * @spec openspec/specs/multi-unit-tabs/spec.md\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { UNIT_TEMPLATES, UnitTemplate } from '@/stores/useMultiUnitStore';\r\n\r\ntype CreationMode = 'new' | 'copy' | 'import';\r\n\r\ninterface NewTabModalProps {\r\n  /** Whether modal is open */\r\n  isOpen: boolean;\r\n  /** Called when modal is closed */\r\n  onClose: () => void;\r\n  /** Called when a unit is created */\r\n  onCreateUnit: (tonnage: number, techBase?: TechBase) => string;\r\n}\r\n\r\n/**\r\n * New unit tab creation modal\r\n */\r\nexport function NewTabModal({\r\n  isOpen,\r\n  onClose,\r\n  onCreateUnit,\r\n}: NewTabModalProps) {\r\n  const [mode, setMode] = useState<CreationMode>('new');\r\n  const [selectedTemplate, setSelectedTemplate] = useState<UnitTemplate>(UNIT_TEMPLATES[1]); // Medium\r\n  const [techBase, setTechBase] = useState<TechBase>(TechBase.INNER_SPHERE);\r\n  \r\n  if (!isOpen) return null;\r\n  \r\n  const handleCreate = () => {\r\n    onCreateUnit(selectedTemplate.tonnage, techBase);\r\n    onClose();\r\n  };\r\n  \r\n  const handleOverlayClick = (e: React.MouseEvent) => {\r\n    if (e.target === e.currentTarget) {\r\n      onClose();\r\n    }\r\n  };\r\n  \r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      onClose();\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60\"\r\n      onClick={handleOverlayClick}\r\n      onKeyDown={handleKeyDown}\r\n    >\r\n      <div className=\"bg-slate-800 rounded-lg border border-slate-700 shadow-xl w-full max-w-lg mx-4\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b border-slate-700\">\r\n          <h2 className=\"text-lg font-semibold text-white\">Create New Unit</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-slate-400 hover:text-white transition-colors\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Mode tabs */}\r\n        <div className=\"flex border-b border-slate-700\">\r\n          {(['new', 'copy', 'import'] as CreationMode[]).map((m) => (\r\n            <button\r\n              key={m}\r\n              onClick={() => setMode(m)}\r\n              className={`flex-1 px-4 py-2 text-sm font-medium transition-colors ${\r\n                mode === m\r\n                  ? 'bg-blue-600 text-white'\r\n                  : 'text-slate-400 hover:text-white hover:bg-slate-700'\r\n              }`}\r\n            >\r\n              {m === 'new' && 'New Unit'}\r\n              {m === 'copy' && 'Copy Current'}\r\n              {m === 'import' && 'Import Data'}\r\n            </button>\r\n          ))}\r\n        </div>\r\n        \r\n        {/* Content */}\r\n        <div className=\"p-4\">\r\n          {mode === 'new' && (\r\n            <div className=\"space-y-4\">\r\n              {/* Template selection */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-slate-300 mb-2\">\r\n                  Select Template\r\n                </label>\r\n                <div className=\"grid grid-cols-2 gap-2\">\r\n                  {UNIT_TEMPLATES.map((template) => (\r\n                    <button\r\n                      key={template.id}\r\n                      onClick={() => setSelectedTemplate(template)}\r\n                      className={`p-3 rounded-lg border text-left transition-colors ${\r\n                        selectedTemplate.id === template.id\r\n                          ? 'border-blue-500 bg-blue-900/30'\r\n                          : 'border-slate-600 hover:border-slate-500'\r\n                      }`}\r\n                    >\r\n                      <div className=\"text-sm font-medium text-white\">{template.name}</div>\r\n                      <div className=\"text-xs text-slate-400\">\r\n                        {template.tonnage}t  {template.walkMP}/{Math.ceil(template.walkMP * 1.5)}/{template.jumpMP} MP\r\n                      </div>\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Tech base selection */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-slate-300 mb-2\">\r\n                  Tech Base\r\n                </label>\r\n                <div className=\"flex gap-2\">\r\n                  <button\r\n                    onClick={() => setTechBase(TechBase.INNER_SPHERE)}\r\n                    className={`flex-1 px-4 py-2 rounded-lg border text-sm font-medium transition-colors ${\r\n                      techBase === TechBase.INNER_SPHERE\r\n                        ? 'border-blue-500 bg-blue-900/30 text-blue-300'\r\n                        : 'border-slate-600 text-slate-400 hover:border-slate-500'\r\n                    }`}\r\n                  >\r\n                    Inner Sphere\r\n                  </button>\r\n                  <button\r\n                    onClick={() => setTechBase(TechBase.CLAN)}\r\n                    className={`flex-1 px-4 py-2 rounded-lg border text-sm font-medium transition-colors ${\r\n                      techBase === TechBase.CLAN\r\n                        ? 'border-green-500 bg-green-900/30 text-green-300'\r\n                        : 'border-slate-600 text-slate-400 hover:border-slate-500'\r\n                    }`}\r\n                  >\r\n                    Clan\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          {mode === 'copy' && (\r\n            <div className=\"py-8 text-center text-slate-400\">\r\n              <p>Creates a copy of the currently active unit.</p>\r\n              <p className=\"text-sm mt-2\">Select this option when you want to create a variant.</p>\r\n            </div>\r\n          )}\r\n          \r\n          {mode === 'import' && (\r\n            <div className=\"py-8 text-center text-slate-400\">\r\n              <p>Import from MTF, SSW, or MegaMek formats.</p>\r\n              <p className=\"text-sm mt-2\">(Coming soon)</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Footer */}\r\n        <div className=\"flex justify-end gap-2 px-4 py-3 border-t border-slate-700\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition-colors\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            onClick={handleCreate}\r\n            disabled={mode === 'import'}\r\n            className=\"px-4 py-2 text-sm font-medium bg-amber-600 hover:bg-amber-500 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            Create Unit\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\OverviewTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IComponentTechBases' is defined but never used.","line":15,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":62},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":48,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":48,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cockpitDef' is assigned a value but never used.","line":140,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":140,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Overview Tab Component\r\n * \r\n * Summary view of the current unit configuration.\r\n * Uses the contextual unit store - no tabId prop needed.\r\n * \r\n * @spec openspec/specs/customizer-tabs/spec.md\r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport React, { useCallback, useMemo } from 'react';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { RulesLevel, ALL_RULES_LEVELS } from '@/types/enums/RulesLevel';\r\nimport { TechBaseConfiguration, IComponentValues } from '../shared/TechBaseConfiguration';\r\nimport { TechBaseMode, TechBaseComponent, IComponentTechBases } from '@/types/construction/TechBaseConfiguration';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { useTabManagerStore } from '@/stores/useTabManagerStore';\r\nimport { getEngineDefinition } from '@/types/construction/EngineType';\r\nimport { getGyroDefinition } from '@/types/construction/GyroType';\r\nimport { getInternalStructureDefinition } from '@/types/construction/InternalStructureType';\r\nimport { getCockpitDefinition } from '@/types/construction/CockpitType';\r\nimport { getHeatSinkDefinition } from '@/types/construction/HeatSinkType';\r\nimport { getArmorDefinition } from '@/types/construction/ArmorType';\r\nimport { getMovementEnhancementDefinition, MovementEnhancementType } from '@/types/construction/MovementEnhancement';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\ninterface OverviewTabProps {\r\n  /** Read-only mode */\r\n  readOnly?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\n/**\r\n * Overview tab showing unit summary\r\n * \r\n * Uses useUnitStore() to access the current unit's state.\r\n * No tabId prop needed - context provides the active unit.\r\n */\r\nexport function OverviewTab({\r\n  readOnly = false,\r\n  className = '',\r\n}: OverviewTabProps) {\r\n  // Get unit state from context (no tabId needed!)\r\n  const unitId = useUnitStore((s) => s.id);\r\n  const chassis = useUnitStore((s) => s.chassis);\r\n  const clanName = useUnitStore((s) => s.clanName);\r\n  const model = useUnitStore((s) => s.model);\r\n  const mulId = useUnitStore((s) => s.mulId);\r\n  const year = useUnitStore((s) => s.year);\r\n  const rulesLevel = useUnitStore((s) => s.rulesLevel);\r\n  const techBaseMode = useUnitStore((s) => s.techBaseMode);\r\n  const componentTechBases = useUnitStore((s) => s.componentTechBases);\r\n  const engineType = useUnitStore((s) => s.engineType);\r\n  const engineRating = useUnitStore((s) => s.engineRating);\r\n  const gyroType = useUnitStore((s) => s.gyroType);\r\n  const internalStructureType = useUnitStore((s) => s.internalStructureType);\r\n  const cockpitType = useUnitStore((s) => s.cockpitType);\r\n  const heatSinkType = useUnitStore((s) => s.heatSinkType);\r\n  const heatSinkCount = useUnitStore((s) => s.heatSinkCount);\r\n  const armorType = useUnitStore((s) => s.armorType);\r\n  const enhancement = useUnitStore((s) => s.enhancement);\r\n  \r\n  // Get actions from context\r\n  const setChassis = useUnitStore((s) => s.setChassis);\r\n  const setClanName = useUnitStore((s) => s.setClanName);\r\n  const setModel = useUnitStore((s) => s.setModel);\r\n  const setMulId = useUnitStore((s) => s.setMulId);\r\n  const setYear = useUnitStore((s) => s.setYear);\r\n  const setRulesLevel = useUnitStore((s) => s.setRulesLevel);\r\n  const setTechBaseMode = useUnitStore((s) => s.setTechBaseMode);\r\n  const setComponentTechBase = useUnitStore((s) => s.setComponentTechBase);\r\n  \r\n  // Get tab manager action\r\n  const renameTab = useTabManagerStore((s) => s.renameTab);\r\n  \r\n  // Helper to update tab name when chassis/model changes\r\n  const updateTabName = useCallback((newChassis: string, newModel: string) => {\r\n    const newName = `${newChassis}${newModel ? ' ' + newModel : ''}`;\r\n    renameTab(unitId, newName);\r\n  }, [unitId, renameTab]);\r\n  \r\n  // Handlers - Basic info (MegaMekLab format)\r\n  const handleChassisChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const newChassis = e.target.value;\r\n    setChassis(newChassis);\r\n    updateTabName(newChassis, model);\r\n  }, [setChassis, model, updateTabName]);\r\n  \r\n  const handleClanNameChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setClanName(e.target.value);\r\n  }, [setClanName]);\r\n  \r\n  const handleModelChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const newModel = e.target.value;\r\n    setModel(newModel);\r\n    updateTabName(chassis, newModel);\r\n  }, [setModel, chassis, updateTabName]);\r\n  \r\n  const handleMulIdChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    // Allow numbers and hyphens only, store as string (-1 for custom units)\r\n    const value = e.target.value.replace(/[^0-9-]/g, '');\r\n    setMulId(value === '' ? '-1' : value);\r\n  }, [setMulId]);\r\n  \r\n  const handleYearChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = parseInt(e.target.value, 10);\r\n    if (!isNaN(value) && value > 0) {\r\n      setYear(value);\r\n    }\r\n  }, [setYear]);\r\n  \r\n  const handleRulesLevelChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setRulesLevel(e.target.value as RulesLevel);\r\n  }, [setRulesLevel]);\r\n\r\n  // Handler for global mode change\r\n  const handleModeChange = useCallback((newMode: TechBaseMode) => {\r\n    setTechBaseMode(newMode);\r\n  }, [setTechBaseMode]);\r\n\r\n  // Handler for individual component change\r\n  const handleComponentChange = useCallback((component: TechBaseComponent, newTechBase: TechBase) => {\r\n    setComponentTechBase(component, newTechBase);\r\n  }, [setComponentTechBase]);\r\n\r\n  // Build component values based on actual store selections\r\n  const componentValues: IComponentValues = useMemo(() => {\r\n    const engineDef = getEngineDefinition(engineType);\r\n    const gyroDef = getGyroDefinition(gyroType);\r\n    const structureDef = getInternalStructureDefinition(internalStructureType);\r\n    const cockpitDef = getCockpitDefinition(cockpitType);\r\n    const heatSinkDef = getHeatSinkDefinition(heatSinkType);\r\n    const armorDef = getArmorDefinition(armorType);\r\n    \r\n    // Get myomer display name based on enhancement\r\n    let myomerName = 'Standard';\r\n    if (enhancement === MovementEnhancementType.TSM) {\r\n      myomerName = 'Triple-Strength Myomer';\r\n    } else if (enhancement) {\r\n      // For MASC/Supercharger, myomer is still standard but movement enhancement is active\r\n      myomerName = 'Standard';\r\n    }\r\n    \r\n    // Get movement enhancement display (MASC, Supercharger, Partial Wing)\r\n    let movementName = 'None';\r\n    if (enhancement && enhancement !== MovementEnhancementType.TSM) {\r\n      const enhancementDef = getMovementEnhancementDefinition(enhancement);\r\n      movementName = enhancementDef?.name ?? enhancement;\r\n    }\r\n    \r\n    return {\r\n      chassis: structureDef?.name ?? 'Standard',\r\n      gyro: gyroDef?.name ?? 'Standard',\r\n      engine: `${engineDef?.name ?? 'Standard Fusion'} ${engineRating}`,\r\n      heatsink: `${heatSinkCount} ${heatSinkDef?.name ?? 'Single'}`,\r\n      targeting: 'None',\r\n      myomer: myomerName,\r\n      movement: movementName,\r\n      armor: armorDef?.name ?? 'Standard',\r\n    };\r\n  }, [engineType, engineRating, gyroType, internalStructureType, cockpitType, heatSinkType, heatSinkCount, armorType, enhancement]);\r\n\r\n  return (\r\n    <div className={`space-y-6 p-4 ${className}`}>\r\n      {/* Basic Info Panel */}\r\n      <div className={cs.panel.main}>\r\n        <h3 className={cs.text.sectionTitle}>Basic Information</h3>\r\n        \r\n        <div className={cs.layout.formStack}>\r\n          {/* Chassis */}\r\n          <div className={cs.layout.field}>\r\n            <label className={cs.text.label}>Chassis</label>\r\n            <input\r\n              type=\"text\"\r\n              value={chassis}\r\n              onChange={handleChassisChange}\r\n              disabled={readOnly}\r\n              className={cs.input.full}\r\n              placeholder=\"e.g., Atlas, Timber Wolf\"\r\n            />\r\n          </div>\r\n          \r\n          {/* Clan Name (optional) */}\r\n          <div className={cs.layout.field}>\r\n            <label className={cs.text.label}>Clan Name <span className={cs.text.secondary}>(optional)</span></label>\r\n            <input\r\n              type=\"text\"\r\n              value={clanName}\r\n              onChange={handleClanNameChange}\r\n              disabled={readOnly}\r\n              className={cs.input.full}\r\n              placeholder=\"e.g., Mad Cat for Timber Wolf\"\r\n            />\r\n          </div>\r\n          \r\n          {/* Model */}\r\n          <div className={cs.layout.field}>\r\n            <label className={cs.text.label}>Model</label>\r\n            <input\r\n              type=\"text\"\r\n              value={model}\r\n              onChange={handleModelChange}\r\n              disabled={readOnly}\r\n              className={cs.input.full}\r\n              placeholder=\"e.g., AS7-D, Prime\"\r\n            />\r\n          </div>\r\n          \r\n          {/* MUL ID, Year, Tech Level - split row */}\r\n          <div className={cs.layout.threeColumn}>\r\n            {/* MUL ID */}\r\n            <div className={cs.layout.field}>\r\n              <label className={cs.text.label}>MUL ID</label>\r\n              <input\r\n                type=\"text\"\r\n                value={mulId}\r\n                onChange={handleMulIdChange}\r\n                disabled={readOnly}\r\n                className={cs.input.full}\r\n                placeholder=\"-1\"\r\n              />\r\n            </div>\r\n            \r\n            {/* Year */}\r\n            <div className={cs.layout.field}>\r\n              <label className={cs.text.label}>Year</label>\r\n              <input\r\n                type=\"number\"\r\n                value={year}\r\n                onChange={handleYearChange}\r\n                disabled={readOnly}\r\n                min={2000}\r\n                max={3200}\r\n                className={`${cs.input.full} ${cs.input.noSpinners}`}\r\n              />\r\n            </div>\r\n            \r\n            {/* Tech Level */}\r\n            <div className={cs.layout.field}>\r\n              <label className={cs.text.label}>Tech Level</label>\r\n              <select\r\n                value={rulesLevel}\r\n                onChange={handleRulesLevelChange}\r\n                disabled={readOnly}\r\n                className={cs.select.full}\r\n              >\r\n                {ALL_RULES_LEVELS.map((level) => (\r\n                  <option key={level} value={level}>\r\n                    {level}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Tech Base Configuration Panel */}\r\n      <TechBaseConfiguration\r\n        mode={techBaseMode}\r\n        components={componentTechBases}\r\n        componentValues={componentValues}\r\n        onModeChange={handleModeChange}\r\n        onComponentChange={handleComponentChange}\r\n        readOnly={readOnly}\r\n      />\r\n\r\n      {/* Equipment Summary */}\r\n      <div className={cs.panel.main}>\r\n        <h3 className={cs.text.sectionTitle}>Equipment Summary</h3>\r\n        <div className={cs.panel.empty}>\r\n          <p>No equipment mounted</p>\r\n          <p className=\"text-sm mt-2\">Add weapons and equipment from the Equipment tab</p>\r\n        </div>\r\n      </div>\r\n\r\n      {readOnly && (\r\n        <div className={cs.panel.notice}>\r\n          This unit is in read-only mode. Changes cannot be made.\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\StructureTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMovementEnhancementDefinition' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MOVEMENT_ENHANCEMENT_DEFINITIONS' is defined but never used.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":35},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":107,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":107,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isNearMaxEngineRating' is assigned a value but never used.","line":170,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":170,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Structure Tab Component\r\n * \r\n * Configuration of structural components (engine, gyro, structure, cockpit)\r\n * and movement settings. Uses movement-first design where Walk MP determines\r\n * engine rating.\r\n * \r\n * @spec openspec/specs/customizer-tabs/spec.md\r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport React, { useCallback, useMemo } from 'react';\r\nimport { useUnitStore } from '@/stores/useUnitStore';\r\nimport { useTechBaseSync } from '@/hooks/useTechBaseSync';\r\nimport { useUnitCalculations } from '@/hooks/useUnitCalculations';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType } from '@/types/construction/CockpitType';\r\nimport { \r\n  MovementEnhancementType, \r\n  getMovementEnhancementDefinition,\r\n  MOVEMENT_ENHANCEMENT_DEFINITIONS \r\n} from '@/types/construction/MovementEnhancement';\r\nimport { JumpJetType, getMaxJumpMP, JUMP_JET_DEFINITIONS, calculateEnhancedMaxRunMP } from '@/utils/construction/movementCalculations';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { MechConfiguration } from '@/types/unit/BattleMechInterfaces';\r\nimport { customizerStyles as cs } from '../styles';\r\n\r\n// =============================================================================\r\n// Constants\r\n// =============================================================================\r\n\r\nconst TONNAGE_RANGE = { min: 20, max: 100, step: 5 };\r\n\r\nconst CONFIGURATION_OPTIONS: { value: MechConfiguration; label: string }[] = [\r\n  { value: MechConfiguration.BIPED, label: 'Biped' },\r\n  { value: MechConfiguration.QUAD, label: 'Quad' },\r\n  { value: MechConfiguration.TRIPOD, label: 'Tripod' },\r\n  { value: MechConfiguration.LAM, label: 'LAM' },\r\n  { value: MechConfiguration.QUADVEE, label: 'QuadVee' },\r\n];\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\ninterface StructureTabProps {\r\n  /** Read-only mode */\r\n  readOnly?: boolean;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n// =============================================================================\r\n// Helper Functions\r\n// =============================================================================\r\n\r\n/** Maximum engine rating per BattleTech TechManual */\r\nconst MAX_ENGINE_RATING = 400;\r\nconst MIN_ENGINE_RATING = 10;\r\n\r\n/**\r\n * Get valid Walk MP range for a given tonnage\r\n * Engine rating = tonnage  walkMP, must be 10-400\r\n */\r\nfunction getWalkMPRange(tonnage: number): { min: number; max: number } {\r\n  const minWalk = Math.max(1, Math.ceil(MIN_ENGINE_RATING / tonnage));\r\n  const maxWalk = Math.min(12, Math.floor(MAX_ENGINE_RATING / tonnage));\r\n  \r\n  return { min: minWalk, max: maxWalk };\r\n}\r\n\r\n/**\r\n * Calculate Run MP from Walk MP (ceil of 1.5 walk)\r\n */\r\nfunction calculateRunMP(walkMP: number): number {\r\n  return Math.ceil(walkMP * 1.5);\r\n}\r\n\r\n/**\r\n * Get available enhancement options\r\n * Note: MASC and TSM are mutually exclusive but we don't disable options\r\n * since selecting one simply replaces the other.\r\n */\r\nfunction getEnhancementOptions(): {\r\n  value: MovementEnhancementType | null;\r\n  label: string;\r\n}[] {\r\n  return [\r\n    { value: null, label: 'None' },\r\n    { value: MovementEnhancementType.MASC, label: 'MASC' },\r\n    { value: MovementEnhancementType.TSM, label: 'Triple Strength Myomer' },\r\n  ];\r\n}\r\n\r\n// =============================================================================\r\n// Component\r\n// =============================================================================\r\n\r\n/**\r\n * Structure configuration tab\r\n * \r\n * Uses useUnitStore() to access the current unit's state.\r\n * No tabId prop needed - context provides the active unit.\r\n */\r\nexport function StructureTab({\r\n  readOnly = false,\r\n  className = '',\r\n}: StructureTabProps) {\r\n  // Get unit state from context\r\n  const tonnage = useUnitStore((s) => s.tonnage);\r\n  const configuration = useUnitStore((s) => s.configuration);\r\n  const componentTechBases = useUnitStore((s) => s.componentTechBases);\r\n  const engineType = useUnitStore((s) => s.engineType);\r\n  const engineRating = useUnitStore((s) => s.engineRating);\r\n  const gyroType = useUnitStore((s) => s.gyroType);\r\n  const internalStructureType = useUnitStore((s) => s.internalStructureType);\r\n  const cockpitType = useUnitStore((s) => s.cockpitType);\r\n  const heatSinkType = useUnitStore((s) => s.heatSinkType);\r\n  const heatSinkCount = useUnitStore((s) => s.heatSinkCount);\r\n  const armorType = useUnitStore((s) => s.armorType);\r\n  const armorTonnage = useUnitStore((s) => s.armorTonnage);\r\n  const enhancement = useUnitStore((s) => s.enhancement);\r\n  const jumpMP = useUnitStore((s) => s.jumpMP);\r\n  const jumpJetType = useUnitStore((s) => s.jumpJetType);\r\n  \r\n  // Get actions from context\r\n  const setTonnage = useUnitStore((s) => s.setTonnage);\r\n  const setConfiguration = useUnitStore((s) => s.setConfiguration);\r\n  const setEngineType = useUnitStore((s) => s.setEngineType);\r\n  const setEngineRating = useUnitStore((s) => s.setEngineRating);\r\n  const setGyroType = useUnitStore((s) => s.setGyroType);\r\n  const setInternalStructureType = useUnitStore((s) => s.setInternalStructureType);\r\n  const setCockpitType = useUnitStore((s) => s.setCockpitType);\r\n  const setHeatSinkType = useUnitStore((s) => s.setHeatSinkType);\r\n  const setHeatSinkCount = useUnitStore((s) => s.setHeatSinkCount);\r\n  const setEnhancement = useUnitStore((s) => s.setEnhancement);\r\n  const setJumpMP = useUnitStore((s) => s.setJumpMP);\r\n  const setJumpJetType = useUnitStore((s) => s.setJumpJetType);\r\n  \r\n  // Get filtered options based on tech base\r\n  const { filteredOptions } = useTechBaseSync(componentTechBases);\r\n  \r\n  // Calculate weights and slots (weight is based on armorTonnage, not allocated points)\r\n  const calculations = useUnitCalculations(\r\n    tonnage,\r\n    {\r\n      engineType,\r\n      engineRating,\r\n      gyroType,\r\n      internalStructureType,\r\n      cockpitType,\r\n      heatSinkType,\r\n      heatSinkCount,\r\n      armorType,\r\n      jumpMP,\r\n      jumpJetType,\r\n    },\r\n    armorTonnage\r\n  );\r\n  \r\n  // Movement calculations - Walk MP drives engine rating\r\n  const walkMP = useMemo(() => Math.floor(engineRating / tonnage), [engineRating, tonnage]);\r\n  const runMP = useMemo(() => calculateRunMP(walkMP), [walkMP]);\r\n  const walkMPRange = useMemo(() => getWalkMPRange(tonnage), [tonnage]);\r\n  \r\n  // Engine rating limit warnings\r\n  const isAtMaxEngineRating = engineRating >= MAX_ENGINE_RATING;\r\n  const isNearMaxEngineRating = engineRating >= MAX_ENGINE_RATING - tonnage; // Would exceed on +1 Walk MP\r\n  \r\n  // Calculate max run MP with enhancement active\r\n  const maxRunMP = useMemo(() => {\r\n    if (!enhancement) return undefined;\r\n    return calculateEnhancedMaxRunMP(walkMP, enhancement);\r\n  }, [enhancement, walkMP]);\r\n  \r\n  // Jump jet calculations\r\n  const maxJumpMP = useMemo(() => getMaxJumpMP(walkMP, jumpJetType), [walkMP, jumpJetType]);\r\n  \r\n  // Enhancement options\r\n  const enhancementOptions = useMemo(() => getEnhancementOptions(), []);\r\n  \r\n  // Handlers - Tonnage and Configuration\r\n  const handleTonnageChange = useCallback((newTonnage: number) => {\r\n    const clamped = Math.max(TONNAGE_RANGE.min, Math.min(TONNAGE_RANGE.max, newTonnage));\r\n    const rounded = Math.round(clamped / TONNAGE_RANGE.step) * TONNAGE_RANGE.step;\r\n    setTonnage(rounded);\r\n  }, [setTonnage]);\r\n  \r\n  const handleConfigurationChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setConfiguration(e.target.value as MechConfiguration);\r\n  }, [setConfiguration]);\r\n  \r\n  // Handlers - Components\r\n  const handleEngineTypeChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setEngineType(e.target.value as EngineType);\r\n  }, [setEngineType]);\r\n  \r\n  const handleWalkMPChange = useCallback((newWalkMP: number) => {\r\n    // Clamp to valid range\r\n    const clampedWalk = Math.max(walkMPRange.min, Math.min(walkMPRange.max, newWalkMP));\r\n    // Calculate and set engine rating\r\n    const newRating = tonnage * clampedWalk;\r\n    setEngineRating(newRating);\r\n  }, [tonnage, walkMPRange, setEngineRating]);\r\n  \r\n  const handleGyroTypeChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setGyroType(e.target.value as GyroType);\r\n  }, [setGyroType]);\r\n  \r\n  const handleStructureTypeChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setInternalStructureType(e.target.value as InternalStructureType);\r\n  }, [setInternalStructureType]);\r\n  \r\n  const handleCockpitTypeChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setCockpitType(e.target.value as CockpitType);\r\n  }, [setCockpitType]);\r\n  \r\n  const handleEnhancementChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    const value = e.target.value;\r\n    setEnhancement(value === '' ? null : value as MovementEnhancementType);\r\n  }, [setEnhancement]);\r\n  \r\n  const handleJumpMPChange = useCallback((newJumpMP: number) => {\r\n    // Clamp to valid range (0 to max)\r\n    const clampedJump = Math.max(0, Math.min(maxJumpMP, newJumpMP));\r\n    setJumpMP(clampedJump);\r\n  }, [maxJumpMP, setJumpMP]);\r\n  \r\n  const handleJumpJetTypeChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setJumpJetType(e.target.value as JumpJetType);\r\n  }, [setJumpJetType]);\r\n  \r\n  // Heat sink handlers\r\n  const handleHeatSinkTypeChange = useCallback((e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setHeatSinkType(e.target.value as HeatSinkType);\r\n  }, [setHeatSinkType]);\r\n  \r\n  const handleHeatSinkCountChange = useCallback((newCount: number) => {\r\n    // Minimum 10 heat sinks, no explicit maximum (limited by tonnage/slots)\r\n    const clampedCount = Math.max(10, newCount);\r\n    setHeatSinkCount(clampedCount);\r\n  }, [setHeatSinkCount]);\r\n  \r\n  return (\r\n    <div className={`${cs.layout.tabContent} ${className}`}>\r\n      {/* Compact Structural Weight Summary - at top */}\r\n      <div className={cs.panel.summary}>\r\n        <div className=\"flex items-center justify-between gap-6\">\r\n          <div className=\"flex items-center gap-6 text-sm\">\r\n            <div className={cs.layout.statRow}>\r\n              <span className={cs.text.label}>Engine:</span>\r\n              <span className={cs.text.value}>{calculations.engineWeight}t</span>\r\n            </div>\r\n            <div className={cs.layout.statRow}>\r\n              <span className={cs.text.label}>Gyro:</span>\r\n              <span className={cs.text.value}>{calculations.gyroWeight}t</span>\r\n            </div>\r\n            <div className={cs.layout.statRow}>\r\n              <span className={cs.text.label}>Structure:</span>\r\n              <span className={cs.text.value}>{calculations.structureWeight}t</span>\r\n            </div>\r\n            <div className={cs.layout.statRow}>\r\n              <span className={cs.text.label}>Cockpit:</span>\r\n              <span className={cs.text.value}>{calculations.cockpitWeight}t</span>\r\n            </div>\r\n            <div className={cs.layout.statRow}>\r\n              <span className={cs.text.label}>Heat Sinks:</span>\r\n              <span className={cs.text.value}>{calculations.heatSinkWeight}t</span>\r\n            </div>\r\n            {calculations.jumpJetWeight > 0 && (\r\n              <div className={cs.layout.statRow}>\r\n                <span className={cs.text.label}>Jump Jets:</span>\r\n                <span className={cs.text.value}>{calculations.jumpJetWeight}t</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div className={`${cs.layout.statRow} ${cs.layout.dividerV}`}>\r\n            <span className={`text-sm ${cs.text.label}`}>Total:</span>\r\n            <span className=\"text-lg font-bold text-amber-400\">{calculations.totalStructuralWeight}t</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Two-column layout: Chassis | Movement */}\r\n      <div className={cs.layout.twoColumn}>\r\n        \r\n        {/* LEFT: Chassis */}\r\n        <div className={cs.panel.main}>\r\n          <h3 className={cs.text.sectionTitle}>Chassis</h3>\r\n          \r\n          <div className={cs.layout.formStack}>\r\n            {/* Tonnage */}\r\n            <div className={cs.layout.field}>\r\n              <label className={cs.text.label}>Tonnage</label>\r\n              <div className={cs.layout.rowGap}>\r\n                <button\r\n                  onClick={() => handleTonnageChange(tonnage - TONNAGE_RANGE.step)}\r\n                  disabled={readOnly || tonnage <= TONNAGE_RANGE.min}\r\n                  className={cs.button.stepperMd}\r\n                >\r\n                  \r\n                </button>\r\n                <input\r\n                  type=\"number\"\r\n                  value={tonnage}\r\n                  onChange={(e) => handleTonnageChange(parseInt(e.target.value, 10) || TONNAGE_RANGE.min)}\r\n                  disabled={readOnly}\r\n                  min={TONNAGE_RANGE.min}\r\n                  max={TONNAGE_RANGE.max}\r\n                  step={TONNAGE_RANGE.step}\r\n                  className={`w-20 ${cs.input.base} text-center ${cs.input.noSpinners}`}\r\n                />\r\n                <button\r\n                  onClick={() => handleTonnageChange(tonnage + TONNAGE_RANGE.step)}\r\n                  disabled={readOnly || tonnage >= TONNAGE_RANGE.max}\r\n                  className={cs.button.stepperMd}\r\n                >\r\n                  +\r\n                </button>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Engine Type */}\r\n            <div className={cs.layout.field}>\r\n              <div className={cs.layout.rowBetween}>\r\n                <label className={cs.text.label}>Engine</label>\r\n                <span className={cs.text.secondary}>{calculations.engineWeight}t / {calculations.engineSlots} slots</span>\r\n              </div>\r\n              <select \r\n                className={cs.select.compact}\r\n                disabled={readOnly}\r\n                value={engineType}\r\n                onChange={handleEngineTypeChange}\r\n              >\r\n                {filteredOptions.engines.map((engine) => (\r\n                  <option key={engine.type} value={engine.type}>\r\n                    {engine.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            \r\n            {/* Gyro */}\r\n            <div className={cs.layout.field}>\r\n              <div className={cs.layout.rowBetween}>\r\n                <label className={cs.text.label}>Gyro</label>\r\n                <span className={cs.text.secondary}>{calculations.gyroWeight}t / {calculations.gyroSlots} slots</span>\r\n              </div>\r\n              <select \r\n                className={cs.select.compact}\r\n                disabled={readOnly}\r\n                value={gyroType}\r\n                onChange={handleGyroTypeChange}\r\n              >\r\n                {filteredOptions.gyros.map((gyro) => (\r\n                  <option key={gyro.type} value={gyro.type}>\r\n                    {gyro.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            \r\n            {/* Internal Structure */}\r\n            <div className={cs.layout.field}>\r\n              <div className={cs.layout.rowBetween}>\r\n                <label className={cs.text.label}>Structure</label>\r\n                <span className={cs.text.secondary}>{calculations.structureWeight}t / {calculations.structureSlots} slots</span>\r\n              </div>\r\n              <select \r\n                className={cs.select.compact}\r\n                disabled={readOnly}\r\n                value={internalStructureType}\r\n                onChange={handleStructureTypeChange}\r\n              >\r\n                {filteredOptions.structures.map((structure) => (\r\n                  <option key={structure.type} value={structure.type}>\r\n                    {structure.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            \r\n            {/* Cockpit */}\r\n            <div className={cs.layout.field}>\r\n              <div className={cs.layout.rowBetween}>\r\n                <label className={cs.text.label}>Cockpit</label>\r\n                <span className={cs.text.secondary}>{calculations.cockpitWeight}t / {calculations.cockpitSlots} slots</span>\r\n              </div>\r\n              <select \r\n                className={cs.select.compact}\r\n                disabled={readOnly}\r\n                value={cockpitType}\r\n                onChange={handleCockpitTypeChange}\r\n              >\r\n                {filteredOptions.cockpits.map((cockpit) => (\r\n                  <option key={cockpit.type} value={cockpit.type}>\r\n                    {cockpit.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            \r\n            {/* Engine Rating (derived info) */}\r\n            <div className={cs.layout.divider}>\r\n              <div className={cs.layout.rowBetween}>\r\n                <span className={`text-sm ${cs.text.label}`}>Engine Rating</span>\r\n                <span className={`text-sm ${isAtMaxEngineRating ? 'text-amber-400 font-bold' : cs.text.valueHighlight}`}>\r\n                  {engineRating}{isAtMaxEngineRating && ' (MAX)'}\r\n                </span>\r\n              </div>\r\n              {isAtMaxEngineRating && (\r\n                <p className=\"text-xs text-amber-400 mt-1\">\r\n                   Maximum engine rating of {MAX_ENGINE_RATING} reached. Cannot increase Walk MP further.\r\n                </p>\r\n              )}\r\n            </div>\r\n            \r\n            {/* Heat Sinks Subsection */}\r\n            <div className={`${cs.layout.divider} mt-2`}>\r\n              <div className={cs.layout.rowBetween}>\r\n                <h4 className=\"text-sm font-semibold text-slate-300\">Heat Sinks</h4>\r\n                <span className={cs.text.secondary}>\r\n                  {calculations.heatSinkWeight}t / {calculations.heatSinkSlots} slots\r\n                </span>\r\n              </div>\r\n              \r\n              {/* Type + Count on same line */}\r\n              <div className=\"flex items-center gap-3 mt-2\">\r\n                <select \r\n                  className={`${cs.select.compact} flex-1`}\r\n                  disabled={readOnly}\r\n                  value={heatSinkType}\r\n                  onChange={handleHeatSinkTypeChange}\r\n                >\r\n                  {filteredOptions.heatSinks.map((hs) => (\r\n                    <option key={hs.type} value={hs.type}>\r\n                      {hs.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <div className=\"flex items-center\">\r\n                  <button\r\n                    onClick={() => handleHeatSinkCountChange(heatSinkCount - 1)}\r\n                    disabled={readOnly || heatSinkCount <= 10}\r\n                    className={cs.button.stepperLeft}\r\n                  >\r\n                    \r\n                  </button>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={heatSinkCount}\r\n                    onChange={(e) => handleHeatSinkCountChange(parseInt(e.target.value, 10) || 10)}\r\n                    disabled={readOnly}\r\n                    min={10}\r\n                    className={`w-12 ${cs.input.number} border-y ${cs.input.noSpinners}`}\r\n                  />\r\n                  <button\r\n                    onClick={() => handleHeatSinkCountChange(heatSinkCount + 1)}\r\n                    disabled={readOnly}\r\n                    className={cs.button.stepperRight}\r\n                  >\r\n                    +\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Heat Sink Summary */}\r\n              <div className=\"mt-3 grid grid-cols-3 gap-2 text-center\">\r\n                <div className=\"bg-slate-900/50 rounded p-2\">\r\n                  <div className={`text-lg font-bold ${cs.text.valuePositive}`}>{calculations.integralHeatSinks}</div>\r\n                  <div className=\"text-[10px] text-slate-500\">Free</div>\r\n                </div>\r\n                <div className=\"bg-slate-900/50 rounded p-2\">\r\n                  <div className={`text-lg font-bold ${calculations.externalHeatSinks > 0 ? cs.text.valueWarning : cs.text.value}`}>\r\n                    {calculations.externalHeatSinks}\r\n                  </div>\r\n                  <div className=\"text-[10px] text-slate-500\">External</div>\r\n                </div>\r\n                <div className=\"bg-slate-900/50 rounded p-2\">\r\n                  <div className={`text-lg font-bold ${cs.text.valueHighlight}`}>{calculations.totalHeatDissipation}</div>\r\n                  <div className=\"text-[10px] text-slate-500\">Dissipation</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* RIGHT: Movement */}\r\n        <div className={cs.panel.main}>\r\n          <h3 className={cs.text.sectionTitle}>Movement</h3>\r\n          \r\n          <div className={cs.layout.formStack}>\r\n            {/* Column Headers */}\r\n            <div className=\"grid grid-cols-[140px_112px_1fr] gap-2 items-center\">\r\n              <span></span>\r\n              <span className={`${cs.text.secondary} text-center uppercase`}>Base</span>\r\n              <span className={`${cs.text.secondary} text-center uppercase`}>Final</span>\r\n            </div>\r\n            \r\n            {/* Walk MP */}\r\n            <div className=\"grid grid-cols-[140px_112px_1fr] gap-2 items-center\">\r\n              <label className={cs.text.label}>Walk MP</label>\r\n              <div className=\"flex items-center justify-center\">\r\n                <button\r\n                  onClick={() => handleWalkMPChange(walkMP - 1)}\r\n                  disabled={readOnly || walkMP <= walkMPRange.min}\r\n                  className={cs.button.stepperLeft}\r\n                >\r\n                  \r\n                </button>\r\n                <input\r\n                  type=\"number\"\r\n                  value={walkMP}\r\n                  onChange={(e) => handleWalkMPChange(parseInt(e.target.value, 10) || walkMPRange.min)}\r\n                  disabled={readOnly}\r\n                  min={walkMPRange.min}\r\n                  max={walkMPRange.max}\r\n                  className={`w-12 ${cs.input.number} border-y ${cs.input.noSpinners}`}\r\n                />\r\n                <button\r\n                  onClick={() => handleWalkMPChange(walkMP + 1)}\r\n                  disabled={readOnly || walkMP >= walkMPRange.max}\r\n                  className={cs.button.stepperRight}\r\n                >\r\n                  +\r\n                </button>\r\n              </div>\r\n              <span className={`text-sm ${cs.text.value} text-center`}>{walkMP}</span>\r\n            </div>\r\n            \r\n            {/* Run MP (calculated) - no stepper, just centered value */}\r\n            <div className=\"grid grid-cols-[140px_112px_1fr] gap-2 items-center\">\r\n              <label className={cs.text.label}>Run MP</label>\r\n              <span className={`text-sm ${cs.text.value} text-center`}>{runMP}</span>\r\n              <div className=\"flex items-center justify-center gap-1\">\r\n                <span className={`text-sm ${cs.text.value}`}>{runMP}</span>\r\n                {maxRunMP && (\r\n                  <span \r\n                    className=\"text-sm font-bold text-white cursor-help\"\r\n                    title={\r\n                      enhancement === MovementEnhancementType.MASC \r\n                        ? `MASC Sprint: Walk ${walkMP}  2 = ${maxRunMP}`\r\n                        : enhancement === MovementEnhancementType.TSM\r\n                        ? `TSM at 9+ heat: Base Run ${runMP} + 1 = ${maxRunMP} (net +1 from +2 Walk, -1 heat penalty)`\r\n                        : enhancement === MovementEnhancementType.SUPERCHARGER\r\n                        ? `Supercharger Sprint: Walk ${walkMP}  2 = ${maxRunMP}`\r\n                        : `Enhanced max: ${maxRunMP}`\r\n                    }\r\n                  >\r\n                    [{maxRunMP}]\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Jump/UMU MP */}\r\n            <div className=\"grid grid-cols-[140px_112px_1fr] gap-2 items-center\">\r\n              <label className={cs.text.label}>Jump MP</label>\r\n              <div className=\"flex items-center justify-center\">\r\n                <button\r\n                  onClick={() => handleJumpMPChange(jumpMP - 1)}\r\n                  disabled={readOnly || jumpMP <= 0}\r\n                  className={cs.button.stepperLeft}\r\n                >\r\n                  \r\n                </button>\r\n                <input\r\n                  type=\"number\"\r\n                  value={jumpMP}\r\n                  onChange={(e) => handleJumpMPChange(parseInt(e.target.value, 10) || 0)}\r\n                  disabled={readOnly}\r\n                  min={0}\r\n                  max={maxJumpMP}\r\n                  className={`w-12 ${cs.input.number} border-y ${cs.input.noSpinners}`}\r\n                />\r\n                <button\r\n                  onClick={() => handleJumpMPChange(jumpMP + 1)}\r\n                  disabled={readOnly || jumpMP >= maxJumpMP}\r\n                  className={cs.button.stepperRight}\r\n                >\r\n                  +\r\n                </button>\r\n              </div>\r\n              <span className={`text-sm ${cs.text.value} text-center`}>{jumpMP}</span>\r\n            </div>\r\n            \r\n            {/* Jump Type */}\r\n            <div className=\"grid grid-cols-[140px_1fr] gap-2 items-center\">\r\n              <label className={cs.text.label}>Jump Type</label>\r\n              <select \r\n                className={cs.select.inline}\r\n                disabled={readOnly}\r\n                value={jumpJetType}\r\n                onChange={handleJumpJetTypeChange}\r\n              >\r\n                {JUMP_JET_DEFINITIONS.filter(def => def.type !== JumpJetType.MECHANICAL).map((def) => (\r\n                  <option key={def.type} value={def.type}>\r\n                    {def.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            \r\n            {/* Mech. J. Booster MP (placeholder) */}\r\n            <div className=\"grid grid-cols-[140px_112px_1fr] gap-2 items-center\">\r\n              <label className={cs.text.label}>Mech. J. Booster MP</label>\r\n              <div className=\"flex items-center justify-center\">\r\n                <input\r\n                  type=\"number\"\r\n                  value={0}\r\n                  disabled={true}\r\n                  className={`w-12 ${cs.input.compact} text-center opacity-50 ${cs.input.noSpinners}`}\r\n                />\r\n              </div>\r\n              <span></span>\r\n            </div>\r\n            \r\n            {/* Movement summary info */}\r\n            <div className={`${cs.layout.divider} mt-3`}>\r\n              <p className={cs.text.secondary}>\r\n                Walk MP range: {walkMPRange.min}{walkMPRange.max} (for {tonnage}t mech, max engine {MAX_ENGINE_RATING})\r\n              </p>\r\n              <p className={cs.text.secondary}>Max Jump MP: {maxJumpMP} ({jumpJetType === JumpJetType.IMPROVED ? 'run speed' : 'walk speed'})</p>\r\n              {jumpMP > 0 && (\r\n                <p className={cs.text.secondary}>Jump Jets: {calculations.jumpJetWeight}t / {calculations.jumpJetSlots} slots</p>\r\n              )}\r\n            </div>\r\n            \r\n            {/* Enhancement Subsection */}\r\n            <div className={`${cs.layout.divider} mt-2`}>\r\n              <h4 className=\"text-sm font-semibold text-slate-300 mb-3\">Enhancement</h4>\r\n              <div className=\"grid grid-cols-[140px_1fr] gap-2 items-center\">\r\n                <label className={cs.text.label}>Type</label>\r\n                <select \r\n                  className={cs.select.inline}\r\n                  disabled={readOnly}\r\n                  value={enhancement ?? ''}\r\n                  onChange={handleEnhancementChange}\r\n                >\r\n                  {enhancementOptions.map((opt) => (\r\n                    <option \r\n                      key={opt.value ?? 'none'} \r\n                      value={opt.value ?? ''}\r\n                    >\r\n                      {opt.label}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n              {enhancement && (\r\n                <p className={`${cs.text.secondary} mt-2`}>\r\n                  {enhancement === MovementEnhancementType.MASC && 'Sprint = Walk  2 when activated. Risk of leg damage on failed roll.'}\r\n                  {enhancement === MovementEnhancementType.TSM && (\r\n                    <>\r\n                      Activates at 9+ heat: +2 Walk MP, but -1 from heat penalty = net +1 MP.\r\n                      <br />\r\n                      <span className=\"text-amber-400\">Doubles physical attack damage.</span>\r\n                    </>\r\n                  )}\r\n                </p>\r\n              )}\r\n            </div>\r\n            \r\n            {/* Motive Type (Configuration) */}\r\n            <div className={`${cs.layout.divider} mt-2`}>\r\n              <div className=\"grid grid-cols-[140px_1fr] gap-2 items-center\">\r\n                <label className={cs.text.label}>Motive Type</label>\r\n                <select \r\n                  className={cs.select.inline}\r\n                  disabled={readOnly}\r\n                  value={configuration}\r\n                  onChange={handleConfigurationChange}\r\n                >\r\n                  {CONFIGURATION_OPTIONS.map((opt) => (\r\n                    <option key={opt.value} value={opt.value}>\r\n                      {opt.label}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\TabBar.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":43,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":43,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tab Bar Component\r\n * \r\n * Horizontal tab bar with tab management.\r\n * \r\n * @spec openspec/specs/multi-unit-tabs/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport { UnitTab as UnitTabComponent } from './UnitTab';\r\n\r\n/**\r\n * Minimal tab info needed for display in tab bar\r\n */\r\nexport interface TabDisplayInfo {\r\n  readonly id: string;\r\n  readonly name: string;\r\n  readonly isModified?: boolean;\r\n}\r\n\r\ninterface TabBarProps {\r\n  /** Array of tabs */\r\n  tabs: readonly TabDisplayInfo[];\r\n  /** Currently active tab ID */\r\n  activeTabId: string | null;\r\n  /** Called when a tab is selected */\r\n  onSelectTab: (tabId: string) => void;\r\n  /** Called when a tab is closed */\r\n  onCloseTab: (tabId: string) => void;\r\n  /** Called when a tab is renamed */\r\n  onRenameTab: (tabId: string, name: string) => void;\r\n  /** Called when new unit button is clicked */\r\n  onNewTab: () => void;\r\n  /** Called when load unit button is clicked */\r\n  onLoadUnit: () => void;\r\n  /** Additional CSS classes */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Horizontal tab bar component\r\n */\r\nexport function TabBar({\r\n  tabs,\r\n  activeTabId,\r\n  onSelectTab,\r\n  onCloseTab,\r\n  onRenameTab,\r\n  onNewTab,\r\n  onLoadUnit,\r\n  className = '',\r\n}: TabBarProps) {\r\n  return (\r\n    <div className={`flex items-center bg-slate-800 border-b border-slate-700 ${className}`}>\r\n      {/* Tab list */}\r\n      <div className=\"flex-1 flex items-center overflow-x-auto\">\r\n        {tabs.map((tab) => (\r\n          <UnitTabComponent\r\n            key={tab.id}\r\n            tab={tab}\r\n            isActive={tab.id === activeTabId}\r\n            canClose={true}\r\n            onSelect={() => onSelectTab(tab.id)}\r\n            onClose={() => onCloseTab(tab.id)}\r\n            onRename={(name) => onRenameTab(tab.id, name)}\r\n          />\r\n        ))}\r\n      </div>\r\n      \r\n      {/* Toolbar icons - MegaMekLab style */}\r\n      <div className=\"flex-shrink-0 flex items-center gap-1 px-2 border-l border-slate-700\">\r\n        {/* New Unit - Document icon */}\r\n        <button\r\n          onClick={onNewTab}\r\n          className=\"p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded transition-colors\"\r\n          title=\"Create New Unit (Ctrl+N)\"\r\n        >\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n          </svg>\r\n        </button>\r\n        \r\n        {/* Load Unit - Folder icon */}\r\n        <button\r\n          onClick={onLoadUnit}\r\n          className=\"p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded transition-colors\"\r\n          title=\"Load Unit from Library (Ctrl+O)\"\r\n        >\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\UnitTab.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":30,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":30,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Tab Component\r\n * \r\n * Individual tab with name, modification indicator, and close button.\r\n * \r\n * @spec openspec/specs/multi-unit-tabs/spec.md\r\n */\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { TabDisplayInfo } from './TabBar';\r\n\r\ninterface UnitTabProps {\r\n  /** Tab data */\r\n  tab: TabDisplayInfo;\r\n  /** Is this the active tab */\r\n  isActive: boolean;\r\n  /** Can this tab be closed */\r\n  canClose: boolean;\r\n  /** Called when tab is clicked */\r\n  onSelect: () => void;\r\n  /** Called when close button is clicked */\r\n  onClose: () => void;\r\n  /** Called when tab is renamed */\r\n  onRename: (name: string) => void;\r\n}\r\n\r\n/**\r\n * Individual unit tab component\r\n */\r\nexport function UnitTab({\r\n  tab,\r\n  isActive,\r\n  canClose,\r\n  onSelect,\r\n  onClose,\r\n  onRename,\r\n}: UnitTabProps) {\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [editName, setEditName] = useState(tab.name);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  \r\n  // Focus input when entering edit mode\r\n  useEffect(() => {\r\n    if (isEditing && inputRef.current) {\r\n      inputRef.current.focus();\r\n      inputRef.current.select();\r\n    }\r\n  }, [isEditing]);\r\n  \r\n  const handleDoubleClick = () => {\r\n    setEditName(tab.name);\r\n    setIsEditing(true);\r\n  };\r\n  \r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter') {\r\n      submitRename();\r\n    } else if (e.key === 'Escape') {\r\n      cancelRename();\r\n    }\r\n  };\r\n  \r\n  const submitRename = () => {\r\n    const trimmedName = editName.trim();\r\n    if (trimmedName && trimmedName !== tab.name) {\r\n      onRename(trimmedName);\r\n    }\r\n    setIsEditing(false);\r\n  };\r\n  \r\n  const cancelRename = () => {\r\n    setEditName(tab.name);\r\n    setIsEditing(false);\r\n  };\r\n  \r\n  const handleCloseClick = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    onClose();\r\n  };\r\n  \r\n  // Truncate long names\r\n  const displayName = tab.name.length > 48 ? tab.name.substring(0, 45) + '...' : tab.name;\r\n  \r\n  return (\r\n    <div\r\n      className={`\r\n        group flex items-center gap-2 px-3 py-2 min-w-[120px] max-w-[200px] cursor-pointer\r\n        border-b-2 transition-colors\r\n        ${isActive \r\n          ? 'bg-slate-700 text-slate-100 border-blue-500' \r\n          : 'bg-transparent text-slate-400 border-transparent hover:bg-slate-700/50 hover:text-slate-300'\r\n        }\r\n      `}\r\n      onClick={onSelect}\r\n      onDoubleClick={handleDoubleClick}\r\n    >\r\n      {/* Tab name or input */}\r\n      <div className=\"flex-1 min-w-0\">\r\n        {isEditing ? (\r\n          <input\r\n            ref={inputRef}\r\n            type=\"text\"\r\n            value={editName}\r\n            onChange={(e) => setEditName(e.target.value)}\r\n            onBlur={submitRename}\r\n            onKeyDown={handleKeyDown}\r\n            className=\"w-full bg-slate-600 text-white px-1 py-0.5 rounded text-sm outline-none focus:ring-1 focus:ring-blue-500\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          />\r\n        ) : (\r\n          <span className=\"block truncate text-sm\">{displayName}</span>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Modified indicator */}\r\n      {tab.isModified && !isEditing && (\r\n        <span className=\"flex-shrink-0 w-2 h-2 rounded-full bg-orange-500\" title=\"Unsaved changes\" />\r\n      )}\r\n      \r\n      {/* Close button - Chrome style */}\r\n      {canClose && !isEditing && (\r\n        <button\r\n          onClick={handleCloseClick}\r\n          className=\"flex-shrink-0 w-[18px] h-[18px] flex items-center justify-center rounded-full text-slate-400 hover:bg-slate-500 hover:text-white transition-all duration-100 text-xs leading-none\"\r\n          title=\"Close (Ctrl+W)\"\r\n        >\r\n          \r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\customizer\\tabs\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\ui\\Badge.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":62,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":62,"endColumn":22},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":82,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":82,"endColumn":30},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":93,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":93,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Badge Component\r\n * Reusable badge/tag component for displaying status, categories, tech bases, etc.\r\n */\r\nimport React from 'react';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { WeightClass } from '@/types/enums/WeightClass';\r\n\r\ntype BadgeVariant = \r\n  // Colors\r\n  | 'blue' \r\n  | 'emerald' \r\n  | 'purple' \r\n  | 'amber' \r\n  | 'orange' \r\n  | 'red' \r\n  | 'cyan' \r\n  | 'violet' \r\n  | 'yellow' \r\n  | 'slate'\r\n  // Semantic aliases\r\n  | 'muted'\r\n  | 'warning'\r\n  | 'success'\r\n  | 'info';\r\n\r\ntype BadgeSize = 'sm' | 'md' | 'lg';\r\n\r\ninterface BadgeProps {\r\n  children: React.ReactNode;\r\n  variant?: BadgeVariant;\r\n  size?: BadgeSize;\r\n  pill?: boolean;\r\n  className?: string;\r\n}\r\n\r\nconst variantClasses: Record<BadgeVariant, string> = {\r\n  // Colors\r\n  blue: 'bg-blue-600/20 text-blue-400 border-blue-600/30',\r\n  emerald: 'bg-emerald-600/20 text-emerald-400 border-emerald-600/30',\r\n  purple: 'bg-purple-600/20 text-purple-400 border-purple-600/30',\r\n  amber: 'bg-amber-600/20 text-amber-400 border-amber-600/30',\r\n  orange: 'bg-orange-600/20 text-orange-400 border-orange-600/30',\r\n  red: 'bg-red-600/20 text-red-400 border-red-600/30',\r\n  cyan: 'bg-cyan-600/20 text-cyan-400 border-cyan-600/30',\r\n  violet: 'bg-violet-600/20 text-violet-400 border-violet-600/30',\r\n  yellow: 'bg-yellow-600/20 text-yellow-400 border-yellow-600/30',\r\n  slate: 'bg-slate-600/20 text-slate-400 border-slate-600/30',\r\n  // Semantic aliases  \r\n  muted: 'bg-slate-600/50 text-slate-300 border-slate-500/30',\r\n  warning: 'bg-amber-600/20 text-amber-400 border-amber-600/30',\r\n  success: 'bg-emerald-600/20 text-emerald-400 border-emerald-600/30',\r\n  info: 'bg-blue-600/20 text-blue-400 border-blue-600/30',\r\n};\r\n\r\nconst sizeClasses: Record<BadgeSize, string> = {\r\n  sm: 'px-2 py-0.5 text-xs',\r\n  md: 'px-2 py-1 text-xs',\r\n  lg: 'px-3 py-1 text-sm',\r\n};\r\n\r\nexport function Badge({\r\n  children,\r\n  variant = 'slate',\r\n  size = 'md',\r\n  pill = false,\r\n  className = '',\r\n}: BadgeProps) {\r\n  const baseClasses = 'font-medium border inline-flex items-center whitespace-nowrap';\r\n  const shapeClasses = pill ? 'rounded-full' : 'rounded';\r\n\r\n  return (\r\n    <span\r\n      className={`${baseClasses} ${shapeClasses} ${sizeClasses[size]} ${variantClasses[variant]} ${className}`}\r\n    >\r\n      {children}\r\n    </span>\r\n  );\r\n}\r\n\r\n// Convenience exports for common badge types\r\nexport function TechBaseBadge({ techBase }: { techBase: TechBase }) {\r\n  const variant: BadgeVariant = techBase === TechBase.CLAN ? 'emerald' : 'blue';\r\n  const label = techBase === TechBase.CLAN ? 'Clan' : 'IS';\r\n\r\n  return (\r\n    <Badge variant={variant} size=\"sm\">\r\n      {label}\r\n    </Badge>\r\n  );\r\n}\r\n\r\nexport function WeightClassBadge({ weightClass }: { weightClass: WeightClass }) {\r\n  const getVariant = (): BadgeVariant => {\r\n    switch (weightClass) {\r\n      case WeightClass.LIGHT: return 'emerald';\r\n      case WeightClass.MEDIUM: return 'amber';\r\n      case WeightClass.HEAVY: return 'orange';\r\n      case WeightClass.ASSAULT: return 'red';\r\n      default: return 'slate';\r\n    }\r\n  };\r\n\r\n  const getLabel = (): string => {\r\n    switch (weightClass) {\r\n      case WeightClass.LIGHT: return 'Light';\r\n      case WeightClass.MEDIUM: return 'Medium';\r\n      case WeightClass.HEAVY: return 'Heavy';\r\n      case WeightClass.ASSAULT: return 'Assault';\r\n      default: return String(weightClass);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Badge variant={getVariant()} size=\"md\">\r\n      {getLabel()}\r\n    </Badge>\r\n  );\r\n}\r\n\r\nexport default Badge;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\ui\\Button.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":34,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":34,"endColumn":23},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":74,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":74,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Button Component\n * Reusable button component with multiple variants and states.\n */\nimport React from 'react';\n\ntype ButtonVariant = 'primary' | 'secondary' | 'ghost' | 'pagination' | 'danger' | 'success';\ntype ButtonSize = 'sm' | 'md' | 'lg';\n\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: ButtonVariant;\n  size?: ButtonSize;\n  isLoading?: boolean;\n  leftIcon?: React.ReactNode;\n  rightIcon?: React.ReactNode;\n  fullWidth?: boolean;\n}\n\nconst variantClasses: Record<ButtonVariant, string> = {\n  primary: 'bg-amber-600 hover:bg-amber-500 text-white border-transparent',\n  secondary: 'bg-slate-700 hover:bg-slate-600 border border-slate-600 text-slate-300',\n  ghost: 'bg-transparent hover:bg-slate-700/50 text-slate-400 hover:text-white border-transparent',\n  pagination: 'bg-slate-800 border border-slate-700 text-slate-400 hover:text-white hover:border-slate-600',\n  danger: 'bg-red-600 hover:bg-red-500 text-white border-transparent',\n  success: 'bg-emerald-600 hover:bg-emerald-500 text-white border-transparent',\n};\n\nconst sizeClasses: Record<ButtonSize, string> = {\n  sm: 'px-3 py-1.5 text-sm',\n  md: 'px-4 py-2 text-sm',\n  lg: 'px-6 py-3 text-base',\n};\n\nexport function Button({\n  children,\n  variant = 'secondary',\n  size = 'md',\n  isLoading = false,\n  leftIcon,\n  rightIcon,\n  disabled,\n  fullWidth = false,\n  className = '',\n  ...props\n}: ButtonProps) {\n  const baseClasses = 'rounded-lg font-medium transition-colors inline-flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed';\n  const widthClass = fullWidth ? 'w-full' : '';\n\n  return (\n    <button\n      className={`${baseClasses} ${sizeClasses[size]} ${variantClasses[variant]} ${widthClass} ${className}`}\n      disabled={disabled || isLoading}\n      {...props}\n    >\n      {isLoading ? (\n        <svg className=\"animate-spin h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n          <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n          <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n        </svg>\n      ) : leftIcon}\n      {children}\n      {!isLoading && rightIcon}\n    </button>\n  );\n}\n\n// Pagination button group helper\ninterface PaginationButtonsProps {\n  currentPage: number;\n  totalPages: number;\n  onPageChange: (page: number) => void;\n}\n\nexport function PaginationButtons({ currentPage, totalPages, onPageChange }: PaginationButtonsProps) {\n  if (totalPages <= 1) return null;\n\n  return (\n    <div className=\"flex items-center justify-center gap-2\">\n      <Button\n        variant=\"pagination\"\n        onClick={() => onPageChange(1)}\n        disabled={currentPage === 1}\n      >\n        First\n      </Button>\n      <Button\n        variant=\"pagination\"\n        onClick={() => onPageChange(Math.max(1, currentPage - 1))}\n        disabled={currentPage === 1}\n      >\n        Prev\n      </Button>\n      <span className=\"px-4 py-2 text-slate-400\">\n        Page {currentPage} of {totalPages}\n      </span>\n      <Button\n        variant=\"pagination\"\n        onClick={() => onPageChange(Math.min(totalPages, currentPage + 1))}\n        disabled={currentPage === totalPages}\n      >\n        Next\n      </Button>\n      <Button\n        variant=\"pagination\"\n        onClick={() => onPageChange(totalPages)}\n        disabled={currentPage === totalPages}\n      >\n        Last\n      </Button>\n    </div>\n  );\n}\n\nexport default Button;\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\ui\\Card.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":25,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":25,"endColumn":21},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":62,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":62,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card Component\n * Reusable card container with multiple variants.\n */\nimport React from 'react';\n\ntype CardVariant = 'default' | 'dark' | 'header' | 'interactive' | 'gradient';\n\ninterface CardProps {\n  children: React.ReactNode;\n  variant?: CardVariant;\n  className?: string;\n  onClick?: () => void;\n  as?: 'div' | 'section' | 'article';\n}\n\nconst variantClasses: Record<CardVariant, string> = {\n  default: 'bg-slate-800/50 border border-slate-700 rounded-xl p-6',\n  dark: 'bg-slate-800/30 border border-slate-700 rounded-xl p-6',\n  header: 'bg-slate-800/50 border border-slate-700 rounded-xl p-6',\n  interactive: 'bg-slate-800/30 border border-slate-700 rounded-xl p-4 hover:border-slate-600 hover:bg-slate-800/50 transition-all cursor-pointer',\n  gradient: 'bg-slate-800/40 backdrop-blur border border-slate-700/50 rounded-2xl p-6 transition-all duration-300 hover:border-slate-600 hover:bg-slate-800/60 hover:shadow-xl hover:shadow-amber-900/10',\n};\n\nexport function Card({\n  children,\n  variant = 'default',\n  className = '',\n  onClick,\n  as: Component = 'div',\n}: CardProps) {\n  return (\n    <Component\n      className={`${variantClasses[variant]} ${className}`}\n      onClick={onClick}\n    >\n      {children}\n    </Component>\n  );\n}\n\n// Card section title - can be used standalone or with children\ninterface CardSectionProps {\n  children?: React.ReactNode;\n  title: string;\n  titleColor?: 'white' | 'amber' | 'cyan' | 'rose' | 'emerald' | 'violet';\n  icon?: React.ReactNode;\n  className?: string;\n  /** If true, renders as a standalone card. Otherwise just renders title + children inline */\n  asCard?: boolean;\n}\n\nconst titleColorClasses: Record<string, string> = {\n  white: 'text-white',\n  amber: 'text-amber-400',\n  cyan: 'text-cyan-400',\n  rose: 'text-rose-400',\n  emerald: 'text-emerald-400',\n  violet: 'text-violet-400',\n};\n\nexport function CardSection({\n  children,\n  title,\n  titleColor = 'white',\n  icon,\n  className = '',\n  asCard = false,\n}: CardSectionProps) {\n  const content = (\n    <>\n      <h3 className={`text-lg font-semibold ${children ? 'mb-4' : ''} flex items-center gap-2 ${titleColorClasses[titleColor]}`}>\n        {icon}\n        {title}\n      </h3>\n      {children}\n    </>\n  );\n\n  if (asCard) {\n    return <Card className={className}>{content}</Card>;\n  }\n\n  return <div className={className}>{content}</div>;\n}\n\nexport default Card;\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\ui\\Input.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":29,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":29,"endColumn":22},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":68,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":68,"endColumn":23},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":108,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":108,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Input Component\n * Reusable input and select components for dark theme.\n */\nimport React from 'react';\n\ntype InputAccent = 'amber' | 'cyan' | 'emerald' | 'violet';\ntype InputVariant = 'default' | 'large';\n\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  accent?: InputAccent;\n  variant?: InputVariant;\n  label?: string;\n  error?: string;\n}\n\nconst accentFocusClasses: Record<InputAccent, string> = {\n  amber: 'focus:border-amber-500',\n  cyan: 'focus:border-cyan-500',\n  emerald: 'focus:border-emerald-500',\n  violet: 'focus:border-violet-500',\n};\n\nconst variantClasses: Record<InputVariant, string> = {\n  default: 'px-4 py-2 rounded-lg',\n  large: 'px-5 py-3 rounded-xl',\n};\n\nexport function Input({\n  accent = 'amber',\n  variant = 'default',\n  label,\n  error,\n  className = '',\n  id,\n  ...props\n}: InputProps) {\n  const inputId = id || props.name;\n  const baseClasses = 'w-full bg-slate-700/50 border border-slate-600 text-white placeholder-slate-400 focus:outline-none transition-colors';\n\n  return (\n    <div className=\"w-full\">\n      {label && (\n        <label htmlFor={inputId} className=\"block text-sm text-slate-400 mb-1\">\n          {label}\n        </label>\n      )}\n      <input\n        id={inputId}\n        className={`${baseClasses} ${variantClasses[variant]} ${accentFocusClasses[accent]} ${error ? 'border-red-500' : ''} ${className}`}\n        {...props}\n      />\n      {error && (\n        <p className=\"mt-1 text-sm text-red-400\">{error}</p>\n      )}\n    </div>\n  );\n}\n\n// Select component\ninterface SelectProps extends React.SelectHTMLAttributes<HTMLSelectElement> {\n  accent?: InputAccent;\n  label?: string;\n  options: Array<{ value: string; label: string }>;\n  placeholder?: string;\n}\n\nexport function Select({\n  accent = 'amber',\n  label,\n  options,\n  placeholder,\n  className = '',\n  id,\n  ...props\n}: SelectProps) {\n  const selectId = id || props.name;\n  const baseClasses = 'w-full bg-slate-700/50 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none transition-colors';\n\n  return (\n    <div className=\"w-full\">\n      {label && (\n        <label htmlFor={selectId} className=\"block text-sm text-slate-400 mb-1\">\n          {label}\n        </label>\n      )}\n      <select\n        id={selectId}\n        className={`${baseClasses} ${accentFocusClasses[accent]} ${className}`}\n        {...props}\n      >\n        {placeholder && <option value=\"\">{placeholder}</option>}\n        {options.map(opt => (\n          <option key={opt.value} value={opt.value}>\n            {opt.label}\n          </option>\n        ))}\n      </select>\n    </div>\n  );\n}\n\n// Search input with icon\ninterface SearchInputProps extends Omit<InputProps, 'type'> {\n  onClear?: () => void;\n}\n\nexport function SearchInput({\n  onClear,\n  value,\n  ...props\n}: SearchInputProps) {\n  return (\n    <div className=\"relative\">\n      <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5 text-slate-400\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\" />\n        </svg>\n      </div>\n      <Input\n        type=\"text\"\n        value={value}\n        className=\"pl-10 pr-10\"\n        {...props}\n      />\n      {value && onClear && (\n        <button\n          type=\"button\"\n          onClick={onClear}\n          className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white\"\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\n          </svg>\n        </button>\n      )}\n    </div>\n  );\n}\n\nexport default Input;\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\ui\\PageLayout.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":30,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":30,"endColumn":27},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":98,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":98,"endColumn":28},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":117,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":117,"endColumn":26},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":149,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":149,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * PageLayout Component\n * Consistent page layout wrapper with optional back navigation.\n */\nimport React from 'react';\nimport Link from 'next/link';\n\ninterface PageLayoutProps {\n  children: React.ReactNode;\n  title: string;\n  subtitle?: string;\n  maxWidth?: 'default' | 'narrow' | 'wide' | 'full';\n  /** Back link - can be object for Link or string href */\n  backLink?: string | { href: string; label: string };\n  /** Label for back link when backLink is a string */\n  backLabel?: string;\n  /** Callback for custom back navigation (e.g., state change instead of route) */\n  onBack?: () => void;\n  headerContent?: React.ReactNode;\n  gradient?: boolean;\n}\n\nconst maxWidthClasses: Record<string, string> = {\n  default: 'max-w-7xl',\n  narrow: 'max-w-5xl',\n  wide: 'max-w-screen-2xl',\n  full: 'max-w-full',\n};\n\nexport function PageLayout({\n  children,\n  title,\n  subtitle,\n  maxWidth = 'default',\n  backLink,\n  backLabel = 'Back',\n  onBack,\n  headerContent,\n  gradient = false,\n}: PageLayoutProps) {\n  const bgClasses = gradient\n    ? 'min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900'\n    : 'min-h-screen bg-slate-900';\n\n  // Normalize backLink\n  const normalizedBackLink = typeof backLink === 'string' \n    ? { href: backLink, label: backLabel }\n    : backLink;\n\n  const BackIcon = () => (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className=\"w-4 h-4 mr-2\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18\" />\n    </svg>\n  );\n\n  return (\n    <div className={`${bgClasses} p-6`}>\n      <div className={`${maxWidthClasses[maxWidth]} mx-auto`}>\n        {/* Back navigation - button if onBack provided, Link otherwise */}\n        {(normalizedBackLink || onBack) && (\n          onBack ? (\n            <button\n              onClick={onBack}\n              className=\"inline-flex items-center text-slate-400 hover:text-amber-400 transition-colors mb-6\"\n            >\n              <BackIcon />\n              {normalizedBackLink?.label || backLabel}\n            </button>\n          ) : normalizedBackLink && (\n            <Link\n              href={normalizedBackLink.href}\n              className=\"inline-flex items-center text-slate-400 hover:text-amber-400 transition-colors mb-6\"\n            >\n              <BackIcon />\n              {normalizedBackLink.label}\n            </Link>\n          )\n        )}\n\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex flex-wrap items-start justify-between gap-4\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-white mb-2\">{title}</h1>\n              {subtitle && <p className=\"text-slate-400\">{subtitle}</p>}\n            </div>\n            {headerContent}\n          </div>\n        </div>\n\n        {children}\n      </div>\n    </div>\n  );\n}\n\n// Loading state component\nexport function PageLoading({ message = 'Loading...' }: { message?: string }) {\n  return (\n    <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\n      <div className=\"text-center\">\n        <div className=\"w-12 h-12 border-4 border-amber-400 border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n        <p className=\"text-slate-400\">{message}</p>\n      </div>\n    </div>\n  );\n}\n\n// Error state component\ninterface PageErrorProps {\n  title?: string;\n  message: string;\n  backLink?: string;\n  backLabel?: string;\n}\n\nexport function PageError({\n  title = 'Error',\n  message,\n  backLink,\n  backLabel = 'Go Back',\n}: PageErrorProps) {\n  return (\n    <div className=\"min-h-screen bg-slate-900 flex items-center justify-center p-8\">\n      <div className=\"bg-red-900/20 border border-red-600/30 rounded-xl p-8 max-w-md text-center\">\n        <h2 className=\"text-xl font-semibold text-red-400 mb-2\">{title}</h2>\n        <p className=\"text-slate-400 mb-6\">{message}</p>\n        {backLink && (\n          <Link\n            href={backLink}\n            className=\"inline-block bg-slate-700 hover:bg-slate-600 text-white px-6 py-2 rounded-lg transition-colors\"\n          >\n            {backLabel}\n          </Link>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Empty state component\ninterface EmptyStateProps {\n  icon?: React.ReactNode;\n  title: string;\n  message?: string;\n  action?: React.ReactNode;\n}\n\nexport function EmptyState({ icon, title, message, action }: EmptyStateProps) {\n  return (\n    <div className=\"bg-slate-700/30 rounded-lg p-8 text-center text-slate-400 border border-dashed border-slate-600\">\n      {icon && <div className=\"mb-3\">{icon}</div>}\n      <p className=\"font-medium\">{title}</p>\n      {message && <p className=\"text-sm mt-1\">{message}</p>}\n      {action && <div className=\"mt-4\">{action}</div>}\n    </div>\n  );\n}\n\nexport default PageLayout;\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\ui\\StatDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":25,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":25,"endColumn":24},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":50,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":50,"endColumn":25},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":75,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":75,"endColumn":25},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":100,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":100,"endColumn":25},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":129,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":129,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * StatDisplay Component\n * Reusable components for displaying key-value statistics.\n */\nimport React from 'react';\n\n// Single stat row\ninterface StatRowProps {\n  label: string;\n  value: React.ReactNode;\n  highlight?: boolean;\n  mono?: boolean;\n  valueColor?: 'white' | 'amber' | 'cyan' | 'emerald' | 'red' | 'orange';\n}\n\nconst valueColorClasses: Record<string, string> = {\n  white: 'text-white',\n  amber: 'text-amber-400',\n  cyan: 'text-cyan-400',\n  emerald: 'text-emerald-400',\n  red: 'text-red-400',\n  orange: 'text-orange-400',\n};\n\nexport function StatRow({\n  label,\n  value,\n  highlight = false,\n  mono = true,\n  valueColor = 'white',\n}: StatRowProps) {\n  const valueClasses = highlight\n    ? `${valueColorClasses[valueColor === 'white' ? 'emerald' : valueColor]} ${mono ? 'font-mono' : ''}`\n    : `${valueColorClasses[valueColor]} ${mono ? 'font-mono' : ''}`;\n\n  return (\n    <div className=\"flex justify-between items-center\">\n      <span className=\"text-slate-400\">{label}</span>\n      <span className={valueClasses}>{value}</span>\n    </div>\n  );\n}\n\n// Stat list container\ninterface StatListProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport function StatList({ children, className = '' }: StatListProps) {\n  return (\n    <div className={`space-y-2 ${className}`}>\n      {children}\n    </div>\n  );\n}\n\n// Section stat card (with title, icon, and children)\ninterface StatCardProps {\n  title: string;\n  icon?: React.ReactNode;\n  variant?: 'amber' | 'cyan' | 'emerald' | 'violet' | 'rose';\n  children: React.ReactNode;\n  className?: string;\n}\n\nconst titleVariantColors: Record<string, string> = {\n  amber: 'text-amber-400',\n  cyan: 'text-cyan-400',\n  emerald: 'text-emerald-400',\n  violet: 'text-violet-400',\n  rose: 'text-rose-400',\n};\n\nexport function StatCard({\n  title,\n  icon,\n  variant = 'amber',\n  children,\n  className = '',\n}: StatCardProps) {\n  return (\n    <div className={`bg-slate-800/30 border border-slate-700 rounded-xl p-6 ${className}`}>\n      <h3 className={`text-lg font-semibold mb-4 flex items-center gap-2 ${titleVariantColors[variant]}`}>\n        {icon}\n        {title}\n      </h3>\n      {children}\n    </div>\n  );\n}\n\n// Stats grid\ninterface StatGridProps {\n  children: React.ReactNode;\n  cols?: 2 | 3 | 4;\n  className?: string;\n}\n\nexport function StatGrid({ children, cols = 2, className = '' }: StatGridProps) {\n  const colClasses: Record<number, string> = {\n    2: 'grid-cols-1 md:grid-cols-2',\n    3: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',\n    4: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-4',\n  };\n\n  return (\n    <div className={`grid ${colClasses[cols]} gap-6 ${className}`}>\n      {children}\n    </div>\n  );\n}\n\n// Simple stat display card (for home page stats)\ninterface SimpleStatCardProps {\n  value: React.ReactNode;\n  label: string;\n  loading?: boolean;\n  valueColor?: 'amber' | 'cyan' | 'emerald' | 'violet';\n}\n\nconst simpleCardValueColors: Record<string, string> = {\n  amber: 'text-amber-400',\n  cyan: 'text-cyan-400',\n  emerald: 'text-emerald-400',\n  violet: 'text-violet-400',\n};\n\nexport function SimpleStatCard({\n  value,\n  label,\n  loading = false,\n  valueColor = 'amber',\n}: SimpleStatCardProps) {\n  return (\n    <div className=\"bg-slate-800/50 backdrop-blur border border-slate-700 rounded-xl p-6 text-center\">\n      <div className={`text-3xl font-bold mb-1 ${simpleCardValueColors[valueColor]}`}>\n        {loading ? (\n          <span className=\"inline-block w-16 h-8 bg-slate-700 rounded animate-pulse\" />\n        ) : (\n          value\n        )}\n      </div>\n      <div className=\"text-slate-400 text-sm uppercase tracking-wide\">{label}</div>\n    </div>\n  );\n}\n\nexport default StatRow;\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\components\\ui\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\hooks\\useCustomizerRouter.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":16,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customizer Router Hook\r\n * \r\n * Provides URL-based routing for the unit customizer.\r\n * Enables shareable URLs and direct navigation to specific units/tabs.\r\n * \r\n * URL Structure:\r\n * - /customizer - Main customizer (redirects to active unit or shows empty state)\r\n * - /customizer/[unitId] - Specific unit (defaults to structure tab)\r\n * - /customizer/[unitId]/[tabId] - Specific unit and tab\r\n * \r\n * @spec openspec/specs/customizer-tabs/spec.md\r\n */\r\n\r\nimport { useRouter } from 'next/router';\r\nimport { useCallback, useMemo, useEffect, useRef } from 'react';\r\nimport { isValidUnitId } from '@/utils/uuid';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\n/**\r\n * Valid customizer tab identifiers\r\n */\r\nexport type CustomizerTabId = \r\n  | 'overview'\r\n  | 'structure'\r\n  | 'armor'\r\n  | 'weapons'\r\n  | 'equipment'\r\n  | 'criticals'\r\n  | 'fluff';\r\n\r\n/**\r\n * All valid tab IDs for validation\r\n */\r\nexport const VALID_TAB_IDS: readonly CustomizerTabId[] = [\r\n  'overview',\r\n  'structure',\r\n  'armor',\r\n  'weapons',\r\n  'equipment',\r\n  'criticals',\r\n  'fluff',\r\n] as const;\r\n\r\n/**\r\n * Default tab when none specified\r\n */\r\nexport const DEFAULT_TAB: CustomizerTabId = 'structure';\r\n\r\n/**\r\n * Parsed route parameters\r\n */\r\nexport interface CustomizerRouteParams {\r\n  /** Unit UUID from URL */\r\n  unitId: string | null;\r\n  /** Tab ID from URL */\r\n  tabId: CustomizerTabId;\r\n  /** Whether the route is valid */\r\n  isValid: boolean;\r\n  /** Whether we're on the index page (no unit specified) */\r\n  isIndex: boolean;\r\n}\r\n\r\n/**\r\n * Router actions for navigation\r\n */\r\nexport interface CustomizerRouterActions {\r\n  /** Navigate to a specific unit */\r\n  navigateToUnit: (unitId: string, tabId?: CustomizerTabId) => void;\r\n  /** Navigate to a specific tab (keeps current unit) */\r\n  navigateToTab: (tabId: CustomizerTabId) => void;\r\n  /** Navigate to the customizer index */\r\n  navigateToIndex: () => void;\r\n  /** Update URL without navigation (for syncing state) */\r\n  syncUrl: (unitId: string, tabId: CustomizerTabId) => void;\r\n}\r\n\r\n/**\r\n * Combined hook return type\r\n */\r\nexport interface CustomizerRouterResult extends CustomizerRouteParams, CustomizerRouterActions {}\r\n\r\n/**\r\n * Options for the customizer router hook\r\n */\r\nexport interface UseCustomizerRouterOptions {\r\n  /**\r\n   * Fallback unit ID to use when URL has no unit ID.\r\n   * Typically the active tab ID from the tab manager store.\r\n   * Enables tab navigation when on /customizer index page.\r\n   */\r\n  fallbackUnitId?: string | null;\r\n}\r\n\r\n// =============================================================================\r\n// Validation Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Check if a string is a valid tab ID\r\n */\r\nexport function isValidTabId(id: string): id is CustomizerTabId {\r\n  return VALID_TAB_IDS.includes(id as CustomizerTabId);\r\n}\r\n\r\n/**\r\n * Parse and validate tab ID from route\r\n */\r\nfunction parseTabId(rawTabId: string | string[] | undefined): CustomizerTabId {\r\n  if (!rawTabId) return DEFAULT_TAB;\r\n  \r\n  const tabId = Array.isArray(rawTabId) ? rawTabId[0] : rawTabId;\r\n  \r\n  if (isValidTabId(tabId)) {\r\n    return tabId;\r\n  }\r\n  \r\n  return DEFAULT_TAB;\r\n}\r\n\r\n/**\r\n * Parse and validate unit ID from route\r\n */\r\nfunction parseUnitId(rawUnitId: string | string[] | undefined): string | null {\r\n  if (!rawUnitId) return null;\r\n  \r\n  const unitId = Array.isArray(rawUnitId) ? rawUnitId[0] : rawUnitId;\r\n  \r\n  // Validate UUID format\r\n  if (isValidUnitId(unitId)) {\r\n    return unitId;\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n// =============================================================================\r\n// Hook Implementation\r\n// =============================================================================\r\n\r\n/**\r\n * Hook for managing customizer URL routing\r\n * \r\n * Usage:\r\n * ```tsx\r\n * // Basic usage\r\n * const { unitId, tabId, navigateToUnit, navigateToTab } = useCustomizerRouter();\r\n * \r\n * // With fallback for index page navigation\r\n * const { navigateToTab } = useCustomizerRouter({ fallbackUnitId: activeTabId });\r\n * \r\n * // Navigate to a specific unit\r\n * navigateToUnit('uuid-here', 'armor');\r\n * \r\n * // Change tabs (stays on current unit, or uses fallback)\r\n * navigateToTab('weapons');\r\n * ```\r\n */\r\nexport function useCustomizerRouter(\r\n  options: UseCustomizerRouterOptions = {}\r\n): CustomizerRouterResult {\r\n  const { fallbackUnitId } = options;\r\n  const router = useRouter();\r\n  const isNavigatingRef = useRef(false);\r\n  \r\n  // Parse route parameters\r\n  const params = useMemo((): CustomizerRouteParams => {\r\n    // Handle catch-all route: /customizer/[[...slug]]\r\n    const { slug } = router.query;\r\n    \r\n    if (!slug || !Array.isArray(slug) || slug.length === 0) {\r\n      // /customizer - index page\r\n      return {\r\n        unitId: null,\r\n        tabId: DEFAULT_TAB,\r\n        isValid: true,\r\n        isIndex: true,\r\n      };\r\n    }\r\n    \r\n    // /customizer/[unitId] or /customizer/[unitId]/[tabId]\r\n    const rawUnitId = slug[0];\r\n    const rawTabId = slug[1];\r\n    \r\n    const unitId = parseUnitId(rawUnitId);\r\n    const tabId = parseTabId(rawTabId);\r\n    \r\n    // Invalid unit ID in URL\r\n    if (!unitId) {\r\n      return {\r\n        unitId: null,\r\n        tabId: DEFAULT_TAB,\r\n        isValid: false,\r\n        isIndex: false,\r\n      };\r\n    }\r\n    \r\n    return {\r\n      unitId,\r\n      tabId,\r\n      isValid: true,\r\n      isIndex: false,\r\n    };\r\n  }, [router.query]);\r\n  \r\n  // ==========================================================================\r\n  // Navigation Actions\r\n  // ==========================================================================\r\n  \r\n  const navigateToUnit = useCallback((unitId: string, tabId: CustomizerTabId = DEFAULT_TAB) => {\r\n    if (!isValidUnitId(unitId)) {\r\n      console.warn('navigateToUnit: Invalid unit ID', unitId);\r\n      return;\r\n    }\r\n    \r\n    isNavigatingRef.current = true;\r\n    router.push(`/customizer/${unitId}/${tabId}`, undefined, { shallow: true });\r\n  }, [router]);\r\n  \r\n  const navigateToTab = useCallback((tabId: CustomizerTabId) => {\r\n    // Use URL unit ID first, then fallback to provided unit ID (e.g., active tab)\r\n    const effectiveUnitId = params.unitId || (fallbackUnitId && isValidUnitId(fallbackUnitId) ? fallbackUnitId : null);\r\n    \r\n    if (!effectiveUnitId) {\r\n      console.warn('navigateToTab: No current unit and no valid fallback');\r\n      return;\r\n    }\r\n    \r\n    if (!isValidTabId(tabId)) {\r\n      console.warn('navigateToTab: Invalid tab ID', tabId);\r\n      return;\r\n    }\r\n    \r\n    isNavigatingRef.current = true;\r\n    router.push(`/customizer/${effectiveUnitId}/${tabId}`, undefined, { shallow: true });\r\n  }, [router, params.unitId, fallbackUnitId]);\r\n  \r\n  const navigateToIndex = useCallback(() => {\r\n    isNavigatingRef.current = true;\r\n    router.push('/customizer', undefined, { shallow: true });\r\n  }, [router]);\r\n  \r\n  const syncUrl = useCallback((unitId: string, tabId: CustomizerTabId) => {\r\n    if (!isValidUnitId(unitId) || !isValidTabId(tabId)) {\r\n      return;\r\n    }\r\n    \r\n    // Only sync if the URL doesn't already match\r\n    if (params.unitId === unitId && params.tabId === tabId) {\r\n      return;\r\n    }\r\n    \r\n    isNavigatingRef.current = true;\r\n    router.replace(`/customizer/${unitId}/${tabId}`, undefined, { shallow: true });\r\n  }, [router, params.unitId, params.tabId]);\r\n  \r\n  return {\r\n    ...params,\r\n    navigateToUnit,\r\n    navigateToTab,\r\n    navigateToIndex,\r\n    syncUrl,\r\n  };\r\n}\r\n\r\n/**\r\n * Build a customizer URL for a unit\r\n */\r\nexport function buildCustomizerUrl(unitId: string, tabId?: CustomizerTabId): string {\r\n  if (tabId && isValidTabId(tabId)) {\r\n    return `/customizer/${unitId}/${tabId}`;\r\n  }\r\n  return `/customizer/${unitId}`;\r\n}\r\n\r\n/**\r\n * Build a shareable URL for the current origin\r\n */\r\nexport function buildShareableUrl(unitId: string, tabId?: CustomizerTabId): string {\r\n  if (typeof window === 'undefined') {\r\n    return buildCustomizerUrl(unitId, tabId);\r\n  }\r\n  return `${window.location.origin}${buildCustomizerUrl(unitId, tabId)}`;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\hooks\\useEquipmentBrowser.ts","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'equipment.length', 'isLoading', and 'loadEquipment'. Either include them or remove the dependency array.","line":158,"column":6,"nodeType":"ArrayExpression","endLine":158,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [equipment.length, isLoading, loadEquipment]","fix":{"range":[4771,4773],"text":"[equipment.length, isLoading, loadEquipment]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has unnecessary dependencies: 'equipment', 'filters.activeCategories', 'filters.category', 'filters.hideOneShot', 'filters.hidePrototype', 'filters.hideUnavailable', 'filters.search', 'filters.showAllCategories', 'filters.techBase', 'sort.column', 'sort.direction', 'unitTechBase', and 'unitYear'. Either exclude them or remove the dependency array.","line":179,"column":5,"nodeType":"ArrayExpression","endLine":195,"endColumn":6,"suggestions":[{"desc":"Update the dependencies array to be: [getFilteredEquipment]","fix":{"range":[5438,5874],"text":"[getFilteredEquipment]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has unnecessary dependencies: 'filteredEquipment', 'pagination.currentPage', and 'pagination.pageSize'. Either exclude them or remove the dependency array.","line":200,"column":5,"nodeType":"ArrayExpression","endLine":200,"endColumn":92,"suggestions":[{"desc":"Update the dependencies array to be: [getPaginatedEquipment]","fix":{"range":[6022,6109],"text":"[getPaginatedEquipment]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\hooks\\useEquipmentCalculations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\hooks\\useKeyboardNavigation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":9,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":42},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":43,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":43,"endColumn":41},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'getKey'. Either exclude it or remove the dependency array.","line":126,"column":6,"nodeType":"ArrayExpression","endLine":126,"endColumn":81,"suggestions":[{"desc":"Update the dependencies array to be: [items, currentIndex, onSelect, wrap, horizontal, columns, enabled]","fix":{"range":[3335,3410],"text":"[items, currentIndex, onSelect, wrap, horizontal, columns, enabled]"}}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":177,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":177,"endColumn":41},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":218,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":218,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Keyboard Navigation Hook\r\n * \r\n * Provides keyboard navigation support for lists and grids.\r\n * \r\n * @spec openspec/specs/confirmation-dialogs/spec.md\r\n */\r\n\r\nimport { useCallback, useEffect, useState } from 'react';\r\n\r\n/**\r\n * Navigation direction\r\n */\r\nexport type NavDirection = 'up' | 'down' | 'left' | 'right' | 'first' | 'last';\r\n\r\n/**\r\n * Keyboard navigation options\r\n */\r\nexport interface KeyboardNavOptions<T> {\r\n  /** Items to navigate */\r\n  items: readonly T[];\r\n  /** Current selected item */\r\n  selectedItem: T | null;\r\n  /** Called when selection changes */\r\n  onSelect: (item: T) => void;\r\n  /** Called when item is activated (Enter key) */\r\n  onActivate?: (item: T) => void;\r\n  /** Get unique key for item */\r\n  getKey: (item: T) => string;\r\n  /** Enable wrap-around navigation */\r\n  wrap?: boolean;\r\n  /** Enable horizontal navigation */\r\n  horizontal?: boolean;\r\n  /** Grid columns (for 2D navigation) */\r\n  columns?: number;\r\n  /** Is navigation enabled */\r\n  enabled?: boolean;\r\n}\r\n\r\n/**\r\n * Hook for keyboard navigation in lists and grids\r\n */\r\nexport function useKeyboardNavigation<T>({\r\n  items,\r\n  selectedItem,\r\n  onSelect,\r\n  onActivate,\r\n  getKey,\r\n  wrap = true,\r\n  horizontal = false,\r\n  columns,\r\n  enabled = true,\r\n}: KeyboardNavOptions<T>) {\r\n  // Find current index\r\n  const currentIndex = selectedItem \r\n    ? items.findIndex(item => getKey(item) === getKey(selectedItem))\r\n    : -1;\r\n\r\n  const navigate = useCallback((direction: NavDirection) => {\r\n    if (!enabled || items.length === 0) return;\r\n\r\n    let newIndex: number;\r\n\r\n    switch (direction) {\r\n      case 'first':\r\n        newIndex = 0;\r\n        break;\r\n      case 'last':\r\n        newIndex = items.length - 1;\r\n        break;\r\n      case 'up':\r\n        if (columns) {\r\n          // Grid navigation\r\n          newIndex = currentIndex - columns;\r\n          if (newIndex < 0) {\r\n            newIndex = wrap ? items.length + newIndex : currentIndex;\r\n          }\r\n        } else if (!horizontal) {\r\n          // List navigation\r\n          newIndex = currentIndex <= 0 \r\n            ? (wrap ? items.length - 1 : 0) \r\n            : currentIndex - 1;\r\n        } else {\r\n          return;\r\n        }\r\n        break;\r\n      case 'down':\r\n        if (columns) {\r\n          newIndex = currentIndex + columns;\r\n          if (newIndex >= items.length) {\r\n            newIndex = wrap ? newIndex % items.length : currentIndex;\r\n          }\r\n        } else if (!horizontal) {\r\n          newIndex = currentIndex >= items.length - 1 \r\n            ? (wrap ? 0 : items.length - 1) \r\n            : currentIndex + 1;\r\n        } else {\r\n          return;\r\n        }\r\n        break;\r\n      case 'left':\r\n        if (horizontal || columns) {\r\n          newIndex = currentIndex <= 0 \r\n            ? (wrap ? items.length - 1 : 0) \r\n            : currentIndex - 1;\r\n        } else {\r\n          return;\r\n        }\r\n        break;\r\n      case 'right':\r\n        if (horizontal || columns) {\r\n          newIndex = currentIndex >= items.length - 1 \r\n            ? (wrap ? 0 : items.length - 1) \r\n            : currentIndex + 1;\r\n        } else {\r\n          return;\r\n        }\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n\r\n    if (newIndex >= 0 && newIndex < items.length && newIndex !== currentIndex) {\r\n      onSelect(items[newIndex]);\r\n    }\r\n  }, [items, currentIndex, onSelect, wrap, horizontal, columns, enabled, getKey]);\r\n\r\n  // Handle keyboard events\r\n  const handleKeyDown = useCallback((e: KeyboardEvent) => {\r\n    if (!enabled) return;\r\n\r\n    switch (e.key) {\r\n      case 'ArrowUp':\r\n        e.preventDefault();\r\n        navigate('up');\r\n        break;\r\n      case 'ArrowDown':\r\n        e.preventDefault();\r\n        navigate('down');\r\n        break;\r\n      case 'ArrowLeft':\r\n        e.preventDefault();\r\n        navigate('left');\r\n        break;\r\n      case 'ArrowRight':\r\n        e.preventDefault();\r\n        navigate('right');\r\n        break;\r\n      case 'Home':\r\n        e.preventDefault();\r\n        navigate('first');\r\n        break;\r\n      case 'End':\r\n        e.preventDefault();\r\n        navigate('last');\r\n        break;\r\n      case 'Enter':\r\n      case ' ':\r\n        if (selectedItem && onActivate) {\r\n          e.preventDefault();\r\n          onActivate(selectedItem);\r\n        }\r\n        break;\r\n    }\r\n  }, [enabled, navigate, selectedItem, onActivate]);\r\n\r\n  return {\r\n    navigate,\r\n    handleKeyDown,\r\n    currentIndex,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook for tab keyboard navigation\r\n */\r\nexport function useTabKeyboardNavigation(\r\n  tabs: readonly { id: string }[],\r\n  activeTabId: string,\r\n  onTabChange: (tabId: string) => void\r\n) {\r\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\r\n    const currentIndex = tabs.findIndex(t => t.id === activeTabId);\r\n    if (currentIndex === -1) return;\r\n\r\n    let newIndex: number | null = null;\r\n\r\n    switch (e.key) {\r\n      case 'ArrowLeft':\r\n        e.preventDefault();\r\n        newIndex = currentIndex > 0 ? currentIndex - 1 : tabs.length - 1;\r\n        break;\r\n      case 'ArrowRight':\r\n        e.preventDefault();\r\n        newIndex = currentIndex < tabs.length - 1 ? currentIndex + 1 : 0;\r\n        break;\r\n      case 'Home':\r\n        e.preventDefault();\r\n        newIndex = 0;\r\n        break;\r\n      case 'End':\r\n        e.preventDefault();\r\n        newIndex = tabs.length - 1;\r\n        break;\r\n    }\r\n\r\n    if (newIndex !== null) {\r\n      onTabChange(tabs[newIndex].id);\r\n    }\r\n  }, [tabs, activeTabId, onTabChange]);\r\n\r\n  return handleKeyDown;\r\n}\r\n\r\n/**\r\n * Hook to focus an element when it becomes selected\r\n */\r\nexport function useFocusOnSelect(\r\n  ref: React.RefObject<HTMLElement>,\r\n  isSelected: boolean\r\n) {\r\n  useEffect(() => {\r\n    if (isSelected && ref.current) {\r\n      ref.current.focus();\r\n    }\r\n  }, [isSelected, ref]);\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\hooks\\useTechBaseSync.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isCompatibleWithTechBase' is defined but never used.","line":81,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tech Base Sync Hook\r\n * \r\n * Provides filtered component options based on tech base settings.\r\n * Handles validation and automatic selection replacement when tech base changes.\r\n * \r\n * @spec openspec/specs/component-configuration/spec.md\r\n */\r\n\r\nimport { useMemo, useCallback } from 'react';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { EngineType, ENGINE_DEFINITIONS, EngineDefinition } from '@/types/construction/EngineType';\r\nimport { GyroType, GYRO_DEFINITIONS, GyroDefinition } from '@/types/construction/GyroType';\r\nimport { InternalStructureType, INTERNAL_STRUCTURE_DEFINITIONS, InternalStructureDefinition } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType, COCKPIT_DEFINITIONS, CockpitDefinition } from '@/types/construction/CockpitType';\r\nimport { HeatSinkType, HEAT_SINK_DEFINITIONS, HeatSinkDefinition } from '@/types/construction/HeatSinkType';\r\nimport { ArmorTypeEnum, ARMOR_DEFINITIONS, ArmorDefinition } from '@/types/construction/ArmorType';\r\nimport { IComponentTechBases } from '@/types/construction/TechBaseConfiguration';\r\nimport { IComponentSelections } from '@/stores/useMultiUnitStore';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface FilteredComponentOptions {\r\n  engines: EngineDefinition[];\r\n  gyros: GyroDefinition[];\r\n  structures: InternalStructureDefinition[];\r\n  cockpits: CockpitDefinition[];\r\n  heatSinks: HeatSinkDefinition[];\r\n  armors: ArmorDefinition[];\r\n}\r\n\r\nexport interface ComponentDefaults {\r\n  engineType: EngineType;\r\n  gyroType: GyroType;\r\n  structureType: InternalStructureType;\r\n  cockpitType: CockpitType;\r\n  heatSinkType: HeatSinkType;\r\n  armorType: ArmorTypeEnum;\r\n}\r\n\r\nexport interface TechBaseSyncResult {\r\n  /** Filtered component options based on current tech base settings */\r\n  filteredOptions: FilteredComponentOptions;\r\n  \r\n  /** Default values for each component type (first valid option) */\r\n  defaults: ComponentDefaults;\r\n  \r\n  /** Check if a specific engine type is valid for current tech base */\r\n  isEngineValid: (engineType: EngineType) => boolean;\r\n  \r\n  /** Check if a specific gyro type is valid for current tech base */\r\n  isGyroValid: (gyroType: GyroType) => boolean;\r\n  \r\n  /** Check if a specific structure type is valid for current tech base */\r\n  isStructureValid: (structureType: InternalStructureType) => boolean;\r\n  \r\n  /** Check if a specific cockpit type is valid for current tech base */\r\n  isCockpitValid: (cockpitType: CockpitType) => boolean;\r\n  \r\n  /** Check if a specific heat sink type is valid for current tech base */\r\n  isHeatSinkValid: (heatSinkType: HeatSinkType) => boolean;\r\n  \r\n  /** Check if a specific armor type is valid for current tech base */\r\n  isArmorValid: (armorType: ArmorTypeEnum) => boolean;\r\n  \r\n  /** Get validated selections (replaces invalid selections with defaults) */\r\n  getValidatedSelections: (current: IComponentSelections) => IComponentSelections;\r\n}\r\n\r\n// =============================================================================\r\n// Helper Functions\r\n// =============================================================================\r\n\r\n/**\r\n * Check if a component is compatible with a given tech base\r\n * Components are compatible if they match the tech base OR are available to both\r\n * (Standard fusion is available to both, XL IS is IS-only, etc.)\r\n */\r\nfunction isCompatibleWithTechBase(\r\n  componentTechBase: TechBase,\r\n  requiredTechBase: TechBase\r\n): boolean {\r\n  // Standard components (marked as IS) are available to both\r\n  // This is a simplification - in reality, some IS components are IS-only\r\n  if (componentTechBase === requiredTechBase) {\r\n    return true;\r\n  }\r\n  \r\n  // Standard/basic components are available to both tech bases\r\n  // (They're marked as IS in the definitions but Clan can use them)\r\n  return false;\r\n}\r\n\r\n/**\r\n * Filter engine options by tech base\r\n * Standard Fusion is available to both\r\n * XL (IS) is IS-only, XL (Clan) is Clan-only\r\n */\r\nfunction filterEngines(techBase: TechBase): EngineDefinition[] {\r\n  return ENGINE_DEFINITIONS.filter(engine => {\r\n    // Standard fusion is available to both\r\n    if (engine.type === EngineType.STANDARD) return true;\r\n    if (engine.type === EngineType.COMPACT) return true;\r\n    \r\n    // Tech-base-specific engines\r\n    if (engine.type === EngineType.XL_IS) return techBase === TechBase.INNER_SPHERE;\r\n    if (engine.type === EngineType.XL_CLAN) return techBase === TechBase.CLAN;\r\n    if (engine.type === EngineType.LIGHT) return techBase === TechBase.INNER_SPHERE;\r\n    if (engine.type === EngineType.XXL) return true; // Available to both\r\n    \r\n    // Non-fusion engines (available to IS only typically)\r\n    return techBase === TechBase.INNER_SPHERE;\r\n  });\r\n}\r\n\r\n/**\r\n * Filter gyro options by tech base\r\n * All gyros are currently IS-based but available to both\r\n */\r\nfunction filterGyros(_techBase: TechBase): GyroDefinition[] {\r\n  // All gyro types are available to both tech bases\r\n  return [...GYRO_DEFINITIONS];\r\n}\r\n\r\n/**\r\n * Filter structure options by tech base\r\n * Standard is available to both\r\n * Endo Steel (IS) is IS-only, Endo Steel (Clan) is Clan-only\r\n */\r\nfunction filterStructures(techBase: TechBase): InternalStructureDefinition[] {\r\n  return INTERNAL_STRUCTURE_DEFINITIONS.filter(structure => {\r\n    if (structure.type === InternalStructureType.STANDARD) return true;\r\n    if (structure.type === InternalStructureType.ENDO_STEEL_IS) return techBase === TechBase.INNER_SPHERE;\r\n    if (structure.type === InternalStructureType.ENDO_STEEL_CLAN) return techBase === TechBase.CLAN;\r\n    // Other experimental types are IS-only\r\n    return techBase === TechBase.INNER_SPHERE;\r\n  });\r\n}\r\n\r\n/**\r\n * Filter cockpit options by tech base\r\n * All cockpits are currently IS-based but most are available to both\r\n */\r\nfunction filterCockpits(_techBase: TechBase): CockpitDefinition[] {\r\n  // All cockpit types are available to both tech bases\r\n  return [...COCKPIT_DEFINITIONS];\r\n}\r\n\r\n/**\r\n * Filter heat sink options by tech base\r\n * Single is available to both\r\n * Double (IS) is IS-only, Double (Clan) is Clan-only\r\n */\r\nfunction filterHeatSinks(techBase: TechBase): HeatSinkDefinition[] {\r\n  return HEAT_SINK_DEFINITIONS.filter(hs => {\r\n    if (hs.type === HeatSinkType.SINGLE) return true;\r\n    if (hs.type === HeatSinkType.DOUBLE_IS) return techBase === TechBase.INNER_SPHERE;\r\n    if (hs.type === HeatSinkType.DOUBLE_CLAN) return techBase === TechBase.CLAN;\r\n    if (hs.type === HeatSinkType.COMPACT) return techBase === TechBase.INNER_SPHERE;\r\n    if (hs.type === HeatSinkType.LASER) return techBase === TechBase.CLAN;\r\n    return false;\r\n  });\r\n}\r\n\r\n/**\r\n * Filter armor options by tech base\r\n * Standard is available to both\r\n * Ferro-Fibrous variants are tech-base-specific\r\n */\r\nfunction filterArmors(techBase: TechBase): ArmorDefinition[] {\r\n  return ARMOR_DEFINITIONS.filter(armor => {\r\n    if (armor.type === ArmorTypeEnum.STANDARD) return true;\r\n    if (armor.type === ArmorTypeEnum.FERRO_FIBROUS_IS) return techBase === TechBase.INNER_SPHERE;\r\n    if (armor.type === ArmorTypeEnum.FERRO_FIBROUS_CLAN) return techBase === TechBase.CLAN;\r\n    // Other experimental types are typically IS-only\r\n    return techBase === TechBase.INNER_SPHERE;\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Hook Implementation\r\n// =============================================================================\r\n\r\n/**\r\n * Hook for tech base synchronization and component filtering\r\n * \r\n * @param componentTechBases - Per-component tech base settings\r\n */\r\nexport function useTechBaseSync(componentTechBases: IComponentTechBases): TechBaseSyncResult {\r\n  // Filter options based on each component's tech base\r\n  const filteredOptions = useMemo<FilteredComponentOptions>(() => ({\r\n    engines: filterEngines(componentTechBases.engine),\r\n    gyros: filterGyros(componentTechBases.gyro),\r\n    structures: filterStructures(componentTechBases.chassis),\r\n    cockpits: filterCockpits(componentTechBases.chassis),\r\n    heatSinks: filterHeatSinks(componentTechBases.heatsink),\r\n    armors: filterArmors(componentTechBases.armor),\r\n  }), [componentTechBases]);\r\n  \r\n  // Calculate defaults (first valid option for each category)\r\n  const defaults = useMemo<ComponentDefaults>(() => ({\r\n    engineType: filteredOptions.engines[0]?.type ?? EngineType.STANDARD,\r\n    gyroType: filteredOptions.gyros[0]?.type ?? GyroType.STANDARD,\r\n    structureType: filteredOptions.structures[0]?.type ?? InternalStructureType.STANDARD,\r\n    cockpitType: filteredOptions.cockpits[0]?.type ?? CockpitType.STANDARD,\r\n    heatSinkType: filteredOptions.heatSinks[0]?.type ?? HeatSinkType.SINGLE,\r\n    armorType: filteredOptions.armors[0]?.type ?? ArmorTypeEnum.STANDARD,\r\n  }), [filteredOptions]);\r\n  \r\n  // Validation functions\r\n  const isEngineValid = useCallback((engineType: EngineType): boolean => {\r\n    return filteredOptions.engines.some(e => e.type === engineType);\r\n  }, [filteredOptions.engines]);\r\n  \r\n  const isGyroValid = useCallback((gyroType: GyroType): boolean => {\r\n    return filteredOptions.gyros.some(g => g.type === gyroType);\r\n  }, [filteredOptions.gyros]);\r\n  \r\n  const isStructureValid = useCallback((structureType: InternalStructureType): boolean => {\r\n    return filteredOptions.structures.some(s => s.type === structureType);\r\n  }, [filteredOptions.structures]);\r\n  \r\n  const isCockpitValid = useCallback((cockpitType: CockpitType): boolean => {\r\n    return filteredOptions.cockpits.some(c => c.type === cockpitType);\r\n  }, [filteredOptions.cockpits]);\r\n  \r\n  const isHeatSinkValid = useCallback((heatSinkType: HeatSinkType): boolean => {\r\n    return filteredOptions.heatSinks.some(h => h.type === heatSinkType);\r\n  }, [filteredOptions.heatSinks]);\r\n  \r\n  const isArmorValid = useCallback((armorType: ArmorTypeEnum): boolean => {\r\n    return filteredOptions.armors.some(a => a.type === armorType);\r\n  }, [filteredOptions.armors]);\r\n  \r\n  // Get validated selections\r\n  const getValidatedSelections = useCallback((current: IComponentSelections): IComponentSelections => {\r\n    return {\r\n      ...current,\r\n      engineType: isEngineValid(current.engineType) ? current.engineType : defaults.engineType,\r\n      gyroType: isGyroValid(current.gyroType) ? current.gyroType : defaults.gyroType,\r\n      internalStructureType: isStructureValid(current.internalStructureType) \r\n        ? current.internalStructureType \r\n        : defaults.structureType,\r\n      cockpitType: isCockpitValid(current.cockpitType) ? current.cockpitType : defaults.cockpitType,\r\n      heatSinkType: isHeatSinkValid(current.heatSinkType) ? current.heatSinkType : defaults.heatSinkType,\r\n      armorType: isArmorValid(current.armorType) ? current.armorType : defaults.armorType,\r\n    };\r\n  }, [\r\n    defaults,\r\n    isEngineValid,\r\n    isGyroValid,\r\n    isStructureValid,\r\n    isCockpitValid,\r\n    isHeatSinkValid,\r\n    isArmorValid,\r\n  ]);\r\n  \r\n  return {\r\n    filteredOptions,\r\n    defaults,\r\n    isEngineValid,\r\n    isGyroValid,\r\n    isStructureValid,\r\n    isCockpitValid,\r\n    isHeatSinkValid,\r\n    isArmorValid,\r\n    getValidatedSelections,\r\n  };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\hooks\\useTechBaseSyncEffect.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'COMPONENT_TECH_BASE_MAP' is assigned a value but never used.","line":51,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tech Base Sync Effect Hook\r\n * \r\n * Automatically updates component selections when their tech base changes.\r\n * This ensures that selections remain valid when switching between\r\n * Inner Sphere and Clan tech bases.\r\n * \r\n * @spec openspec/specs/component-configuration/spec.md\r\n */\r\n\r\nimport { useEffect, useRef } from 'react';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { IComponentTechBases, TechBaseComponent } from '@/types/construction/TechBaseConfiguration';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType } from '@/types/construction/CockpitType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\r\nimport { useTechBaseSync } from './useTechBaseSync';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface ComponentSelections {\r\n  engineType: EngineType;\r\n  gyroType: GyroType;\r\n  internalStructureType: InternalStructureType;\r\n  cockpitType: CockpitType;\r\n  heatSinkType: HeatSinkType;\r\n  armorType: ArmorTypeEnum;\r\n}\r\n\r\nexport interface ComponentSetters {\r\n  setEngineType: (type: EngineType) => void;\r\n  setGyroType: (type: GyroType) => void;\r\n  setInternalStructureType: (type: InternalStructureType) => void;\r\n  setCockpitType: (type: CockpitType) => void;\r\n  setHeatSinkType: (type: HeatSinkType) => void;\r\n  setArmorType: (type: ArmorTypeEnum) => void;\r\n}\r\n\r\n// =============================================================================\r\n// Component to TechBase Mapping\r\n// =============================================================================\r\n\r\n/**\r\n * Maps component types to their respective tech base category\r\n */\r\nconst COMPONENT_TECH_BASE_MAP: Record<keyof ComponentSelections, TechBaseComponent> = {\r\n  engineType: TechBaseComponent.ENGINE,\r\n  gyroType: TechBaseComponent.GYRO,\r\n  internalStructureType: TechBaseComponent.CHASSIS,\r\n  cockpitType: TechBaseComponent.CHASSIS,\r\n  heatSinkType: TechBaseComponent.HEATSINK,\r\n  armorType: TechBaseComponent.ARMOR,\r\n};\r\n\r\n// =============================================================================\r\n// Hook Implementation\r\n// =============================================================================\r\n\r\n/**\r\n * Hook that automatically syncs component selections when tech base changes.\r\n * \r\n * When a component's tech base changes (e.g., engine from IS to Clan),\r\n * this hook validates the current selection and updates it to a valid\r\n * default if necessary.\r\n * \r\n * @param componentTechBases - Current tech base settings for each component\r\n * @param selections - Current component selections\r\n * @param setters - Functions to update component selections\r\n * \r\n * @example\r\n * ```tsx\r\n * useTechBaseSyncEffect(\r\n *   componentTechBases,\r\n *   { engineType, gyroType, ... },\r\n *   { setEngineType, setGyroType, ... }\r\n * );\r\n * ```\r\n */\r\nexport function useTechBaseSyncEffect(\r\n  componentTechBases: IComponentTechBases,\r\n  selections: ComponentSelections,\r\n  setters: ComponentSetters\r\n): void {\r\n  // Get validation functions and defaults from useTechBaseSync\r\n  const {\r\n    defaults,\r\n    isEngineValid,\r\n    isGyroValid,\r\n    isStructureValid,\r\n    isCockpitValid,\r\n    isHeatSinkValid,\r\n    isArmorValid,\r\n  } = useTechBaseSync(componentTechBases);\r\n\r\n  // Track previous tech bases to detect changes\r\n  const prevTechBasesRef = useRef<IComponentTechBases>(componentTechBases);\r\n\r\n  // Effect to sync selections when tech base changes\r\n  useEffect(() => {\r\n    const prevTechBases = prevTechBasesRef.current;\r\n    let hasChanges = false;\r\n\r\n    // Check each component's tech base for changes\r\n    const techBaseKeys = Object.keys(componentTechBases) as TechBaseComponent[];\r\n    for (const key of techBaseKeys) {\r\n      if (prevTechBases[key] !== componentTechBases[key]) {\r\n        hasChanges = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    // If no tech base changed, skip validation\r\n    if (!hasChanges) {\r\n      return;\r\n    }\r\n\r\n    // Validate and update each component if needed\r\n    // Engine\r\n    if (prevTechBases.engine !== componentTechBases.engine) {\r\n      if (!isEngineValid(selections.engineType)) {\r\n        setters.setEngineType(defaults.engineType);\r\n      }\r\n    }\r\n\r\n    // Gyro\r\n    if (prevTechBases.gyro !== componentTechBases.gyro) {\r\n      if (!isGyroValid(selections.gyroType)) {\r\n        setters.setGyroType(defaults.gyroType);\r\n      }\r\n    }\r\n\r\n    // Structure (chassis affects both structure and cockpit)\r\n    if (prevTechBases.chassis !== componentTechBases.chassis) {\r\n      if (!isStructureValid(selections.internalStructureType)) {\r\n        setters.setInternalStructureType(defaults.structureType);\r\n      }\r\n      if (!isCockpitValid(selections.cockpitType)) {\r\n        setters.setCockpitType(defaults.cockpitType);\r\n      }\r\n    }\r\n\r\n    // Heat sinks\r\n    if (prevTechBases.heatsink !== componentTechBases.heatsink) {\r\n      if (!isHeatSinkValid(selections.heatSinkType)) {\r\n        setters.setHeatSinkType(defaults.heatSinkType);\r\n      }\r\n    }\r\n\r\n    // Armor\r\n    if (prevTechBases.armor !== componentTechBases.armor) {\r\n      if (!isArmorValid(selections.armorType)) {\r\n        setters.setArmorType(defaults.armorType);\r\n      }\r\n    }\r\n\r\n    // Update ref for next comparison\r\n    prevTechBasesRef.current = componentTechBases;\r\n  }, [\r\n    componentTechBases,\r\n    selections,\r\n    setters,\r\n    defaults,\r\n    isEngineValid,\r\n    isGyroValid,\r\n    isStructureValid,\r\n    isCockpitValid,\r\n    isHeatSinkValid,\r\n    isArmorValid,\r\n  ]);\r\n}\r\n\r\n/**\r\n * Simplified hook for syncing a single component type\r\n * \r\n * Use this when you only need to sync one specific component type.\r\n * \r\n * @param techBase - Current tech base for the component\r\n * @param currentValue - Current selection value\r\n * @param isValid - Validation function\r\n * @param defaultValue - Default value to use if current is invalid\r\n * @param setValue - Setter function\r\n */\r\nexport function useSingleComponentSync<T>(\r\n  techBase: TechBase,\r\n  currentValue: T,\r\n  isValid: (value: T) => boolean,\r\n  defaultValue: T,\r\n  setValue: (value: T) => void\r\n): void {\r\n  const prevTechBaseRef = useRef<TechBase>(techBase);\r\n\r\n  useEffect(() => {\r\n    // Only act when tech base changes\r\n    if (prevTechBaseRef.current !== techBase) {\r\n      prevTechBaseRef.current = techBase;\r\n      \r\n      // Validate and update if needed\r\n      if (!isValid(currentValue)) {\r\n        setValue(defaultValue);\r\n      }\r\n    }\r\n  }, [techBase, currentValue, isValid, defaultValue, setValue]);\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\hooks\\useUnit.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":156,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":156,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useUnit Hook\r\n * \r\n * Provides access to the currently active unit in the customizer.\r\n * Combines multi-unit store state with unit-specific data.\r\n * \r\n * @spec openspec/specs/multi-unit-tabs/spec.md\r\n */\r\n\r\nimport { useMemo, useCallback } from 'react';\r\nimport { useMultiUnitStore, UnitTab, UNIT_TEMPLATES } from '@/stores/useMultiUnitStore';\r\nimport { useCustomizerStore, EquipmentSelection } from '@/stores/useCustomizerStore';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { MechLocation } from '@/types/construction';\r\n\r\n/**\r\n * Unit context returned by the hook\r\n */\r\nexport interface UnitContext {\r\n  // Current unit tab\r\n  readonly tab: UnitTab | null;\r\n  readonly isLoading: boolean;\r\n  readonly hasUnsavedChanges: boolean;\r\n  \r\n  // All tabs\r\n  readonly allTabs: readonly UnitTab[];\r\n  readonly activeTabId: string | null;\r\n  \r\n  // Actions\r\n  readonly selectTab: (tabId: string) => void;\r\n  readonly createNewUnit: (tonnage: number, techBase?: TechBase) => string;\r\n  readonly duplicateCurrentUnit: () => string | null;\r\n  readonly closeTab: (tabId: string) => void;\r\n  readonly renameUnit: (name: string) => void;\r\n  readonly markModified: () => void;\r\n  readonly markSaved: () => void;\r\n  \r\n  // Modal state\r\n  readonly isNewTabModalOpen: boolean;\r\n  readonly openNewTabModal: () => void;\r\n  readonly closeNewTabModal: () => void;\r\n}\r\n\r\n/**\r\n * Selection context returned by the hook\r\n */\r\nexport interface SelectionContext {\r\n  readonly selectedEquipment: EquipmentSelection | null;\r\n  readonly selectedLocation: MechLocation | null;\r\n  readonly selectionMode: 'click' | 'drag';\r\n  \r\n  readonly selectEquipment: (equipment: EquipmentSelection | null) => void;\r\n  readonly selectLocation: (location: MechLocation | null) => void;\r\n  readonly clearSelection: () => void;\r\n}\r\n\r\n/**\r\n * Hook to access the current unit context\r\n */\r\nexport function useUnit(): UnitContext {\r\n  const {\r\n    tabs,\r\n    activeTabId,\r\n    isLoading,\r\n    selectTab,\r\n    createTab,\r\n    duplicateTab,\r\n    closeTab,\r\n    renameTab,\r\n    markModified,\r\n    isNewTabModalOpen,\r\n    openNewTabModal,\r\n    closeNewTabModal,\r\n  } = useMultiUnitStore();\r\n  \r\n  const activeTab = useMemo(\r\n    () => tabs.find(t => t.id === activeTabId) || null,\r\n    [tabs, activeTabId]\r\n  );\r\n  \r\n  const createNewUnit = useCallback((tonnage: number, techBase: TechBase = TechBase.INNER_SPHERE) => {\r\n    // Find matching template\r\n    const template = UNIT_TEMPLATES.find(t => t.tonnage === tonnage) || UNIT_TEMPLATES[1]; // Default to medium\r\n    const templateWithTechBase = { ...template, techBase };\r\n    return createTab(templateWithTechBase);\r\n  }, [createTab]);\r\n  \r\n  const duplicateCurrentUnit = useCallback(() => {\r\n    if (!activeTabId) return null;\r\n    return duplicateTab(activeTabId);\r\n  }, [activeTabId, duplicateTab]);\r\n  \r\n  const renameUnit = useCallback((name: string) => {\r\n    if (activeTabId) {\r\n      renameTab(activeTabId, name);\r\n    }\r\n  }, [activeTabId, renameTab]);\r\n  \r\n  const markModifiedCallback = useCallback(() => {\r\n    if (activeTabId) {\r\n      markModified(activeTabId, true);\r\n    }\r\n  }, [activeTabId, markModified]);\r\n  \r\n  const markSaved = useCallback(() => {\r\n    if (activeTabId) {\r\n      markModified(activeTabId, false);\r\n    }\r\n  }, [activeTabId, markModified]);\r\n  \r\n  return {\r\n    tab: activeTab,\r\n    isLoading,\r\n    hasUnsavedChanges: activeTab?.isModified ?? false,\r\n    allTabs: tabs,\r\n    activeTabId,\r\n    selectTab,\r\n    createNewUnit,\r\n    duplicateCurrentUnit,\r\n    closeTab,\r\n    renameUnit,\r\n    markModified: markModifiedCallback,\r\n    markSaved,\r\n    isNewTabModalOpen,\r\n    openNewTabModal,\r\n    closeNewTabModal,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook to access selection state (equipment and location selection)\r\n */\r\nexport function useSelection(): SelectionContext {\r\n  const {\r\n    selectedEquipment,\r\n    selectedLocation,\r\n    selectionMode,\r\n    selectEquipment,\r\n    selectLocation,\r\n    clearSelection,\r\n  } = useCustomizerStore();\r\n  \r\n  return {\r\n    selectedEquipment,\r\n    selectedLocation,\r\n    selectionMode,\r\n    selectEquipment,\r\n    selectLocation,\r\n    clearSelection,\r\n  };\r\n}\r\n\r\n/**\r\n * Combined hook for unit and selection context\r\n */\r\nexport function useUnitEditor() {\r\n  const unit = useUnit();\r\n  const selection = useSelection();\r\n  \r\n  return {\r\n    ...unit,\r\n    selection,\r\n  };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\hooks\\useUnitCalculations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\_app.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":7,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":7,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { AppProps } from 'next/app'\nimport { useState } from 'react'\nimport '../styles/globals.css'\nimport Layout from '../components/common/Layout'\nimport Sidebar from '../components/common/Sidebar'\n\nexport default function App({ Component, pageProps }: AppProps) {\n  const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false)\n\n  return (\n    <Layout\n      sidebarComponent={\n        <Sidebar\n          isCollapsed={isSidebarCollapsed}\n          setIsCollapsed={setIsSidebarCollapsed}\n        />\n      }\n      isSidebarCollapsed={isSidebarCollapsed}\n    >\n      <Component {...pageProps} />\n    </Layout>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\_document.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":3,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":3,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Html, Head, Main, NextScript } from 'next/document';\n\nexport default function Document() {\n  return (\n    <Html lang=\"en\">\n      <Head />\n      <body>\n        <Main />\n        <NextScript />\n      </body>\n    </Html>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\catalog.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":22,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":22,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Catalog API\n * \n * Main unit catalog endpoint for browsing and searching.\n * Returns the full unit index for client-side filtering.\n * \n * GET /api/catalog - Get full unit index\n * GET /api/catalog?search=<query> - Search units by name\n * \n * @spec openspec/specs/unit-services/spec.md\n */\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport { canonicalUnitService } from '@/services/units/CanonicalUnitService';\n\ninterface ApiResponse {\n  success: boolean;\n  data?: unknown;\n  error?: string;\n  count?: number;\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<ApiResponse>\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({\n      success: false,\n      error: 'Method not allowed. Use GET.',\n    });\n  }\n\n  try {\n    // Get the full unit index\n    const index = await canonicalUnitService.getIndex();\n\n    const { search } = req.query;\n\n    // If search query provided, filter by name\n    if (search && typeof search === 'string') {\n      const searchLower = search.toLowerCase();\n      const filtered = index.filter(unit => \n        unit.name.toLowerCase().includes(searchLower) ||\n        unit.chassis.toLowerCase().includes(searchLower) ||\n        unit.variant.toLowerCase().includes(searchLower)\n      );\n\n      return res.status(200).json({\n        success: true,\n        data: filtered,\n        count: filtered.length,\n      });\n    }\n\n    return res.status(200).json({\n      success: true,\n      data: index,\n      count: index.length,\n    });\n\n  } catch (error) {\n    console.error('Catalog API error:', error);\n    return res.status(500).json({\n      success: false,\n      error: error instanceof Error ? error.message : 'Internal server error',\n    });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\custom-variants.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":33,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":33,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Custom Variants API (DEPRECATED)\n * \n * @deprecated This endpoint is deprecated. Use /api/units/custom/* endpoints instead.\n * \n * The new API uses SQLite server-side storage for:\n * - Electron desktop apps (single-user)\n * - Self-hosted multi-user web apps\n * - Version history with revert capability\n * \n * New endpoints:\n * - GET/POST /api/units/custom - List and create units\n * - GET/PUT/DELETE /api/units/custom/[id] - Single unit operations\n * - GET /api/units/custom/[id]/versions - Version history\n * - POST /api/units/custom/[id]/revert/[version] - Revert to version\n * - GET /api/units/custom/[id]/export - Export as JSON\n * - POST /api/units/import - Import from JSON\n * \n * @spec openspec/specs/unit-services/spec.md\n */\nimport type { NextApiRequest, NextApiResponse } from 'next';\n\ninterface ApiResponse {\n  success: boolean;\n  deprecated: boolean;\n  message: string;\n  newApi: {\n    baseUrl: string;\n    endpoints: Record<string, string>;\n  };\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<ApiResponse>\n) {\n  // Return deprecation notice for any method\n  return res.status(410).json({\n    success: false,\n    deprecated: true,\n    message: 'This endpoint is deprecated. Please use /api/units/custom/* endpoints instead.',\n    newApi: {\n      baseUrl: '/api/units/custom',\n      endpoints: {\n        list: 'GET /api/units/custom',\n        create: 'POST /api/units/custom',\n        get: 'GET /api/units/custom/[id]',\n        update: 'PUT /api/units/custom/[id]',\n        delete: 'DELETE /api/units/custom/[id]',\n        versions: 'GET /api/units/custom/[id]/versions',\n        revert: 'POST /api/units/custom/[id]/revert/[version]',\n        export: 'GET /api/units/custom/[id]/export',\n        import: 'POST /api/units/import',\n      },\n    },\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\custom-variants\\[variantId].ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":17,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":17,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Custom Variant Detail API (DEPRECATED)\n * \n * @deprecated This endpoint is deprecated. Use /api/units/custom/[id] endpoints instead.\n * \n * @spec openspec/specs/unit-services/spec.md\n */\nimport type { NextApiRequest, NextApiResponse } from 'next';\n\ninterface ApiResponse {\n  success: boolean;\n  deprecated: boolean;\n  message: string;\n  redirect: string;\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<ApiResponse>\n) {\n  const { variantId } = req.query;\n  const id = typeof variantId === 'string' ? variantId : '';\n\n  // Return deprecation notice for any method\n  return res.status(410).json({\n    success: false,\n    deprecated: true,\n    message: 'This endpoint is deprecated. Please use /api/units/custom/[id] endpoints instead.',\n    redirect: `/api/units/custom/${id}`,\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\equipment.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":72,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":72,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment API\n * \n * Query and retrieve equipment data.\n * \n * GET /api/equipment - List/query equipment\n * GET /api/equipment?id=<id> - Get single equipment by ID\n * \n * Query Parameters:\n * - id: Get specific equipment by ID\n * - category: Filter by category (ENERGY_WEAPON, BALLISTIC_WEAPON, etc.)\n * - techBase: Filter by tech base (INNER_SPHERE, CLAN, BOTH)\n * - year: Filter by availability year\n * - search: Search by name\n * - rulesLevel: Filter by rules level\n * - maxWeight: Maximum weight in tons\n * - maxSlots: Maximum critical slots\n * \n * @spec openspec/specs/equipment-services/spec.md\n */\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport { equipmentLookupService } from '@/services/equipment/EquipmentLookupService';\nimport { IEquipmentQueryCriteria } from '@/services/common/types';\nimport { TechBase } from '@/types/enums/TechBase';\nimport { RulesLevel } from '@/types/enums/RulesLevel';\nimport { EquipmentCategory } from '@/types/equipment';\n\ninterface ApiResponse {\n  success: boolean;\n  data?: unknown;\n  error?: string;\n  count?: number;\n}\n\n/**\n * Type guard to validate EquipmentCategory enum value\n */\nfunction isValidEquipmentCategory(value: string): value is EquipmentCategory {\n  return Object.values(EquipmentCategory).includes(value as EquipmentCategory);\n}\n\n/**\n * Type guard to validate TechBase enum value\n */\nfunction isValidTechBase(value: string): value is TechBase {\n  return Object.values(TechBase).includes(value as TechBase);\n}\n\n/**\n * Type guard to validate RulesLevel enum value\n */\nfunction isValidRulesLevel(value: string): value is RulesLevel {\n  return Object.values(RulesLevel).includes(value as RulesLevel);\n}\n\n/**\n * Parse string to integer, returning undefined if invalid\n */\nfunction parseIntOrUndefined(value: string): number | undefined {\n  const parsed = parseInt(value, 10);\n  return isNaN(parsed) ? undefined : parsed;\n}\n\n/**\n * Parse string to float, returning undefined if invalid\n */\nfunction parseFloatOrUndefined(value: string): number | undefined {\n  const parsed = parseFloat(value);\n  return isNaN(parsed) ? undefined : parsed;\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<ApiResponse>\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({\n      success: false,\n      error: 'Method not allowed. Use GET.',\n    });\n  }\n\n  try {\n    const { \n      id, \n      category, \n      techBase, \n      year, \n      search, \n      rulesLevel,\n      maxWeight,\n      maxSlots \n    } = req.query;\n\n    // Get single equipment by ID\n    if (id && typeof id === 'string') {\n      const equipment = equipmentLookupService.getById(id);\n      \n      if (!equipment) {\n        return res.status(404).json({\n          success: false,\n          error: `Equipment not found: ${id}`,\n        });\n      }\n\n      return res.status(200).json({\n        success: true,\n        data: equipment,\n      });\n    }\n\n    // Build query criteria from query parameters using type-safe spread\n    const criteria: IEquipmentQueryCriteria = {\n      ...(typeof category === 'string' && isValidEquipmentCategory(category) && { category }),\n      ...(typeof techBase === 'string' && isValidTechBase(techBase) && { techBase }),\n      ...(typeof year === 'string' && { year: parseIntOrUndefined(year) }),\n      ...(typeof search === 'string' && { nameQuery: search }),\n      ...(typeof rulesLevel === 'string' && isValidRulesLevel(rulesLevel) && { rulesLevel }),\n      ...(typeof maxWeight === 'string' && { maxWeight: parseFloatOrUndefined(maxWeight) }),\n      ...(typeof maxSlots === 'string' && { maxSlots: parseIntOrUndefined(maxSlots) }),\n    };\n\n    // Query equipment\n    const equipment = equipmentLookupService.query(criteria);\n\n    return res.status(200).json({\n      success: true,\n      data: equipment,\n      count: equipment.length,\n    });\n\n  } catch (error) {\n    console.error('Equipment API error:', error);\n    return res.status(500).json({\n      success: false,\n      error: error instanceof Error ? error.message : 'Internal server error',\n    });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\equipment\\catalog.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":41,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":41,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment Catalog API\n * \n * Get all equipment organized by category.\n * \n * GET /api/equipment/catalog - Get all equipment\n * GET /api/equipment/catalog?type=weapons - Get only weapons\n * GET /api/equipment/catalog?type=ammunition - Get only ammunition\n * \n * @spec openspec/specs/equipment-services/spec.md\n */\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport { equipmentLookupService } from '@/services/equipment/EquipmentLookupService';\n\ninterface ApiResponse {\n  success: boolean;\n  data?: unknown;\n  error?: string;\n  count?: number;\n}\n\n/**\n * Interface for equipment items with name property\n */\ninterface INamedEquipment {\n  name: string;\n}\n\n/**\n * Type guard to check if an item has a name property\n */\nfunction hasNameProperty(item: unknown): item is INamedEquipment {\n  return (\n    typeof item === 'object' &&\n    item !== null &&\n    'name' in item &&\n    typeof (item as INamedEquipment).name === 'string'\n  );\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<ApiResponse>\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({\n      success: false,\n      error: 'Method not allowed. Use GET.',\n    });\n  }\n\n  try {\n    const { type, search } = req.query;\n\n    let data: unknown[];\n\n    // Filter by type if specified\n    if (type === 'weapons') {\n      data = equipmentLookupService.getAllWeapons();\n    } else if (type === 'ammunition') {\n      data = equipmentLookupService.getAllAmmunition();\n    } else {\n      data = equipmentLookupService.getAllEquipment();\n    }\n\n    // Apply search filter if provided\n    if (search && typeof search === 'string') {\n      const searchLower = search.toLowerCase();\n      data = data.filter((item: unknown) => {\n        if (hasNameProperty(item)) {\n          return item.name.toLowerCase().includes(searchLower);\n        }\n        return false;\n      });\n    }\n\n    return res.status(200).json({\n      success: true,\n      data,\n      count: data.length,\n    });\n\n  } catch (error) {\n    console.error('Equipment Catalog API error:', error);\n    return res.status(500).json({\n      success: false,\n      error: error instanceof Error ? error.message : 'Internal server error',\n    });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\equipment\\filters.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":37,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":37,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment Filters API\n * \n * Returns available filter options for the equipment browser.\n * \n * GET /api/equipment/filters - Get all available filter values\n * \n * @spec openspec/specs/equipment-services/spec.md\n */\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport { TechBase } from '@/types/enums/TechBase';\nimport { RulesLevel } from '@/types/enums/RulesLevel';\nimport { EquipmentCategory } from '@/types/equipment';\n\ninterface FilterOptions {\n  categories: Array<{ value: string; label: string }>;\n  techBases: Array<{ value: string; label: string }>;\n  rulesLevels: Array<{ value: string; label: string }>;\n}\n\ninterface ApiResponse {\n  success: boolean;\n  data?: FilterOptions;\n  error?: string;\n}\n\n/**\n * Format enum value to display label\n */\nfunction formatLabel(value: string): string {\n  return value\n    .split('_')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n    .join(' ');\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<ApiResponse>\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({\n      success: false,\n      error: 'Method not allowed. Use GET.',\n    });\n  }\n\n  try {\n    const filters: FilterOptions = {\n      categories: Object.values(EquipmentCategory).map(value => ({\n        value,\n        label: formatLabel(value),\n      })),\n      techBases: Object.values(TechBase).map(value => ({\n        value,\n        label: formatLabel(value),\n      })),\n      rulesLevels: Object.values(RulesLevel).map(value => ({\n        value,\n        label: formatLabel(value),\n      })),\n    };\n\n    return res.status(200).json({\n      success: true,\n      data: filters,\n    });\n\n  } catch (error) {\n    console.error('Equipment Filters API error:', error);\n    return res.status(500).json({\n      success: false,\n      error: error instanceof Error ? error.message : 'Internal server error',\n    });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\meta\\categories.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":26,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":26,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextApiRequest, NextApiResponse } from 'next';\n\n/**\n * Unit type categories - canonical list of unit types supported by the system.\n * These match the folder structure in megameklab data files.\n */\nconst UNIT_CATEGORIES = [\n  'meks',\n  'vehicles',\n  'infantry',\n  'battlearmor',\n  'ge',\n  'fighters',\n  'dropships',\n  'warship',\n  'protomeks',\n  'convfighter',\n  'smallcraft',\n  'spacestation',\n  'jumpships',\n  'handheld',\n] as const;\n\nexport type UnitCategory = typeof UNIT_CATEGORIES[number];\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ message: 'Method not allowed' });\n  }\n\n  try {\n    res.status(200).json(UNIT_CATEGORIES);\n  } catch (error) {\n    console.error('Error fetching unit categories:', error);\n    res.status(500).json({ message: 'Internal server error' });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\meta\\equipment_categories.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":4,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":4,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextApiRequest, NextApiResponse } from 'next';\nimport { EquipmentCategory } from '@/types/equipment';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ message: 'Method not allowed' });\n  }\n\n  try {\n    const categories = Object.values(EquipmentCategory);\n    res.status(200).json(categories);\n  } catch (error) {\n    console.error('Error fetching equipment categories:', error);\n    res.status(500).json({ message: 'Internal server error' });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\meta\\equipment_eras.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":4,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":4,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextApiRequest, NextApiResponse } from 'next';\nimport { ALL_ERAS } from '@/types/enums/Era';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ message: 'Method not allowed' });\n  }\n\n  try {\n    res.status(200).json(ALL_ERAS);\n  } catch (error) {\n    console.error('Error fetching equipment eras:', error);\n    res.status(500).json({ message: 'Internal server error' });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\meta\\equipment_tech_bases.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":4,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":4,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextApiRequest, NextApiResponse } from 'next';\nimport { ALL_TECH_BASES } from '@/types/enums/TechBase';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ message: 'Method not allowed' });\n  }\n\n  try {\n    res.status(200).json(ALL_TECH_BASES);\n  } catch (error) {\n    console.error('Error fetching equipment tech bases:', error);\n    res.status(500).json({ message: 'Internal server error' });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\meta\\unit_eras.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":4,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":4,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextApiRequest, NextApiResponse } from 'next';\nimport { ALL_ERAS } from '@/types/enums/Era';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ message: 'Method not allowed' });\n  }\n\n  try {\n    res.status(200).json(ALL_ERAS);\n  } catch (error) {\n    console.error('Error fetching unit eras:', error);\n    res.status(500).json({ message: 'Internal server error' });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\meta\\unit_tech_bases.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":4,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":4,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextApiRequest, NextApiResponse } from 'next';\nimport { ALL_TECH_BASES } from '@/types/enums/TechBase';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ message: 'Method not allowed' });\n  }\n\n  try {\n    res.status(200).json(ALL_TECH_BASES);\n  } catch (error) {\n    console.error('Error fetching unit tech bases:', error);\n    res.status(500).json({ message: 'Internal server error' });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\meta\\unit_weight_classes.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":4,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":4,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextApiRequest, NextApiResponse } from 'next';\nimport { STANDARD_WEIGHT_CLASSES } from '@/types/enums/WeightClass';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ message: 'Method not allowed' });\n  }\n\n  try {\n    res.status(200).json(STANDARD_WEIGHT_CLASSES);\n  } catch (error) {\n    console.error('Error fetching unit weight classes:', error);\n    res.status(500).json({ message: 'Internal server error' });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\units.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":75,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":75,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Units API\n * \n * Query and retrieve canonical unit data.\n * \n * GET /api/units - List/query units\n * GET /api/units?id=<id> - Get single unit by ID\n * \n * Query Parameters:\n * - id: Get specific unit by ID\n * - techBase: Filter by tech base (INNER_SPHERE, CLAN, BOTH)\n * - era: Filter by era\n * - weightClass: Filter by weight class (LIGHT, MEDIUM, HEAVY, ASSAULT)\n * - unitType: Filter by unit type (BattleMech, Vehicle, etc.)\n * - minTonnage: Minimum tonnage\n * - maxTonnage: Maximum tonnage\n * \n * @spec openspec/specs/unit-services/spec.md\n */\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport { canonicalUnitService } from '@/services/units/CanonicalUnitService';\nimport { IUnitQueryCriteria, UnitType } from '@/services/common/types';\nimport { TechBase } from '@/types/enums/TechBase';\nimport { Era } from '@/types/enums/Era';\nimport { WeightClass } from '@/types/enums/WeightClass';\n\ninterface ApiResponse {\n  success: boolean;\n  data?: unknown;\n  error?: string;\n  count?: number;\n}\n\n/**\n * Type guard to validate TechBase enum value\n */\nfunction isValidTechBase(value: string): value is TechBase {\n  return Object.values(TechBase).includes(value as TechBase);\n}\n\n/**\n * Type guard to validate Era enum value\n */\nfunction isValidEra(value: string): value is Era {\n  return Object.values(Era).includes(value as Era);\n}\n\n/**\n * Type guard to validate WeightClass enum value\n */\nfunction isValidWeightClass(value: string): value is WeightClass {\n  return Object.values(WeightClass).includes(value as WeightClass);\n}\n\n/**\n * Type guard to validate UnitType\n */\nfunction isValidUnitType(value: string): value is UnitType {\n  const validTypes: UnitType[] = [\n    'BattleMech', 'Vehicle', 'Infantry', 'ProtoMech', 'BattleArmor',\n    'Aerospace', 'ConvFighter', 'Dropship', 'Jumpship', 'Warship',\n    'SpaceStation', 'SmallCraft'\n  ];\n  return validTypes.includes(value as UnitType);\n}\n\n/**\n * Parse string to integer, returning undefined if invalid\n */\nfunction parseIntOrUndefined(value: string): number | undefined {\n  const parsed = parseInt(value, 10);\n  return isNaN(parsed) ? undefined : parsed;\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<ApiResponse>\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({\n      success: false,\n      error: 'Method not allowed. Use GET.',\n    });\n  }\n\n  try {\n    const { id, techBase, era, weightClass, unitType, minTonnage, maxTonnage } = req.query;\n\n    // Get single unit by ID\n    if (id && typeof id === 'string') {\n      const unit = await canonicalUnitService.getById(id);\n      \n      if (!unit) {\n        return res.status(404).json({\n          success: false,\n          error: `Unit not found: ${id}`,\n        });\n      }\n\n      return res.status(200).json({\n        success: true,\n        data: unit,\n      });\n    }\n\n    // Build query criteria from query parameters using type-safe spread\n    const criteria: IUnitQueryCriteria = {\n      ...(typeof techBase === 'string' && isValidTechBase(techBase) && { techBase }),\n      ...(typeof era === 'string' && isValidEra(era) && { era }),\n      ...(typeof weightClass === 'string' && isValidWeightClass(weightClass) && { weightClass }),\n      ...(typeof unitType === 'string' && isValidUnitType(unitType) && { unitType }),\n      ...(typeof minTonnage === 'string' && { minTonnage: parseIntOrUndefined(minTonnage) }),\n      ...(typeof maxTonnage === 'string' && { maxTonnage: parseIntOrUndefined(maxTonnage) }),\n    };\n\n    // Query units\n    const units = await canonicalUnitService.query(criteria);\n\n    return res.status(200).json({\n      success: true,\n      data: units,\n      count: units.length,\n    });\n\n  } catch (error) {\n    console.error('Units API error:', error);\n    return res.status(500).json({\n      success: false,\n      error: error instanceof Error ? error.message : 'Internal server error',\n    });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\units\\custom\\[id].ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":34,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":34,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Custom Unit API - Single Unit Operations\r\n * \r\n * GET /api/units/custom/:id - Get a custom unit by ID\r\n * PUT /api/units/custom/:id - Update a custom unit\r\n * DELETE /api/units/custom/:id - Delete a custom unit\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\nimport {\r\n  ICustomUnitRecord,\r\n  IUpdateUnitRequest,\r\n  IUnitOperationResult,\r\n} from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Response types\r\n */\r\ntype GetResponse = ICustomUnitRecord & { parsedData: Record<string, unknown> };\r\n\r\ntype UpdateResponse = IUnitOperationResult;\r\n\r\ntype DeleteResponse = IUnitOperationResult;\r\n\r\ntype ErrorResponse = {\r\n  error: string;\r\n  code?: string;\r\n};\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<GetResponse | UpdateResponse | DeleteResponse | ErrorResponse>\r\n) {\r\n  // Initialize database\r\n  try {\r\n    getSQLiteService().initialize();\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Database initialization failed';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n\r\n  const unitRepository = getUnitRepository();\r\n  const { id } = req.query;\r\n\r\n  if (!id || typeof id !== 'string') {\r\n    return res.status(400).json({ error: 'Missing unit ID' });\r\n  }\r\n\r\n  switch (req.method) {\r\n    case 'GET':\r\n      return handleGet(unitRepository, id, res);\r\n    case 'PUT':\r\n      return handlePut(unitRepository, id, req, res);\r\n    case 'DELETE':\r\n      return handleDelete(unitRepository, id, res);\r\n    default:\r\n      res.setHeader('Allow', ['GET', 'PUT', 'DELETE']);\r\n      return res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/units/custom/:id - Get a custom unit by ID\r\n */\r\nfunction handleGet(\r\n  unitRepository: ReturnType<typeof getUnitRepository>,\r\n  id: string,\r\n  res: NextApiResponse<GetResponse | ErrorResponse>\r\n) {\r\n  try {\r\n    const unit = unitRepository.getById(id);\r\n\r\n    if (!unit) {\r\n      return res.status(404).json({ error: `Unit \"${id}\" not found` });\r\n    }\r\n\r\n    // Parse the JSON data for client convenience\r\n    const parsedData = JSON.parse(unit.data) as Record<string, unknown>;\r\n\r\n    return res.status(200).json({\r\n      ...unit,\r\n      parsedData,\r\n    });\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to get unit';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n/**\r\n * PUT /api/units/custom/:id - Update a custom unit (saves new version)\r\n */\r\nfunction handlePut(\r\n  unitRepository: ReturnType<typeof getUnitRepository>,\r\n  id: string,\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<UpdateResponse | ErrorResponse>\r\n) {\r\n  try {\r\n    const body = req.body as IUpdateUnitRequest;\r\n\r\n    // Validate required fields\r\n    if (!body.data) {\r\n      return res.status(400).json({\r\n        error: 'Missing required field: data',\r\n      });\r\n    }\r\n\r\n    const result = unitRepository.update(id, body);\r\n\r\n    if (result.success) {\r\n      return res.status(200).json(result);\r\n    } else {\r\n      const statusCode = result.errorCode === 'NOT_FOUND' ? 404 : 400;\r\n      return res.status(statusCode).json(result);\r\n    }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to update unit';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n/**\r\n * DELETE /api/units/custom/:id - Delete a custom unit\r\n */\r\nfunction handleDelete(\r\n  unitRepository: ReturnType<typeof getUnitRepository>,\r\n  id: string,\r\n  res: NextApiResponse<DeleteResponse | ErrorResponse>\r\n) {\r\n  try {\r\n    const result = unitRepository.delete(id);\r\n\r\n    if (result.success) {\r\n      return res.status(200).json(result);\r\n    } else {\r\n      return res.status(400).json(result);\r\n    }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to delete unit';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\units\\custom\\[id]\\export.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":29,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":29,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Export API - Export Unit as JSON\r\n * \r\n * GET /api/units/custom/:id/export - Export a custom unit as JSON file\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\nimport { ISerializedUnitEnvelope } from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Package version (would normally come from package.json)\r\n */\r\nconst APP_VERSION = '1.0.0';\r\nconst FORMAT_VERSION = '1.0.0';\r\n\r\n/**\r\n * Response types\r\n */\r\ntype ExportResponse = ISerializedUnitEnvelope;\r\n\r\ntype ErrorResponse = {\r\n  error: string;\r\n};\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<ExportResponse | ErrorResponse>\r\n) {\r\n  // Initialize database\r\n  try {\r\n    getSQLiteService().initialize();\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Database initialization failed';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n\r\n  if (req.method !== 'GET') {\r\n    res.setHeader('Allow', ['GET']);\r\n    return res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n\r\n  const { id, download } = req.query;\r\n\r\n  if (!id || typeof id !== 'string') {\r\n    return res.status(400).json({ error: 'Missing unit ID' });\r\n  }\r\n\r\n  const unitRepository = getUnitRepository();\r\n\r\n  try {\r\n    const unit = unitRepository.getById(id);\r\n\r\n    if (!unit) {\r\n      return res.status(404).json({ error: `Unit \"${id}\" not found` });\r\n    }\r\n\r\n    // Parse the stored JSON data\r\n    const unitData = JSON.parse(unit.data) as Record<string, unknown>;\r\n\r\n    // Create export envelope\r\n    const envelope: ISerializedUnitEnvelope = {\r\n      formatVersion: FORMAT_VERSION,\r\n      savedAt: new Date().toISOString(),\r\n      application: 'battletech-editor',\r\n      applicationVersion: APP_VERSION,\r\n      unit: unitData,\r\n    };\r\n\r\n    // If download query param is set, send as file download\r\n    if (download === 'true') {\r\n      const filename = `${unit.chassis}-${unit.variant}.json`\r\n        .replace(/[^a-zA-Z0-9\\-_.]/g, '-');\r\n      \r\n      res.setHeader('Content-Type', 'application/json');\r\n      res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\r\n    }\r\n\r\n    return res.status(200).json(envelope);\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to export unit';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\units\\custom\\[id]\\revert\\[version].ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":31,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":31,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Revert API - Revert to Previous Version\r\n * \r\n * POST /api/units/custom/:id/revert/:version - Revert a unit to a previous version\r\n * \r\n * @spec openspec/specs/unit-versioning/spec.md\r\n */\r\n\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getVersionRepository } from '@/services/units/VersionRepository';\r\nimport { IUnitOperationResult } from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Request body type\r\n */\r\ninterface RevertRequestBody {\r\n  notes?: string;\r\n}\r\n\r\n/**\r\n * Response types\r\n */\r\ntype RevertResponse = IUnitOperationResult;\r\n\r\ntype ErrorResponse = {\r\n  error: string;\r\n  code?: string;\r\n};\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<RevertResponse | ErrorResponse>\r\n) {\r\n  // Initialize database\r\n  try {\r\n    getSQLiteService().initialize();\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Database initialization failed';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n\r\n  if (req.method !== 'POST') {\r\n    res.setHeader('Allow', ['POST']);\r\n    return res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n\r\n  const { id, version } = req.query;\r\n\r\n  if (!id || typeof id !== 'string') {\r\n    return res.status(400).json({ error: 'Missing unit ID' });\r\n  }\r\n\r\n  if (!version || typeof version !== 'string') {\r\n    return res.status(400).json({ error: 'Missing version number' });\r\n  }\r\n\r\n  const versionNum = parseInt(version, 10);\r\n  if (isNaN(versionNum) || versionNum < 1) {\r\n    return res.status(400).json({ error: 'Invalid version number' });\r\n  }\r\n\r\n  const body = req.body as RevertRequestBody | undefined;\r\n  const versionRepository = getVersionRepository();\r\n\r\n  try {\r\n    const result = versionRepository.revert(id, versionNum, body?.notes);\r\n\r\n    if (result.success) {\r\n      return res.status(200).json(result);\r\n    } else {\r\n      const statusCode = result.errorCode === 'NOT_FOUND' || result.errorCode === 'VERSION_NOT_FOUND'\r\n        ? 404\r\n        : 400;\r\n      return res.status(statusCode).json(result);\r\n    }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to revert';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\units\\custom\\[id]\\versions\\[version].ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":23,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":23,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Version API - Get Specific Version\r\n * \r\n * GET /api/units/custom/:id/versions/:version - Get a specific version of a unit\r\n * \r\n * @spec openspec/specs/unit-versioning/spec.md\r\n */\r\n\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getVersionRepository } from '@/services/units/VersionRepository';\r\nimport { IVersionRecord } from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Response types\r\n */\r\ntype VersionResponse = IVersionRecord & { parsedData: Record<string, unknown> };\r\n\r\ntype ErrorResponse = {\r\n  error: string;\r\n};\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<VersionResponse | ErrorResponse>\r\n) {\r\n  // Initialize database\r\n  try {\r\n    getSQLiteService().initialize();\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Database initialization failed';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n\r\n  if (req.method !== 'GET') {\r\n    res.setHeader('Allow', ['GET']);\r\n    return res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n\r\n  const { id, version } = req.query;\r\n\r\n  if (!id || typeof id !== 'string') {\r\n    return res.status(400).json({ error: 'Missing unit ID' });\r\n  }\r\n\r\n  if (!version || typeof version !== 'string') {\r\n    return res.status(400).json({ error: 'Missing version number' });\r\n  }\r\n\r\n  const versionNum = parseInt(version, 10);\r\n  if (isNaN(versionNum) || versionNum < 1) {\r\n    return res.status(400).json({ error: 'Invalid version number' });\r\n  }\r\n\r\n  const versionRepository = getVersionRepository();\r\n\r\n  try {\r\n    const versionRecord = versionRepository.getVersion(id, versionNum);\r\n\r\n    if (!versionRecord) {\r\n      return res.status(404).json({\r\n        error: `Version ${versionNum} not found for unit \"${id}\"`,\r\n      });\r\n    }\r\n\r\n    // Parse the JSON data for client convenience\r\n    const parsedData = JSON.parse(versionRecord.data) as Record<string, unknown>;\r\n\r\n    return res.status(200).json({\r\n      ...versionRecord,\r\n      parsedData,\r\n    });\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to get version';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\units\\custom\\[id]\\versions\\index.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":29,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":29,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Versions API - List Versions\r\n * \r\n * GET /api/units/custom/:id/versions - List version history for a unit\r\n * \r\n * @spec openspec/specs/unit-versioning/spec.md\r\n */\r\n\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\nimport { getVersionRepository } from '@/services/units/VersionRepository';\r\nimport { IVersionMetadata } from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Response types\r\n */\r\ntype VersionsResponse = {\r\n  unitId: string;\r\n  currentVersion: number;\r\n  versions: readonly IVersionMetadata[];\r\n  count: number;\r\n};\r\n\r\ntype ErrorResponse = {\r\n  error: string;\r\n};\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<VersionsResponse | ErrorResponse>\r\n) {\r\n  // Initialize database\r\n  try {\r\n    getSQLiteService().initialize();\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Database initialization failed';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n\r\n  if (req.method !== 'GET') {\r\n    res.setHeader('Allow', ['GET']);\r\n    return res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n\r\n  const { id } = req.query;\r\n\r\n  if (!id || typeof id !== 'string') {\r\n    return res.status(400).json({ error: 'Missing unit ID' });\r\n  }\r\n\r\n  const unitRepository = getUnitRepository();\r\n  const versionRepository = getVersionRepository();\r\n\r\n  try {\r\n    // Check if unit exists\r\n    const unit = unitRepository.getById(id);\r\n    if (!unit) {\r\n      return res.status(404).json({ error: `Unit \"${id}\" not found` });\r\n    }\r\n\r\n    // Get version history\r\n    const versions = versionRepository.getVersionHistory(id);\r\n\r\n    return res.status(200).json({\r\n      unitId: id,\r\n      currentVersion: unit.currentVersion,\r\n      versions,\r\n      count: versions.length,\r\n    });\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to get versions';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\units\\custom\\index.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":34,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":34,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Custom Units API - List and Create\r\n * \r\n * GET /api/units/custom - List all custom units\r\n * POST /api/units/custom - Create a new custom unit\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\nimport {\r\n  ICustomUnitIndexEntry,\r\n  ICreateUnitRequest,\r\n  IUnitOperationResult,\r\n} from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Response types\r\n */\r\ntype ListResponse = {\r\n  units: readonly ICustomUnitIndexEntry[];\r\n  count: number;\r\n};\r\n\r\ntype CreateResponse = IUnitOperationResult;\r\n\r\ntype ErrorResponse = {\r\n  error: string;\r\n  code?: string;\r\n};\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<ListResponse | CreateResponse | ErrorResponse>\r\n) {\r\n  // Initialize database\r\n  try {\r\n    getSQLiteService().initialize();\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Database initialization failed';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n\r\n  const unitRepository = getUnitRepository();\r\n\r\n  switch (req.method) {\r\n    case 'GET':\r\n      return handleGet(unitRepository, res);\r\n    case 'POST':\r\n      return handlePost(unitRepository, req, res);\r\n    default:\r\n      res.setHeader('Allow', ['GET', 'POST']);\r\n      return res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/units/custom - List all custom units\r\n */\r\nfunction handleGet(\r\n  unitRepository: ReturnType<typeof getUnitRepository>,\r\n  res: NextApiResponse<ListResponse | ErrorResponse>\r\n) {\r\n  try {\r\n    const units = unitRepository.list();\r\n    return res.status(200).json({\r\n      units,\r\n      count: units.length,\r\n    });\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to list units';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/units/custom - Create a new custom unit\r\n */\r\nfunction handlePost(\r\n  unitRepository: ReturnType<typeof getUnitRepository>,\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<CreateResponse | ErrorResponse>\r\n) {\r\n  try {\r\n    const body = req.body as ICreateUnitRequest;\r\n\r\n    // Validate required fields\r\n    if (!body.chassis || !body.variant || !body.data) {\r\n      return res.status(400).json({\r\n        error: 'Missing required fields: chassis, variant, data',\r\n      });\r\n    }\r\n\r\n    const result = unitRepository.create(body);\r\n\r\n    if (result.success) {\r\n      return res.status(201).json(result);\r\n    } else {\r\n      return res.status(400).json(result);\r\n    }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to create unit';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\units\\custom\\suggest-name.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":33,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":33,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Suggest Clone Name API\r\n * \r\n * POST /api/units/custom/suggest-name - Get a unique name suggestion for a unit clone\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\nimport { ICloneNameSuggestion } from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Request body type\r\n */\r\ninterface SuggestNameRequest {\r\n  chassis: string;\r\n  variant: string;\r\n}\r\n\r\n/**\r\n * Response types\r\n */\r\ntype SuggestNameResponse = ICloneNameSuggestion & {\r\n  isOriginalAvailable: boolean;\r\n};\r\n\r\ntype ErrorResponse = {\r\n  error: string;\r\n};\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<SuggestNameResponse | ErrorResponse>\r\n) {\r\n  // Initialize database\r\n  try {\r\n    getSQLiteService().initialize();\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Database initialization failed';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n\r\n  if (req.method !== 'POST') {\r\n    res.setHeader('Allow', ['POST']);\r\n    return res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n\r\n  const body = req.body as SuggestNameRequest;\r\n\r\n  if (!body.chassis || !body.variant) {\r\n    return res.status(400).json({\r\n      error: 'Missing required fields: chassis, variant',\r\n    });\r\n  }\r\n\r\n  const unitRepository = getUnitRepository();\r\n\r\n  try {\r\n    // Check if original name is available\r\n    const isOriginalAvailable = !unitRepository.nameExists(body.chassis, body.variant);\r\n\r\n    // Get suggestion\r\n    const suggestion = unitRepository.suggestCloneName(body.chassis, body.variant);\r\n\r\n    return res.status(200).json({\r\n      ...suggestion,\r\n      isOriginalAvailable,\r\n    });\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to suggest name';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\api\\units\\import.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UnitErrorCode' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":16},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":48,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":48,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Import API - Import Unit from JSON\r\n * \r\n * POST /api/units/import - Import a unit from JSON file\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { getSQLiteService } from '@/services/persistence/SQLiteService';\r\nimport { getUnitRepository } from '@/services/units/UnitRepository';\r\nimport {\r\n  ISerializedUnitEnvelope,\r\n  IImportResult,\r\n  UnitErrorCode,\r\n} from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Expected format version\r\n */\r\nconst SUPPORTED_FORMAT_VERSIONS = ['1.0.0'];\r\n\r\n/**\r\n * Request body type - can be envelope or raw unit data\r\n */\r\ntype ImportRequestBody = ISerializedUnitEnvelope | {\r\n  chassis: string;\r\n  variant?: string;\r\n  model?: string;\r\n  tonnage?: number;\r\n  techBase?: string;\r\n  era?: string;\r\n  rulesLevel?: string;\r\n  unitType?: string;\r\n  [key: string]: unknown;\r\n};\r\n\r\n/**\r\n * Response types\r\n */\r\ntype ImportResponse = IImportResult;\r\n\r\ntype ErrorResponse = {\r\n  error: string;\r\n  code?: string;\r\n};\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse<ImportResponse | ErrorResponse>\r\n) {\r\n  // Initialize database\r\n  try {\r\n    getSQLiteService().initialize();\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Database initialization failed';\r\n    return res.status(500).json({ error: message });\r\n  }\r\n\r\n  if (req.method !== 'POST') {\r\n    res.setHeader('Allow', ['POST']);\r\n    return res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n\r\n  const body = req.body as ImportRequestBody;\r\n\r\n  if (!body) {\r\n    return res.status(400).json({\r\n      error: 'Missing request body',\r\n    });\r\n  }\r\n\r\n  try {\r\n    // Determine if this is an envelope or raw unit data\r\n    let unitData: Record<string, unknown>;\r\n    \r\n    if ('formatVersion' in body && 'unit' in body) {\r\n      // This is an envelope\r\n      const envelope = body as ISerializedUnitEnvelope;\r\n      \r\n      // Validate format version\r\n      if (!SUPPORTED_FORMAT_VERSIONS.includes(envelope.formatVersion)) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          error: `Unsupported format version: ${envelope.formatVersion}. Supported versions: ${SUPPORTED_FORMAT_VERSIONS.join(', ')}`,\r\n        });\r\n      }\r\n      \r\n      unitData = envelope.unit;\r\n    } else {\r\n      // This is raw unit data\r\n      unitData = body as Record<string, unknown>;\r\n    }\r\n\r\n    // Validate required fields\r\n    const validationErrors: string[] = [];\r\n    \r\n    if (!unitData.chassis || typeof unitData.chassis !== 'string') {\r\n      validationErrors.push('Missing or invalid field: chassis');\r\n    }\r\n    \r\n    // Accept either 'variant' or 'model' for compatibility\r\n    const variant = (unitData.variant || unitData.model) as string | undefined;\r\n    if (!variant) {\r\n      validationErrors.push('Missing field: variant or model');\r\n    }\r\n\r\n    if (validationErrors.length > 0) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: 'Validation failed',\r\n        validationErrors,\r\n      });\r\n    }\r\n\r\n    const chassis = unitData.chassis as string;\r\n    const unitRepository = getUnitRepository();\r\n\r\n    // Check for name conflict\r\n    if (unitRepository.nameExists(chassis, variant!)) {\r\n      const suggestion = unitRepository.suggestCloneName(chassis, variant!);\r\n      return res.status(409).json({\r\n        success: false,\r\n        error: `Unit \"${chassis} ${variant}\" already exists`,\r\n        suggestedName: `${suggestion.chassis} ${suggestion.suggestedVariant}`,\r\n      });\r\n    }\r\n\r\n    // Create the unit\r\n    const result = unitRepository.create({\r\n      chassis,\r\n      variant: variant!,\r\n      data: unitData,\r\n      notes: 'Imported from JSON file',\r\n    });\r\n\r\n    if (result.success) {\r\n      return res.status(201).json({\r\n        success: true,\r\n        unitId: result.id,\r\n      });\r\n    } else {\r\n      return res.status(400).json({\r\n        success: false,\r\n        error: result.error,\r\n      });\r\n    }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Failed to import unit';\r\n    return res.status(500).json({\r\n      error: message,\r\n    });\r\n  }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\compare\\index.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":16,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":16,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":28,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":28,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":29,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":29,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":30,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":30,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":60,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":60,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":62,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":62,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `any[]`.","line":63,"column":34,"nodeType":"ArrayExpression","messageId":"unsafeReturn","endLine":63,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":63,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":63,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Unit Comparison Page\n * Compare multiple units side-by-side.\n */\nimport { useEffect, useState, useCallback } from 'react';\nimport { IUnitEntry, IUnitDetails, calculateTotalArmor } from '@/types/pages';\nimport {\n  PageLayout,\n  Card,\n  Input,\n  EmptyState,\n} from '@/components/ui';\n\nconst MAX_COMPARE = 4;\n\nexport default function ComparePage() {\n  const [catalog, setCatalog] = useState<IUnitEntry[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedUnits, setSelectedUnits] = useState<IUnitDetails[]>([]);\n  const [loadingUnits, setLoadingUnits] = useState<Set<string>>(new Set());\n  const [catalogLoading, setCatalogLoading] = useState(true);\n\n  // Fetch catalog\n  useEffect(() => {\n    async function fetchCatalog() {\n      try {\n        const response = await fetch('/api/catalog');\n        const data = await response.json();\n        if (data.success) {\n          setCatalog(data.data || []);\n        }\n      } catch (err) {\n        console.error('Failed to fetch catalog:', err);\n      } finally {\n        setCatalogLoading(false);\n      }\n    }\n    fetchCatalog();\n  }, []);\n\n  // Filter catalog by search\n  const filteredCatalog = catalog.filter(unit => {\n    if (!searchTerm) return false; // Only show results when searching\n    const search = searchTerm.toLowerCase();\n    return (\n      unit.name.toLowerCase().includes(search) ||\n      unit.chassis.toLowerCase().includes(search)\n    );\n  }).slice(0, 10);\n\n  // Add unit to comparison\n  const addUnit = useCallback(async (entry: IUnitEntry) => {\n    if (selectedUnits.length >= MAX_COMPARE) return;\n    if (selectedUnits.some(u => u.id === entry.id)) return;\n\n    setLoadingUnits(prev => new Set(prev).add(entry.id));\n\n    try {\n      const response = await fetch(`/api/units?id=${encodeURIComponent(entry.id)}`);\n      const data = await response.json();\n      \n      if (data.success) {\n        setSelectedUnits(prev => [...prev, data.data]);\n      }\n    } catch (err) {\n      console.error('Failed to load unit:', err);\n    } finally {\n      setLoadingUnits(prev => {\n        const next = new Set(prev);\n        next.delete(entry.id);\n        return next;\n      });\n    }\n\n    setSearchTerm('');\n  }, [selectedUnits]);\n\n  // Remove unit from comparison\n  const removeUnit = (id: string) => {\n    setSelectedUnits(prev => prev.filter(u => u.id !== id));\n  };\n\n  return (\n    <PageLayout\n      title=\"Unit Comparison\"\n      subtitle={`Compare up to ${MAX_COMPARE} units side-by-side`}\n    >\n      {/* Search Bar */}\n      <div className=\"relative mb-6\">\n        <Input\n          type=\"text\"\n          placeholder=\"Search for a unit to add...\"\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          disabled={selectedUnits.length >= MAX_COMPARE}\n          variant=\"large\"\n          aria-label=\"Search units to compare\"\n        />\n        \n        {/* Search Results Dropdown */}\n        {searchTerm && filteredCatalog.length > 0 && (\n          <div className=\"absolute top-full left-0 right-0 mt-2 bg-slate-800 border border-slate-700 rounded-xl overflow-hidden shadow-xl z-10\">\n            <ul className=\"divide-y divide-slate-700/50\">\n              {filteredCatalog.map((unit) => {\n                const isLoading = loadingUnits.has(unit.id);\n                const isAdded = selectedUnits.some(u => u.id === unit.id);\n                \n                return (\n                  <li key={unit.id}>\n                    <button\n                      onClick={() => addUnit(unit)}\n                      disabled={isLoading || isAdded}\n                      className=\"w-full px-4 py-3 text-left hover:bg-slate-700/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      aria-label={`Add ${unit.name} to comparison`}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className=\"font-medium text-white\">{unit.name}</div>\n                          <div className=\"text-sm text-slate-400\">\n                            {unit.tonnage}t  {unit.techBase.replace(/_/g, ' ')}\n                          </div>\n                        </div>\n                        {isLoading ? (\n                          <div className=\"loading-spinner loading-spinner-sm\" />\n                        ) : isAdded ? (\n                          <span className=\"text-emerald-400 text-sm\">Added</span>\n                        ) : (\n                          <span className=\"text-violet-400 text-sm\">+ Add</span>\n                        )}\n                      </div>\n                    </button>\n                  </li>\n                );\n              })}\n            </ul>\n          </div>\n        )}\n\n        {searchTerm && filteredCatalog.length === 0 && !catalogLoading && (\n          <div className=\"absolute top-full left-0 right-0 mt-2 bg-slate-800 border border-slate-700 rounded-xl p-4 text-center text-slate-400\">\n            No units found matching &quot;{searchTerm}&quot;\n          </div>\n        )}\n      </div>\n\n      {/* Comparison Grid */}\n      {selectedUnits.length === 0 ? (\n        <EmptyState\n          icon={<CompareIcon />}\n          title=\"No Units Selected\"\n          message=\"Use the search bar above to add units to compare\"\n        />\n      ) : (\n        <Card variant=\"dark\" className=\"overflow-hidden\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-slate-800\">\n                <tr>\n                  <th className=\"px-4 py-3 text-left text-slate-400 font-medium w-40\">Stat</th>\n                  {selectedUnits.map((unit) => (\n                    <th key={unit.id} className=\"px-4 py-3 text-left min-w-[200px]\">\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <div className=\"font-semibold text-white\">\n                            {unit.name || `${unit.chassis} ${unit.model}`}\n                          </div>\n                          <div className=\"text-sm text-slate-400\">\n                            {unit.tonnage}t  {unit.techBase?.replace(/_/g, ' ')}\n                          </div>\n                        </div>\n                        <button\n                          onClick={() => removeUnit(unit.id)}\n                          className=\"text-slate-500 hover:text-red-400 transition-colors ml-2\"\n                          aria-label={`Remove ${unit.name || unit.chassis} from comparison`}\n                        >\n                          <CloseIcon />\n                        </button>\n                      </div>\n                    </th>\n                  ))}\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-700/50\">\n                <CompareRow label=\"Tonnage\" units={selectedUnits} getValue={u => `${u.tonnage}t`} mono />\n                <CompareRow label=\"Walk MP\" units={selectedUnits} getValue={u => u.movement?.walk || ''} mono />\n                <CompareRow label=\"Run MP\" units={selectedUnits} getValue={u => u.movement?.walk ? Math.ceil(u.movement.walk * 1.5) : ''} mono />\n                <CompareRow label=\"Jump MP\" units={selectedUnits} getValue={u => u.movement?.jump || 0} mono />\n                <CompareRow label=\"Engine\" units={selectedUnits} getValue={u => u.engine ? `${u.engine.type} ${u.engine.rating}` : ''} />\n                <CompareRow label=\"Heat Sinks\" units={selectedUnits} getValue={u => u.heatSinks ? `${u.heatSinks.count} ${u.heatSinks.type}` : ''} />\n                <CompareRow label=\"Armor Type\" units={selectedUnits} getValue={u => u.armor?.type || ''} />\n                <CompareRow label=\"Total Armor\" units={selectedUnits} getValue={u => u.armor ? `${calculateTotalArmor(u.armor)} pts` : ''} mono />\n              </tbody>\n            </table>\n          </div>\n        </Card>\n      )}\n\n      {/* Add more slots indicator */}\n      {selectedUnits.length > 0 && selectedUnits.length < MAX_COMPARE && (\n        <div className=\"mt-4 text-center text-slate-400 text-sm\">\n          You can add {MAX_COMPARE - selectedUnits.length} more unit{MAX_COMPARE - selectedUnits.length > 1 ? 's' : ''} to compare\n        </div>\n      )}\n    </PageLayout>\n  );\n}\n\n// Reusable comparison row component\ninterface CompareRowProps {\n  label: string;\n  units: IUnitDetails[];\n  getValue: (unit: IUnitDetails) => string | number;\n  mono?: boolean;\n}\n\nfunction CompareRow({ label, units, getValue, mono }: CompareRowProps) {\n  return (\n    <tr className=\"hover:bg-slate-700/20\">\n      <td className=\"px-4 py-3 text-slate-400\">{label}</td>\n      {units.map((unit) => (\n        <td key={unit.id} className={`px-4 py-3 text-white ${mono ? 'font-mono' : ''}`}>\n          {getValue(unit)}\n        </td>\n      ))}\n    </tr>\n  );\n}\n\n// Icons\nfunction CompareIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-16 h-16\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5\" />\n    </svg>\n  );\n}\n\nfunction CloseIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\n    </svg>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\compendium\\index.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":218,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":218,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Rules Compendium Page\n * Reference for BattleTech construction rules and game mechanics.\n */\nimport React from 'react';\nimport {\n  PageLayout,\n  Card,\n} from '@/components/ui';\n\ninterface RuleSection {\n  id: string;\n  title: string;\n  description: string;\n  icon: React.ReactNode;\n  items: RuleItem[];\n}\n\ninterface RuleItem {\n  title: string;\n  content: string;\n  formula?: string;\n}\n\nconst ruleSections: RuleSection[] = [\n  {\n    id: 'structure',\n    title: 'Internal Structure',\n    description: 'Structure types and weight calculations',\n    icon: <StructureIcon />,\n    items: [\n      {\n        title: 'Standard Structure',\n        content: 'The default internal structure type. Weight equals 10% of total tonnage.',\n        formula: 'Weight = Tonnage  0.10',\n      },\n      {\n        title: 'Endo Steel',\n        content: 'Lighter structure using advanced materials. Weight equals 5% of total tonnage. Requires 14 critical slots (IS) or 7 slots (Clan).',\n        formula: 'Weight = Tonnage  0.05',\n      },\n      {\n        title: 'Composite Structure',\n        content: 'Lighter but fragile structure. Weight equals 5% of total tonnage. Takes double internal damage from crits.',\n        formula: 'Weight = Tonnage  0.05',\n      },\n      {\n        title: 'Reinforced Structure',\n        content: 'Heavier but more durable. Weight equals 20% of total tonnage. Takes half internal damage.',\n        formula: 'Weight = Tonnage  0.20',\n      },\n    ],\n  },\n  {\n    id: 'engine',\n    title: 'Engine',\n    description: 'Engine types and rating calculations',\n    icon: <LightningIcon />,\n    items: [\n      {\n        title: 'Engine Rating',\n        content: 'Determines movement capability. Walking MP  Tonnage = Engine Rating.',\n        formula: 'Rating = Walk MP  Tonnage',\n      },\n      {\n        title: 'Fusion Engine (Standard)',\n        content: 'The baseline engine. Uses the standard weight table and occupies 6 critical slots in center torso.',\n      },\n      {\n        title: 'XL Engine',\n        content: 'Half the weight of standard. Also occupies 3 slots in each side torso. Destruction of side torso destroys mech.',\n      },\n      {\n        title: 'Light Engine',\n        content: '75% the weight of standard. Occupies 2 slots in each side torso. More survivable than XL.',\n      },\n      {\n        title: 'Compact Engine',\n        content: '150% the weight of standard but only uses 3 center torso slots instead of 6.',\n      },\n    ],\n  },\n  {\n    id: 'armor',\n    title: 'Armor',\n    description: 'Armor types and maximum allocations',\n    icon: <ShieldIcon />,\n    items: [\n      {\n        title: 'Maximum Armor Formula',\n        content: 'Maximum armor points per location equals 2 the internal structure points. Head maximum is always 9.',\n        formula: 'Max = Structure  2 (Head = 9)',\n      },\n      {\n        title: 'Standard Armor',\n        content: '16 points per ton. No critical slots required.',\n        formula: 'Weight = Points  16',\n      },\n      {\n        title: 'Ferro-Fibrous Armor',\n        content: 'IS: 17.92 points/ton (14 slots). Clan: 19.2 points/ton (7 slots).',\n      },\n      {\n        title: 'Light Ferro-Fibrous',\n        content: '16.96 points per ton. Requires 7 critical slots. Inner Sphere only.',\n      },\n      {\n        title: 'Heavy Ferro-Fibrous',\n        content: '24.32 points per ton. Requires 21 critical slots. Inner Sphere only.',\n      },\n    ],\n  },\n  {\n    id: 'heatsinks',\n    title: 'Heat Sinks',\n    description: 'Heat management and dissipation',\n    icon: <FlameIcon />,\n    items: [\n      {\n        title: 'Minimum Heat Sinks',\n        content: 'All mechs require at least 10 heat sinks.',\n      },\n      {\n        title: 'Engine Integral Heat Sinks',\n        content: 'First (Engine Rating  25) heat sinks are included in the engine, no additional weight or slots.',\n        formula: 'Free HS = Rating  25',\n      },\n      {\n        title: 'Single Heat Sinks',\n        content: 'Dissipate 1 heat per turn. 1 ton and 1 critical slot each.',\n      },\n      {\n        title: 'Double Heat Sinks',\n        content: 'Dissipate 2 heat per turn. 1 ton each. IS: 3 slots, Clan: 2 slots (1 if engine integral).',\n      },\n    ],\n  },\n  {\n    id: 'gyro',\n    title: 'Gyro',\n    description: 'Gyro types and stability',\n    icon: <GyroIcon />,\n    items: [\n      {\n        title: 'Standard Gyro',\n        content: 'Weight = ceiling(Engine Rating  100). Occupies 4 critical slots in center torso.',\n        formula: 'Weight = Rating  100',\n      },\n      {\n        title: 'Compact Gyro',\n        content: '150% the weight of standard but only occupies 2 critical slots.',\n      },\n      {\n        title: 'Heavy-Duty Gyro',\n        content: '200% the weight of standard. Survives 2 critical hits before destruction.',\n      },\n      {\n        title: 'XL Gyro',\n        content: '50% the weight of standard but occupies 6 critical slots.',\n      },\n    ],\n  },\n  {\n    id: 'movement',\n    title: 'Movement',\n    description: 'Movement points and jump jets',\n    icon: <RocketIcon />,\n    items: [\n      {\n        title: 'Running MP',\n        content: 'Running MP = Walking MP  1.5 (round up)',\n        formula: 'Run MP = Walk MP  1.5',\n      },\n      {\n        title: 'Standard Jump Jets',\n        content: 'Light mechs: 0.5t each. Medium mechs: 1t each. Heavy mechs: 1t each. Assault mechs: 2t each.',\n      },\n      {\n        title: 'Improved Jump Jets',\n        content: 'Double the weight of standard jump jets but can jump farther (2 max jump MP).',\n      },\n      {\n        title: 'MASC',\n        content: 'Allows running at 2 walking speed for 1 turn. Weight = Rating  20 (IS) or Rating  25 (Clan).',\n      },\n    ],\n  },\n  {\n    id: 'criticals',\n    title: 'Critical Slots',\n    description: 'Critical slot allocation by location',\n    icon: <ListIcon />,\n    items: [\n      {\n        title: 'Head',\n        content: '6 critical slots. Contains: Life Support, Sensors, Cockpit (2 slots each).',\n      },\n      {\n        title: 'Center Torso',\n        content: '12 critical slots. Contains: Engine (6 slots), Gyro (4 slots). 2 slots free.',\n      },\n      {\n        title: 'Side Torsos',\n        content: '12 critical slots each. Left and Right. May contain engine components for XL/Light engines.',\n      },\n      {\n        title: 'Arms',\n        content: '12 critical slots each. Contains: Shoulder, Upper Arm Actuator. Optional: Lower Arm, Hand.',\n      },\n      {\n        title: 'Legs',\n        content: '6 critical slots each. Contains: Hip, Upper Leg, Lower Leg, Foot actuators.',\n      },\n    ],\n  },\n];\n\nexport default function CompendiumPage() {\n  return (\n    <PageLayout\n      title=\"Rules Compendium\"\n      subtitle=\"Quick reference for BattleTech TechManual construction rules\"\n      maxWidth=\"narrow\"\n    >\n      {/* Navigation */}\n      <Card className=\"mb-8\">\n        <nav aria-label=\"Compendium sections\">\n          <div className=\"flex flex-wrap gap-2\">\n            {ruleSections.map((section) => (\n              <a\n                key={section.id}\n                href={`#${section.id}`}\n                className=\"px-4 py-2 bg-slate-700/50 hover:bg-slate-700 rounded-lg text-slate-300 hover:text-white transition-colors text-sm\"\n              >\n                {section.title}\n              </a>\n            ))}\n          </div>\n        </nav>\n      </Card>\n\n      {/* Rule Sections */}\n      <div className=\"space-y-8\">\n        {ruleSections.map((section) => (\n          <section\n            key={section.id}\n            id={section.id}\n            className=\"bg-slate-800/30 border border-slate-700 rounded-xl overflow-hidden scroll-mt-6\"\n            aria-labelledby={`${section.id}-title`}\n          >\n            {/* Section Header */}\n            <div className=\"bg-slate-800/50 px-6 py-4 border-b border-slate-700\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 rounded-lg bg-rose-600/20 text-rose-400\">\n                  {section.icon}\n                </div>\n                <div>\n                  <h2 id={`${section.id}-title`} className=\"text-xl font-semibold text-white\">\n                    {section.title}\n                  </h2>\n                  <p className=\"text-slate-400 text-sm\">{section.description}</p>\n                </div>\n              </div>\n            </div>\n\n            {/* Section Items */}\n            <div className=\"divide-y divide-slate-700/50\">\n              {section.items.map((item, index) => (\n                <article key={index} className=\"px-6 py-4\">\n                  <h3 className=\"font-medium text-amber-400 mb-1\">{item.title}</h3>\n                  <p className=\"text-slate-300 text-sm leading-relaxed\">{item.content}</p>\n                  {item.formula && (\n                    <div className=\"mt-2 inline-block px-3 py-1 bg-slate-700/50 rounded font-mono text-sm text-cyan-400\">\n                      {item.formula}\n                    </div>\n                  )}\n                </article>\n              ))}\n            </div>\n          </section>\n        ))}\n      </div>\n\n      {/* Source Reference */}\n      <Card variant=\"dark\" className=\"mt-12 text-center\">\n        <p className=\"text-slate-400 text-sm\">\n          Rules reference based on BattleTech TechManual.\n          <br />\n          For complete rules, consult the official rulebooks.\n        </p>\n      </Card>\n    </PageLayout>\n  );\n}\n\n// Icon Components\nfunction StructureIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z\" />\n    </svg>\n  );\n}\n\nfunction LightningIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z\" />\n    </svg>\n  );\n}\n\nfunction ShieldIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z\" />\n    </svg>\n  );\n}\n\nfunction FlameIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z\" />\n    </svg>\n  );\n}\n\nfunction GyroIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99\" />\n    </svg>\n  );\n}\n\nfunction RocketIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15.59 14.37a6 6 0 01-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 006.16-12.12A14.98 14.98 0 009.631 8.41m5.96 5.96a14.926 14.926 0 01-5.841 2.58m-.119-8.54a6 6 0 00-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 00-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 01-2.448-2.448 14.9 14.9 0 01.06-.312m-2.24 2.39a4.493 4.493 0 00-1.757 4.306 4.493 4.493 0 004.306-1.758M16.5 9a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z\" />\n    </svg>\n  );\n}\n\nfunction ListIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5\" />\n    </svg>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\customizer\\[[...slug]].tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":36,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":36,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Dynamic Customizer Route\r\n * \r\n * Handles URL-based routing for the unit customizer:\r\n * - /customizer - Main customizer (shows active unit or empty state)\r\n * - /customizer/[unitId] - Specific unit (defaults to structure tab)\r\n * - /customizer/[unitId]/[tabId] - Specific unit and tab\r\n * \r\n * Uses optional catch-all route [[...slug]] to handle all patterns.\r\n * \r\n * @spec openspec/specs/customizer-tabs/spec.md\r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport React from 'react';\r\nimport dynamic from 'next/dynamic';\r\n\r\n// Dynamically import the customizer content with SSR disabled\r\n// This prevents hydration issues with Zustand's persist middleware\r\nconst CustomizerWithRouter = dynamic(\r\n  () => import('@/components/customizer/CustomizerWithRouter'),\r\n  { \r\n    ssr: false,\r\n    loading: () => (\r\n      <div className=\"min-h-screen bg-slate-900 flex items-center justify-center\">\r\n        <div className=\"text-slate-400\">Loading customizer...</div>\r\n      </div>\r\n    ),\r\n  }\r\n);\r\n\r\n/**\r\n * Dynamic customizer page\r\n * Handles all customizer routes via catch-all pattern\r\n */\r\nexport default function CustomizerDynamicPage() {\r\n  return <CustomizerWithRouter />;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\equipment\\[id].tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":70,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":70,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":84,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":84,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":86,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":86,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":87,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":87,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":89,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":89,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment Detail Page\n * Displays full specifications for a single equipment item.\n */\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport { TechBase } from '@/types/enums/TechBase';\nimport {\n  PageLayout,\n  PageLoading,\n  PageError,\n  Card,\n  CardSection,\n  Badge,\n  TechBaseBadge,\n  StatRow,\n  StatList,\n  StatCard,\n  StatGrid,\n} from '@/components/ui';\n\ninterface EquipmentData {\n  id: string;\n  name: string;\n  category?: string;\n  techBase?: TechBase;\n  rulesLevel?: string;\n  weight?: number;\n  criticalSlots?: number;\n  costCBills?: number;\n  \n  // Weapon-specific\n  damage?: number;\n  heat?: number;\n  minimumRange?: number;\n  shortRange?: number;\n  mediumRange?: number;\n  longRange?: number;\n  extremeRange?: number;\n  ammoPerTon?: number;\n  \n  // Temporal\n  introductionYear?: number;\n  extinctionYear?: number;\n  reintroductionYear?: number;\n  \n  // Additional\n  description?: string;\n  specialRules?: string[];\n  battleValue?: number;\n}\n\n// Category display names\nconst categoryLabels: Record<string, string> = {\n  ENERGY_WEAPON: 'Energy Weapon',\n  BALLISTIC_WEAPON: 'Ballistic Weapon',\n  MISSILE_WEAPON: 'Missile Weapon',\n  AMMUNITION: 'Ammunition',\n  PHYSICAL_WEAPON: 'Physical Weapon',\n  ELECTRONICS: 'Electronics',\n  HEAT_SINK: 'Heat Sink',\n  JUMP_JET: 'Jump Jet',\n  MYOMER: 'Myomer Enhancement',\n  MOVEMENT_ENHANCEMENT: 'Movement Enhancement',\n  TARGETING_SYSTEM: 'Targeting System',\n  INDUSTRIAL: 'Industrial Equipment',\n  MISC_EQUIPMENT: 'Misc Equipment',\n};\n\nexport default function EquipmentDetailPage() {\n  const router = useRouter();\n  const { id } = router.query;\n  \n  const [equipment, setEquipment] = useState<EquipmentData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!id || typeof id !== 'string') return;\n\n    async function fetchEquipment() {\n      try {\n        const response = await fetch(`/api/equipment?id=${encodeURIComponent(id as string)}`);\n        const data = await response.json();\n        \n        if (data.success) {\n          setEquipment(data.data);\n        } else {\n          setError(data.error || 'Equipment not found');\n        }\n      } catch {\n        setError('Failed to load equipment');\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    fetchEquipment();\n  }, [id]);\n\n  if (loading) {\n    return <PageLoading message=\"Loading equipment data...\" />;\n  }\n\n  if (error || !equipment) {\n    return (\n      <PageError\n        title=\"Equipment Not Found\"\n        message={error || 'The requested equipment could not be found.'}\n        backLink=\"/equipment\"\n        backLabel=\"Back to Equipment\"\n      />\n    );\n  }\n\n  const isWeapon = equipment.category?.includes('WEAPON');\n  const hasRangeData = equipment.shortRange || equipment.mediumRange || equipment.longRange;\n\n  return (\n    <PageLayout\n      title={equipment.name}\n      backLink=\"/equipment\"\n      backLabel=\"Back to Equipment\"\n      maxWidth=\"narrow\"\n    >\n      {/* Header Card */}\n      <Card className=\"mb-6\">\n        <div className=\"flex flex-wrap items-start justify-between gap-4\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-white mb-2\">{equipment.name}</h1>\n            <div className=\"flex flex-wrap gap-3 text-sm\">\n              {equipment.category && (\n                <Badge variant=\"cyan\">\n                  {categoryLabels[equipment.category] || equipment.category.replace(/_/g, ' ')}\n                </Badge>\n              )}\n              {equipment.techBase && <TechBaseBadge techBase={equipment.techBase} />}\n              {equipment.rulesLevel && (\n                <Badge variant=\"muted\">{equipment.rulesLevel.replace(/_/g, ' ')}</Badge>\n              )}\n            </div>\n          </div>\n        </div>\n      </Card>\n\n      {/* Basic Stats */}\n      <StatGrid cols={2} className=\"mb-6\">\n        {/* Physical Properties */}\n        <StatCard title=\"Physical Properties\" icon={<CubeIcon />} variant=\"cyan\">\n          <StatList>\n            {equipment.weight !== undefined && (\n              <StatRow label=\"Weight\" value={`${equipment.weight} tons`} />\n            )}\n            {equipment.criticalSlots !== undefined && (\n              <StatRow label=\"Critical Slots\" value={equipment.criticalSlots} />\n            )}\n            {equipment.costCBills !== undefined && (\n              <StatRow \n                label=\"Cost (C-Bills)\" \n                value={equipment.costCBills.toLocaleString()} \n                highlight \n              />\n            )}\n            {equipment.battleValue !== undefined && (\n              <StatRow label=\"Battle Value\" value={equipment.battleValue} />\n            )}\n          </StatList>\n        </StatCard>\n\n        {/* Availability */}\n        <StatCard title=\"Availability\" icon={<CalendarIcon />} variant=\"amber\">\n          <StatList>\n            {equipment.introductionYear !== undefined && (\n              <StatRow label=\"Introduced\" value={equipment.introductionYear} />\n            )}\n            {equipment.extinctionYear !== undefined && (\n              <StatRow label=\"Extinct\" value={equipment.extinctionYear} />\n            )}\n            {equipment.reintroductionYear !== undefined && (\n              <StatRow label=\"Reintroduced\" value={equipment.reintroductionYear} />\n            )}\n          </StatList>\n        </StatCard>\n      </StatGrid>\n\n      {/* Combat Stats (for weapons) */}\n      {isWeapon && (\n        <StatGrid cols={2} className=\"mb-6\">\n          {/* Damage & Heat */}\n          <StatCard title=\"Combat Stats\" icon={<FlameIcon />} variant=\"rose\">\n            <StatList>\n              {equipment.damage !== undefined && (\n                <StatRow label=\"Damage\" value={equipment.damage} highlight />\n              )}\n              {equipment.heat !== undefined && (\n                <StatRow label=\"Heat\" value={equipment.heat} />\n              )}\n              {equipment.ammoPerTon !== undefined && (\n                <StatRow label=\"Ammo/Ton\" value={equipment.ammoPerTon} />\n              )}\n            </StatList>\n          </StatCard>\n\n          {/* Range Data */}\n          {hasRangeData && (\n            <StatCard title=\"Range Profile\" icon={<TargetIcon />} variant=\"emerald\">\n              <StatList>\n                {equipment.minimumRange !== undefined && equipment.minimumRange > 0 && (\n                  <StatRow label=\"Minimum\" value={equipment.minimumRange} />\n                )}\n                {equipment.shortRange !== undefined && (\n                  <StatRow label=\"Short Range\" value={equipment.shortRange} />\n                )}\n                {equipment.mediumRange !== undefined && (\n                  <StatRow label=\"Medium Range\" value={equipment.mediumRange} />\n                )}\n                {equipment.longRange !== undefined && (\n                  <StatRow label=\"Long Range\" value={equipment.longRange} />\n                )}\n                {equipment.extremeRange !== undefined && (\n                  <StatRow label=\"Extreme Range\" value={equipment.extremeRange} />\n                )}\n              </StatList>\n            </StatCard>\n          )}\n        </StatGrid>\n      )}\n\n      {/* Special Rules */}\n      {equipment.specialRules && equipment.specialRules.length > 0 && (\n        <Card variant=\"dark\" className=\"mb-6\">\n          <CardSection title=\"Special Rules\" />\n          <div className=\"flex flex-wrap gap-2\">\n            {equipment.specialRules.map((rule, index) => (\n              <Badge key={index} variant=\"purple\">{rule}</Badge>\n            ))}\n          </div>\n        </Card>\n      )}\n\n      {/* Description */}\n      {equipment.description && (\n        <Card variant=\"dark\">\n          <CardSection title=\"Description\" />\n          <p className=\"text-slate-300 leading-relaxed\">{equipment.description}</p>\n        </Card>\n      )}\n    </PageLayout>\n  );\n}\n\n// Icon Components\nfunction CubeIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6.429 9.75L2.25 12l4.179 2.25m0-4.5l5.571 3 5.571-3m-11.142 0L2.25 7.5 12 2.25l9.75 5.25-4.179 2.25m0 0L21.75 12l-4.179 2.25m0 0l4.179 2.25L12 21.75 2.25 16.5l4.179-2.25m11.142 0l-5.571 3-5.571-3\" />\n    </svg>\n  );\n}\n\nfunction CalendarIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5\" />\n    </svg>\n  );\n}\n\nfunction FlameIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z\" />\n    </svg>\n  );\n}\n\nfunction TargetIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M7.5 3.75H6A2.25 2.25 0 003.75 6v1.5M16.5 3.75H18A2.25 2.25 0 0120.25 6v1.5m0 9V18A2.25 2.25 0 0118 20.25h-1.5m-9 0H6A2.25 2.25 0 013.75 18v-1.5M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n    </svg>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\equipment\\index.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":62,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":62,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":96,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":96,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":98,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":98,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":99,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":99,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":100,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":100,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":102,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":102,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment Browser Page\n * Browse and search the equipment catalog with filtering.\n */\nimport Link from 'next/link';\nimport { useEffect, useState, useCallback } from 'react';\nimport { TechBase } from '@/types/enums/TechBase';\nimport { RulesLevel } from '@/types/enums/RulesLevel';\nimport { EquipmentCategory } from '@/types/equipment';\nimport { \n  PageLayout, \n  PageLoading, \n  PageError,\n  Card,\n  Badge,\n  TechBaseBadge,\n  Button,\n  PaginationButtons,\n  Input,\n  Select,\n  EmptyState,\n} from '@/components/ui';\n\ninterface EquipmentEntry {\n  id: string;\n  name: string;\n  category?: EquipmentCategory;\n  techBase?: TechBase;\n  rulesLevel?: RulesLevel;\n  weight?: number;\n  criticalSlots?: number;\n  damage?: number;\n  heat?: number;\n  costCBills?: number;\n  introductionYear?: number;\n}\n\ninterface FilterState {\n  search: string;\n  category: EquipmentCategory | '';\n  techBase: TechBase | '';\n  rulesLevel: RulesLevel | '';\n}\n\nconst ITEMS_PER_PAGE = 30;\n\n// Category display names and badge colors - uses EquipmentCategory enum values\nconst categoryConfig: Record<EquipmentCategory, { label: string; variant: 'red' | 'orange' | 'cyan' | 'yellow' | 'emerald' | 'violet' }> = {\n  [EquipmentCategory.ENERGY_WEAPON]: { label: 'Energy Weapons', variant: 'red' },\n  [EquipmentCategory.BALLISTIC_WEAPON]: { label: 'Ballistic Weapons', variant: 'red' },\n  [EquipmentCategory.MISSILE_WEAPON]: { label: 'Missile Weapons', variant: 'red' },\n  [EquipmentCategory.ARTILLERY]: { label: 'Artillery', variant: 'red' },\n  [EquipmentCategory.CAPITAL_WEAPON]: { label: 'Capital Weapons', variant: 'red' },\n  [EquipmentCategory.PHYSICAL_WEAPON]: { label: 'Physical Weapons', variant: 'orange' },\n  [EquipmentCategory.AMMUNITION]: { label: 'Ammunition', variant: 'yellow' },\n  [EquipmentCategory.ELECTRONICS]: { label: 'Electronics', variant: 'cyan' },\n  [EquipmentCategory.MOVEMENT]: { label: 'Movement', variant: 'emerald' },\n  [EquipmentCategory.STRUCTURAL]: { label: 'Structural', variant: 'violet' },\n  [EquipmentCategory.MISC_EQUIPMENT]: { label: 'Misc Equipment', variant: 'violet' },\n};\n\nexport default function EquipmentListPage() {\n  const [equipment, setEquipment] = useState<EquipmentEntry[]>([]);\n  const [filteredEquipment, setFilteredEquipment] = useState<EquipmentEntry[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [filters, setFilters] = useState<FilterState>({\n    search: '',\n    category: '',\n    techBase: '',\n    rulesLevel: '',\n  });\n  \n  // Build select options from enums\n  const categoryOptions = Object.values(EquipmentCategory).map(cat => ({\n    value: cat,\n    label: categoryConfig[cat]?.label ?? cat,\n  }));\n\n  const techBaseOptions = Object.values(TechBase).map(tb => ({\n    value: tb,\n    label: tb,\n  }));\n  \n  const rulesLevelOptions = Object.values(RulesLevel).map(rl => ({\n    value: rl,\n    label: rl,\n  }));\n\n  // Fetch equipment on mount\n  useEffect(() => {\n    async function fetchEquipment() {\n      try {\n        const response = await fetch('/api/equipment/catalog');\n        const data = await response.json();\n        \n        if (data.success) {\n          setEquipment(data.data || []);\n          setFilteredEquipment(data.data || []);\n        } else {\n          setError(data.error || 'Failed to load equipment');\n        }\n      } catch {\n        setError('Failed to connect to server');\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    fetchEquipment();\n  }, []);\n\n  // Apply filters\n  const applyFilters = useCallback(() => {\n    let result = [...equipment];\n\n    if (filters.search) {\n      const searchLower = filters.search.toLowerCase();\n      result = result.filter(eq =>\n        eq.name.toLowerCase().includes(searchLower) ||\n        eq.id.toLowerCase().includes(searchLower)\n      );\n    }\n\n    if (filters.category) {\n      result = result.filter(eq => eq.category === filters.category);\n    }\n\n    if (filters.techBase) {\n      result = result.filter(eq => eq.techBase === filters.techBase);\n    }\n\n    if (filters.rulesLevel) {\n      result = result.filter(eq => eq.rulesLevel === filters.rulesLevel);\n    }\n\n    setFilteredEquipment(result);\n    setCurrentPage(1);\n  }, [equipment, filters]);\n\n  useEffect(() => {\n    applyFilters();\n  }, [applyFilters]);\n\n  // Pagination\n  const totalPages = Math.ceil(filteredEquipment.length / ITEMS_PER_PAGE);\n  const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\n  const displayedEquipment = filteredEquipment.slice(startIndex, startIndex + ITEMS_PER_PAGE);\n\n  const handleFilterChange = <K extends keyof FilterState>(key: K, value: FilterState[K]) => {\n    setFilters(prev => ({ ...prev, [key]: value }));\n  };\n\n  const clearFilters = () => {\n    setFilters({ search: '', category: '', techBase: '', rulesLevel: '' });\n  };\n\n  if (loading) {\n    return <PageLoading message=\"Loading equipment catalog...\" />;\n  }\n\n  if (error) {\n    return (\n      <PageError\n        title=\"Error Loading Equipment\"\n        message={error}\n        backLink=\"/\"\n        backLabel=\"Go Home\"\n      />\n    );\n  }\n\n  return (\n    <PageLayout\n      title=\"Equipment Catalog\"\n      subtitle={`Browse ${equipment.length.toLocaleString()} items across all categories`}\n    >\n      {/* Filters */}\n      <Card variant=\"header\" className=\"mb-6\">\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4\">\n          {/* Search */}\n          <div className=\"lg:col-span-2\">\n            <Input\n              type=\"text\"\n              placeholder=\"Search by name...\"\n              value={filters.search}\n              onChange={(e) => handleFilterChange('search', e.target.value)}\n              accent=\"cyan\"\n              aria-label=\"Search equipment by name\"\n            />\n          </div>\n\n          {/* Category */}\n          <Select\n            value={filters.category}\n            onChange={(e) => handleFilterChange('category', e.target.value as EquipmentCategory | '')}\n            options={categoryOptions}\n            placeholder=\"All Categories\"\n            accent=\"cyan\"\n            aria-label=\"Filter by equipment category\"\n          />\n\n          {/* Tech Base */}\n          <Select\n            value={filters.techBase}\n            onChange={(e) => handleFilterChange('techBase', e.target.value as TechBase | '')}\n            options={techBaseOptions}\n            placeholder=\"All Tech Bases\"\n            accent=\"cyan\"\n            aria-label=\"Filter by tech base\"\n          />\n\n          {/* Rules Level */}\n          <Select\n            value={filters.rulesLevel}\n            onChange={(e) => handleFilterChange('rulesLevel', e.target.value as RulesLevel | '')}\n            options={rulesLevelOptions}\n            placeholder=\"All Rules Levels\"\n            accent=\"cyan\"\n            aria-label=\"Filter by rules level\"\n          />\n\n          {/* Clear Filters */}\n          <Button variant=\"secondary\" onClick={clearFilters}>\n            Clear Filters\n          </Button>\n        </div>\n\n        {/* Results count */}\n        <div className=\"mt-4 text-sm text-slate-400\">\n          Showing {displayedEquipment.length} of {filteredEquipment.length} results\n          {filteredEquipment.length !== equipment.length && (\n            <span className=\"text-cyan-400 ml-2\">\n              (filtered from {equipment.length} total)\n            </span>\n          )}\n        </div>\n      </Card>\n\n      {/* Equipment Grid - Compact layout */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2 mb-6\">\n        {displayedEquipment.length === 0 ? (\n          <div className=\"col-span-full\">\n            <EmptyState\n              title=\"No equipment found matching your filters\"\n              action={<Button variant=\"secondary\" onClick={clearFilters}>Clear Filters</Button>}\n            />\n          </div>\n        ) : (\n          displayedEquipment.map((eq) => (\n            <Link\n              key={eq.id}\n              href={`/equipment/${encodeURIComponent(eq.id)}`}\n            >\n              <Card variant=\"interactive\" className=\"h-full !p-2.5\">\n                {/* Top row: Name + Badges stacked */}\n                <div className=\"flex items-start justify-between gap-2\">\n                  {/* Left: Name + Stats */}\n                  <div className=\"flex-1 min-w-0\">\n                    <h3 className=\"text-sm font-medium text-white leading-tight line-clamp-1 mb-1\">\n                      {eq.name}\n                    </h3>\n                    {/* Stats inline under name */}\n                    <div className=\"flex flex-wrap gap-x-2 text-xs text-slate-400\">\n                      {eq.weight !== undefined && (\n                        <span><span className=\"text-slate-300 font-mono\">{eq.weight}</span> tons</span>\n                      )}\n                      {eq.criticalSlots !== undefined && (\n                        <span><span className=\"text-slate-300 font-mono\">{eq.criticalSlots}</span> slots</span>\n                      )}\n                      {eq.damage !== undefined && (\n                        <span><span className=\"text-slate-300 font-mono\">{eq.damage}</span> dmg</span>\n                      )}\n                    </div>\n                  </div>\n                  {/* Right: Badges stacked */}\n                  <div className=\"flex flex-col items-end gap-1 flex-shrink-0\">\n                    {eq.techBase && <TechBaseBadge techBase={eq.techBase} />}\n                    {eq.category && categoryConfig[eq.category as EquipmentCategory] && (\n                      <Badge \n                        variant={categoryConfig[eq.category as EquipmentCategory].variant} \n                        size=\"sm\"\n                      >\n                        {categoryConfig[eq.category as EquipmentCategory].label}\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n              </Card>\n            </Link>\n          ))\n        )}\n      </div>\n\n      {/* Pagination */}\n      <PaginationButtons\n        currentPage={currentPage}\n        totalPages={totalPages}\n        onPageChange={setCurrentPage}\n      />\n    </PageLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\index.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":82,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":82,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":98,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":98,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":99,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":99,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":102,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":102,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":102,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":102,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":103,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":103,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .count on an `any` value.","line":103,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":103,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":107,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":107,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * BattleTech Editor - Home Dashboard\n * Central navigation hub with quick access to all sections and system stats.\n */\nimport Link from 'next/link';\nimport { useEffect, useState } from 'react';\n\ninterface SystemStats {\n  unitCount: number;\n  equipmentCount: number;\n  loading: boolean;\n  error: string | null;\n}\n\ninterface NavigationCard {\n  href: string;\n  title: string;\n  description: string;\n  icon: React.ReactNode;\n  accent: string;\n}\n\nconst navigationCards: NavigationCard[] = [\n  {\n    href: '/units',\n    title: 'Unit Database',\n    description: 'Browse canonical BattleMechs, vehicles, and more',\n    accent: 'from-amber-600 to-orange-700',\n    icon: (\n      <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-8 h-8\">\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 3.75H6.912a2.25 2.25 0 00-2.15 1.588L2.35 13.177a2.25 2.25 0 00-.1.661V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 00-2.15-1.588H15M2.25 13.5h3.86a2.25 2.25 0 012.012 1.244l.256.512a2.25 2.25 0 002.013 1.244h3.218a2.25 2.25 0 002.013-1.244l.256-.512a2.25 2.25 0 012.013-1.244h3.859\" />\n      </svg>\n    ),\n  },\n  {\n    href: '/equipment',\n    title: 'Equipment Catalog',\n    description: 'Explore weapons, electronics, and miscellaneous gear',\n    accent: 'from-cyan-600 to-blue-700',\n    icon: (\n      <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-8 h-8\">\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z\" />\n      </svg>\n    ),\n  },\n  {\n    href: '/customizer',\n    title: 'Unit Customizer',\n    description: 'Build and modify your own custom BattleMech variants',\n    accent: 'from-emerald-600 to-teal-700',\n    icon: (\n      <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-8 h-8\">\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z\" />\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n      </svg>\n    ),\n  },\n  {\n    href: '/compare',\n    title: 'Unit Comparison',\n    description: 'Compare multiple units side-by-side',\n    accent: 'from-violet-600 to-purple-700',\n    icon: (\n      <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-8 h-8\">\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5\" />\n      </svg>\n    ),\n  },\n  {\n    href: '/compendium',\n    title: 'Rules Compendium',\n    description: 'Reference construction rules and game mechanics',\n    accent: 'from-rose-600 to-red-700',\n    icon: (\n      <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-8 h-8\">\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25\" />\n      </svg>\n    ),\n  },\n];\n\nexport default function HomePage() {\n  const [stats, setStats] = useState<SystemStats>({\n    unitCount: 0,\n    equipmentCount: 0,\n    loading: true,\n    error: null,\n  });\n\n  useEffect(() => {\n    async function fetchStats() {\n      try {\n        const [unitsRes, equipmentRes] = await Promise.all([\n          fetch('/api/catalog'),\n          fetch('/api/equipment/catalog'),\n        ]);\n\n        const unitsData = await unitsRes.json();\n        const equipmentData = await equipmentRes.json();\n\n        setStats({\n          unitCount: unitsData.count || 0,\n          equipmentCount: equipmentData.count || 0,\n          loading: false,\n          error: null,\n        });\n      } catch (err) {\n        setStats(prev => ({\n          ...prev,\n          loading: false,\n          error: 'Failed to load stats',\n        }));\n      }\n    }\n\n    fetchStats();\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      {/* Hero Section */}\n      <div className=\"relative overflow-hidden\">\n        {/* Background grid pattern */}\n        <div className=\"absolute inset-0 opacity-5\">\n          <div \n            className=\"h-full w-full\"\n            style={{\n              backgroundImage: 'linear-gradient(rgba(251,191,36,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(251,191,36,0.3) 1px, transparent 1px)',\n              backgroundSize: '40px 40px',\n            }}\n          />\n        </div>\n\n        <div className=\"relative px-6 py-16 sm:px-12 lg:px-20\">\n          <div className=\"max-w-7xl mx-auto\">\n            {/* Title Section */}\n            <div className=\"text-center mb-16\">\n              <h1 className=\"text-5xl sm:text-6xl font-black tracking-tight mb-4\">\n                <span className=\"bg-gradient-to-r from-amber-400 via-yellow-500 to-amber-600 bg-clip-text text-transparent\">\n                  BattleTech\n                </span>\n                <span className=\"text-white\"> Editor</span>\n              </h1>\n              <p className=\"text-slate-400 text-lg max-w-2xl mx-auto\">\n                Your comprehensive toolkit for browsing, building, and customizing BattleMech units.\n                Built with TechManual-accurate construction rules.\n              </p>\n            </div>\n\n            {/* Stats Cards */}\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6 max-w-lg mx-auto mb-16\">\n              <div className=\"bg-slate-800/50 backdrop-blur border border-slate-700 rounded-xl p-6 text-center\">\n                <div className=\"text-3xl font-bold text-amber-400 mb-1\">\n                  {stats.loading ? (\n                    <span className=\"inline-block w-16 h-8 bg-slate-700 rounded animate-pulse\" />\n                  ) : (\n                    stats.unitCount.toLocaleString()\n                  )}\n                </div>\n                <div className=\"text-slate-400 text-sm uppercase tracking-wide\">Canonical Units</div>\n              </div>\n              <div className=\"bg-slate-800/50 backdrop-blur border border-slate-700 rounded-xl p-6 text-center\">\n                <div className=\"text-3xl font-bold text-cyan-400 mb-1\">\n                  {stats.loading ? (\n                    <span className=\"inline-block w-16 h-8 bg-slate-700 rounded animate-pulse\" />\n                  ) : (\n                    stats.equipmentCount.toLocaleString()\n                  )}\n                </div>\n                <div className=\"text-slate-400 text-sm uppercase tracking-wide\">Equipment Items</div>\n              </div>\n            </div>\n\n            {/* Navigation Cards */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto\">\n              {navigationCards.map((card) => (\n                <Link key={card.href} href={card.href}>\n                  <div className=\"group relative bg-slate-800/40 backdrop-blur border border-slate-700/50 rounded-2xl p-6 h-full transition-all duration-300 hover:border-slate-600 hover:bg-slate-800/60 hover:shadow-xl hover:shadow-amber-900/10 cursor-pointer\">\n                    {/* Gradient accent bar */}\n                    <div className={`absolute top-0 left-6 right-6 h-1 bg-gradient-to-r ${card.accent} rounded-b-full opacity-60 group-hover:opacity-100 transition-opacity`} />\n                    \n                    <div className=\"flex items-start gap-4\">\n                      <div className={`p-3 rounded-xl bg-gradient-to-br ${card.accent} text-white shadow-lg`}>\n                        {card.icon}\n                      </div>\n                      <div className=\"flex-1 pt-1\">\n                        <h3 className=\"text-lg font-semibold text-white group-hover:text-amber-400 transition-colors\">\n                          {card.title}\n                        </h3>\n                        <p className=\"text-slate-400 text-sm mt-1 leading-relaxed\">\n                          {card.description}\n                        </p>\n                      </div>\n                    </div>\n\n                    {/* Arrow indicator */}\n                    <div className=\"absolute bottom-4 right-4 text-slate-600 group-hover:text-amber-400 transition-all group-hover:translate-x-1\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className=\"w-5 h-5\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3\" />\n                      </svg>\n                    </div>\n                  </div>\n                </Link>\n              ))}\n            </div>\n\n            {/* Footer info */}\n            <div className=\"text-center mt-16 text-slate-500 text-sm\">\n              <p>\n                Powered by OpenSpec-driven development\n                <span className=\"mx-2\"></span>\n                <span className=\"text-slate-600\">v0.1.0</span>\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\units\\[id].tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":21,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":21,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":35,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":35,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":37,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":37,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":38,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":38,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":40,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":40,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Unit Detail Page\n * Displays full details for a single unit.\n */\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport { IUnitDetails, isArmorFrontRear, calculateTotalArmor } from '@/types/pages';\nimport {\n  PageLayout,\n  PageLoading,\n  PageError,\n  Card,\n  CardSection,\n  Badge,\n  StatRow,\n  StatList,\n  StatCard,\n  StatGrid,\n} from '@/components/ui';\n\nexport default function UnitDetailPage() {\n  const router = useRouter();\n  const { id } = router.query;\n  \n  const [unit, setUnit] = useState<IUnitDetails | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!id || typeof id !== 'string') return;\n\n    async function fetchUnit() {\n      try {\n        const response = await fetch(`/api/units?id=${encodeURIComponent(id as string)}`);\n        const data = await response.json();\n        \n        if (data.success) {\n          setUnit(data.data);\n        } else {\n          setError(data.error || 'Unit not found');\n        }\n      } catch {\n        setError('Failed to load unit');\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    fetchUnit();\n  }, [id]);\n\n  if (loading) {\n    return <PageLoading message=\"Loading unit data...\" />;\n  }\n\n  if (error || !unit) {\n    return (\n      <PageError\n        title=\"Unit Not Found\"\n        message={error || 'The requested unit could not be found.'}\n        backLink=\"/units\"\n        backLabel=\"Back to Units\"\n      />\n    );\n  }\n\n  const displayName = unit.name || `${unit.chassis || ''} ${unit.model || unit.variant || ''}`.trim();\n  const totalArmor = calculateTotalArmor(unit.armor);\n\n  return (\n    <PageLayout\n      title={displayName}\n      backLink=\"/units\"\n      backLabel=\"Back to Units\"\n    >\n      {/* Header Card */}\n      <Card className=\"mb-6\">\n        <div className=\"flex flex-wrap items-start justify-between gap-4\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-white mb-2\">{displayName}</h1>\n            <div className=\"flex flex-wrap gap-3 text-sm\">\n              <Badge variant=\"warning\">{unit.tonnage} tons</Badge>\n              {unit.techBase && (\n                <Badge variant=\"info\">{unit.techBase.replace(/_/g, ' ')}</Badge>\n              )}\n              {unit.unitType && (\n                <Badge variant=\"muted\">{unit.unitType}</Badge>\n              )}\n              {unit.configuration && (\n                <Badge variant=\"muted\">{unit.configuration}</Badge>\n              )}\n            </div>\n          </div>\n          <div className=\"text-right text-slate-400 text-sm\">\n            {unit.era && <div>Era: {unit.era.replace(/_/g, ' ')}</div>}\n            {unit.year && <div>Year: {unit.year}</div>}\n            {unit.rulesLevel && <div>Rules: {unit.rulesLevel.replace(/_/g, ' ')}</div>}\n          </div>\n        </div>\n      </Card>\n\n      {/* Stats Grid */}\n      <StatGrid cols={3} className=\"mb-6\">\n        {/* Movement */}\n        <StatCard title=\"Movement\" icon={<MovementIcon />} variant=\"amber\">\n          <StatList>\n            <StatRow label=\"Walk MP\" value={unit.movement?.walk || ''} />\n            <StatRow\n              label=\"Run MP\"\n              value={unit.movement?.walk ? Math.ceil(unit.movement.walk * 1.5) : ''}\n            />\n            <StatRow label=\"Jump MP\" value={unit.movement?.jump || 0} />\n            {unit.movement?.jumpJetType && (\n              <StatRow label=\"Jump Jets\" value={unit.movement.jumpJetType} mono={false} />\n            )}\n          </StatList>\n          {unit.movement?.enhancements && unit.movement.enhancements.length > 0 && (\n            <div className=\"pt-3 mt-3 border-t border-slate-700\">\n              <span className=\"text-slate-400 text-sm\">Enhancements:</span>\n              <div className=\"flex flex-wrap gap-1 mt-1\">\n                {unit.movement.enhancements.map((e, i) => (\n                  <Badge key={i} variant=\"success\" size=\"sm\">{e}</Badge>\n                ))}\n              </div>\n            </div>\n          )}\n        </StatCard>\n\n        {/* Engine & Structure */}\n        <StatCard title=\"Core Systems\" icon={<GearIcon />} variant=\"cyan\">\n          <StatList>\n            {unit.engine && (\n              <>\n                <StatRow label=\"Engine\" value={unit.engine.type} mono={false} />\n                <StatRow label=\"Rating\" value={unit.engine.rating} />\n              </>\n            )}\n            {unit.gyro && (\n              <StatRow label=\"Gyro\" value={unit.gyro.type} mono={false} />\n            )}\n            {unit.cockpit && (\n              <StatRow label=\"Cockpit\" value={unit.cockpit} mono={false} />\n            )}\n            {unit.structure && (\n              <StatRow label=\"Structure\" value={unit.structure.type} mono={false} />\n            )}\n          </StatList>\n        </StatCard>\n\n        {/* Heat & Armor */}\n        <StatCard title=\"Heat & Armor\" icon={<FlameIcon />} variant=\"rose\">\n          <StatList>\n            {unit.heatSinks && (\n              <>\n                <StatRow label=\"Heat Sinks\" value={unit.heatSinks.count} />\n                <StatRow label=\"Type\" value={unit.heatSinks.type} mono={false} />\n              </>\n            )}\n            {unit.armor && (\n              <>\n                <StatRow label=\"Armor Type\" value={unit.armor.type} mono={false} />\n                <StatRow label=\"Total Armor\" value={`${totalArmor} pts`} />\n              </>\n            )}\n          </StatList>\n        </StatCard>\n      </StatGrid>\n\n      {/* Armor Allocation */}\n      {unit.armor?.allocation && (\n        <Card variant=\"dark\" className=\"mb-6\">\n          <CardSection title=\"Armor Allocation\" />\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4\">\n            {Object.entries(unit.armor.allocation).map(([location, value]) => (\n              <div key={location} className=\"bg-slate-700/30 rounded-lg p-3 text-center\">\n                <div className=\"text-slate-400 text-xs uppercase mb-1\">\n                  {location.replace(/_/g, ' ')}\n                </div>\n                <div className=\"text-white font-mono\">\n                  {typeof value === 'number' ? (\n                    value\n                  ) : isArmorFrontRear(value) ? (\n                    <>\n                      {value.front}\n                      {value.rear > 0 && (\n                        <span className=\"text-slate-500 text-sm\"> / {value.rear}</span>\n                      )}\n                    </>\n                  ) : null}\n                </div>\n              </div>\n            ))}\n          </div>\n        </Card>\n      )}\n\n      {/* Equipment */}\n      {unit.equipment && unit.equipment.length > 0 && (\n        <Card variant=\"dark\" className=\"mb-6 overflow-hidden\">\n          <CardSection title=\"Equipment\" />\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-slate-800/50\">\n                <tr className=\"text-left text-slate-400 text-sm uppercase\">\n                  <th className=\"px-4 py-3\">Equipment</th>\n                  <th className=\"px-4 py-3\">Location</th>\n                  <th className=\"px-4 py-3\">Notes</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-slate-700/50\">\n                {unit.equipment.map((eq, index) => (\n                  <tr key={index} className=\"hover:bg-slate-700/20\">\n                    <td className=\"px-4 py-3 text-white\">{eq.id}</td>\n                    <td className=\"px-4 py-3 text-slate-300\">{eq.location}</td>\n                    <td className=\"px-4 py-3 text-slate-400 text-sm\">\n                      {eq.isRearMounted && (\n                        <Badge variant=\"warning\" size=\"sm\">Rear</Badge>\n                      )}\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </Card>\n      )}\n\n      {/* Quirks */}\n      {unit.quirks && unit.quirks.length > 0 && (\n        <Card variant=\"dark\">\n          <CardSection title=\"Quirks\" />\n          <div className=\"flex flex-wrap gap-2\">\n            {unit.quirks.map((quirk, index) => (\n              <Badge key={index} variant=\"purple\">{quirk}</Badge>\n            ))}\n          </div>\n        </Card>\n      )}\n    </PageLayout>\n  );\n}\n\n// Icon Components\nfunction MovementIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z\" />\n    </svg>\n  );\n}\n\nfunction GearIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z\" />\n    </svg>\n  );\n}\n\nfunction FlameIcon() {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z\" />\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 18a3.75 3.75 0 00.495-7.467 5.99 5.99 0 00-1.925 3.546 5.974 5.974 0 01-2.133-1A3.75 3.75 0 0012 18z\" />\n    </svg>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\pages\\units\\index.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":89,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":89,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":118,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":118,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .success on an `any` value.","line":120,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":120,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":121,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":121,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":122,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":122,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .error on an `any` value.","line":124,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":124,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Units Browser Page\n * Browse and search the canonical unit database with filtering and sorting.\n */\nimport Link from 'next/link';\nimport { useEffect, useState, useCallback, useMemo } from 'react';\nimport { TechBase } from '@/types/enums/TechBase';\nimport { WeightClass } from '@/types/enums/WeightClass';\nimport { RulesLevel, ALL_RULES_LEVELS } from '@/types/enums/RulesLevel';\nimport { IUnitEntry } from '@/types/pages';\nimport {\n  PageLayout,\n  PageLoading,\n  PageError,\n  Card,\n  Input,\n  Select,\n  Button,\n  PaginationButtons,\n  TechBaseBadge,\n  WeightClassBadge,\n} from '@/components/ui';\n\ninterface FilterState {\n  search: string;\n  techBase: string;\n  weightClass: string;\n  rulesLevel: string;\n  yearMin: string;\n  yearMax: string;\n  tonnageMin: string;\n  tonnageMax: string;\n  bvMin: string;\n  bvMax: string;\n}\n\ntype SortColumn = 'chassis' | 'variant' | 'tonnage' | 'year' | 'weightClass' | 'techBase' | 'unitType' | 'rulesLevel' | 'cost' | 'bv';\ntype SortDirection = 'asc' | 'desc';\n\ninterface SortState {\n  column: SortColumn;\n  direction: SortDirection;\n}\n\nconst ITEMS_PER_PAGE = 50;\n\n// Weight class sort order\nconst WEIGHT_CLASS_ORDER: Record<string, number> = {\n  [WeightClass.ULTRALIGHT]: 0,\n  [WeightClass.LIGHT]: 1,\n  [WeightClass.MEDIUM]: 2,\n  [WeightClass.HEAVY]: 3,\n  [WeightClass.ASSAULT]: 4,\n  [WeightClass.SUPERHEAVY]: 5,\n};\n\n// Rules level sort order (ascending complexity)\nconst RULES_LEVEL_ORDER: Record<string, number> = {\n  [RulesLevel.INTRODUCTORY]: 0,\n  [RulesLevel.STANDARD]: 1,\n  [RulesLevel.ADVANCED]: 2,\n  [RulesLevel.EXPERIMENTAL]: 3,\n};\n\n// Rules level display labels\nconst RULES_LEVEL_LABELS: Record<string, string> = {\n  [RulesLevel.INTRODUCTORY]: 'Intro',\n  [RulesLevel.STANDARD]: 'Std',\n  [RulesLevel.ADVANCED]: 'Adv',\n  [RulesLevel.EXPERIMENTAL]: 'Exp',\n};\n\nconst TECH_BASE_OPTIONS = [\n  { value: '', label: 'All Tech' },\n  { value: TechBase.INNER_SPHERE, label: 'Inner Sphere' },\n  { value: TechBase.CLAN, label: 'Clan' },\n];\n\nconst WEIGHT_CLASS_OPTIONS = [\n  { value: '', label: 'All Classes' },\n  ...Object.values(WeightClass).map(wc => ({ value: wc, label: wc })),\n];\n\nconst RULES_LEVEL_OPTIONS = [\n  { value: '', label: 'All Levels' },\n  ...ALL_RULES_LEVELS.map(rl => ({ value: rl, label: rl })),\n];\n\nexport default function UnitsListPage() {\n  const [units, setUnits] = useState<IUnitEntry[]>([]);\n  const [filteredUnits, setFilteredUnits] = useState<IUnitEntry[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [filters, setFilters] = useState<FilterState>({\n    search: '',\n    techBase: '',\n    weightClass: '',\n    rulesLevel: '',\n    yearMin: '',\n    yearMax: '',\n    tonnageMin: '',\n    tonnageMax: '',\n    bvMin: '',\n    bvMax: '',\n  });\n  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);\n  const [sort, setSort] = useState<SortState>({\n    column: 'chassis',\n    direction: 'asc',\n  });\n\n  // Fetch units on mount\n  useEffect(() => {\n    async function fetchUnits() {\n      try {\n        const response = await fetch('/api/catalog');\n        const data = await response.json();\n        \n        if (data.success) {\n          setUnits(data.data || []);\n          setFilteredUnits(data.data || []);\n        } else {\n          setError(data.error || 'Failed to load units');\n        }\n      } catch {\n        setError('Failed to connect to server');\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    fetchUnits();\n  }, []);\n\n  // Apply filters\n  const applyFilters = useCallback(() => {\n    let result = [...units];\n\n    // Text search\n    if (filters.search) {\n      const searchLower = filters.search.toLowerCase();\n      result = result.filter(unit =>\n        unit.name.toLowerCase().includes(searchLower) ||\n        unit.chassis.toLowerCase().includes(searchLower) ||\n        unit.variant.toLowerCase().includes(searchLower)\n      );\n    }\n\n    // Tech base filter\n    if (filters.techBase) {\n      result = result.filter(unit => unit.techBase === filters.techBase);\n    }\n\n    // Weight class filter\n    if (filters.weightClass) {\n      result = result.filter(unit => unit.weightClass === filters.weightClass);\n    }\n\n    // Rules level filter\n    if (filters.rulesLevel) {\n      result = result.filter(unit => unit.rulesLevel === filters.rulesLevel);\n    }\n\n    // Year range filter\n    if (filters.yearMin) {\n      const minYear = parseInt(filters.yearMin, 10);\n      if (!isNaN(minYear)) {\n        result = result.filter(unit => (unit.year ?? 0) >= minYear);\n      }\n    }\n    if (filters.yearMax) {\n      const maxYear = parseInt(filters.yearMax, 10);\n      if (!isNaN(maxYear)) {\n        result = result.filter(unit => (unit.year ?? 9999) <= maxYear);\n      }\n    }\n\n    // Tonnage range filter\n    if (filters.tonnageMin) {\n      const minTon = parseInt(filters.tonnageMin, 10);\n      if (!isNaN(minTon)) {\n        result = result.filter(unit => unit.tonnage >= minTon);\n      }\n    }\n    if (filters.tonnageMax) {\n      const maxTon = parseInt(filters.tonnageMax, 10);\n      if (!isNaN(maxTon)) {\n        result = result.filter(unit => unit.tonnage <= maxTon);\n      }\n    }\n\n    // BV range filter\n    if (filters.bvMin) {\n      const minBV = parseInt(filters.bvMin, 10);\n      if (!isNaN(minBV)) {\n        result = result.filter(unit => (unit.bv ?? 0) >= minBV);\n      }\n    }\n    if (filters.bvMax) {\n      const maxBV = parseInt(filters.bvMax, 10);\n      if (!isNaN(maxBV)) {\n        result = result.filter(unit => (unit.bv ?? 99999) <= maxBV);\n      }\n    }\n\n    setFilteredUnits(result);\n    setCurrentPage(1);\n  }, [units, filters]);\n\n  useEffect(() => {\n    applyFilters();\n  }, [applyFilters]);\n\n  // Sort filtered units\n  const sortedUnits = useMemo(() => {\n    const sorted = [...filteredUnits];\n    const { column, direction } = sort;\n    const multiplier = direction === 'asc' ? 1 : -1;\n\n    sorted.sort((a, b) => {\n      let aVal: string | number;\n      let bVal: string | number;\n\n      switch (column) {\n        case 'chassis':\n          aVal = a.chassis.toLowerCase();\n          bVal = b.chassis.toLowerCase();\n          break;\n        case 'variant':\n          aVal = a.variant.toLowerCase();\n          bVal = b.variant.toLowerCase();\n          break;\n        case 'tonnage':\n          aVal = a.tonnage;\n          bVal = b.tonnage;\n          break;\n        case 'year':\n          aVal = a.year ?? 9999;\n          bVal = b.year ?? 9999;\n          break;\n        case 'weightClass':\n          aVal = WEIGHT_CLASS_ORDER[a.weightClass] ?? 99;\n          bVal = WEIGHT_CLASS_ORDER[b.weightClass] ?? 99;\n          break;\n        case 'techBase':\n          aVal = a.techBase;\n          bVal = b.techBase;\n          break;\n        case 'unitType':\n          aVal = a.unitType;\n          bVal = b.unitType;\n          break;\n        case 'rulesLevel':\n          aVal = RULES_LEVEL_ORDER[a.rulesLevel ?? ''] ?? 99;\n          bVal = RULES_LEVEL_ORDER[b.rulesLevel ?? ''] ?? 99;\n          break;\n        case 'cost':\n          aVal = a.cost ?? 0;\n          bVal = b.cost ?? 0;\n          break;\n        case 'bv':\n          aVal = a.bv ?? 0;\n          bVal = b.bv ?? 0;\n          break;\n        default:\n          return 0;\n      }\n\n      if (aVal < bVal) return -1 * multiplier;\n      if (aVal > bVal) return 1 * multiplier;\n      return 0;\n    });\n\n    return sorted;\n  }, [filteredUnits, sort]);\n\n  // Handle sort column click\n  const handleSort = (column: SortColumn) => {\n    setSort(prev => ({\n      column,\n      direction: prev.column === column && prev.direction === 'asc' ? 'desc' : 'asc',\n    }));\n    setCurrentPage(1);\n  };\n\n  // Pagination\n  const totalPages = Math.ceil(sortedUnits.length / ITEMS_PER_PAGE);\n  const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\n  const displayedUnits = sortedUnits.slice(startIndex, startIndex + ITEMS_PER_PAGE);\n\n  const handleFilterChange = (key: keyof FilterState, value: string) => {\n    setFilters(prev => ({ ...prev, [key]: value }));\n  };\n\n  const clearFilters = () => {\n    setFilters({\n      search: '',\n      techBase: '',\n      weightClass: '',\n      rulesLevel: '',\n      yearMin: '',\n      yearMax: '',\n      tonnageMin: '',\n      tonnageMax: '',\n      bvMin: '',\n      bvMax: '',\n    });\n  };\n\n  // Check if any advanced filters are active\n  const hasAdvancedFilters = Boolean(\n    filters.yearMin || filters.yearMax ||\n    filters.tonnageMin || filters.tonnageMax ||\n    filters.bvMin || filters.bvMax\n  );\n\n  if (loading) {\n    return <PageLoading message=\"Loading unit database...\" />;\n  }\n\n  if (error) {\n    return <PageError title=\"Error Loading Units\" message={error} />;\n  }\n\n  return (\n    <PageLayout\n      title=\"Unit Database\"\n      subtitle={`Browse ${units.length.toLocaleString()} canonical units from all eras`}\n    >\n      {/* Filters */}\n      <Card className=\"mb-6\">\n        {/* Primary Filters Row */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-3\">\n          <div className=\"lg:col-span-2\">\n            <Input\n              type=\"text\"\n              placeholder=\"Search chassis, model, or variant...\"\n              value={filters.search}\n              onChange={(e) => handleFilterChange('search', e.target.value)}\n              aria-label=\"Search units\"\n            />\n          </div>\n\n          <Select\n            value={filters.techBase}\n            onChange={(e) => handleFilterChange('techBase', e.target.value)}\n            options={TECH_BASE_OPTIONS}\n            aria-label=\"Filter by tech base\"\n          />\n\n          <Select\n            value={filters.weightClass}\n            onChange={(e) => handleFilterChange('weightClass', e.target.value)}\n            options={WEIGHT_CLASS_OPTIONS}\n            aria-label=\"Filter by weight class\"\n          />\n\n          <Select\n            value={filters.rulesLevel}\n            onChange={(e) => handleFilterChange('rulesLevel', e.target.value)}\n            options={RULES_LEVEL_OPTIONS}\n            aria-label=\"Filter by rules level\"\n          />\n\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"ghost\"\n              onClick={() => setShowAdvancedFilters(!showAdvancedFilters)}\n              className={`flex-1 text-xs ${hasAdvancedFilters ? 'text-amber-400' : ''}`}\n            >\n              {showAdvancedFilters ? '' : ''} Filters\n              {hasAdvancedFilters && ' '}\n            </Button>\n            <Button variant=\"secondary\" onClick={clearFilters} className=\"text-xs px-3\">\n              Clear\n            </Button>\n          </div>\n        </div>\n\n        {/* Advanced Filters Panel */}\n        {showAdvancedFilters && (\n          <div className=\"mt-4 pt-4 border-t border-slate-700\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {/* Year Range */}\n              <div>\n                <label className=\"block text-xs text-slate-400 mb-1.5 uppercase tracking-wide\">\n                  Design Year\n                </label>\n                <div className=\"flex items-center gap-2\">\n                  <Input\n                    type=\"number\"\n                    placeholder=\"Min\"\n                    value={filters.yearMin}\n                    onChange={(e) => handleFilterChange('yearMin', e.target.value)}\n                    className=\"text-center text-sm\"\n                    min={2000}\n                    max={3150}\n                  />\n                  <span className=\"text-slate-500\"></span>\n                  <Input\n                    type=\"number\"\n                    placeholder=\"Max\"\n                    value={filters.yearMax}\n                    onChange={(e) => handleFilterChange('yearMax', e.target.value)}\n                    className=\"text-center text-sm\"\n                    min={2000}\n                    max={3150}\n                  />\n                </div>\n              </div>\n\n              {/* Tonnage Range */}\n              <div>\n                <label className=\"block text-xs text-slate-400 mb-1.5 uppercase tracking-wide\">\n                  Tonnage\n                </label>\n                <div className=\"flex items-center gap-2\">\n                  <Input\n                    type=\"number\"\n                    placeholder=\"Min\"\n                    value={filters.tonnageMin}\n                    onChange={(e) => handleFilterChange('tonnageMin', e.target.value)}\n                    className=\"text-center text-sm\"\n                    min={10}\n                    max={200}\n                    step={5}\n                  />\n                  <span className=\"text-slate-500\"></span>\n                  <Input\n                    type=\"number\"\n                    placeholder=\"Max\"\n                    value={filters.tonnageMax}\n                    onChange={(e) => handleFilterChange('tonnageMax', e.target.value)}\n                    className=\"text-center text-sm\"\n                    min={10}\n                    max={200}\n                    step={5}\n                  />\n                </div>\n              </div>\n\n              {/* BV Range */}\n              <div>\n                <label className=\"block text-xs text-slate-400 mb-1.5 uppercase tracking-wide\">\n                  Battle Value\n                </label>\n                <div className=\"flex items-center gap-2\">\n                  <Input\n                    type=\"number\"\n                    placeholder=\"Min\"\n                    value={filters.bvMin}\n                    onChange={(e) => handleFilterChange('bvMin', e.target.value)}\n                    className=\"text-center text-sm\"\n                    min={0}\n                    max={5000}\n                    step={50}\n                  />\n                  <span className=\"text-slate-500\"></span>\n                  <Input\n                    type=\"number\"\n                    placeholder=\"Max\"\n                    value={filters.bvMax}\n                    onChange={(e) => handleFilterChange('bvMax', e.target.value)}\n                    className=\"text-center text-sm\"\n                    min={0}\n                    max={5000}\n                    step={50}\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Results Count */}\n        <div className=\"mt-4 flex items-center justify-between text-sm text-slate-400\">\n          <div>\n            Showing {displayedUnits.length} of {filteredUnits.length} results\n            {filteredUnits.length !== units.length && (\n              <span className=\"text-amber-400 ml-2\">\n                (filtered from {units.length.toLocaleString()} total)\n              </span>\n            )}\n          </div>\n          {hasAdvancedFilters && (\n            <div className=\"text-xs text-amber-400/70\">\n              Advanced filters active\n            </div>\n          )}\n        </div>\n      </Card>\n\n      {/* Units Table - Compact */}\n      <Card variant=\"dark\" className=\"overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-slate-800\">\n              <tr className=\"text-left text-slate-400 text-xs uppercase tracking-wide\">\n                <SortableHeader\n                  label=\"Chassis\"\n                  column=\"chassis\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                />\n                <SortableHeader\n                  label=\"Model\"\n                  column=\"variant\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                />\n                <SortableHeader\n                  label=\"Weight\"\n                  column=\"tonnage\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                  className=\"w-20 text-right\"\n                />\n                <SortableHeader\n                  label=\"Year\"\n                  column=\"year\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                  className=\"w-16 text-right\"\n                />\n                <SortableHeader\n                  label=\"Class\"\n                  column=\"weightClass\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                  className=\"w-24\"\n                />\n                <SortableHeader\n                  label=\"Tech\"\n                  column=\"techBase\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                  className=\"w-28\"\n                />\n                <SortableHeader\n                  label=\"Type\"\n                  column=\"unitType\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                  className=\"w-28\"\n                />\n                <SortableHeader\n                  label=\"Level\"\n                  column=\"rulesLevel\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                  className=\"w-16\"\n                />\n                <SortableHeader\n                  label=\"Price\"\n                  column=\"cost\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                  className=\"w-24 text-right\"\n                />\n                <SortableHeader\n                  label=\"BV\"\n                  column=\"bv\"\n                  currentColumn={sort.column}\n                  direction={sort.direction}\n                  onSort={handleSort}\n                  className=\"w-16 text-right\"\n                />\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-slate-700/50\">\n              {displayedUnits.length === 0 ? (\n                <tr>\n                  <td colSpan={10} className=\"px-3 py-8 text-center text-slate-400\">\n                    No units found matching your filters\n                  </td>\n                </tr>\n              ) : (\n                displayedUnits.map((unit) => (\n                  <tr\n                    key={unit.id}\n                    className=\"hover:bg-slate-700/30 transition-colors\"\n                  >\n                    <td className=\"px-3 py-2\">\n                      <Link href={`/units/${unit.id}`} className=\"group\">\n                        <span className=\"font-medium text-sm text-white group-hover:text-amber-400 transition-colors whitespace-nowrap\">\n                          {unit.chassis}\n                        </span>\n                      </Link>\n                    </td>\n                    <td className=\"px-3 py-2 text-slate-300 text-sm whitespace-nowrap\">\n                      {unit.variant}\n                    </td>\n                    <td className=\"px-3 py-2 text-slate-300 font-mono text-sm text-right\">\n                      {unit.tonnage} t\n                    </td>\n                    <td className=\"px-3 py-2 text-slate-400 font-mono text-sm text-right\">\n                      {unit.year ?? ''}\n                    </td>\n                    <td className=\"px-3 py-2\">\n                      <WeightClassBadge weightClass={unit.weightClass} />\n                    </td>\n                    <td className=\"px-3 py-2\">\n                      <TechBaseBadge techBase={unit.techBase} />\n                    </td>\n                    <td className=\"px-3 py-2 text-slate-400 text-sm whitespace-nowrap\">\n                      {unit.unitType === 'BattleMech' ? 'Mek' : unit.unitType}\n                    </td>\n                    <td className=\"px-3 py-2 text-slate-400 text-xs font-mono whitespace-nowrap\">\n                      {RULES_LEVEL_LABELS[unit.rulesLevel ?? ''] ?? unit.rulesLevel ?? ''}\n                    </td>\n                    <td className=\"px-3 py-2 text-slate-300 text-xs font-mono text-right whitespace-nowrap\">\n                      {unit.cost ? `${(unit.cost / 1000000).toPrecision(3)}M` : ''}\n                    </td>\n                    <td className=\"px-3 py-2 text-amber-400 text-xs font-mono text-right whitespace-nowrap font-medium\">\n                      {unit.bv?.toLocaleString() ?? ''}\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      </Card>\n\n      {/* Pagination */}\n      {totalPages > 1 && (\n        <div className=\"flex justify-center mt-6\">\n          <PaginationButtons\n            currentPage={currentPage}\n            totalPages={totalPages}\n            onPageChange={setCurrentPage}\n          />\n        </div>\n      )}\n    </PageLayout>\n  );\n}\n\n// Sortable table header component\ninterface SortableHeaderProps {\n  label: string;\n  column: SortColumn;\n  currentColumn: SortColumn;\n  direction: SortDirection;\n  onSort: (column: SortColumn) => void;\n  className?: string;\n}\n\nfunction SortableHeader({\n  label,\n  column,\n  currentColumn,\n  direction,\n  onSort,\n  className = '',\n}: SortableHeaderProps) {\n  const isActive = column === currentColumn;\n  const isRightAligned = className.includes('text-right');\n\n  return (\n    <th\n      className={`px-3 py-2 font-medium cursor-pointer hover:text-white transition-colors select-none ${className}`}\n      onClick={() => onSort(column)}\n    >\n      <span className={`flex items-center gap-1 ${isRightAligned ? 'justify-end' : ''}`}>\n        {label}\n        {isActive && (\n          <span className=\"text-amber-400 text-[10px]\">\n            {direction === 'asc' ? '' : ''}\n          </span>\n        )}\n      </span>\n    </th>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\common\\errors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\common\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\common\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\construction\\CalculationService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'engineWeight' is assigned a value but never used.","line":200,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":200,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'gyroWeight' is assigned a value but never used.","line":214,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":214,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Calculation Service\n * \n * Computes derived values for mech builds.\n * \n * @spec openspec/specs/construction-services/spec.md\n */\n\nimport { IEditableMech } from './MechBuilderService';\nimport { calculateEngineWeight } from '@/utils/construction/engineCalculations';\nimport { EngineType } from '@/types/construction/EngineType';\nimport { getStructurePoints } from '@/types/construction/InternalStructureType';\nimport { getEquipmentRegistry } from '@/services/equipment/EquipmentRegistry';\nimport { BV2_SPEED_FACTORS } from '@/types/validation/BattleValue';\n\n/**\n * Mech totals summary\n */\nexport interface IMechTotals {\n  readonly totalWeight: number;\n  readonly remainingWeight: number;\n  readonly maxWeight: number;\n  readonly totalArmorPoints: number;\n  readonly maxArmorPoints: number;\n  readonly usedCriticalSlots: number;\n  readonly totalCriticalSlots: number;\n}\n\n/**\n * Heat profile analysis\n */\nexport interface IHeatProfile {\n  readonly heatGenerated: number;\n  readonly heatDissipated: number;\n  readonly netHeat: number;\n  readonly alphaStrikeHeat: number;\n}\n\n/**\n * Movement profile\n */\nexport interface IMovementProfile {\n  readonly walkMP: number;\n  readonly runMP: number;\n  readonly jumpMP: number;\n  readonly sprintMP?: number;\n}\n\n/**\n * Calculation service interface\n */\nexport interface ICalculationService {\n  calculateTotals(mech: IEditableMech): IMechTotals;\n  calculateBattleValue(mech: IEditableMech): number;\n  calculateCost(mech: IEditableMech): number;\n  calculateHeatProfile(mech: IEditableMech): IHeatProfile;\n  calculateMovement(mech: IEditableMech): IMovementProfile;\n}\n\n/**\n * Calculation Service implementation\n */\nexport class CalculationService implements ICalculationService {\n\n  /**\n   * Calculate all totals for a mech\n   */\n  calculateTotals(mech: IEditableMech): IMechTotals {\n    const weights = this.calculateComponentWeights(mech);\n    const totalWeight = Object.values(weights).reduce((sum, w) => sum + w, 0);\n\n    const armorPoints = this.calculateTotalArmorPoints(mech);\n    const maxArmorPoints = this.calculateMaxArmorPoints(mech.tonnage);\n\n    const usedSlots = mech.equipment.length;\n    const totalSlots = 78; // Standard mech has 78 critical slots\n\n    return {\n      totalWeight,\n      remainingWeight: mech.tonnage - totalWeight,\n      maxWeight: mech.tonnage,\n      totalArmorPoints: armorPoints,\n      maxArmorPoints,\n      usedCriticalSlots: usedSlots,\n      totalCriticalSlots: totalSlots,\n    };\n  }\n\n  /**\n   * Calculate Battle Value using BV2 formula\n   * BV = (Defensive BV + Offensive BV)  Speed Factor\n   */\n  calculateBattleValue(mech: IEditableMech): number {\n    // 1. Calculate Defensive BV\n    const defensiveBV = this.calculateDefensiveBV(mech);\n    \n    // 2. Calculate Offensive BV (weapons + ammo)\n    const offensiveBV = this.calculateOffensiveBV(mech);\n    \n    // 3. Calculate heat adjustment factor\n    const heatAdjustment = this.calculateHeatAdjustment(mech);\n    \n    // 4. Get speed factor from movement\n    const movement = this.calculateMovement(mech);\n    const speedFactor = this.getSpeedFactor(movement.runMP, movement.jumpMP);\n    \n    // 5. Apply formula: (Defensive + (Offensive  Heat Adjustment))  Speed Factor\n    const adjustedOffensive = offensiveBV * heatAdjustment;\n    const baseBV = defensiveBV + adjustedOffensive;\n    const finalBV = baseBV * speedFactor;\n    \n    return Math.round(finalBV);\n  }\n\n  /**\n   * Calculate defensive BV from armor and structure\n   */\n  private calculateDefensiveBV(mech: IEditableMech): number {\n    // Armor BV = total armor points  2.5\n    const armorBV = this.calculateTotalArmorPoints(mech) * 2.5;\n    \n    // Structure BV = total structure points  1.5\n    const structureBV = this.calculateTotalStructurePoints(mech) * 1.5;\n    \n    return armorBV + structureBV;\n  }\n\n  /**\n   * Calculate offensive BV from weapons and ammunition\n   */\n  private calculateOffensiveBV(mech: IEditableMech): number {\n    const registry = getEquipmentRegistry();\n    let totalBV = 0;\n    \n    for (const slot of mech.equipment) {\n      const result = registry.lookup(slot.equipmentId);\n      if (result.found && result.equipment && 'battleValue' in result.equipment) {\n        totalBV += (result.equipment as { battleValue: number }).battleValue;\n      }\n    }\n    \n    return totalBV;\n  }\n\n  /**\n   * Calculate heat adjustment factor for BV\n   * If heat generation exceeds dissipation, offensive BV is reduced\n   */\n  private calculateHeatAdjustment(mech: IEditableMech): number {\n    const heatProfile = this.calculateHeatProfile(mech);\n    \n    if (heatProfile.netHeat <= 0) {\n      return 1.0; // No penalty if heat neutral or negative\n    }\n    \n    // Heat penalty: reduce BV by 10% for each point of excess heat (max 50% reduction)\n    const penalty = Math.min(0.5, heatProfile.netHeat * 0.1);\n    return 1.0 - penalty;\n  }\n\n  /**\n   * Get speed factor from BV2 table\n   */\n  private getSpeedFactor(runMP: number, jumpMP: number): number {\n    // Use higher of run or jump (jump weighted)\n    const effectiveSpeed = Math.max(runMP, Math.ceil(jumpMP * 0.5));\n    \n    if (effectiveSpeed <= 0) return BV2_SPEED_FACTORS[0];\n    if (effectiveSpeed >= 25) return BV2_SPEED_FACTORS[25];\n    return BV2_SPEED_FACTORS[effectiveSpeed] ?? 1.0;\n  }\n\n  /**\n   * Calculate total structure points for the mech\n   */\n  private calculateTotalStructurePoints(mech: IEditableMech): number {\n    const locations = ['head', 'centerTorso', 'leftTorso', 'rightTorso',\n                       'leftArm', 'rightArm', 'leftLeg', 'rightLeg'];\n    let total = 0;\n    \n    for (const location of locations) {\n      total += getStructurePoints(mech.tonnage, location);\n    }\n    \n    return total;\n  }\n\n  /**\n   * Calculate C-Bill cost using TechManual formula\n   * Total Cost = (Structure + Engine + Gyro + Cockpit + Armor + Equipment)  Tech Multiplier\n   */\n  calculateCost(mech: IEditableMech): number {\n    // 1. Structure cost: tonnage  400 (standard)\n    let structureCost = mech.tonnage * 400;\n    if (mech.structureType.toLowerCase().includes('endo')) {\n      structureCost *= 2; // Endo Steel is 2 cost\n    }\n    \n    // 2. Engine cost: rating  5000  weight / standard weight\n    const engineWeight = this.getEngineWeight(mech.engineRating, mech.engineType);\n    let engineCostMultiplier = 1.0;\n    if (mech.engineType.toLowerCase().includes('xl')) {\n      engineCostMultiplier = 2.0;\n    } else if (mech.engineType.toLowerCase().includes('light')) {\n      engineCostMultiplier = 1.5;\n    } else if (mech.engineType.toLowerCase().includes('xxl')) {\n      engineCostMultiplier = 3.0;\n    } else if (mech.engineType.toLowerCase().includes('compact')) {\n      engineCostMultiplier = 1.5;\n    }\n    const engineCost = (mech.engineRating * 5000) * engineCostMultiplier;\n    \n    // 3. Gyro cost: rating  300 (standard)\n    const gyroWeight = Math.ceil(mech.engineRating / 100);\n    let gyroCostMultiplier = 1.0;\n    if (mech.gyroType.toLowerCase().includes('xl')) {\n      gyroCostMultiplier = 2.0;\n    } else if (mech.gyroType.toLowerCase().includes('compact')) {\n      gyroCostMultiplier = 4.0;\n    } else if (mech.gyroType.toLowerCase().includes('heavy')) {\n      gyroCostMultiplier = 0.5;\n    }\n    const gyroCost = (mech.engineRating * 300) * gyroCostMultiplier;\n    \n    // 4. Cockpit cost: 200,000 (standard)\n    let cockpitCost = 200000;\n    if (mech.cockpitType.toLowerCase().includes('small')) {\n      cockpitCost = 175000;\n    } else if (mech.cockpitType.toLowerCase().includes('command')) {\n      cockpitCost = 500000;\n    }\n    \n    // 5. Armor cost: armor weight  10,000 (standard)\n    const armorWeight = this.calculateArmorWeight(mech);\n    let armorCostMultiplier = 1.0;\n    if (mech.armorType.toLowerCase().includes('ferro')) {\n      armorCostMultiplier = 2.0;\n    } else if (mech.armorType.toLowerCase().includes('stealth')) {\n      armorCostMultiplier = 5.0;\n    } else if (mech.armorType.toLowerCase().includes('reactive')) {\n      armorCostMultiplier = 3.0;\n    }\n    const armorCost = armorWeight * 10000 * armorCostMultiplier;\n    \n    // 6. Equipment cost: sum of all equipment costs\n    const registry = getEquipmentRegistry();\n    let equipmentCost = 0;\n    for (const slot of mech.equipment) {\n      const result = registry.lookup(slot.equipmentId);\n      if (result.found && result.equipment && 'cost' in result.equipment) {\n        equipmentCost += (result.equipment as { cost: number }).cost;\n      }\n    }\n    \n    // 7. Heat sink cost: 2000 per single, 6000 per double (beyond engine integral)\n    const integralHeatSinks = Math.floor(mech.engineRating / 25);\n    const externalHeatSinks = Math.max(0, mech.heatSinkCount - integralHeatSinks);\n    const heatSinkCostPer = mech.heatSinkType.includes('Double') ? 6000 : 2000;\n    const heatSinkCost = externalHeatSinks * heatSinkCostPer;\n    \n    // Total base cost\n    const baseCost = structureCost + engineCost + gyroCost + cockpitCost + \n                     armorCost + equipmentCost + heatSinkCost;\n    \n    // Apply final multiplier (1.25 for 'Mechs is the standard construction multiplier)\n    return Math.round(baseCost * 1.25);\n  }\n\n  /**\n   * Calculate heat profile from weapons and heat sinks\n   */\n  calculateHeatProfile(mech: IEditableMech): IHeatProfile {\n    // Calculate heat dissipation\n    const heatSinkCapacity = mech.heatSinkType.includes('Double') ? 2 : 1;\n    const heatDissipated = mech.heatSinkCount * heatSinkCapacity;\n\n    // Calculate heat generated from weapons\n    const registry = getEquipmentRegistry();\n    let heatGenerated = 0;\n    \n    for (const slot of mech.equipment) {\n      const result = registry.lookup(slot.equipmentId);\n      if (result.found && result.equipment && 'heat' in result.equipment) {\n        heatGenerated += (result.equipment as { heat: number }).heat;\n      }\n    }\n\n    // Alpha strike heat = total heat from firing all weapons\n    const alphaStrikeHeat = heatGenerated;\n\n    return {\n      heatGenerated,\n      heatDissipated,\n      netHeat: heatGenerated - heatDissipated,\n      alphaStrikeHeat,\n    };\n  }\n\n  /**\n   * Calculate movement profile including jump MP from jump jets\n   */\n  calculateMovement(mech: IEditableMech): IMovementProfile {\n    const walkMP = mech.walkMP;\n    const runMP = Math.floor(walkMP * 1.5); // Per TechManual: floor(walk * 1.5)\n\n    // Calculate jump MP from jump jet count\n    const jumpJetIds = ['jump-jet', 'jump-jet-light', 'jump-jet-medium', 'jump-jet-heavy', \n                        'improved-jump-jet', 'improved-jump-jet-light', 'improved-jump-jet-medium', 'improved-jump-jet-heavy'];\n    const jumpMP = mech.equipment.filter(eq => \n      jumpJetIds.some(id => eq.equipmentId.toLowerCase().includes(id.toLowerCase()))\n    ).length;\n\n    return {\n      walkMP,\n      runMP,\n      jumpMP,\n    };\n  }\n\n  // ============================================================================\n  // HELPER METHODS\n  // ============================================================================\n\n  private calculateComponentWeights(mech: IEditableMech): Record<string, number> {\n    return {\n      structure: mech.tonnage * 0.1, // 10% for standard\n      engine: this.getEngineWeight(mech.engineRating, mech.engineType),\n      gyro: Math.ceil(mech.engineRating / 100),\n      cockpit: 3,\n      armor: this.calculateArmorWeight(mech),\n      heatSinks: Math.max(0, mech.heatSinkCount - 10),\n    };\n  }\n\n  /**\n   * Map engine type string to EngineType enum\n   */\n  private mapEngineType(type: string): EngineType {\n    const typeUpper = type.toUpperCase();\n    if (typeUpper.includes('XL') && typeUpper.includes('CLAN')) {\n      return EngineType.XL_CLAN;\n    }\n    if (typeUpper.includes('XL')) {\n      return EngineType.XL_IS;\n    }\n    if (typeUpper.includes('LIGHT')) {\n      return EngineType.LIGHT;\n    }\n    if (typeUpper.includes('XXL')) {\n      return EngineType.XXL;\n    }\n    if (typeUpper.includes('COMPACT')) {\n      return EngineType.COMPACT;\n    }\n    if (typeUpper.includes('ICE') || typeUpper.includes('COMBUSTION')) {\n      return EngineType.ICE;\n    }\n    if (typeUpper.includes('FUEL')) {\n      return EngineType.FUEL_CELL;\n    }\n    if (typeUpper.includes('FISSION')) {\n      return EngineType.FISSION;\n    }\n    return EngineType.STANDARD;\n  }\n\n  /**\n   * Calculate engine weight using proper TechManual formula\n   */\n  private getEngineWeight(rating: number, type: string): number {\n    const engineType = this.mapEngineType(type);\n    return calculateEngineWeight(rating, engineType);\n  }\n\n  private calculateArmorWeight(mech: IEditableMech): number {\n    const totalPoints = this.calculateTotalArmorPoints(mech);\n    return Math.ceil(totalPoints / 16 * 2) / 2;\n  }\n\n  private calculateTotalArmorPoints(mech: IEditableMech): number {\n    const a = mech.armorAllocation;\n    return (\n      a.head +\n      a.centerTorso + a.centerTorsoRear +\n      a.leftTorso + a.leftTorsoRear +\n      a.rightTorso + a.rightTorsoRear +\n      a.leftArm + a.rightArm +\n      a.leftLeg + a.rightLeg\n    );\n  }\n\n  /**\n   * Calculate maximum armor points from internal structure\n   * Per TechManual: max armor = 2  structure points (head = 9)\n   */\n  private calculateMaxArmorPoints(tonnage: number): number {\n    const locations = ['head', 'centerTorso', 'leftTorso', 'rightTorso', \n                       'leftArm', 'rightArm', 'leftLeg', 'rightLeg'];\n    let maxArmor = 0;\n    \n    for (const location of locations) {\n      if (location === 'head') {\n        maxArmor += 9; // Head max is always 9\n      } else {\n        const structure = getStructurePoints(tonnage, location);\n        maxArmor += structure * 2;\n      }\n    }\n    \n    return maxArmor;\n  }\n}\n\n// Singleton instance\nexport const calculationService = new CalculationService();\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\construction\\MechBuilderService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\construction\\ValidationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\construction\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\conversion\\ConversionValidation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\conversion\\EquipmentNameResolver.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\conversion\\LocationMappings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\conversion\\MTFImportService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ISerializedEngine' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ISerializedGyro' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ISerializedStructure' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ISerializedHeatSinks' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ISerializedMovement' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ISerializedFluff' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mtfContent' is defined but never used. Allowed unused args must match /^_/u.","line":82,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":82,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mtfContent' is defined but never used. Allowed unused args must match /^_/u.","line":96,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'location' is assigned a value but never used.","line":248,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":248,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":331,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":331,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * MTF Import Service\r\n * \r\n * Imports and validates unit data from JSON files converted from MTF format.\r\n * Implements the IMTFImporter interface from UnitSerialization.\r\n * \r\n * @module services/conversion/MTFImportService\r\n */\r\n\r\nimport {\r\n  ISerializedUnit,\r\n  ISerializedEngine,\r\n  ISerializedGyro,\r\n  ISerializedStructure,\r\n  ISerializedArmor,\r\n  ISerializedHeatSinks,\r\n  ISerializedMovement,\r\n  ISerializedEquipment,\r\n  ISerializedCriticalSlots,\r\n  ISerializedFluff,\r\n  IDeserializationResult,\r\n  IMTFImporter,\r\n} from '@/types/unit/UnitSerialization';\r\nimport { getEquipmentRegistry, EquipmentRegistry } from '@/services/equipment/EquipmentRegistry';\r\nimport { getEquipmentNameMapper, EquipmentNameMapper } from '@/services/equipment/EquipmentNameMapper';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\n\r\n/**\r\n * MTF Import result with additional metadata\r\n */\r\nexport interface IMTFImportResult extends IDeserializationResult {\r\n  readonly unitId: string | null;\r\n  readonly equipmentResolutionErrors: string[];\r\n}\r\n\r\n/**\r\n * Validation options\r\n */\r\nexport interface IValidationOptions {\r\n  readonly validateEquipment: boolean;\r\n  readonly validateArmor: boolean;\r\n  readonly validateCriticalSlots: boolean;\r\n  readonly strictMode: boolean;\r\n}\r\n\r\nconst DEFAULT_VALIDATION_OPTIONS: IValidationOptions = {\r\n  validateEquipment: true,\r\n  validateArmor: true,\r\n  validateCriticalSlots: true,\r\n  strictMode: false,\r\n};\r\n\r\n/**\r\n * MTF Import Service\r\n * \r\n * Handles importing and validating unit data from JSON.\r\n */\r\nexport class MTFImportService implements IMTFImporter {\r\n  private static instance: MTFImportService | null = null;\r\n  \r\n  private registry: EquipmentRegistry;\r\n  private nameMapper: EquipmentNameMapper;\r\n  \r\n  private constructor() {\r\n    this.registry = getEquipmentRegistry();\r\n    this.nameMapper = getEquipmentNameMapper();\r\n  }\r\n  \r\n  /**\r\n   * Get singleton instance\r\n   */\r\n  static getInstance(): MTFImportService {\r\n    if (!MTFImportService.instance) {\r\n      MTFImportService.instance = new MTFImportService();\r\n    }\r\n    return MTFImportService.instance;\r\n  }\r\n  \r\n  /**\r\n   * Import unit from MTF content (not implemented - use importFromJSON)\r\n   */\r\n  import(mtfContent: string): IDeserializationResult {\r\n    // This interface method is for raw MTF text parsing\r\n    // For JSON import, use importFromJSON\r\n    return {\r\n      success: false,\r\n      errors: ['Direct MTF parsing not implemented. Use importFromJSON for pre-converted JSON.'],\r\n      warnings: [],\r\n      migrations: [],\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Validate MTF content (not implemented - use validateJSON)\r\n   */\r\n  validate(mtfContent: string): { isValid: boolean; errors: string[] } {\r\n    return {\r\n      isValid: false,\r\n      errors: ['Direct MTF validation not implemented. Use validateJSON for JSON data.'],\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Import unit from pre-converted JSON data\r\n   */\r\n  importFromJSON(data: ISerializedUnit, options?: Partial<IValidationOptions>): IMTFImportResult {\r\n    const opts = { ...DEFAULT_VALIDATION_OPTIONS, ...options };\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n    const migrations: string[] = [];\r\n    const equipmentResolutionErrors: string[] = [];\r\n    \r\n    try {\r\n      // Validate required fields\r\n      const fieldErrors = this.validateRequiredFields(data);\r\n      errors.push(...fieldErrors);\r\n      \r\n      if (errors.length > 0 && opts.strictMode) {\r\n        return {\r\n          success: false,\r\n          unit: undefined,\r\n          errors,\r\n          warnings,\r\n          migrations,\r\n          unitId: data.id || null,\r\n          equipmentResolutionErrors,\r\n        };\r\n      }\r\n      \r\n      // Validate equipment references\r\n      if (opts.validateEquipment && data.equipment) {\r\n        const equipmentResults = this.validateEquipmentReferences(data.equipment, data.techBase);\r\n        equipmentResolutionErrors.push(...equipmentResults.errors);\r\n        warnings.push(...equipmentResults.warnings);\r\n      }\r\n      \r\n      // Validate armor allocation\r\n      if (opts.validateArmor && data.armor) {\r\n        const armorResults = this.validateArmorAllocation(data.armor, data.tonnage);\r\n        warnings.push(...armorResults.warnings);\r\n        if (opts.strictMode) {\r\n          errors.push(...armorResults.errors);\r\n        } else {\r\n          warnings.push(...armorResults.errors);\r\n        }\r\n      }\r\n      \r\n      // Validate critical slots\r\n      if (opts.validateCriticalSlots && data.criticalSlots) {\r\n        const slotResults = this.validateCriticalSlots(data.criticalSlots);\r\n        warnings.push(...slotResults.warnings);\r\n      }\r\n      \r\n      // Success - return the validated data\r\n      // Note: We return undefined for unit since we don't construct IBattleMech here\r\n      // That's the job of UnitFactoryService\r\n      return {\r\n        success: errors.length === 0,\r\n        unit: undefined,\r\n        errors,\r\n        warnings,\r\n        migrations,\r\n        unitId: data.id,\r\n        equipmentResolutionErrors,\r\n      };\r\n    } catch (e) {\r\n      errors.push(`Import failed: ${e}`);\r\n      return {\r\n        success: false,\r\n        unit: undefined,\r\n        errors,\r\n        warnings,\r\n        migrations,\r\n        unitId: data.id || null,\r\n        equipmentResolutionErrors,\r\n      };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Validate required fields\r\n   */\r\n  private validateRequiredFields(data: ISerializedUnit): string[] {\r\n    const errors: string[] = [];\r\n    \r\n    if (!data.id) errors.push('Missing required field: id');\r\n    if (!data.chassis) errors.push('Missing required field: chassis');\r\n    if (!data.model) errors.push('Missing required field: model');\r\n    if (!data.unitType) errors.push('Missing required field: unitType');\r\n    if (!data.configuration) errors.push('Missing required field: configuration');\r\n    if (!data.techBase) errors.push('Missing required field: techBase');\r\n    if (!data.rulesLevel) errors.push('Missing required field: rulesLevel');\r\n    if (!data.era) errors.push('Missing required field: era');\r\n    if (data.year === undefined) errors.push('Missing required field: year');\r\n    if (data.tonnage === undefined) errors.push('Missing required field: tonnage');\r\n    if (!data.engine) errors.push('Missing required field: engine');\r\n    if (!data.gyro) errors.push('Missing required field: gyro');\r\n    if (!data.cockpit) errors.push('Missing required field: cockpit');\r\n    if (!data.structure) errors.push('Missing required field: structure');\r\n    if (!data.armor) errors.push('Missing required field: armor');\r\n    if (!data.heatSinks) errors.push('Missing required field: heatSinks');\r\n    if (!data.movement) errors.push('Missing required field: movement');\r\n    if (!data.equipment) errors.push('Missing required field: equipment');\r\n    if (!data.criticalSlots) errors.push('Missing required field: criticalSlots');\r\n    \r\n    return errors;\r\n  }\r\n  \r\n  /**\r\n   * Validate equipment references\r\n   */\r\n  private validateEquipmentReferences(\r\n    equipment: readonly ISerializedEquipment[],\r\n    techBase: string\r\n  ): { errors: string[]; warnings: string[] } {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n    \r\n    const parsedTechBase = this.parseTechBase(techBase);\r\n    \r\n    for (const item of equipment) {\r\n      const result = this.nameMapper.mapName(item.id, parsedTechBase);\r\n      \r\n      if (!result.success) {\r\n        errors.push(`Unknown equipment: ${item.id}`);\r\n        if (result.alternates && result.alternates.length > 0) {\r\n          warnings.push(`Suggestions for \"${item.id}\": ${result.alternates.join(', ')}`);\r\n        }\r\n      }\r\n    }\r\n    \r\n    return { errors, warnings };\r\n  }\r\n  \r\n  /**\r\n   * Validate armor allocation\r\n   */\r\n  private validateArmorAllocation(\r\n    armor: ISerializedArmor,\r\n    tonnage: number\r\n  ): { errors: string[]; warnings: string[] } {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n    \r\n    // Calculate total armor points\r\n    let totalArmor = 0;\r\n    \r\n    for (const [location, value] of Object.entries(armor.allocation)) {\r\n      if (typeof value === 'number') {\r\n        totalArmor += value;\r\n      } else if (typeof value === 'object' && value !== null) {\r\n        totalArmor += (value as { front: number; rear: number }).front;\r\n        totalArmor += (value as { front: number; rear: number }).rear;\r\n      }\r\n    }\r\n    \r\n    // Maximum armor = tonnage * 16 (for standard armor)\r\n    const maxArmor = tonnage * 16;\r\n    if (totalArmor > maxArmor) {\r\n      errors.push(`Armor exceeds maximum: ${totalArmor} > ${maxArmor}`);\r\n    }\r\n    \r\n    // Check head armor max (9)\r\n    const headArmor = armor.allocation['HEAD'];\r\n    if (typeof headArmor === 'number' && headArmor > 9) {\r\n      errors.push(`Head armor exceeds maximum: ${headArmor} > 9`);\r\n    }\r\n    \r\n    return { errors, warnings };\r\n  }\r\n  \r\n  /**\r\n   * Validate critical slots\r\n   */\r\n  private validateCriticalSlots(\r\n    criticalSlots: ISerializedCriticalSlots\r\n  ): { errors: string[]; warnings: string[] } {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n    \r\n    // Expected slot counts per location\r\n    const expectedSlots: Record<string, number> = {\r\n      'HEAD': 6,\r\n      'CENTER_TORSO': 12,\r\n      'LEFT_TORSO': 12,\r\n      'RIGHT_TORSO': 12,\r\n      'LEFT_ARM': 12,\r\n      'RIGHT_ARM': 12,\r\n      'LEFT_LEG': 6,\r\n      'RIGHT_LEG': 6,\r\n    };\r\n    \r\n    for (const [location, slots] of Object.entries(criticalSlots)) {\r\n      const expected = expectedSlots[location];\r\n      if (expected && slots.length !== expected) {\r\n        warnings.push(`${location} has ${slots.length} slots, expected ${expected}`);\r\n      }\r\n    }\r\n    \r\n    return { errors, warnings };\r\n  }\r\n  \r\n  /**\r\n   * Parse tech base string to enum\r\n   * Per spec VAL-ENUM-004: Components must have binary tech base (IS or Clan).\r\n   */\r\n  private parseTechBase(value: string): TechBase {\r\n    switch (value.toUpperCase()) {\r\n      case 'CLAN':\r\n        return TechBase.CLAN;\r\n      case 'INNER_SPHERE':\r\n      case 'IS':\r\n      case 'BOTH':\r\n      case 'MIXED':\r\n      default:\r\n        // Per spec: Default to IS for mixed/unknown\r\n        return TechBase.INNER_SPHERE;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Load and import a unit from a URL\r\n   */\r\n  async loadFromUrl(url: string, options?: Partial<IValidationOptions>): Promise<IMTFImportResult> {\r\n    try {\r\n      const response = await fetch(url);\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n      \r\n      const data: ISerializedUnit = await response.json();\r\n      return this.importFromJSON(data, options);\r\n    } catch (e) {\r\n      return {\r\n        success: false,\r\n        unit: undefined,\r\n        errors: [`Failed to load unit from ${url}: ${e}`],\r\n        warnings: [],\r\n        migrations: [],\r\n        unitId: null,\r\n        equipmentResolutionErrors: [],\r\n      };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Validate JSON data without full import\r\n   */\r\n  validateJSON(data: unknown): { isValid: boolean; errors: string[] } {\r\n    const errors: string[] = [];\r\n    \r\n    if (!data || typeof data !== 'object') {\r\n      return { isValid: false, errors: ['Data must be an object'] };\r\n    }\r\n    \r\n    const unit = data as Record<string, unknown>;\r\n    \r\n    // Check required string fields\r\n    const requiredStrings = ['id', 'chassis', 'model', 'unitType', 'configuration', 'techBase', 'rulesLevel', 'era'];\r\n    for (const field of requiredStrings) {\r\n      if (typeof unit[field] !== 'string') {\r\n        errors.push(`Field \"${field}\" must be a string`);\r\n      }\r\n    }\r\n    \r\n    // Check required number fields\r\n    const requiredNumbers = ['year', 'tonnage'];\r\n    for (const field of requiredNumbers) {\r\n      if (typeof unit[field] !== 'number') {\r\n        errors.push(`Field \"${field}\" must be a number`);\r\n      }\r\n    }\r\n    \r\n    // Check required object fields\r\n    const requiredObjects = ['engine', 'gyro', 'structure', 'armor', 'heatSinks', 'movement', 'criticalSlots'];\r\n    for (const field of requiredObjects) {\r\n      if (!unit[field] || typeof unit[field] !== 'object') {\r\n        errors.push(`Field \"${field}\" must be an object`);\r\n      }\r\n    }\r\n    \r\n    // Check equipment array\r\n    if (!Array.isArray(unit.equipment)) {\r\n      errors.push('Field \"equipment\" must be an array');\r\n    }\r\n    \r\n    return { isValid: errors.length === 0, errors };\r\n  }\r\n  \r\n  /**\r\n   * Resolve equipment IDs for a unit\r\n   */\r\n  resolveEquipment(equipmentIds: string[]): {\r\n    resolved: Map<string, string>;\r\n    unresolved: string[];\r\n  } {\r\n    const resolved = new Map<string, string>();\r\n    const unresolved: string[] = [];\r\n    \r\n    for (const id of equipmentIds) {\r\n      const mappedId = this.registry.resolveEquipmentName(id);\r\n      if (mappedId) {\r\n        resolved.set(id, mappedId);\r\n      } else {\r\n        unresolved.push(id);\r\n      }\r\n    }\r\n    \r\n    return { resolved, unresolved };\r\n  }\r\n}\r\n\r\n/**\r\n * Convenience function to get the import service instance\r\n */\r\nexport function getMTFImportService(): MTFImportService {\r\n  return MTFImportService.getInstance();\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\conversion\\UnitFormatConverter.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RulesLevel' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Era' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WeightClass' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getWeightClass' is defined but never used.","line":13,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EngineType' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InternalStructureType' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HeatSinkType' is defined but never used.","line":16,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArmorTypeEnum' is defined but never used.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MechLocation' is defined but never used.","line":20,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IArmorAllocation' is defined but never used.","line":21,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UnitType' is defined but never used.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MechConfiguration' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IUnitMetadata' is defined but never used.","line":25,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IEngineConfiguration' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IGyroConfiguration' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IStructureConfiguration' is defined but never used.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IHeatSinkConfiguration' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IMovementConfiguration' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IMountedEquipment' is defined but never used.","line":31,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ICriticalSlotAssignment' is defined but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ICriticalSlot' is defined but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IBattleMech' is defined but never used.","line":34,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IOmniMech' is defined but never used.","line":35,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mapGyroType' is defined but never used.","line":51,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculateTotalArmor' is defined but never used.","line":59,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ParsedCriticalSlots' is defined but never used.","line":63,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BIPED_SLOT_COUNTS' is defined but never used.","line":64,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EquipmentResolution' is defined but never used.","line":69,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cockpit' is assigned a value but never used.","line":307,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":307,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'source' is defined but never used. Allowed unused args must match /^_/u.","line":392,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":392,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'itemName' is defined but never used. Allowed unused args must match /^_/u.","line":597,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":597,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":31,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Unit Format Converter Service\n * \n * Converts MegaMekLab JSON format to the internal typed format.\n * \n * @spec unit-json.plan.md\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport { TechBase } from '@/types/enums/TechBase';\nimport { RulesLevel } from '@/types/enums/RulesLevel';\nimport { Era } from '@/types/enums/Era';\nimport { WeightClass, getWeightClass } from '@/types/enums/WeightClass';\nimport { EngineType } from '@/types/construction/EngineType';\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\nimport { GyroType } from '@/types/construction/GyroType';\nimport { CockpitType } from '@/types/construction/CockpitType';\nimport { MechLocation } from '@/types/construction/CriticalSlotAllocation';\nimport { IArmorAllocation } from '@/types/construction/ComponentInterfaces';\nimport {\n  UnitType,\n  MechConfiguration,\n  IUnitMetadata,\n  IEngineConfiguration,\n  IGyroConfiguration,\n  IStructureConfiguration,\n  IHeatSinkConfiguration,\n  IMovementConfiguration,\n  IMountedEquipment,\n  ICriticalSlotAssignment,\n  ICriticalSlot,\n  IBattleMech,\n  IOmniMech,\n} from '@/types/unit/BattleMechInterfaces';\nimport {\n  ISerializedUnit,\n  ISerializedFluff,\n} from '@/types/unit/UnitSerialization';\n\nimport {\n  mapTechBase,\n  mapRulesLevel,\n  mapEra,\n  extractYear,\n  mapEngineType,\n  mapStructureType,\n  mapHeatSinkType,\n  mapArmorType,\n  mapGyroType,\n  mapMechConfiguration,\n  isOmniMechConfig,\n} from './ValueMappings';\n\nimport {\n  parseLocation,\n  convertArmorLocations,\n  calculateTotalArmor,\n  parseCriticalSlots,\n  SourceArmorLocation,\n  SourceCriticalEntry,\n  ParsedCriticalSlots,\n  BIPED_SLOT_COUNTS,\n} from './LocationMappings';\n\nimport {\n  equipmentNameResolver,\n  EquipmentResolution,\n} from './EquipmentNameResolver';\n\n// ============================================================================\n// SOURCE DATA TYPES\n// ============================================================================\n\n/**\n * MegaMekLab source unit format\n */\nexport interface MegaMekLabUnit {\n  chassis: string;\n  model: string;\n  mul_id: string | number;\n  config: string;\n  tech_base: string;\n  era: string | number;\n  source: string;\n  rules_level: string | number;\n  role?: string;\n  mass: number;\n  \n  engine: {\n    type: string;\n    rating: number;\n    manufacturer?: string;\n  };\n  \n  structure: {\n    type: string;\n    manufacturer?: string | null;\n  };\n  \n  myomer?: {\n    type: string;\n    manufacturer?: string | null;\n  };\n  \n  heat_sinks: {\n    type: string;\n    count: number;\n  };\n  \n  walk_mp: string | number;\n  jump_mp: string | number;\n  \n  armor: {\n    type: string;\n    manufacturer?: string;\n    locations: SourceArmorLocation[];\n    total_armor_points?: number;\n  };\n  \n  weapons_and_equipment: MegaMekLabEquipmentItem[];\n  criticals: SourceCriticalEntry[];\n  \n  quirks?: string[];\n  manufacturers?: MegaMekLabManufacturer[];\n  system_manufacturers?: MegaMekLabSystemManufacturer[];\n  fluff_text?: MegaMekLabFluff;\n  \n  // OmniMech specific\n  is_omnimech?: boolean;\n  omnimech_base_chassis?: string;\n  omnimech_configuration?: string;\n  base_chassis_heat_sinks?: string | number;\n  \n  // Clan alternate name\n  clanname?: string;\n}\n\n/**\n * MegaMekLab equipment item format\n */\nexport interface MegaMekLabEquipmentItem {\n  item_name: string;\n  location: string;\n  item_type: string;\n  tech_base: string;\n  is_omnipod?: boolean;\n  rear_facing?: boolean;\n  turret_mounted?: boolean;\n}\n\n/**\n * MegaMekLab manufacturer info\n */\nexport interface MegaMekLabManufacturer {\n  name: string;\n  location?: string;\n}\n\n/**\n * MegaMekLab system manufacturer info\n */\nexport interface MegaMekLabSystemManufacturer {\n  type: string;\n  name: string;\n}\n\n/**\n * MegaMekLab fluff text\n */\nexport interface MegaMekLabFluff {\n  overview?: string;\n  capabilities?: string;\n  deployment?: string;\n  history?: string;\n  notes?: string;\n}\n\n// ============================================================================\n// CONVERSION RESULT TYPES\n// ============================================================================\n\n/**\n * Conversion warning\n */\nexport interface ConversionWarning {\n  readonly field: string;\n  readonly message: string;\n  readonly sourceValue?: unknown;\n}\n\n/**\n * Conversion result\n */\nexport interface ConversionResult {\n  readonly success: boolean;\n  readonly unit: ISerializedUnit | null;\n  readonly warnings: ConversionWarning[];\n  readonly errors: string[];\n}\n\n/**\n * Batch conversion result\n */\nexport interface BatchConversionResult {\n  readonly total: number;\n  readonly successful: number;\n  readonly failed: number;\n  readonly results: ConversionResult[];\n}\n\n// ============================================================================\n// UNIT FORMAT CONVERTER\n// ============================================================================\n\n/**\n * Unit Format Converter\n * \n * Converts MegaMekLab JSON format to internal serialized format.\n */\nexport class UnitFormatConverter {\n  private warnings: ConversionWarning[] = [];\n  private errors: string[] = [];\n  \n  /**\n   * Convert a MegaMekLab unit to serialized format\n   */\n  convert(source: MegaMekLabUnit): ConversionResult {\n    this.warnings = [];\n    this.errors = [];\n    \n    try {\n      const unit = this.convertUnit(source);\n      \n      return {\n        success: true,\n        unit,\n        warnings: this.warnings,\n        errors: this.errors,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        unit: null,\n        warnings: this.warnings,\n        errors: [...this.errors, error instanceof Error ? error.message : String(error)],\n      };\n    }\n  }\n  \n  /**\n   * Convert a batch of units\n   */\n  convertBatch(sources: MegaMekLabUnit[]): BatchConversionResult {\n    const results: ConversionResult[] = [];\n    let successful = 0;\n    let failed = 0;\n    \n    for (const source of sources) {\n      const result = this.convert(source);\n      results.push(result);\n      \n      if (result.success) {\n        successful++;\n      } else {\n        failed++;\n      }\n    }\n    \n    return {\n      total: sources.length,\n      successful,\n      failed,\n      results,\n    };\n  }\n  \n  /**\n   * Main conversion logic\n   */\n  private convertUnit(source: MegaMekLabUnit): ISerializedUnit {\n    // Generate unique ID\n    const id = this.generateUnitId(source);\n    \n    // Convert tech base\n    const techBase = mapTechBase(source.tech_base);\n    \n    // Convert era and year\n    const era = mapEra(source.era);\n    const year = extractYear(source.era);\n    \n    // Convert rules level\n    const rulesLevel = mapRulesLevel(source.rules_level);\n    \n    // Convert configuration\n    const configuration = mapMechConfiguration(source.config);\n    const isOmni = isOmniMechConfig(source.config) || source.is_omnimech === true;\n    \n    // Convert engine\n    const engine = this.convertEngine(source.engine, techBase);\n    \n    // Convert gyro (defaults to standard - source doesn't always specify)\n    const gyro = this.convertGyro(source, techBase);\n    \n    // Convert cockpit (defaults to standard - source doesn't always specify)\n    const cockpit = this.convertCockpit(source);\n    \n    // Convert structure\n    const structure = this.convertStructure(source.structure, techBase);\n    \n    // Convert armor\n    const armor = this.convertArmor(source.armor, techBase);\n    \n    // Convert heat sinks\n    const heatSinks = this.convertHeatSinks(source.heat_sinks, source.engine.rating, techBase);\n    \n    // Convert movement\n    const movement = this.convertMovement(source);\n    \n    // Convert equipment\n    const equipment = this.convertEquipment(source.weapons_and_equipment, techBase);\n    \n    // Convert critical slots\n    const criticalSlots = this.convertCriticals(source.criticals);\n    \n    // Convert fluff\n    const fluff = this.convertFluff(source);\n    \n    return {\n      id,\n      chassis: source.chassis,\n      model: source.model,\n      variant: source.clanname || source.omnimech_configuration,\n      unitType: isOmni ? 'OmniMech' : 'BattleMech',\n      configuration: configuration,\n      techBase: techBase,\n      rulesLevel: rulesLevel,\n      era: era,\n      year,\n      tonnage: source.mass,\n      engine,\n      gyro,\n      cockpit: CockpitType.STANDARD, // Default - source doesn't usually specify\n      structure,\n      armor,\n      heatSinks,\n      movement,\n      equipment,\n      criticalSlots,\n      quirks: source.quirks,\n      fluff,\n    };\n  }\n  \n  /**\n   * Generate a unique ID for the unit\n   */\n  private generateUnitId(source: MegaMekLabUnit): string {\n    // Use MUL ID if available\n    if (source.mul_id) {\n      return `mul-${source.mul_id}`;\n    }\n    \n    // Generate from chassis and model\n    const sanitized = `${source.chassis}-${source.model}`\n      .toLowerCase()\n      .replace(/[^a-z0-9]+/g, '-')\n      .replace(/^-|-$/g, '');\n    \n    return sanitized || uuidv4();\n  }\n  \n  /**\n   * Convert engine data\n   */\n  private convertEngine(\n    source: { type: string; rating: number; manufacturer?: string },\n    techBase: TechBase\n  ): { type: string; rating: number } {\n    const engineType = mapEngineType(source.type, techBase);\n    \n    return {\n      type: engineType,\n      rating: source.rating,\n    };\n  }\n  \n  /**\n   * Convert gyro data\n   */\n  private convertGyro(source: MegaMekLabUnit, _techBase: TechBase): { type: string } {\n    // MegaMekLab doesn't usually include gyro type in exported JSON\n    // We default to standard, but could infer from criticals\n    return {\n      type: GyroType.STANDARD,\n    };\n  }\n  \n  /**\n   * Convert cockpit data\n   */\n  private convertCockpit(_source: MegaMekLabUnit): string {\n    // MegaMekLab doesn't usually include cockpit type in exported JSON\n    return CockpitType.STANDARD;\n  }\n  \n  /**\n   * Convert structure data\n   */\n  private convertStructure(\n    source: { type: string; manufacturer?: string | null },\n    techBase: TechBase\n  ): { type: string } {\n    const structureType = mapStructureType(source.type, techBase);\n    \n    return {\n      type: structureType,\n    };\n  }\n  \n  /**\n   * Convert armor data\n   */\n  private convertArmor(\n    source: { type: string; manufacturer?: string; locations: SourceArmorLocation[]; total_armor_points?: number },\n    techBase: TechBase\n  ): { type: string; allocation: Record<string, number | { front: number; rear: number }> } {\n    const armorType = mapArmorType(source.type, techBase);\n    const allocation = convertArmorLocations(source.locations);\n    \n    // Convert IArmorAllocation to serialized format\n    const serializedAllocation: Record<string, number | { front: number; rear: number }> = {\n      head: allocation.head,\n      centerTorso: {\n        front: allocation.centerTorso,\n        rear: allocation.centerTorsoRear,\n      },\n      leftTorso: {\n        front: allocation.leftTorso,\n        rear: allocation.leftTorsoRear,\n      },\n      rightTorso: {\n        front: allocation.rightTorso,\n        rear: allocation.rightTorsoRear,\n      },\n      leftArm: allocation.leftArm,\n      rightArm: allocation.rightArm,\n      leftLeg: allocation.leftLeg,\n      rightLeg: allocation.rightLeg,\n    };\n    \n    return {\n      type: armorType,\n      allocation: serializedAllocation,\n    };\n  }\n  \n  /**\n   * Convert heat sinks data\n   */\n  private convertHeatSinks(\n    source: { type: string; count: number },\n    engineRating: number,\n    techBase: TechBase\n  ): { type: string; count: number } {\n    const heatSinkType = mapHeatSinkType(source.type, techBase);\n    \n    return {\n      type: heatSinkType,\n      count: source.count,\n    };\n  }\n  \n  /**\n   * Convert movement data\n   */\n  private convertMovement(source: MegaMekLabUnit): {\n    walk: number;\n    jump: number;\n    jumpJetType?: string;\n    enhancements?: string[];\n  } {\n    const walkMP = typeof source.walk_mp === 'string' \n      ? parseInt(source.walk_mp, 10) \n      : source.walk_mp;\n    \n    const jumpMP = typeof source.jump_mp === 'string'\n      ? parseInt(source.jump_mp, 10)\n      : source.jump_mp;\n    \n    // Detect movement enhancements from equipment\n    const enhancements: string[] = [];\n    for (const item of source.weapons_and_equipment) {\n      const lowerType = item.item_type.toLowerCase();\n      if (lowerType.includes('masc')) {\n        enhancements.push('MASC');\n      }\n      if (lowerType.includes('tsm') || lowerType.includes('triplestrength')) {\n        enhancements.push('TSM');\n      }\n      if (lowerType.includes('supercharger')) {\n        enhancements.push('Supercharger');\n      }\n    }\n    \n    // Detect jump jet type from equipment\n    let jumpJetType: string | undefined;\n    for (const item of source.weapons_and_equipment) {\n      const lowerType = item.item_type.toLowerCase();\n      if (lowerType.includes('improved') && lowerType.includes('jump')) {\n        jumpJetType = 'Improved';\n        break;\n      } else if (lowerType.includes('jump')) {\n        jumpJetType = 'Standard';\n      }\n    }\n    \n    return {\n      walk: walkMP || 0,\n      jump: jumpMP || 0,\n      jumpJetType: jumpMP > 0 ? jumpJetType : undefined,\n      enhancements: enhancements.length > 0 ? enhancements : undefined,\n    };\n  }\n  \n  /**\n   * Convert equipment items\n   */\n  private convertEquipment(\n    items: MegaMekLabEquipmentItem[],\n    unitTechBase: TechBase\n  ): Array<{\n    id: string;\n    location: string;\n    slots?: number[];\n    isRearMounted?: boolean;\n    linkedAmmo?: string;\n  }> {\n    const result: Array<{\n      id: string;\n      location: string;\n      slots?: number[];\n      isRearMounted?: boolean;\n      linkedAmmo?: string;\n    }> = [];\n    \n    for (const item of items) {\n      // Skip system components (they're handled separately)\n      if (equipmentNameResolver.isSystemComponent(item.item_type)) {\n        continue;\n      }\n      \n      // Resolve equipment ID\n      const itemTechBase = item.tech_base === 'Clan' ? TechBase.CLAN : \n                          item.tech_base === 'IS' ? TechBase.INNER_SPHERE : \n                          unitTechBase;\n      \n      const resolution = equipmentNameResolver.resolve(\n        item.item_type,\n        item.item_name,\n        itemTechBase\n      );\n      \n      // Parse location\n      const parsedLocation = parseLocation(item.location);\n      const locationStr = parsedLocation?.location || item.location;\n      \n      if (!resolution.found) {\n        this.warnings.push({\n          field: 'equipment',\n          message: `Unknown equipment: ${item.item_name} (type: ${item.item_type})`,\n          sourceValue: item,\n        });\n        \n        // Still include it with a generated ID\n        result.push({\n          id: this.generateEquipmentId(item.item_type, item.item_name),\n          location: locationStr,\n          isRearMounted: item.rear_facing || parsedLocation?.isRear,\n        });\n      } else {\n        result.push({\n          id: resolution.equipmentId!,\n          location: locationStr,\n          isRearMounted: item.rear_facing || parsedLocation?.isRear,\n        });\n      }\n    }\n    \n    return result;\n  }\n  \n  /**\n   * Generate an equipment ID for unrecognized equipment\n   */\n  private generateEquipmentId(itemType: string, itemName: string): string {\n    return `unknown-${itemType.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`;\n  }\n  \n  /**\n   * Convert critical slots\n   */\n  private convertCriticals(entries: SourceCriticalEntry[]): { [location: string]: (string | null)[] } {\n    const parsed = parseCriticalSlots(entries);\n    const result: { [location: string]: (string | null)[] } = {};\n    \n    for (const entry of parsed) {\n      const slots = entry.slots.map(slot => {\n        if (slot === '-Empty-' || slot === 'Empty' || slot === '') {\n          return null;\n        }\n        return slot;\n      });\n      \n      result[entry.location] = slots;\n    }\n    \n    return result;\n  }\n  \n  /**\n   * Convert fluff/flavor text\n   */\n  private convertFluff(source: MegaMekLabUnit): ISerializedFluff | undefined {\n    if (!source.fluff_text && !source.manufacturers && !source.system_manufacturers) {\n      return undefined;\n    }\n    \n    // Build fluff object - use Partial to allow building incrementally\n    const fluff: Partial<{\n      overview?: string;\n      capabilities?: string;\n      history?: string;\n      deployment?: string;\n      variants?: string;\n      notableUnits?: string;\n      manufacturer?: string;\n      primaryFactory?: string;\n      systemManufacturer?: Record<string, string>;\n    }> = {};\n    \n    if (source.fluff_text) {\n      if (source.fluff_text.overview) fluff.overview = source.fluff_text.overview;\n      if (source.fluff_text.capabilities) fluff.capabilities = source.fluff_text.capabilities;\n      if (source.fluff_text.history) fluff.history = source.fluff_text.history;\n      if (source.fluff_text.deployment) fluff.deployment = source.fluff_text.deployment;\n    }\n    \n    // Extract primary manufacturer\n    if (source.manufacturers && source.manufacturers.length > 0) {\n      fluff.manufacturer = source.manufacturers[0].name;\n      if (source.manufacturers[0].location) {\n        fluff.primaryFactory = source.manufacturers[0].location;\n      }\n    }\n    \n    // Extract system manufacturers\n    if (source.system_manufacturers && source.system_manufacturers.length > 0) {\n      const systemMfrs: Record<string, string> = {};\n      for (const sm of source.system_manufacturers) {\n        systemMfrs[sm.type.toLowerCase()] = sm.name;\n      }\n      fluff.systemManufacturer = systemMfrs;\n    }\n    \n    return Object.keys(fluff).length > 0 ? (fluff as ISerializedFluff) : undefined;\n  }\n}\n\n// Singleton instance\nexport const unitFormatConverter = new UnitFormatConverter();\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\conversion\\ValueMappings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\conversion\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\equipment\\EquipmentCalculatorService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\equipment\\EquipmentLoaderService.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":465,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":465,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":482,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":482,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":499,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":499,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":516,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":516,"endColumn":81},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":533,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":533,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":550,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":550,"endColumn":84},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":600,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":600,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":603,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":603,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Equipment Loader Service\r\n * \r\n * Provides runtime loading of equipment data from JSON files.\r\n * Supports both official equipment and custom user-defined equipment.\r\n * \r\n * @module services/equipment/EquipmentLoaderService\r\n */\r\n\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { RulesLevel } from '@/types/enums/RulesLevel';\r\nimport { IWeapon, WeaponCategory } from '@/types/equipment/weapons/interfaces';\r\nimport { IAmmunition, AmmoCategory, AmmoVariant } from '@/types/equipment/AmmunitionTypes';\r\nimport { IElectronics, ElectronicsCategory } from '@/types/equipment/ElectronicsTypes';\r\nimport { IMiscEquipment, MiscEquipmentCategory } from '@/types/equipment/MiscEquipmentTypes';\r\n\r\n/**\r\n * Equipment loading result\r\n */\r\nexport interface IEquipmentLoadResult {\r\n  readonly success: boolean;\r\n  readonly itemsLoaded: number;\r\n  readonly errors: string[];\r\n  readonly warnings: string[];\r\n}\r\n\r\n/**\r\n * Validation result for equipment data\r\n */\r\nexport interface IEquipmentValidationResult {\r\n  readonly isValid: boolean;\r\n  readonly errors: string[];\r\n  readonly warnings: string[];\r\n}\r\n\r\n/**\r\n * Equipment filter criteria\r\n */\r\nexport interface IEquipmentFilter {\r\n  readonly category?: string | string[];\r\n  readonly techBase?: TechBase | TechBase[];\r\n  readonly rulesLevel?: RulesLevel | RulesLevel[];\r\n  readonly maxYear?: number;\r\n  readonly minYear?: number;\r\n  readonly searchText?: string;\r\n}\r\n\r\n/**\r\n * Raw JSON weapon data before conversion\r\n */\r\ninterface IRawWeaponData {\r\n  id: string;\r\n  name: string;\r\n  category: string;\r\n  subType: string;\r\n  techBase: string;\r\n  rulesLevel: string;\r\n  damage: number | string;\r\n  heat: number;\r\n  ranges: {\r\n    minimum: number;\r\n    short: number;\r\n    medium: number;\r\n    long: number;\r\n    extreme?: number;\r\n  };\r\n  weight: number;\r\n  criticalSlots: number;\r\n  ammoPerTon?: number;\r\n  costCBills: number;\r\n  battleValue: number;\r\n  introductionYear: number;\r\n  isExplosive?: boolean;\r\n  special?: string[];\r\n}\r\n\r\n/**\r\n * Raw JSON ammunition data\r\n */\r\ninterface IRawAmmunitionData {\r\n  id: string;\r\n  name: string;\r\n  category: string;\r\n  variant: string;\r\n  techBase: string;\r\n  rulesLevel: string;\r\n  compatibleWeaponIds: string[];\r\n  shotsPerTon: number;\r\n  weight: number;\r\n  criticalSlots: number;\r\n  costPerTon: number;\r\n  battleValue: number;\r\n  isExplosive: boolean;\r\n  introductionYear: number;\r\n  damageModifier?: number;\r\n  rangeModifier?: number;\r\n  special?: string[];\r\n}\r\n\r\n/**\r\n * Raw JSON electronics data\r\n */\r\ninterface IRawElectronicsData {\r\n  id: string;\r\n  name: string;\r\n  category: string;\r\n  techBase: string;\r\n  rulesLevel: string;\r\n  weight: number;\r\n  criticalSlots: number;\r\n  costCBills: number;\r\n  battleValue: number;\r\n  introductionYear: number;\r\n  special?: string[];\r\n  variableEquipmentId?: string;\r\n}\r\n\r\n/**\r\n * Raw JSON misc equipment data\r\n */\r\ninterface IRawMiscEquipmentData {\r\n  id: string;\r\n  name: string;\r\n  category: string;\r\n  techBase: string;\r\n  rulesLevel: string;\r\n  weight: number;\r\n  criticalSlots: number;\r\n  costCBills: number;\r\n  battleValue: number;\r\n  introductionYear: number;\r\n  special?: string[];\r\n  variableEquipmentId?: string;\r\n}\r\n\r\n/**\r\n * Equipment file wrapper structure\r\n */\r\ninterface IEquipmentFile<T> {\r\n  $schema: string;\r\n  version: string;\r\n  generatedAt: string;\r\n  count: number;\r\n  items: T[];\r\n}\r\n\r\n/**\r\n * Convert string to TechBase enum\r\n */\r\n/**\r\n * Parse tech base from string\r\n * Per spec VAL-ENUM-004: Components must have binary tech base (IS or Clan).\r\n * MIXED/BOTH from import sources default to INNER_SPHERE.\r\n */\r\nfunction parseTechBase(value: string): TechBase {\r\n  switch (value.toUpperCase()) {\r\n    case 'CLAN':\r\n      return TechBase.CLAN;\r\n    case 'INNER_SPHERE':\r\n    case 'IS':\r\n    case 'BOTH':\r\n    case 'MIXED':\r\n    default:\r\n      // Per spec: Default to IS for mixed/unknown\r\n      return TechBase.INNER_SPHERE;\r\n  }\r\n}\r\n\r\n/**\r\n * Convert string to RulesLevel enum\r\n */\r\nfunction parseRulesLevel(value: string): RulesLevel {\r\n  switch (value.toUpperCase()) {\r\n    case 'INTRODUCTORY':\r\n      return RulesLevel.INTRODUCTORY;\r\n    case 'STANDARD':\r\n      return RulesLevel.STANDARD;\r\n    case 'ADVANCED':\r\n      return RulesLevel.ADVANCED;\r\n    case 'EXPERIMENTAL':\r\n    case 'UNOFFICIAL':\r\n      return RulesLevel.EXPERIMENTAL;\r\n    default:\r\n      return RulesLevel.STANDARD;\r\n  }\r\n}\r\n\r\n/**\r\n * Convert string to WeaponCategory enum\r\n */\r\nfunction parseWeaponCategory(value: string): WeaponCategory {\r\n  switch (value) {\r\n    case 'Energy':\r\n      return WeaponCategory.ENERGY;\r\n    case 'Ballistic':\r\n      return WeaponCategory.BALLISTIC;\r\n    case 'Missile':\r\n      return WeaponCategory.MISSILE;\r\n    case 'Physical':\r\n      return WeaponCategory.PHYSICAL;\r\n    case 'Artillery':\r\n      return WeaponCategory.ARTILLERY;\r\n    default:\r\n      return WeaponCategory.ENERGY;\r\n  }\r\n}\r\n\r\n/**\r\n * Convert string to AmmoCategory enum\r\n */\r\nfunction parseAmmoCategory(value: string): AmmoCategory {\r\n  switch (value) {\r\n    case 'Autocannon':\r\n      return AmmoCategory.AUTOCANNON;\r\n    case 'Gauss':\r\n      return AmmoCategory.GAUSS;\r\n    case 'Machine Gun':\r\n      return AmmoCategory.MACHINE_GUN;\r\n    case 'LRM':\r\n      return AmmoCategory.LRM;\r\n    case 'SRM':\r\n      return AmmoCategory.SRM;\r\n    case 'MRM':\r\n      return AmmoCategory.MRM;\r\n    case 'ATM':\r\n      return AmmoCategory.ATM;\r\n    case 'NARC':\r\n      return AmmoCategory.NARC;\r\n    case 'Artillery':\r\n      return AmmoCategory.ARTILLERY;\r\n    case 'AMS':\r\n      return AmmoCategory.AMS;\r\n    default:\r\n      return AmmoCategory.AUTOCANNON;\r\n  }\r\n}\r\n\r\n/**\r\n * Convert string to AmmoVariant enum\r\n */\r\nfunction parseAmmoVariant(value: string): AmmoVariant {\r\n  switch (value) {\r\n    case 'Standard':\r\n      return AmmoVariant.STANDARD;\r\n    case 'Armor-Piercing':\r\n      return AmmoVariant.ARMOR_PIERCING;\r\n    case 'Cluster':\r\n      return AmmoVariant.CLUSTER;\r\n    case 'Precision':\r\n      return AmmoVariant.PRECISION;\r\n    case 'Flechette':\r\n      return AmmoVariant.FLECHETTE;\r\n    case 'Inferno':\r\n      return AmmoVariant.INFERNO;\r\n    case 'Fragmentation':\r\n      return AmmoVariant.FRAGMENTATION;\r\n    case 'Incendiary':\r\n      return AmmoVariant.INCENDIARY;\r\n    case 'Smoke':\r\n      return AmmoVariant.SMOKE;\r\n    case 'Thunder':\r\n      return AmmoVariant.THUNDER;\r\n    case 'Swarm':\r\n      return AmmoVariant.SWARM;\r\n    case 'Tandem-Charge':\r\n      return AmmoVariant.TANDEM_CHARGE;\r\n    case 'Extended Range':\r\n      return AmmoVariant.EXTENDED_RANGE;\r\n    case 'High Explosive':\r\n      return AmmoVariant.HIGH_EXPLOSIVE;\r\n    default:\r\n      return AmmoVariant.STANDARD;\r\n  }\r\n}\r\n\r\n/**\r\n * Convert string to ElectronicsCategory enum\r\n */\r\nfunction parseElectronicsCategory(value: string): ElectronicsCategory {\r\n  switch (value) {\r\n    case 'Targeting':\r\n      return ElectronicsCategory.TARGETING;\r\n    case 'ECM':\r\n      return ElectronicsCategory.ECM;\r\n    case 'Active Probe':\r\n      return ElectronicsCategory.ACTIVE_PROBE;\r\n    case 'C3 System':\r\n      return ElectronicsCategory.C3;\r\n    case 'TAG':\r\n      return ElectronicsCategory.TAG;\r\n    case 'Communications':\r\n      return ElectronicsCategory.COMMUNICATIONS;\r\n    default:\r\n      return ElectronicsCategory.TARGETING;\r\n  }\r\n}\r\n\r\n/**\r\n * Convert string to MiscEquipmentCategory enum\r\n */\r\nfunction parseMiscEquipmentCategory(value: string): MiscEquipmentCategory {\r\n  switch (value) {\r\n    case 'Heat Sink':\r\n      return MiscEquipmentCategory.HEAT_SINK;\r\n    case 'Jump Jet':\r\n      return MiscEquipmentCategory.JUMP_JET;\r\n    case 'Movement Enhancement':\r\n      return MiscEquipmentCategory.MOVEMENT;\r\n    case 'Defensive':\r\n      return MiscEquipmentCategory.DEFENSIVE;\r\n    case 'Myomer':\r\n      return MiscEquipmentCategory.MYOMER;\r\n    case 'Industrial':\r\n      return MiscEquipmentCategory.INDUSTRIAL;\r\n    default:\r\n      return MiscEquipmentCategory.HEAT_SINK;\r\n  }\r\n}\r\n\r\n/**\r\n * Convert raw JSON weapon data to IWeapon interface\r\n */\r\nfunction convertWeapon(raw: IRawWeaponData): IWeapon {\r\n  return {\r\n    id: raw.id,\r\n    name: raw.name,\r\n    category: parseWeaponCategory(raw.category),\r\n    subType: raw.subType,\r\n    techBase: parseTechBase(raw.techBase),\r\n    rulesLevel: parseRulesLevel(raw.rulesLevel),\r\n    damage: raw.damage,\r\n    heat: raw.heat,\r\n    ranges: raw.ranges,\r\n    weight: raw.weight,\r\n    criticalSlots: raw.criticalSlots,\r\n    ...(raw.ammoPerTon && { ammoPerTon: raw.ammoPerTon }),\r\n    costCBills: raw.costCBills,\r\n    battleValue: raw.battleValue,\r\n    introductionYear: raw.introductionYear,\r\n    ...(raw.isExplosive && { isExplosive: raw.isExplosive }),\r\n    ...(raw.special && { special: raw.special }),\r\n  };\r\n}\r\n\r\n/**\r\n * Convert raw JSON ammunition data to IAmmunition interface\r\n */\r\nfunction convertAmmunition(raw: IRawAmmunitionData): IAmmunition {\r\n  return {\r\n    id: raw.id,\r\n    name: raw.name,\r\n    category: parseAmmoCategory(raw.category),\r\n    variant: parseAmmoVariant(raw.variant),\r\n    techBase: parseTechBase(raw.techBase),\r\n    rulesLevel: parseRulesLevel(raw.rulesLevel),\r\n    compatibleWeaponIds: raw.compatibleWeaponIds,\r\n    shotsPerTon: raw.shotsPerTon,\r\n    weight: raw.weight,\r\n    criticalSlots: raw.criticalSlots,\r\n    costPerTon: raw.costPerTon,\r\n    battleValue: raw.battleValue,\r\n    isExplosive: raw.isExplosive,\r\n    introductionYear: raw.introductionYear,\r\n    ...(raw.damageModifier !== undefined && { damageModifier: raw.damageModifier }),\r\n    ...(raw.rangeModifier !== undefined && { rangeModifier: raw.rangeModifier }),\r\n    ...(raw.special && { special: raw.special }),\r\n  };\r\n}\r\n\r\n/**\r\n * Convert raw JSON electronics data to IElectronics interface\r\n */\r\nfunction convertElectronics(raw: IRawElectronicsData): IElectronics {\r\n  return {\r\n    id: raw.id,\r\n    name: raw.name,\r\n    category: parseElectronicsCategory(raw.category),\r\n    techBase: parseTechBase(raw.techBase),\r\n    rulesLevel: parseRulesLevel(raw.rulesLevel),\r\n    weight: raw.weight,\r\n    criticalSlots: raw.criticalSlots,\r\n    costCBills: raw.costCBills,\r\n    battleValue: raw.battleValue,\r\n    introductionYear: raw.introductionYear,\r\n    ...(raw.special && { special: raw.special }),\r\n    ...(raw.variableEquipmentId && { variableEquipmentId: raw.variableEquipmentId }),\r\n  };\r\n}\r\n\r\n/**\r\n * Convert raw JSON misc equipment data to IMiscEquipment interface\r\n */\r\nfunction convertMiscEquipment(raw: IRawMiscEquipmentData): IMiscEquipment {\r\n  return {\r\n    id: raw.id,\r\n    name: raw.name,\r\n    category: parseMiscEquipmentCategory(raw.category),\r\n    techBase: parseTechBase(raw.techBase),\r\n    rulesLevel: parseRulesLevel(raw.rulesLevel),\r\n    weight: raw.weight,\r\n    criticalSlots: raw.criticalSlots,\r\n    costCBills: raw.costCBills,\r\n    battleValue: raw.battleValue,\r\n    introductionYear: raw.introductionYear,\r\n    ...(raw.special && { special: raw.special }),\r\n    ...(raw.variableEquipmentId && { variableEquipmentId: raw.variableEquipmentId }),\r\n  };\r\n}\r\n\r\n/**\r\n * Equipment Loader Service\r\n * \r\n * Loads and caches equipment data from JSON files for runtime use.\r\n */\r\nexport class EquipmentLoaderService {\r\n  private static instance: EquipmentLoaderService | null = null;\r\n  \r\n  private weapons: Map<string, IWeapon> = new Map();\r\n  private ammunition: Map<string, IAmmunition> = new Map();\r\n  private electronics: Map<string, IElectronics> = new Map();\r\n  private miscEquipment: Map<string, IMiscEquipment> = new Map();\r\n  \r\n  private isLoaded = false;\r\n  private loadErrors: string[] = [];\r\n  \r\n  private constructor() {}\r\n  \r\n  /**\r\n   * Get singleton instance\r\n   */\r\n  static getInstance(): EquipmentLoaderService {\r\n    if (!EquipmentLoaderService.instance) {\r\n      EquipmentLoaderService.instance = new EquipmentLoaderService();\r\n    }\r\n    return EquipmentLoaderService.instance;\r\n  }\r\n  \r\n  /**\r\n   * Check if equipment is loaded\r\n   */\r\n  getIsLoaded(): boolean {\r\n    return this.isLoaded;\r\n  }\r\n  \r\n  /**\r\n   * Get any loading errors\r\n   */\r\n  getLoadErrors(): readonly string[] {\r\n    return this.loadErrors;\r\n  }\r\n  \r\n  /**\r\n   * Load all official equipment from JSON files\r\n   */\r\n  async loadOfficialEquipment(basePath = '/data/equipment/official'): Promise<IEquipmentLoadResult> {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n    let itemsLoaded = 0;\r\n    \r\n    try {\r\n      // Load energy weapons\r\n      try {\r\n        const response = await fetch(`${basePath}/weapons/energy.json`);\r\n        if (response.ok) {\r\n          const data: IEquipmentFile<IRawWeaponData> = await response.json();\r\n          data.items.forEach(item => {\r\n            const weapon = convertWeapon(item);\r\n            this.weapons.set(weapon.id, weapon);\r\n            itemsLoaded++;\r\n          });\r\n        } else {\r\n          warnings.push(`Failed to load energy weapons: ${response.status}`);\r\n        }\r\n      } catch (e) {\r\n        warnings.push(`Error loading energy weapons: ${e}`);\r\n      }\r\n      \r\n      // Load ballistic weapons\r\n      try {\r\n        const response = await fetch(`${basePath}/weapons/ballistic.json`);\r\n        if (response.ok) {\r\n          const data: IEquipmentFile<IRawWeaponData> = await response.json();\r\n          data.items.forEach(item => {\r\n            const weapon = convertWeapon(item);\r\n            this.weapons.set(weapon.id, weapon);\r\n            itemsLoaded++;\r\n          });\r\n        } else {\r\n          warnings.push(`Failed to load ballistic weapons: ${response.status}`);\r\n        }\r\n      } catch (e) {\r\n        warnings.push(`Error loading ballistic weapons: ${e}`);\r\n      }\r\n      \r\n      // Load missile weapons\r\n      try {\r\n        const response = await fetch(`${basePath}/weapons/missile.json`);\r\n        if (response.ok) {\r\n          const data: IEquipmentFile<IRawWeaponData> = await response.json();\r\n          data.items.forEach(item => {\r\n            const weapon = convertWeapon(item);\r\n            this.weapons.set(weapon.id, weapon);\r\n            itemsLoaded++;\r\n          });\r\n        } else {\r\n          warnings.push(`Failed to load missile weapons: ${response.status}`);\r\n        }\r\n      } catch (e) {\r\n        warnings.push(`Error loading missile weapons: ${e}`);\r\n      }\r\n      \r\n      // Load ammunition\r\n      try {\r\n        const response = await fetch(`${basePath}/ammunition.json`);\r\n        if (response.ok) {\r\n          const data: IEquipmentFile<IRawAmmunitionData> = await response.json();\r\n          data.items.forEach(item => {\r\n            const ammo = convertAmmunition(item);\r\n            this.ammunition.set(ammo.id, ammo);\r\n            itemsLoaded++;\r\n          });\r\n        } else {\r\n          warnings.push(`Failed to load ammunition: ${response.status}`);\r\n        }\r\n      } catch (e) {\r\n        warnings.push(`Error loading ammunition: ${e}`);\r\n      }\r\n      \r\n      // Load electronics\r\n      try {\r\n        const response = await fetch(`${basePath}/electronics.json`);\r\n        if (response.ok) {\r\n          const data: IEquipmentFile<IRawElectronicsData> = await response.json();\r\n          data.items.forEach(item => {\r\n            const electronics = convertElectronics(item);\r\n            this.electronics.set(electronics.id, electronics);\r\n            itemsLoaded++;\r\n          });\r\n        } else {\r\n          warnings.push(`Failed to load electronics: ${response.status}`);\r\n        }\r\n      } catch (e) {\r\n        warnings.push(`Error loading electronics: ${e}`);\r\n      }\r\n      \r\n      // Load misc equipment\r\n      try {\r\n        const response = await fetch(`${basePath}/miscellaneous.json`);\r\n        if (response.ok) {\r\n          const data: IEquipmentFile<IRawMiscEquipmentData> = await response.json();\r\n          data.items.forEach(item => {\r\n            const equipment = convertMiscEquipment(item);\r\n            this.miscEquipment.set(equipment.id, equipment);\r\n            itemsLoaded++;\r\n          });\r\n        } else {\r\n          warnings.push(`Failed to load miscellaneous equipment: ${response.status}`);\r\n        }\r\n      } catch (e) {\r\n        warnings.push(`Error loading miscellaneous equipment: ${e}`);\r\n      }\r\n      \r\n      this.isLoaded = true;\r\n      this.loadErrors = errors;\r\n      \r\n      return {\r\n        success: errors.length === 0,\r\n        itemsLoaded,\r\n        errors,\r\n        warnings,\r\n      };\r\n    } catch (e) {\r\n      errors.push(`Failed to load equipment: ${e}`);\r\n      return {\r\n        success: false,\r\n        itemsLoaded,\r\n        errors,\r\n        warnings,\r\n      };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Load custom equipment from a JSON file or object\r\n   */\r\n  async loadCustomEquipment(source: string | File | object): Promise<IEquipmentLoadResult> {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n    let itemsLoaded = 0;\r\n    \r\n    try {\r\n      let data: IEquipmentFile<IRawWeaponData | IRawAmmunitionData | IRawElectronicsData | IRawMiscEquipmentData>;\r\n      \r\n      if (typeof source === 'string') {\r\n        // Assume URL\r\n        const response = await fetch(source);\r\n        if (!response.ok) {\r\n          throw new Error(`Failed to fetch: ${response.status}`);\r\n        }\r\n        data = await response.json();\r\n      } else if (source instanceof File) {\r\n        const text = await source.text();\r\n        data = JSON.parse(text);\r\n      } else {\r\n        data = source as IEquipmentFile<IRawWeaponData>;\r\n      }\r\n      \r\n      // Determine type from schema or first item\r\n      const schemaPath = data.$schema || '';\r\n      \r\n      if (schemaPath.includes('weapon')) {\r\n        (data.items as IRawWeaponData[]).forEach(item => {\r\n          const weapon = convertWeapon(item);\r\n          this.weapons.set(weapon.id, weapon);\r\n          itemsLoaded++;\r\n        });\r\n      } else if (schemaPath.includes('ammunition')) {\r\n        (data.items as IRawAmmunitionData[]).forEach(item => {\r\n          const ammo = convertAmmunition(item);\r\n          this.ammunition.set(ammo.id, ammo);\r\n          itemsLoaded++;\r\n        });\r\n      } else if (schemaPath.includes('electronics')) {\r\n        (data.items as IRawElectronicsData[]).forEach(item => {\r\n          const electronics = convertElectronics(item);\r\n          this.electronics.set(electronics.id, electronics);\r\n          itemsLoaded++;\r\n        });\r\n      } else if (schemaPath.includes('misc-equipment')) {\r\n        (data.items as IRawMiscEquipmentData[]).forEach(item => {\r\n          const equipment = convertMiscEquipment(item);\r\n          this.miscEquipment.set(equipment.id, equipment);\r\n          itemsLoaded++;\r\n        });\r\n      } else {\r\n        warnings.push('Unknown equipment type, attempting to infer from data');\r\n      }\r\n      \r\n      return {\r\n        success: errors.length === 0,\r\n        itemsLoaded,\r\n        errors,\r\n        warnings,\r\n      };\r\n    } catch (e) {\r\n      errors.push(`Failed to load custom equipment: ${e}`);\r\n      return {\r\n        success: false,\r\n        itemsLoaded,\r\n        errors,\r\n        warnings,\r\n      };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Get weapon by ID\r\n   */\r\n  getWeaponById(id: string): IWeapon | null {\r\n    return this.weapons.get(id) || null;\r\n  }\r\n  \r\n  /**\r\n   * Get ammunition by ID\r\n   */\r\n  getAmmunitionById(id: string): IAmmunition | null {\r\n    return this.ammunition.get(id) || null;\r\n  }\r\n  \r\n  /**\r\n   * Get electronics by ID\r\n   */\r\n  getElectronicsById(id: string): IElectronics | null {\r\n    return this.electronics.get(id) || null;\r\n  }\r\n  \r\n  /**\r\n   * Get misc equipment by ID\r\n   */\r\n  getMiscEquipmentById(id: string): IMiscEquipment | null {\r\n    return this.miscEquipment.get(id) || null;\r\n  }\r\n  \r\n  /**\r\n   * Get any equipment by ID (searches all categories)\r\n   */\r\n  getById(id: string): IWeapon | IAmmunition | IElectronics | IMiscEquipment | null {\r\n    return this.weapons.get(id) ||\r\n           this.ammunition.get(id) ||\r\n           this.electronics.get(id) ||\r\n           this.miscEquipment.get(id) ||\r\n           null;\r\n  }\r\n  \r\n  /**\r\n   * Get all weapons\r\n   */\r\n  getAllWeapons(): IWeapon[] {\r\n    return Array.from(this.weapons.values());\r\n  }\r\n  \r\n  /**\r\n   * Get all ammunition\r\n   */\r\n  getAllAmmunition(): IAmmunition[] {\r\n    return Array.from(this.ammunition.values());\r\n  }\r\n  \r\n  /**\r\n   * Get all electronics\r\n   */\r\n  getAllElectronics(): IElectronics[] {\r\n    return Array.from(this.electronics.values());\r\n  }\r\n  \r\n  /**\r\n   * Get all misc equipment\r\n   */\r\n  getAllMiscEquipment(): IMiscEquipment[] {\r\n    return Array.from(this.miscEquipment.values());\r\n  }\r\n  \r\n  /**\r\n   * Search weapons by filter\r\n   */\r\n  searchWeapons(filter: IEquipmentFilter): IWeapon[] {\r\n    let results = this.getAllWeapons();\r\n    \r\n    if (filter.techBase) {\r\n      const techBases = Array.isArray(filter.techBase) ? filter.techBase : [filter.techBase];\r\n      // Per spec: Tech base is binary (IS or Clan), no MIXED\r\n      results = results.filter(w => techBases.includes(w.techBase));\r\n    }\r\n    \r\n    if (filter.rulesLevel) {\r\n      const levels = Array.isArray(filter.rulesLevel) ? filter.rulesLevel : [filter.rulesLevel];\r\n      results = results.filter(w => levels.includes(w.rulesLevel));\r\n    }\r\n    \r\n    if (filter.maxYear !== undefined) {\r\n      results = results.filter(w => w.introductionYear <= filter.maxYear!);\r\n    }\r\n    \r\n    if (filter.minYear !== undefined) {\r\n      results = results.filter(w => w.introductionYear >= filter.minYear!);\r\n    }\r\n    \r\n    if (filter.searchText) {\r\n      const search = filter.searchText.toLowerCase();\r\n      results = results.filter(w => \r\n        w.name.toLowerCase().includes(search) ||\r\n        w.id.toLowerCase().includes(search)\r\n      );\r\n    }\r\n    \r\n    return results;\r\n  }\r\n  \r\n  /**\r\n   * Get total equipment count\r\n   */\r\n  getTotalCount(): number {\r\n    return this.weapons.size + this.ammunition.size + \r\n           this.electronics.size + this.miscEquipment.size;\r\n  }\r\n  \r\n  /**\r\n   * Clear all loaded equipment\r\n   */\r\n  clear(): void {\r\n    this.weapons.clear();\r\n    this.ammunition.clear();\r\n    this.electronics.clear();\r\n    this.miscEquipment.clear();\r\n    this.isLoaded = false;\r\n    this.loadErrors = [];\r\n  }\r\n}\r\n\r\n/**\r\n * Convenience function to get the loader instance\r\n */\r\nexport function getEquipmentLoader(): EquipmentLoaderService {\r\n  return EquipmentLoaderService.getInstance();\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\equipment\\EquipmentLookupService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RulesLevel' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment Lookup Service\n * \n * Provides access to equipment definitions with filtering and search.\n * Wraps the existing equipment type system.\n * \n * @spec openspec/specs/equipment-services/spec.md\n */\n\nimport { TechBase } from '@/types/enums/TechBase';\nimport { RulesLevel } from '@/types/enums/RulesLevel';\nimport {\n  EquipmentCategory,\n  IEquipmentItem,\n  IWeapon,\n  IAmmunition,\n  getAllEquipmentItems,\n  getAllWeapons,\n  getAllAmmunition,\n  getEquipmentById as getEquipmentByIdFromTypes,\n  filterEquipmentByTechBase,\n  filterEquipmentByCategory,\n  filterEquipmentByYear,\n} from '@/types/equipment';\nimport { IEquipmentQueryCriteria } from '../common/types';\n\n/**\n * Equipment lookup service interface\n */\nexport interface IEquipmentLookupService {\n  // Single-criterion lookups\n  getById(id: string): IEquipmentItem | undefined;\n  getByCategory(category: EquipmentCategory): IEquipmentItem[];\n  getByTechBase(techBase: TechBase): IEquipmentItem[];\n  getByEra(year: number): IEquipmentItem[];\n  search(query: string): IEquipmentItem[];\n  \n  // Combined filter query\n  query(criteria: IEquipmentQueryCriteria): IEquipmentItem[];\n  \n  // Bulk accessors\n  getAllWeapons(): IWeapon[];\n  getAllAmmunition(): IAmmunition[];\n  getAllEquipment(): IEquipmentItem[];\n}\n\n/**\n * Equipment Lookup Service implementation\n */\nexport class EquipmentLookupService implements IEquipmentLookupService {\n  private equipmentCache: IEquipmentItem[] | null = null;\n\n  /**\n   * Get cached equipment list\n   */\n  private getEquipment(): IEquipmentItem[] {\n    if (!this.equipmentCache) {\n      this.equipmentCache = getAllEquipmentItems();\n    }\n    return this.equipmentCache;\n  }\n\n  /**\n   * Get equipment by unique identifier\n   */\n  getById(id: string): IEquipmentItem | undefined {\n    return getEquipmentByIdFromTypes(id);\n  }\n\n  /**\n   * Get all equipment in a given category\n   */\n  getByCategory(category: EquipmentCategory): IEquipmentItem[] {\n    return filterEquipmentByCategory(category);\n  }\n\n  /**\n   * Get equipment compatible with a tech base\n   */\n  getByTechBase(techBase: TechBase): IEquipmentItem[] {\n    return filterEquipmentByTechBase(techBase);\n  }\n\n  /**\n   * Get equipment available in a given year\n   */\n  getByEra(year: number): IEquipmentItem[] {\n    return filterEquipmentByYear(year);\n  }\n\n  /**\n   * Search equipment by name substring (case-insensitive)\n   */\n  search(queryStr: string): IEquipmentItem[] {\n    const lowerQuery = queryStr.toLowerCase();\n    return this.getEquipment().filter(e => \n      e.name.toLowerCase().includes(lowerQuery)\n    );\n  }\n\n  /**\n   * Query equipment with multiple filter criteria\n   */\n  query(criteria: IEquipmentQueryCriteria): IEquipmentItem[] {\n    let results = this.getEquipment();\n\n    // Filter by category\n    if (criteria.category !== undefined) {\n      results = results.filter(e => e.category === criteria.category);\n    }\n\n    // Filter by tech base\n    if (criteria.techBase !== undefined) {\n      results = results.filter(e => e.techBase === criteria.techBase);\n    }\n\n    // Filter by year (introduction year)\n    if (criteria.year !== undefined) {\n      results = results.filter(e => e.introductionYear <= criteria.year!);\n    }\n\n    // Filter by name query\n    if (criteria.nameQuery !== undefined && criteria.nameQuery.length > 0) {\n      const lowerQuery = criteria.nameQuery.toLowerCase();\n      results = results.filter(e => e.name.toLowerCase().includes(lowerQuery));\n    }\n\n    // Filter by rules level\n    if (criteria.rulesLevel !== undefined) {\n      results = results.filter(e => e.rulesLevel === criteria.rulesLevel);\n    }\n\n    // Filter by max weight\n    if (criteria.maxWeight !== undefined) {\n      results = results.filter(e => e.weight <= criteria.maxWeight!);\n    }\n\n    // Filter by max slots\n    if (criteria.maxSlots !== undefined) {\n      results = results.filter(e => e.criticalSlots <= criteria.maxSlots!);\n    }\n\n    return results;\n  }\n\n  /**\n   * Get all weapon definitions\n   */\n  getAllWeapons(): IWeapon[] {\n    return getAllWeapons() as IWeapon[];\n  }\n\n  /**\n   * Get all ammunition definitions\n   */\n  getAllAmmunition(): IAmmunition[] {\n    return getAllAmmunition() as IAmmunition[];\n  }\n\n  /**\n   * Get all equipment items\n   */\n  getAllEquipment(): IEquipmentItem[] {\n    return this.getEquipment();\n  }\n}\n\n// Singleton instance\nexport const equipmentLookupService = new EquipmentLookupService();\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\equipment\\EquipmentNameMapper.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":359,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":359,"endColumn":69}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment Name Mapper\n * \n * Maps MTF equipment names to canonical equipment IDs.\n * Handles legacy names, alternate spellings, and tech base variations.\n * \n * @module services/equipment/EquipmentNameMapper\n */\n\nimport { TechBase } from '@/types/enums/TechBase';\nimport { getEquipmentRegistry, EquipmentRegistry } from './EquipmentRegistry';\n\n/**\n * Name mapping result\n */\nexport interface INameMappingResult {\n  readonly success: boolean;\n  readonly equipmentId: string | null;\n  readonly confidence: 'exact' | 'normalized' | 'alias' | 'fuzzy' | 'unknown';\n  readonly alternates?: string[];\n  readonly warning?: string;\n}\n\n/**\n * Mapping statistics\n */\nexport interface IMappingStats {\n  readonly totalMappings: number;\n  readonly exactMatches: number;\n  readonly aliasMatches: number;\n  readonly unknownItems: string[];\n}\n\n/**\n * Static name mappings from MTF format to canonical IDs\n * \n * These are the known mappings for equipment names as they appear\n * in MegaMek MTF files to our canonical equipment IDs.\n */\nconst MTF_NAME_MAPPINGS: Record<string, string> = {\n  // Energy Weapons\n  'Small Laser': 'small-laser',\n  'Medium Laser': 'medium-laser',\n  'Large Laser': 'large-laser',\n  'ER Small Laser': 'er-small-laser',\n  'ER Medium Laser': 'er-medium-laser',\n  'ER Large Laser': 'er-large-laser',\n  'Small Pulse Laser': 'small-pulse-laser',\n  'Medium Pulse Laser': 'medium-pulse-laser',\n  'Large Pulse Laser': 'large-pulse-laser',\n  'PPC': 'ppc',\n  'ER PPC': 'er-ppc',\n  'Light PPC': 'light-ppc',\n  'Heavy PPC': 'heavy-ppc',\n  'Snub-Nose PPC': 'snub-nose-ppc',\n  'Flamer': 'flamer',\n  'Heavy Flamer': 'heavy-flamer',\n  'Vehicle Flamer': 'vehicle-flamer',\n  \n  // Clan Energy Weapons\n  'ER Micro Laser': 'clan-er-micro-laser',\n  'Clan ER Small Laser': 'clan-er-small-laser',\n  'Clan ER Medium Laser': 'clan-er-medium-laser',\n  'Clan ER Large Laser': 'clan-er-large-laser',\n  'Micro Pulse Laser': 'clan-micro-pulse-laser',\n  'Clan Small Pulse Laser': 'clan-small-pulse-laser',\n  'Clan Medium Pulse Laser': 'clan-medium-pulse-laser',\n  'Clan Large Pulse Laser': 'clan-large-pulse-laser',\n  'Clan ER PPC': 'clan-er-ppc',\n  'Clan Flamer': 'clan-flamer',\n  \n  // Ballistic Weapons\n  'Autocannon/2': 'ac-2',\n  'AC/2': 'ac-2',\n  'Autocannon/5': 'ac-5',\n  'AC/5': 'ac-5',\n  'Autocannon/10': 'ac-10',\n  'AC/10': 'ac-10',\n  'Autocannon/20': 'ac-20',\n  'AC/20': 'ac-20',\n  'Ultra AC/2': 'uac-2',\n  'Ultra AC/5': 'uac-5',\n  'Ultra AC/10': 'uac-10',\n  'Ultra AC/20': 'uac-20',\n  'LB 2-X AC': 'lb-2x-ac',\n  'LB 5-X AC': 'lb-5x-ac',\n  'LB 10-X AC': 'lb-10x-ac',\n  'LB 20-X AC': 'lb-20x-ac',\n  'Rotary AC/2': 'rac-2',\n  'Rotary AC/5': 'rac-5',\n  'Light AC/2': 'lac-2',\n  'Light AC/5': 'lac-5',\n  'Gauss Rifle': 'gauss-rifle',\n  'Light Gauss Rifle': 'light-gauss-rifle',\n  'Heavy Gauss Rifle': 'heavy-gauss-rifle',\n  'Machine Gun': 'machine-gun',\n  'Light Machine Gun': 'light-machine-gun',\n  'Heavy Machine Gun': 'heavy-machine-gun',\n  'AMS': 'ams',\n  'Anti-Missile System': 'ams',\n  \n  // Clan Ballistic Weapons\n  'Clan Ultra AC/2': 'clan-uac-2',\n  'Clan Ultra AC/5': 'clan-uac-5',\n  'Clan Ultra AC/10': 'clan-uac-10',\n  'Clan Ultra AC/20': 'clan-uac-20',\n  'Clan LB 2-X AC': 'clan-lb-2x-ac',\n  'Clan LB 5-X AC': 'clan-lb-5x-ac',\n  'Clan LB 10-X AC': 'clan-lb-10x-ac',\n  'Clan LB 20-X AC': 'clan-lb-20x-ac',\n  'Clan Gauss Rifle': 'clan-gauss-rifle',\n  'Clan Machine Gun': 'clan-machine-gun',\n  'Clan AMS': 'clan-ams',\n  \n  // Missile Weapons\n  'LRM 5': 'lrm-5',\n  'LRM-5': 'lrm-5',\n  'LRM 10': 'lrm-10',\n  'LRM-10': 'lrm-10',\n  'LRM 15': 'lrm-15',\n  'LRM-15': 'lrm-15',\n  'LRM 20': 'lrm-20',\n  'LRM-20': 'lrm-20',\n  'SRM 2': 'srm-2',\n  'SRM-2': 'srm-2',\n  'SRM 4': 'srm-4',\n  'SRM-4': 'srm-4',\n  'SRM 6': 'srm-6',\n  'SRM-6': 'srm-6',\n  'Streak SRM 2': 'streak-srm-2',\n  'Streak SRM 4': 'streak-srm-4',\n  'Streak SRM 6': 'streak-srm-6',\n  'MRM 10': 'mrm-10',\n  'MRM 20': 'mrm-20',\n  'MRM 30': 'mrm-30',\n  'MRM 40': 'mrm-40',\n  'NARC Missile Beacon': 'narc-beacon',\n  'iNARC Launcher': 'inarc-launcher',\n  \n  // Clan Missile Weapons\n  'Clan LRM 5': 'clan-lrm-5',\n  'Clan LRM 10': 'clan-lrm-10',\n  'Clan LRM 15': 'clan-lrm-15',\n  'Clan LRM 20': 'clan-lrm-20',\n  'Clan SRM 2': 'clan-srm-2',\n  'Clan SRM 4': 'clan-srm-4',\n  'Clan SRM 6': 'clan-srm-6',\n  'Clan Streak SRM 2': 'clan-streak-srm-2',\n  'Clan Streak SRM 4': 'clan-streak-srm-4',\n  'Clan Streak SRM 6': 'clan-streak-srm-6',\n  'ATM 3': 'atm-3',\n  'ATM 6': 'atm-6',\n  'ATM 9': 'atm-9',\n  'ATM 12': 'atm-12',\n  \n  // Heat Sinks\n  'Heat Sink': 'single-heat-sink',\n  'Single Heat Sink': 'single-heat-sink',\n  'Double Heat Sink': 'double-heat-sink',\n  'Clan Double Heat Sink': 'clan-double-heat-sink',\n  \n  // Jump Jets\n  'Jump Jet': 'jump-jet-medium',\n  'Jump Jets': 'jump-jet-medium',\n  'Improved Jump Jet': 'improved-jump-jet-medium',\n  \n  // Electronics\n  'Guardian ECM Suite': 'guardian-ecm',\n  'Guardian ECM': 'guardian-ecm',\n  'Clan ECM Suite': 'clan-ecm',\n  'Beagle Active Probe': 'beagle-active-probe',\n  'Bloodhound Active Probe': 'bloodhound-active-probe',\n  'Clan Active Probe': 'clan-active-probe',\n  'Light Active Probe': 'light-active-probe',\n  'TAG': 'tag',\n  'Clan TAG': 'clan-tag',\n  'Light TAG': 'light-tag',\n  'C3 Master Computer': 'c3-master',\n  'C3 Slave Unit': 'c3-slave',\n  'Improved C3 Computer': 'c3i',\n  'C3i': 'c3i',\n  'Targeting Computer': 'targeting-computer',\n  'Clan Targeting Computer': 'clan-targeting-computer',\n  \n  // Misc Equipment\n  'MASC': 'masc',\n  'Clan MASC': 'clan-masc',\n  'Triple Strength Myomer': 'tsm',\n  'TSM': 'tsm',\n  'Supercharger': 'supercharger',\n  \n  // Ammo common patterns\n  'IS Ammo LRM-5': 'lrm-5-ammo',\n  'IS Ammo LRM-10': 'lrm-10-ammo',\n  'IS Ammo LRM-15': 'lrm-15-ammo',\n  'IS Ammo LRM-20': 'lrm-20-ammo',\n  'IS Ammo SRM-2': 'srm-2-ammo',\n  'IS Ammo SRM-4': 'srm-4-ammo',\n  'IS Ammo SRM-6': 'srm-6-ammo',\n  'IS Ammo AC/2': 'ac-2-ammo',\n  'IS Ammo AC/5': 'ac-5-ammo',\n  'IS Ammo AC/10': 'ac-10-ammo',\n  'IS Ammo AC/20': 'ac-20-ammo',\n  'IS Gauss Ammo': 'gauss-ammo',\n  'IS Machine Gun Ammo': 'machine-gun-ammo',\n  \n  // Clan Ammo\n  'Clan Ammo LRM-5': 'clan-lrm-5-ammo',\n  'Clan Ammo LRM-10': 'clan-lrm-10-ammo',\n  'Clan Ammo LRM-15': 'clan-lrm-15-ammo',\n  'Clan Ammo LRM-20': 'clan-lrm-20-ammo',\n  'Clan Ammo SRM-2': 'clan-srm-2-ammo',\n  'Clan Ammo SRM-4': 'clan-srm-4-ammo',\n  'Clan Ammo SRM-6': 'clan-srm-6-ammo',\n};\n\n/**\n * Equipment Name Mapper\n * \n * Maps MTF equipment names to canonical equipment IDs.\n */\nexport class EquipmentNameMapper {\n  private static instance: EquipmentNameMapper | null = null;\n  \n  private registry: EquipmentRegistry;\n  private customMappings: Map<string, string> = new Map();\n  private unknownNames: Set<string> = new Set();\n  \n  private constructor() {\n    this.registry = getEquipmentRegistry();\n    \n    // Initialize static mappings\n    Object.entries(MTF_NAME_MAPPINGS).forEach(([name, id]) => {\n      this.customMappings.set(name.toLowerCase(), id);\n    });\n  }\n  \n  /**\n   * Get singleton instance\n   */\n  static getInstance(): EquipmentNameMapper {\n    if (!EquipmentNameMapper.instance) {\n      EquipmentNameMapper.instance = new EquipmentNameMapper();\n    }\n    return EquipmentNameMapper.instance;\n  }\n  \n  /**\n   * Map an MTF equipment name to a canonical ID\n   */\n  mapName(mtfName: string, techBase?: TechBase): INameMappingResult {\n    // Clean up the name\n    const cleanName = this.cleanMtfName(mtfName);\n    \n    // Try exact match from static mappings\n    const staticId = this.customMappings.get(cleanName.toLowerCase());\n    if (staticId) {\n      return {\n        success: true,\n        equipmentId: staticId,\n        confidence: 'exact',\n      };\n    }\n    \n    // Try with tech base prefix\n    if (techBase === TechBase.CLAN) {\n      const clanId = this.customMappings.get(`clan ${cleanName}`.toLowerCase());\n      if (clanId) {\n        return {\n          success: true,\n          equipmentId: clanId,\n          confidence: 'alias',\n        };\n      }\n    } else if (techBase === TechBase.INNER_SPHERE) {\n      const isId = this.customMappings.get(`is ${cleanName}`.toLowerCase());\n      if (isId) {\n        return {\n          success: true,\n          equipmentId: isId,\n          confidence: 'alias',\n        };\n      }\n    }\n    \n    // Try registry lookup\n    const registryResult = this.registry.lookup(cleanName);\n    if (registryResult.found && registryResult.equipment) {\n      return {\n        success: true,\n        equipmentId: registryResult.equipment.id,\n        confidence: 'normalized',\n      };\n    }\n    \n    // Try normalized lookup without special characters\n    const normalizedName = this.normalizeName(cleanName);\n    const normalizedId = this.customMappings.get(normalizedName);\n    if (normalizedId) {\n      return {\n        success: true,\n        equipmentId: normalizedId,\n        confidence: 'normalized',\n      };\n    }\n    \n    // Track unknown name\n    this.unknownNames.add(mtfName);\n    \n    return {\n      success: false,\n      equipmentId: null,\n      confidence: 'unknown',\n      alternates: registryResult.alternateIds,\n      warning: `Unknown equipment: ${mtfName}`,\n    };\n  }\n  \n  /**\n   * Clean an MTF equipment name\n   */\n  private cleanMtfName(name: string): string {\n    return name\n      .replace(/\\s*\\(R\\)\\s*$/i, '') // Remove rear-facing indicator\n      .replace(/\\s*\\(Clan\\)\\s*$/i, '') // Remove Clan suffix (handled separately)\n      .replace(/\\s*\\(IS\\)\\s*$/i, '') // Remove IS suffix\n      .replace(/^\\s+|\\s+$/g, '') // Trim whitespace\n      .replace(/\\s+/g, ' '); // Normalize spaces\n  }\n  \n  /**\n   * Normalize a name for fuzzy matching\n   */\n  private normalizeName(name: string): string {\n    return name\n      .toLowerCase()\n      .replace(/[^a-z0-9]/g, '')\n      .trim();\n  }\n  \n  /**\n   * Add a custom name mapping\n   */\n  addMapping(mtfName: string, equipmentId: string): void {\n    this.customMappings.set(mtfName.toLowerCase(), equipmentId);\n    this.unknownNames.delete(mtfName);\n  }\n  \n  /**\n   * Load mappings from a JSON file\n   */\n  async loadMappings(url: string): Promise<number> {\n    try {\n      const response = await fetch(url);\n      if (!response.ok) {\n        throw new Error(`Failed to fetch: ${response.status}`);\n      }\n      \n      const mappings: Record<string, string> = await response.json();\n      let count = 0;\n      \n      Object.entries(mappings).forEach(([name, id]) => {\n        this.customMappings.set(name.toLowerCase(), id);\n        count++;\n      });\n      \n      return count;\n    } catch (e) {\n      console.error('Failed to load name mappings:', e);\n      return 0;\n    }\n  }\n  \n  /**\n   * Get list of unknown equipment names\n   */\n  getUnknownNames(): string[] {\n    return Array.from(this.unknownNames);\n  }\n  \n  /**\n   * Clear unknown names tracking\n   */\n  clearUnknownNames(): void {\n    this.unknownNames.clear();\n  }\n  \n  /**\n   * Get mapping statistics\n   */\n  getStats(): IMappingStats {\n    return {\n      totalMappings: this.customMappings.size,\n      exactMatches: Object.keys(MTF_NAME_MAPPINGS).length,\n      aliasMatches: this.customMappings.size - Object.keys(MTF_NAME_MAPPINGS).length,\n      unknownItems: this.getUnknownNames(),\n    };\n  }\n  \n  /**\n   * Export unknown names to JSON format for manual mapping\n   */\n  exportUnknownNames(): string {\n    const unknowns: Record<string, string> = {};\n    this.unknownNames.forEach(name => {\n      unknowns[name] = ''; // Empty value to be filled in manually\n    });\n    return JSON.stringify(unknowns, null, 2);\n  }\n}\n\n/**\n * Convenience function to get the mapper instance\n */\nexport function getEquipmentNameMapper(): EquipmentNameMapper {\n  return EquipmentNameMapper.getInstance();\n}\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\equipment\\EquipmentRegistry.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RulesLevel' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Equipment Registry\n * \n * Provides fast lookup for equipment by ID, name, or category.\n * Acts as a centralized cache for all loaded equipment.\n * \n * @module services/equipment/EquipmentRegistry\n */\n\nimport { TechBase } from '@/types/enums/TechBase';\nimport { RulesLevel } from '@/types/enums/RulesLevel';\nimport { IWeapon, WeaponCategory } from '@/types/equipment/weapons/interfaces';\nimport { IAmmunition, AmmoCategory } from '@/types/equipment/AmmunitionTypes';\nimport { IElectronics, ElectronicsCategory } from '@/types/equipment/ElectronicsTypes';\nimport { IMiscEquipment, MiscEquipmentCategory } from '@/types/equipment/MiscEquipmentTypes';\nimport { EquipmentLoaderService, getEquipmentLoader } from './EquipmentLoaderService';\n\n/**\n * Generic equipment type union\n */\nexport type AnyEquipment = IWeapon | IAmmunition | IElectronics | IMiscEquipment;\n\n/**\n * Equipment category union\n */\nexport type EquipmentCategoryType = \n  | WeaponCategory \n  | AmmoCategory \n  | ElectronicsCategory \n  | MiscEquipmentCategory \n  | 'Weapon' \n  | 'Ammunition' \n  | 'Electronics' \n  | 'Miscellaneous';\n\n/**\n * Equipment registry statistics\n */\nexport interface IRegistryStats {\n  readonly totalItems: number;\n  readonly weapons: number;\n  readonly ammunition: number;\n  readonly electronics: number;\n  readonly miscellaneous: number;\n  readonly byTechBase: Record<string, number>;\n  readonly byRulesLevel: Record<string, number>;\n}\n\n/**\n * Equipment lookup result\n */\nexport interface IEquipmentLookupResult {\n  readonly found: boolean;\n  readonly equipment: AnyEquipment | null;\n  readonly category: EquipmentCategoryType | null;\n  readonly alternateIds?: string[];\n}\n\n/**\n * Equipment Registry\n * \n * Central registry for all equipment lookups with name aliasing support.\n */\nexport class EquipmentRegistry {\n  private static instance: EquipmentRegistry | null = null;\n  \n  // Name to ID mappings (for MTF name resolution)\n  private nameToIdMap: Map<string, string> = new Map();\n  \n  // ID to equipment type mapping\n  private idToTypeMap: Map<string, EquipmentCategoryType> = new Map();\n  \n  private loader: EquipmentLoaderService;\n  private isInitialized = false;\n  \n  private constructor() {\n    this.loader = getEquipmentLoader();\n  }\n  \n  /**\n   * Get singleton instance\n   */\n  static getInstance(): EquipmentRegistry {\n    if (!EquipmentRegistry.instance) {\n      EquipmentRegistry.instance = new EquipmentRegistry();\n    }\n    return EquipmentRegistry.instance;\n  }\n  \n  /**\n   * Initialize the registry with loaded equipment\n   */\n  async initialize(): Promise<void> {\n    if (this.isInitialized) {\n      return;\n    }\n    \n    // Ensure equipment is loaded\n    if (!this.loader.getIsLoaded()) {\n      await this.loader.loadOfficialEquipment();\n    }\n    \n    // Build name-to-ID mappings for all equipment\n    this.buildNameMappings();\n    \n    this.isInitialized = true;\n  }\n  \n  /**\n   * Build name-to-ID mappings for fast lookups\n   */\n  private buildNameMappings(): void {\n    this.nameToIdMap.clear();\n    this.idToTypeMap.clear();\n    \n    // Map weapons\n    this.loader.getAllWeapons().forEach(weapon => {\n      this.registerEquipment(weapon.id, weapon.name, 'Weapon');\n      this.addCommonAliases(weapon.id, weapon.name, weapon);\n    });\n    \n    // Map ammunition\n    this.loader.getAllAmmunition().forEach(ammo => {\n      this.registerEquipment(ammo.id, ammo.name, 'Ammunition');\n      this.addAmmoAliases(ammo);\n    });\n    \n    // Map electronics\n    this.loader.getAllElectronics().forEach(electronics => {\n      this.registerEquipment(electronics.id, electronics.name, 'Electronics');\n    });\n    \n    // Map misc equipment\n    this.loader.getAllMiscEquipment().forEach(equipment => {\n      this.registerEquipment(equipment.id, equipment.name, 'Miscellaneous');\n      this.addMiscAliases(equipment);\n    });\n  }\n  \n  /**\n   * Register an equipment item\n   */\n  private registerEquipment(id: string, name: string, category: EquipmentCategoryType): void {\n    // Map by ID\n    this.idToTypeMap.set(id, category);\n    \n    // Map by name (normalized)\n    const normalizedName = this.normalizeName(name);\n    this.nameToIdMap.set(normalizedName, id);\n    \n    // Also map original name\n    this.nameToIdMap.set(name, id);\n  }\n  \n  /**\n   * Add common aliases for weapons\n   */\n  private addCommonAliases(id: string, name: string, weapon: IWeapon): void {\n    // Add aliases for common naming variations\n    \n    // Handle \"PPC\" variations\n    if (name.includes('PPC')) {\n      this.nameToIdMap.set('Particle Projector Cannon', id);\n    }\n    \n    // Handle clan weapons with \"(Clan)\" suffix\n    if (weapon.techBase === TechBase.CLAN && !name.includes('Clan')) {\n      // Allow lookup without \"(Clan)\" if unique\n      const baseName = name.replace(' (Clan)', '').replace('(Clan)', '');\n      // Only add if no IS version exists with same base name\n      const normalizedBase = this.normalizeName(baseName);\n      if (!this.nameToIdMap.has(normalizedBase)) {\n        this.nameToIdMap.set(normalizedBase, id);\n      }\n    }\n    \n    // Handle AC/X naming\n    if (name.startsWith('AC/')) {\n      const altName = name.replace('AC/', 'Autocannon/');\n      this.nameToIdMap.set(altName, id);\n      this.nameToIdMap.set(this.normalizeName(altName), id);\n    }\n    \n    // Handle LRM/SRM spacing\n    if (name.match(/^[LS]RM\\s*\\d+/)) {\n      const noSpace = name.replace(/^([LS]RM)\\s+/, '$1');\n      const withSpace = name.replace(/^([LS]RM)(\\d)/, '$1 $2');\n      this.nameToIdMap.set(noSpace, id);\n      this.nameToIdMap.set(withSpace, id);\n    }\n  }\n  \n  /**\n   * Add aliases for ammunition\n   */\n  private addAmmoAliases(ammo: IAmmunition): void {\n    const name = ammo.name;\n    \n    // Handle \"IS Ammo\" and \"Clan Ammo\" prefixes\n    if (ammo.techBase === TechBase.INNER_SPHERE) {\n      this.nameToIdMap.set(`IS ${name}`, ammo.id);\n      this.nameToIdMap.set(`IS Ammo ${name.replace(' Ammo', '').replace('Ammo ', '')}`, ammo.id);\n    } else if (ammo.techBase === TechBase.CLAN) {\n      this.nameToIdMap.set(`Clan ${name}`, ammo.id);\n      this.nameToIdMap.set(`Clan Ammo ${name.replace(' Ammo', '').replace('Ammo ', '')}`, ammo.id);\n    }\n    \n    // Handle various ammo naming patterns from MTF files\n    const weaponBase = name.replace(' Ammo', '').replace('Ammo ', '');\n    this.nameToIdMap.set(`Ammo ${weaponBase}`, ammo.id);\n    this.nameToIdMap.set(`${weaponBase} Ammo`, ammo.id);\n  }\n  \n  /**\n   * Add aliases for miscellaneous equipment\n   */\n  private addMiscAliases(equipment: IMiscEquipment): void {\n    const name = equipment.name;\n    \n    // Handle heat sink variations\n    if (name === 'Heat Sink' || name === 'Double Heat Sink') {\n      this.nameToIdMap.set('Single Heat Sink', 'single-heat-sink');\n      this.nameToIdMap.set('Single', 'single-heat-sink');\n      this.nameToIdMap.set('Double', 'double-heat-sink');\n      this.nameToIdMap.set('DHS', 'double-heat-sink');\n    }\n    \n    // Handle jump jet variations\n    if (name.includes('Jump Jet')) {\n      this.nameToIdMap.set('Jump Jet', 'jump-jet-medium');\n      this.nameToIdMap.set('Jump Jets', 'jump-jet-medium');\n    }\n  }\n  \n  /**\n   * Normalize a name for lookup\n   */\n  private normalizeName(name: string): string {\n    return name\n      .toLowerCase()\n      .replace(/[^a-z0-9]/g, '')\n      .trim();\n  }\n  \n  /**\n   * Look up equipment by ID or name\n   */\n  lookup(idOrName: string): IEquipmentLookupResult {\n    // Try direct ID lookup first\n    const byId = this.loader.getById(idOrName);\n    if (byId) {\n      return {\n        found: true,\n        equipment: byId,\n        category: this.idToTypeMap.get(idOrName) || null,\n      };\n    }\n    \n    // Try name lookup\n    const id = this.nameToIdMap.get(idOrName);\n    if (id) {\n      const equipment = this.loader.getById(id);\n      if (equipment) {\n        return {\n          found: true,\n          equipment,\n          category: this.idToTypeMap.get(id) || null,\n        };\n      }\n    }\n    \n    // Try normalized name lookup\n    const normalizedId = this.nameToIdMap.get(this.normalizeName(idOrName));\n    if (normalizedId) {\n      const equipment = this.loader.getById(normalizedId);\n      if (equipment) {\n        return {\n          found: true,\n          equipment,\n          category: this.idToTypeMap.get(normalizedId) || null,\n        };\n      }\n    }\n    \n    // Not found - suggest alternatives\n    return {\n      found: false,\n      equipment: null,\n      category: null,\n      alternateIds: this.findSimilar(idOrName),\n    };\n  }\n  \n  /**\n   * Find similar equipment IDs for a given name\n   */\n  private findSimilar(name: string): string[] {\n    const normalized = this.normalizeName(name);\n    const similar: string[] = [];\n    \n    // Simple substring matching\n    for (const [mappedName, id] of Array.from(this.nameToIdMap.entries())) {\n      const normalizedMapped = this.normalizeName(mappedName);\n      if (normalizedMapped.includes(normalized) || normalized.includes(normalizedMapped)) {\n        if (!similar.includes(id)) {\n          similar.push(id);\n        }\n      }\n    }\n    \n    return similar.slice(0, 5); // Return top 5 suggestions\n  }\n  \n  /**\n   * Get equipment by ID (type-safe version)\n   */\n  getWeapon(id: string): IWeapon | null {\n    return this.loader.getWeaponById(id);\n  }\n  \n  /**\n   * Get ammunition by ID\n   */\n  getAmmunition(id: string): IAmmunition | null {\n    return this.loader.getAmmunitionById(id);\n  }\n  \n  /**\n   * Get electronics by ID\n   */\n  getElectronics(id: string): IElectronics | null {\n    return this.loader.getElectronicsById(id);\n  }\n  \n  /**\n   * Get misc equipment by ID\n   */\n  getMiscEquipment(id: string): IMiscEquipment | null {\n    return this.loader.getMiscEquipmentById(id);\n  }\n  \n  /**\n   * Resolve an MTF equipment name to a canonical ID\n   */\n  resolveEquipmentName(mtfName: string): string | null {\n    const result = this.lookup(mtfName);\n    return result.found && result.equipment ? result.equipment.id : null;\n  }\n  \n  /**\n   * Get registry statistics\n   */\n  getStats(): IRegistryStats {\n    const weapons = this.loader.getAllWeapons();\n    const ammunition = this.loader.getAllAmmunition();\n    const electronics = this.loader.getAllElectronics();\n    const miscellaneous = this.loader.getAllMiscEquipment();\n    \n    const byTechBase: Record<string, number> = {};\n    const byRulesLevel: Record<string, number> = {};\n    \n    const allEquipment = [...weapons, ...ammunition, ...electronics, ...miscellaneous];\n    \n    allEquipment.forEach(eq => {\n      const tb = eq.techBase.toString();\n      const rl = eq.rulesLevel.toString();\n      byTechBase[tb] = (byTechBase[tb] || 0) + 1;\n      byRulesLevel[rl] = (byRulesLevel[rl] || 0) + 1;\n    });\n    \n    return {\n      totalItems: allEquipment.length,\n      weapons: weapons.length,\n      ammunition: ammunition.length,\n      electronics: electronics.length,\n      miscellaneous: miscellaneous.length,\n      byTechBase,\n      byRulesLevel,\n    };\n  }\n  \n  /**\n   * Check if registry is initialized\n   */\n  isReady(): boolean {\n    return this.isInitialized;\n  }\n  \n  /**\n   * Reset the registry (for testing)\n   */\n  reset(): void {\n    this.nameToIdMap.clear();\n    this.idToTypeMap.clear();\n    this.isInitialized = false;\n  }\n}\n\n/**\n * Convenience function to get the registry instance\n */\nexport function getEquipmentRegistry(): EquipmentRegistry {\n  return EquipmentRegistry.getInstance();\n}\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\equipment\\FormulaEvaluator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\equipment\\FormulaRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\equipment\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\equipment\\variableEquipmentFormulas.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'max' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":6}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Variable Equipment Formulas\r\n * \r\n * Data-driven formula definitions for BattleTech equipment with variable\r\n * weight, slots, cost, or damage based on mech properties.\r\n * \r\n * @spec openspec/specs/equipment-services/spec.md\r\n */\r\n\r\nimport { \r\n  IVariableFormulas, \r\n  fixed, \r\n  ceilDivide, \r\n  floorDivide,\r\n  roundDivide,\r\n  multiply, \r\n  multiplyRound, \r\n  equalsWeight,\r\n  plus,\r\n  max,\r\n} from '@/types/equipment/VariableEquipment';\r\n\r\n/**\r\n * Variable equipment formulas\r\n * Maps equipment ID to formula definitions\r\n */\r\nexport const VARIABLE_EQUIPMENT_FORMULAS: Readonly<Record<string, IVariableFormulas>> = {\r\n  \r\n  // ============================================================================\r\n  // TARGETING COMPUTERS\r\n  // ============================================================================\r\n  \r\n  /**\r\n   * Targeting Computer (Inner Sphere)\r\n   * Weight: ceil(directFireWeaponTonnage / 4)\r\n   * Slots: = weight\r\n   * Cost: weight  10,000\r\n   */\r\n  'targeting-computer-is': {\r\n    weight: ceilDivide('directFireWeaponTonnage', 4),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 10000),\r\n    requiredContext: ['directFireWeaponTonnage'],\r\n  },\r\n\r\n  /**\r\n   * Targeting Computer (Clan)\r\n   * Weight: ceil(directFireWeaponTonnage / 5)\r\n   * Slots: = weight\r\n   * Cost: weight  10,000\r\n   */\r\n  'targeting-computer-clan': {\r\n    weight: ceilDivide('directFireWeaponTonnage', 5),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 10000),\r\n    requiredContext: ['directFireWeaponTonnage'],\r\n  },\r\n\r\n  // ============================================================================\r\n  // MASC\r\n  // ============================================================================\r\n  \r\n  /**\r\n   * MASC (Inner Sphere)\r\n   * Weight: tonnage / 20, rounded to nearest whole ton\r\n   * Slots: = weight\r\n   * Cost: tonnage  1,000\r\n   * \r\n   * Examples: 85t  4 tons (4.25 rounds to 4), 90t  5 tons (4.5 rounds to 5)\r\n   */\r\n  'masc-is': {\r\n    weight: roundDivide('tonnage', 20),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('tonnage', 1000),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  /**\r\n   * MASC (Clan)\r\n   * Weight: tonnage / 25, rounded to nearest whole ton\r\n   * Slots: = weight\r\n   * Cost: tonnage  1,000\r\n   * \r\n   * Examples: 75t  3 tons, 100t  4 tons\r\n   */\r\n  'masc-clan': {\r\n    weight: roundDivide('tonnage', 25),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('tonnage', 1000),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  // ============================================================================\r\n  // SUPERCHARGER\r\n  // ============================================================================\r\n  \r\n  /**\r\n   * Supercharger\r\n   * Weight: engineWeight  10%, rounded up to nearest 0.5 ton\r\n   * Values: 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5, etc.\r\n   * Slots: 1\r\n   * Cost: engineWeight  10,000\r\n   */\r\n  'supercharger': {\r\n    weight: multiplyRound('engineWeight', 0.1, 0.5),\r\n    criticalSlots: fixed(1),\r\n    cost: multiply('engineWeight', 10000),\r\n    requiredContext: ['engineWeight'],\r\n  },\r\n\r\n  // ============================================================================\r\n  // PARTIAL WING\r\n  // ============================================================================\r\n  \r\n  /**\r\n   * Partial Wing\r\n   * Weight: tonnage  0.05 rounded to 0.5 tons\r\n   * Slots: 6 (3 per side torso)\r\n   * Cost: weight  50,000\r\n   */\r\n  'partial-wing': {\r\n    weight: multiplyRound('tonnage', 0.05, 0.5),\r\n    criticalSlots: fixed(6),\r\n    cost: multiply('weight', 50000),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  // ============================================================================\r\n  // TRIPLE STRENGTH MYOMER (TSM)\r\n  // ============================================================================\r\n  \r\n  /**\r\n   * Triple Strength Myomer\r\n   * Weight: 0 (replaces standard myomer)\r\n   * Slots: 6 (distributed across torso/legs)\r\n   * Cost: tonnage  16,000\r\n   */\r\n  'tsm': {\r\n    weight: fixed(0),\r\n    criticalSlots: fixed(6),\r\n    cost: multiply('tonnage', 16000),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  // ============================================================================\r\n  // PHYSICAL WEAPONS\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Hatchet\r\n   * Weight: ceil(tonnage / 15)\r\n   * Slots: = weight\r\n   * Cost: weight  5,000\r\n   * Damage: floor(tonnage / 5)\r\n   */\r\n  'hatchet': {\r\n    weight: ceilDivide('tonnage', 15),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 5000),\r\n    damage: floorDivide('tonnage', 5),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  /**\r\n   * Sword\r\n   * Weight: ceil(tonnage / 15)\r\n   * Slots: = weight\r\n   * Cost: weight  10,000\r\n   * Damage: floor(tonnage / 10) + 1\r\n   */\r\n  'sword': {\r\n    weight: ceilDivide('tonnage', 15),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 10000),\r\n    damage: plus(floorDivide('tonnage', 10), 1),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  /**\r\n   * Mace\r\n   * Weight: ceil(tonnage / 10)\r\n   * Slots: = weight\r\n   * Cost: weight  7,500\r\n   * Damage: floor(tonnage / 4)\r\n   */\r\n  'mace': {\r\n    weight: ceilDivide('tonnage', 10),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 7500),\r\n    damage: floorDivide('tonnage', 4),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  /**\r\n   * Claws (Clan)\r\n   * Weight: ceil(tonnage / 15)\r\n   * Slots: = weight\r\n   * Cost: weight  6,000\r\n   * Damage: floor(tonnage / 7)\r\n   */\r\n  'claws': {\r\n    weight: ceilDivide('tonnage', 15),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 6000),\r\n    damage: floorDivide('tonnage', 7),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  /**\r\n   * Lance\r\n   * Weight: ceil(tonnage / 20)\r\n   * Slots: = weight\r\n   * Cost: weight  15,000\r\n   * Damage: floor(tonnage / 5) + 1\r\n   */\r\n  'lance': {\r\n    weight: ceilDivide('tonnage', 20),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 15000),\r\n    damage: plus(floorDivide('tonnage', 5), 1),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  /**\r\n   * Talons (Clan)\r\n   * Weight: ceil(tonnage / 15)\r\n   * Slots: = weight\r\n   * Cost: weight  6,000\r\n   * Damage: floor(tonnage / 7)\r\n   */\r\n  'talons': {\r\n    weight: ceilDivide('tonnage', 15),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 6000),\r\n    damage: floorDivide('tonnage', 7),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  /**\r\n   * Retractable Blade\r\n   * Weight: tonnage  0.05 rounded to 0.5 tons\r\n   * Slots: 1 per arm (fixed)\r\n   * Cost: weight  10,000\r\n   * Damage: floor(tonnage / 10)\r\n   */\r\n  'retractable-blade': {\r\n    weight: multiplyRound('tonnage', 0.05, 0.5),\r\n    criticalSlots: fixed(1),\r\n    cost: multiply('weight', 10000),\r\n    damage: floorDivide('tonnage', 10),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  /**\r\n   * Flail\r\n   * Weight: ceil(tonnage / 5)\r\n   * Slots: = weight\r\n   * Cost: weight  11,000\r\n   * Damage: floor(tonnage / 4) + 2\r\n   */\r\n  'flail': {\r\n    weight: ceilDivide('tonnage', 5),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 11000),\r\n    damage: plus(floorDivide('tonnage', 4), 2),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n  /**\r\n   * Wrecking Ball\r\n   * Weight: ceil(tonnage / 10)\r\n   * Slots: = weight\r\n   * Cost: weight  11,000\r\n   * Damage: floor(tonnage / 5) + 3\r\n   */\r\n  'wrecking-ball': {\r\n    weight: ceilDivide('tonnage', 10),\r\n    criticalSlots: equalsWeight(),\r\n    cost: multiply('weight', 11000),\r\n    damage: plus(floorDivide('tonnage', 5), 3),\r\n    requiredContext: ['tonnage'],\r\n  },\r\n\r\n} as const;\r\n\r\n/**\r\n * Get all variable equipment IDs\r\n */\r\nexport function getVariableEquipmentIds(): string[] {\r\n  return Object.keys(VARIABLE_EQUIPMENT_FORMULAS);\r\n}\r\n\r\n/**\r\n * Check if an equipment ID has variable formulas\r\n */\r\nexport function hasVariableEquipmentFormulas(equipmentId: string): boolean {\r\n  return equipmentId in VARIABLE_EQUIPMENT_FORMULAS;\r\n}\r\n\r\n/**\r\n * Get variable formulas for an equipment ID\r\n */\r\nexport function getVariableEquipmentFormulas(equipmentId: string): IVariableFormulas | undefined {\r\n  return VARIABLE_EQUIPMENT_FORMULAS[equipmentId];\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\persistence\\FileService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ValidationError' is defined but never used.","line":9,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":177,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":177,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * File Service\n * \n * Export and import JSON files for unit data.\n * \n * @spec openspec/specs/persistence-services/spec.md\n */\n\nimport { FileError, ValidationError } from '../common/errors';\nimport { IImportResult, IValidationResult, validResult, invalidResult, ValidationSeverity } from '../common/types';\n\n/**\n * File service interface\n */\nexport interface IFileService {\n  exportUnit(unit: unknown, filename?: string): void;\n  exportBatch(units: unknown[], filename?: string): Promise<void>;\n  importUnit(file: File): Promise<IImportResult>;\n  importBatch(files: File[]): Promise<IImportResult[]>;\n  validateFile(file: File): Promise<IValidationResult>;\n}\n\n/**\n * File Service implementation\n */\nexport class FileService implements IFileService {\n  /**\n   * Export a single unit as JSON file download\n   */\n  exportUnit(unit: unknown, filename?: string): void {\n    const unitObj = unit as { chassis?: string; variant?: string; model?: string };\n    const defaultName = this.generateFilename(unitObj);\n    const finalFilename = filename || defaultName;\n\n    const json = JSON.stringify(unit, null, 2);\n    const blob = new Blob([json], { type: 'application/json' });\n    this.downloadBlob(blob, finalFilename);\n  }\n\n  /**\n   * Export multiple units as individual JSON files\n   * Note: For ZIP support, jszip library would be needed\n   */\n  async exportBatch(units: unknown[], filename?: string): Promise<void> {\n    // Without jszip, export as a single JSON array file\n    const finalFilename = filename || 'units-export.json';\n    const json = JSON.stringify(units, null, 2);\n    const blob = new Blob([json], { type: 'application/json' });\n    this.downloadBlob(blob, finalFilename);\n  }\n\n  /**\n   * Import a unit from a JSON file\n   */\n  async importUnit(file: File): Promise<IImportResult> {\n    try {\n      const text = await this.readFileAsText(file);\n      const parsed = this.parseJSON(text, file.name);\n      \n      if (!parsed.success) {\n        return {\n          success: false,\n          filename: file.name,\n          errors: [parsed.error],\n        };\n      }\n\n      const validation = this.validateUnitStructure(parsed.data);\n      if (!validation.isValid) {\n        return {\n          success: false,\n          filename: file.name,\n          errors: validation.errors.map(e => e.message),\n        };\n      }\n\n      return {\n        success: true,\n        filename: file.name,\n        unit: parsed.data,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        filename: file.name,\n        errors: [error instanceof Error ? error.message : 'Unknown error'],\n      };\n    }\n  }\n\n  /**\n   * Import multiple units from multiple files\n   */\n  async importBatch(files: File[]): Promise<IImportResult[]> {\n    return Promise.all(files.map(file => this.importUnit(file)));\n  }\n\n  /**\n   * Validate a file without importing\n   */\n  async validateFile(file: File): Promise<IValidationResult> {\n    try {\n      // Check file extension\n      if (!file.name.endsWith('.json')) {\n        return invalidResult([{\n          code: 'INVALID_EXTENSION',\n          message: 'File must have .json extension',\n          severity: ValidationSeverity.ERROR,\n        }]);\n      }\n\n      // Check file size (max 10MB)\n      const MAX_SIZE = 10 * 1024 * 1024;\n      if (file.size > MAX_SIZE) {\n        return invalidResult([{\n          code: 'FILE_TOO_LARGE',\n          message: 'File exceeds maximum size of 10MB',\n          severity: ValidationSeverity.ERROR,\n        }]);\n      }\n\n      const text = await this.readFileAsText(file);\n      const parsed = this.parseJSON(text, file.name);\n      \n      if (!parsed.success) {\n        return invalidResult([{\n          code: 'INVALID_JSON',\n          message: parsed.error,\n          severity: ValidationSeverity.ERROR,\n        }]);\n      }\n\n      return this.validateUnitStructure(parsed.data);\n    } catch (error) {\n      return invalidResult([{\n        code: 'READ_ERROR',\n        message: error instanceof Error ? error.message : 'Failed to read file',\n        severity: ValidationSeverity.ERROR,\n      }]);\n    }\n  }\n\n  // ============================================================================\n  // PRIVATE HELPERS\n  // ============================================================================\n\n  private generateFilename(unit: { chassis?: string; variant?: string; model?: string }): string {\n    const chassis = unit.chassis || 'unknown';\n    const variant = unit.variant || unit.model || 'variant';\n    const safeChassis = chassis.toLowerCase().replace(/[^a-z0-9]+/g, '-');\n    const safeVariant = variant.toLowerCase().replace(/[^a-z0-9]+/g, '-');\n    return `${safeChassis}-${safeVariant}.json`;\n  }\n\n  private downloadBlob(blob: Blob, filename: string): void {\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  }\n\n  private async readFileAsText(file: File): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => resolve(reader.result as string);\n      reader.onerror = () => reject(new FileError('Failed to read file', file.name));\n      reader.readAsText(file);\n    });\n  }\n\n  private parseJSON(text: string, filename: string): { success: true; data: unknown } | { success: false; error: string } {\n    try {\n      const data = JSON.parse(text);\n      return { success: true, data };\n    } catch {\n      return { success: false, error: `Invalid JSON in ${filename}` };\n    }\n  }\n\n  private validateUnitStructure(data: unknown): IValidationResult {\n    const errors: { code: string; message: string; severity: ValidationSeverity }[] = [];\n\n    if (typeof data !== 'object' || data === null) {\n      errors.push({\n        code: 'INVALID_STRUCTURE',\n        message: 'File must contain a JSON object',\n        severity: ValidationSeverity.ERROR,\n      });\n      return invalidResult(errors);\n    }\n\n    const unit = data as Record<string, unknown>;\n\n    // Check required fields\n    if (!unit.id && !unit.chassis) {\n      errors.push({\n        code: 'MISSING_IDENTIFIER',\n        message: 'Unit must have an id or chassis field',\n        severity: ValidationSeverity.ERROR,\n      });\n    }\n\n    if (unit.tonnage !== undefined && typeof unit.tonnage !== 'number') {\n      errors.push({\n        code: 'INVALID_TONNAGE',\n        message: 'Tonnage must be a number',\n        severity: ValidationSeverity.ERROR,\n      });\n    }\n\n    if (errors.length > 0) {\n      return invalidResult(errors);\n    }\n\n    return validResult();\n  }\n}\n\n// Singleton instance\nexport const fileService = new FileService();\n\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\persistence\\IndexedDBService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\persistence\\MigrationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\persistence\\SQLiteService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\persistence\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\CanonicalUnitService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NotFoundError' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":137,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":137,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":139,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":139,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":141,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":141,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":141,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":141,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .join on an `any` value.","line":141,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":141,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":142,"column":10,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":142,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .existsSync on an `any` value.","line":142,"column":13,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":142,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":145,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":145,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of a(n) `any` typed value.","line":145,"column":21,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":145,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .readFileSync on an `any` value.","line":145,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":145,"endColumn":36}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":137,"column":16,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":137,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":139,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":139,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Canonical Unit Service\r\n * \r\n * Provides read-only access to bundled canonical unit data.\r\n * Uses lazy loading for full unit data.\r\n * Supports both server-side (Node.js) and client-side (browser) loading.\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport { IUnitIndexEntry, IUnitQueryCriteria } from '../common/types';\r\nimport { NotFoundError } from '../common/errors';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { Era } from '@/types/enums/Era';\r\nimport { WeightClass } from '@/types/enums/WeightClass';\r\n\r\n/**\r\n * Raw unit index entry from index.json\r\n */\r\ninterface RawUnitIndexEntry {\r\n  id: string;\r\n  chassis: string;\r\n  model: string; // This is 'variant' in our system\r\n  tonnage: number;\r\n  techBase: string;\r\n  year: number;\r\n  role?: string;\r\n  rulesLevel?: string;\r\n  cost?: number;\r\n  bv?: number;\r\n  path: string;\r\n}\r\n\r\n/**\r\n * Map raw index data to IUnitIndexEntry format\r\n */\r\nfunction mapRawToIndexEntry(raw: RawUnitIndexEntry): IUnitIndexEntry {\r\n  // Map techBase string to TechBase enum\r\n  let techBase: TechBase = TechBase.INNER_SPHERE;\r\n  if (raw.techBase === 'CLAN') {\r\n    techBase = TechBase.CLAN;\r\n  } else if (raw.techBase === 'MIXED') {\r\n    techBase = TechBase.INNER_SPHERE; // Default mixed to IS\r\n  }\r\n  \r\n  // Determine weight class from tonnage\r\n  let weightClass: WeightClass;\r\n  if (raw.tonnage <= 35) {\r\n    weightClass = WeightClass.LIGHT;\r\n  } else if (raw.tonnage <= 55) {\r\n    weightClass = WeightClass.MEDIUM;\r\n  } else if (raw.tonnage <= 75) {\r\n    weightClass = WeightClass.HEAVY;\r\n  } else {\r\n    weightClass = WeightClass.ASSAULT;\r\n  }\r\n  \r\n  // Map era from file path (e.g., \"2-star-league/standard/...\")\r\n  let era: Era = Era.LATE_SUCCESSION_WARS;\r\n  if (raw.path.includes('1-age-of-war')) {\r\n    era = Era.AGE_OF_WAR;\r\n  } else if (raw.path.includes('2-star-league')) {\r\n    era = Era.STAR_LEAGUE;\r\n  } else if (raw.path.includes('3-succession-wars')) {\r\n    era = Era.LATE_SUCCESSION_WARS;\r\n  } else if (raw.path.includes('4-clan-invasion')) {\r\n    era = Era.CLAN_INVASION;\r\n  } else if (raw.path.includes('5-civil-war')) {\r\n    era = Era.CIVIL_WAR;\r\n  } else if (raw.path.includes('6-dark-age')) {\r\n    era = Era.DARK_AGE;\r\n  } else if (raw.path.includes('7-ilclan')) {\r\n    era = Era.IL_CLAN;\r\n  }\r\n  \r\n  return {\r\n    id: raw.id,\r\n    name: `${raw.chassis} ${raw.model}`,\r\n    chassis: raw.chassis,\r\n    variant: raw.model,\r\n    tonnage: raw.tonnage,\r\n    techBase,\r\n    era,\r\n    weightClass,\r\n    unitType: 'BattleMech',\r\n    filePath: `/data/units/battlemechs/${raw.path}`,\r\n    year: raw.year,\r\n    role: raw.role,\r\n    rulesLevel: raw.rulesLevel,\r\n    cost: raw.cost,\r\n    bv: raw.bv,\r\n  };\r\n}\r\n\r\n/**\r\n * Full unit data structure (placeholder - will be defined in types)\r\n */\r\nexport interface IFullUnit {\r\n  readonly id: string;\r\n  readonly chassis: string;\r\n  readonly variant: string;\r\n  readonly tonnage: number;\r\n  readonly techBase: string;\r\n  readonly era: string;\r\n  readonly unitType: string;\r\n  // Additional fields for complete unit data\r\n  readonly equipment?: unknown[];\r\n  readonly armor?: Record<string, number>;\r\n  readonly structure?: Record<string, number>;\r\n  [key: string]: unknown;\r\n}\r\n\r\n/**\r\n * Canonical unit service interface\r\n */\r\nexport interface ICanonicalUnitService {\r\n  getIndex(): Promise<readonly IUnitIndexEntry[]>;\r\n  getById(id: string): Promise<IFullUnit | null>;\r\n  getByIds(ids: string[]): Promise<IFullUnit[]>;\r\n  query(criteria: IUnitQueryCriteria): Promise<readonly IUnitIndexEntry[]>;\r\n}\r\n\r\n/**\r\n * Check if running on server side (Node.js)\r\n */\r\nfunction isServerSide(): boolean {\r\n  return typeof window === 'undefined';\r\n}\r\n\r\n/**\r\n * Load JSON data from file system (server-side only)\r\n */\r\nfunction loadJsonFromFs<T>(relativePath: string): T | null {\r\n  try {\r\n    // Dynamic require to avoid bundling fs/path in browser\r\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\r\n    const fs = require('fs');\r\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\r\n    const path = require('path');\r\n    \r\n    const filePath = path.join(process.cwd(), 'public', relativePath);\r\n    if (!fs.existsSync(filePath)) {\r\n      return null;\r\n    }\r\n    const content = fs.readFileSync(filePath, 'utf-8');\r\n    return JSON.parse(content) as T;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Canonical Unit Service implementation\r\n */\r\nexport class CanonicalUnitService implements ICanonicalUnitService {\r\n  private indexCache: IUnitIndexEntry[] | null = null;\r\n  private unitCache: Map<string, IFullUnit> = new Map();\r\n  private indexPath = '/data/units/battlemechs/index.json';\r\n\r\n  /**\r\n   * Load JSON data - works on both server and client side\r\n   */\r\n  private async loadJson<T>(relativePath: string): Promise<T | null> {\r\n    if (isServerSide()) {\r\n      // Server-side: use Node.js fs module via dynamic require\r\n      return loadJsonFromFs<T>(relativePath);\r\n    } else {\r\n      // Client-side: use fetch\r\n      try {\r\n        const response = await fetch(relativePath);\r\n        if (!response.ok) {\r\n          return null;\r\n        }\r\n        return await response.json() as T;\r\n      } catch {\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load the lightweight unit index\r\n   */\r\n  async getIndex(): Promise<readonly IUnitIndexEntry[]> {\r\n    if (this.indexCache) {\r\n      return this.indexCache;\r\n    }\r\n\r\n    try {\r\n      const data = await this.loadJson<{ units?: RawUnitIndexEntry[] }>(this.indexPath);\r\n      \r\n      if (!data) {\r\n        this.indexCache = [];\r\n        return this.indexCache;\r\n      }\r\n      \r\n      // Map raw index data to IUnitIndexEntry format\r\n      this.indexCache = (data.units || []).map(mapRawToIndexEntry);\r\n      return this.indexCache;\r\n    } catch {\r\n      // Index not available - return empty array\r\n      this.indexCache = [];\r\n      return this.indexCache;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get full unit data by ID (lazy loads from static JSON)\r\n   */\r\n  async getById(id: string): Promise<IFullUnit | null> {\r\n    // Check cache first\r\n    if (this.unitCache.has(id)) {\r\n      return this.unitCache.get(id)!;\r\n    }\r\n\r\n    // Find in index to get file path\r\n    const index = await this.getIndex();\r\n    const entry = index.find(e => e.id === id);\r\n    \r\n    if (!entry) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const unit = await this.loadJson<IFullUnit>(entry.filePath);\r\n      if (!unit) {\r\n        return null;\r\n      }\r\n      this.unitCache.set(id, unit);\r\n      return unit;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get multiple units by ID (parallel loading)\r\n   */\r\n  async getByIds(ids: string[]): Promise<IFullUnit[]> {\r\n    const results = await Promise.all(\r\n      ids.map(id => this.getById(id))\r\n    );\r\n    return results.filter((unit): unit is IFullUnit => unit !== null);\r\n  }\r\n\r\n  /**\r\n   * Query units by criteria (filters index in memory)\r\n   */\r\n  async query(criteria: IUnitQueryCriteria): Promise<readonly IUnitIndexEntry[]> {\r\n    let results = await this.getIndex();\r\n\r\n    if (criteria.techBase !== undefined) {\r\n      results = results.filter(e => e.techBase === criteria.techBase);\r\n    }\r\n\r\n    if (criteria.era !== undefined) {\r\n      results = results.filter(e => e.era === criteria.era);\r\n    }\r\n\r\n    if (criteria.weightClass !== undefined) {\r\n      results = results.filter(e => e.weightClass === criteria.weightClass);\r\n    }\r\n\r\n    if (criteria.unitType !== undefined) {\r\n      results = results.filter(e => e.unitType === criteria.unitType);\r\n    }\r\n\r\n    if (criteria.minTonnage !== undefined) {\r\n      results = results.filter(e => e.tonnage >= criteria.minTonnage!);\r\n    }\r\n\r\n    if (criteria.maxTonnage !== undefined) {\r\n      results = results.filter(e => e.tonnage <= criteria.maxTonnage!);\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Clear caches (for testing)\r\n   */\r\n  clearCache(): void {\r\n    this.indexCache = null;\r\n    this.unitCache.clear();\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const canonicalUnitService = new CanonicalUnitService();\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\CustomUnitApiService.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":97,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":97,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .ce im on an `any` value.","line":98,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":98,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":115,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":115,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access . Promise<I on an `any` value.","line":119,"column":15,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":119,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":120,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":120,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .nu on an `any` value.","line":120,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":120,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":121,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":121,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .se = aw on an `any` value.","line":121,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":121,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":122,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":122,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .custom/ on an `any` value.","line":122,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":122,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":123,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":123,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .    \r\n    if ( on an `any` value.","line":123,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":123,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":124,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":124,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .{\r\n       on an `any` value.","line":124,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":124,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":125,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":125,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .\r\n    if  on an `any` value.","line":125,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":125,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":156,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":156,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":161,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":161,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .   co on an `any` value.","line":161,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":161,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .hod: 'POS on an `any` value.","line":162,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":162,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":168,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":168,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .ha on an `any` value.","line":168,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":168,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":169,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":169,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .        on an `any` value.","line":169,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":169,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":186,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":186,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":191,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":191,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .: str on an `any` value.","line":191,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":191,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":197,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":197,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":197,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":197,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":198,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":198,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .T',\r\n   on an `any` value.","line":198,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":198,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":210,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":210,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":214,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":214,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .\n  on an `any` value.","line":214,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":214,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":215,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":215,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .    i on an `any` value.","line":215,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":215,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `Promise<any>`.","line":250,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":250,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":290,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":290,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .ccess: t on an `any` value.","line":291,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":291,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":310,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":310,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":313,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":313,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .mber):  on an `any` value.","line":313,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":313,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":314,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":314,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .a | nul on an `any` value.","line":314,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":314,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":315,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":315,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .nse = on an `any` value.","line":315,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":315,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":316,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":316,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .BASE}/custom on an `any` value.","line":316,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":316,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .t(id)}/ver on an `any` value.","line":317,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":317,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":334,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":334,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":338,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":338,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .es on an `any` value.","line":338,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":338,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":339,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":339,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .Operati on an `any` value.","line":339,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":339,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":340,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":340,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .respo on an `any` value.","line":340,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":340,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of a value of type `Promise<any>`.","line":360,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":360,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":373,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":373,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":378,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":378,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .\r\n  a on an `any` value.","line":378,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":378,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .SaveResult> { on an `any` value.","line":380,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":380,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":383,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":383,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .headers: { 'C on an `any` value.","line":383,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":383,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":390,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":390,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access . = awa on an `any` value.","line":390,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":390,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":65,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Custom Unit API Service\r\n * \r\n * Client-side service for interacting with the custom units REST API.\r\n * Provides CRUD operations, version management, and canonical unit protection.\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport {\r\n  ICustomUnitIndexEntry,\r\n  IVersionMetadata,\r\n  ISerializedUnitEnvelope,\r\n  ICloneNameSuggestion,\r\n  IUnitOperationResult,\r\n} from '@/types/persistence/UnitPersistence';\r\nimport { IFullUnit } from './CanonicalUnitService';\r\nimport { canonicalUnitService } from './CanonicalUnitService';\r\n\r\n/**\r\n * Unit with version info\r\n */\r\nexport interface IUnitWithVersion extends IFullUnit {\r\n  readonly currentVersion: number;\r\n  readonly createdAt: string;\r\n  readonly updatedAt: string;\r\n}\r\n\r\n/**\r\n * API Response types\r\n */\r\ninterface IUnitListResponse {\r\n  readonly units: readonly ICustomUnitIndexEntry[];\r\n}\r\n\r\ninterface IUnitDetailsResponse {\r\n  readonly success: boolean;\r\n  readonly data?: IUnitWithVersion;\r\n  readonly error?: string;\r\n}\r\n\r\ninterface IUnitOperationResponse {\r\n  readonly success: boolean;\r\n  readonly data?: ISerializedUnitEnvelope;\r\n  readonly error?: string;\r\n  readonly count?: number;\r\n}\r\n\r\n/**\r\n * Save result\r\n */\r\nexport interface ISaveResult {\r\n  readonly success: boolean;\r\n  readonly id?: string;\r\n  readonly version?: number;\r\n  readonly error?: string;\r\n  readonly requiresRename?: boolean;\r\n  readonly suggestedName?: ICloneNameSuggestion;\r\n}\r\n\r\n/**\r\n * Version history entry with full data\r\n */\r\nexport interface IVersionWithData {\r\n  readonly version: number;\r\n  readonly savedAt: string;\r\n  readonly notes: string | null;\r\n  readonly revertSource: number | null;\r\n  readonly data: IFullUnit;\r\n}\r\n\r\n/**\r\n * Custom Unit API Service interface\r\n */\r\nexport interface ICustomUnitApiService {\r\n  // CRUD\r\n  list(): Promise<readonly ICustomUnitIndexEntry[]>;\r\n  getById(id: string): Promise<IUnitWithVersion | null>;\r\n  create(unit: IFullUnit, chassis: string, variant: string, notes?: string): Promise<ISaveResult>;\r\n  save(id: string, unit: IFullUnit, notes?: string): Promise<ISaveResult>;\r\n  delete(id: string): Promise<IUnitOperationResult>;\r\n  \r\n  // Canonical protection\r\n  isCanonical(chassis: string, variant: string): Promise<boolean>;\r\n  suggestCloneName(chassis: string, variant: string): Promise<ICloneNameSuggestion>;\r\n  checkSaveAllowed(unit: IFullUnit, originalId?: string): Promise<ISaveResult>;\r\n  \r\n  // Version management\r\n  getVersionHistory(id: string): Promise<readonly IVersionMetadata[]>;\r\n  getVersion(id: string, version: number): Promise<IVersionWithData | null>;\r\n  revert(id: string, targetVersion: number, notes?: string): Promise<IUnitOperationResult>;\r\n  \r\n  // Export/Import\r\n  exportUnit(id: string): Promise<ISerializedUnitEnvelope | null>;\r\n  importUnit(data: ISerializedUnitEnvelope | Record<string, unknown>): Promise<ISaveResult>;\r\n}\r\n\r\n/**\r\n * API base URL\r\n */\r\nconst API_BASE = '/api/units';\r\n\r\n/**\r\n * Custom Unit API Service implementation\r\n */\r\nexport class CustomUnitApiService implements ICustomUnitApiService {\r\n  /**\r\n   * List all custom units\r\n   */\r\n  async list(): Promise<readonly ICustomUnitIndexEntry[]> {\r\n    const response = await fetch(`${API_BASE}/custom`);\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`Failed to list units: ${response.statusText}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    return data.units as ICustomUnitIndexEntry[];\r\n  }\r\n\r\n  /**\r\n   * Get a custom unit by ID\r\n   */\r\n  async getById(id: string): Promise<IUnitWithVersion | null> {\r\n    const response = await fetch(`${API_BASE}/custom/${encodeURIComponent(id)}`);\r\n    \r\n    if (response.status === 404) {\r\n      return null;\r\n    }\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`Failed to get unit: ${response.statusText}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    \r\n    // Convert API response to IFullUnit format\r\n    return {\r\n      ...data.parsedData,\r\n      id: data.id,\r\n      chassis: data.chassis,\r\n      variant: data.variant,\r\n      currentVersion: data.currentVersion,\r\n      createdAt: data.createdAt,\r\n      updatedAt: data.updatedAt,\r\n    } as IUnitWithVersion;\r\n  }\r\n\r\n  /**\r\n   * Create a new custom unit\r\n   */\r\n  async create(unit: IFullUnit, chassis: string, variant: string, notes?: string): Promise<ISaveResult> {\r\n    // Check if name is already taken\r\n    const existingCustom = await this.findByName(chassis, variant);\r\n    if (existingCustom) {\r\n      const suggestion = await this.suggestCloneName(chassis, variant);\r\n      return {\r\n        success: false,\r\n        error: `Unit \"${chassis} ${variant}\" already exists`,\r\n        requiresRename: true,\r\n        suggestedName: suggestion,\r\n      };\r\n    }\r\n\r\n    const response = await fetch(`${API_BASE}/custom`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        chassis,\r\n        variant,\r\n        data: { ...unit, chassis, variant },\r\n        notes,\r\n      }),\r\n    });\r\n    \r\n    const result = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      return {\r\n        success: false,\r\n        error: result.error || 'Failed to create unit',\r\n        requiresRename: result.errorCode === 'DUPLICATE_NAME',\r\n      };\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      id: result.id,\r\n      version: result.version,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Save (update) an existing custom unit\r\n   */\r\n  async save(id: string, unit: IFullUnit, notes?: string): Promise<ISaveResult> {\r\n    const response = await fetch(`${API_BASE}/custom/${encodeURIComponent(id)}`, {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        data: unit,\r\n        notes,\r\n      }),\r\n    });\r\n    \r\n    const result = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      return {\r\n        success: false,\r\n        error: result.error || 'Failed to save unit',\r\n      };\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      id: result.id,\r\n      version: result.version,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete a custom unit\r\n   */\r\n  async delete(id: string): Promise<IUnitOperationResult> {\r\n    const response = await fetch(`${API_BASE}/custom/${encodeURIComponent(id)}`, {\r\n      method: 'DELETE',\r\n    });\r\n    \r\n    const result = await response.json();\r\n    \r\n    return {\r\n      success: response.ok,\r\n      id: result.id,\r\n      error: result.error,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if a chassis/variant combination is a canonical unit\r\n   */\r\n  async isCanonical(chassis: string, variant: string): Promise<boolean> {\r\n    const index = await canonicalUnitService.getIndex();\r\n    const normalizedName = `${chassis} ${variant}`.toLowerCase();\r\n    \r\n    return index.some(entry => \r\n      `${entry.chassis} ${entry.variant}`.toLowerCase() === normalizedName\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get a suggested clone name\r\n   */\r\n  async suggestCloneName(chassis: string, variant: string): Promise<ICloneNameSuggestion> {\r\n    const response = await fetch(`${API_BASE}/custom/suggest-name`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ chassis, variant }),\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      // Fallback to client-side suggestion\r\n      return {\r\n        chassis,\r\n        variant,\r\n        suggestedVariant: `${variant}-Custom-1`,\r\n      };\r\n    }\r\n    \r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Check if saving is allowed and get rename suggestion if needed\r\n   */\r\n  async checkSaveAllowed(unit: IFullUnit, originalId?: string): Promise<ISaveResult> {\r\n    const chassis = unit.chassis;\r\n    const variant = unit.variant;\r\n    \r\n    // If this is an existing custom unit, saving is always allowed\r\n    if (originalId?.startsWith('custom-')) {\r\n      return { success: true };\r\n    }\r\n    \r\n    // Check if it's a canonical unit\r\n    const isCanon = await this.isCanonical(chassis, variant);\r\n    if (isCanon) {\r\n      const suggestion = await this.suggestCloneName(chassis, variant);\r\n      return {\r\n        success: false,\r\n        error: 'Cannot overwrite canonical unit',\r\n        requiresRename: true,\r\n        suggestedName: suggestion,\r\n      };\r\n    }\r\n    \r\n    return { success: true };\r\n  }\r\n\r\n  /**\r\n   * Get version history for a unit\r\n   */\r\n  async getVersionHistory(id: string): Promise<readonly IVersionMetadata[]> {\r\n    const response = await fetch(`${API_BASE}/custom/${encodeURIComponent(id)}/versions`);\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`Failed to get version history: ${response.statusText}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    return data.versions as IVersionMetadata[];\r\n  }\r\n\r\n  /**\r\n   * Get a specific version of a unit\r\n   */\r\n  async getVersion(id: string, version: number): Promise<IVersionWithData | null> {\r\n    const response = await fetch(\r\n      `${API_BASE}/custom/${encodeURIComponent(id)}/versions/${version}`\r\n    );\r\n    \r\n    if (response.status === 404) {\r\n      return null;\r\n    }\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`Failed to get version: ${response.statusText}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    \r\n    return {\r\n      version: data.version,\r\n      savedAt: data.savedAt,\r\n      notes: data.notes,\r\n      revertSource: data.revertSource,\r\n      data: data.parsedData as IFullUnit,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Revert a unit to a previous version\r\n   */\r\n  async revert(id: string, targetVersion: number, notes?: string): Promise<IUnitOperationResult> {\r\n    const response = await fetch(\r\n      `${API_BASE}/custom/${encodeURIComponent(id)}/revert/${targetVersion}`,\r\n      {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ notes }),\r\n      }\r\n    );\r\n    \r\n    const result = await response.json();\r\n    \r\n    return {\r\n      success: response.ok,\r\n      id: result.id,\r\n      version: result.version,\r\n      error: result.error,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Export a unit as JSON envelope\r\n   */\r\n  async exportUnit(id: string): Promise<ISerializedUnitEnvelope | null> {\r\n    const response = await fetch(\r\n      `${API_BASE}/custom/${encodeURIComponent(id)}/export`\r\n    );\r\n    \r\n    if (response.status === 404) {\r\n      return null;\r\n    }\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`Failed to export unit: ${response.statusText}`);\r\n    }\r\n    \r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Import a unit from JSON\r\n   */\r\n  async importUnit(data: ISerializedUnitEnvelope | Record<string, unknown>): Promise<ISaveResult> {\r\n    const response = await fetch(`${API_BASE}/import`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(data),\r\n    });\r\n    \r\n    const result = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      return {\r\n        success: false,\r\n        error: result.error,\r\n        requiresRename: response.status === 409,\r\n        suggestedName: result.suggestedName ? {\r\n          chassis: '',\r\n          variant: '',\r\n          suggestedVariant: result.suggestedName,\r\n        } : undefined,\r\n      };\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      id: result.unitId,\r\n      version: 1,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Find a custom unit by name\r\n   */\r\n  private async findByName(chassis: string, variant: string): Promise<ICustomUnitIndexEntry | null> {\r\n    const units = await this.list();\r\n    const normalizedName = `${chassis} ${variant}`.toLowerCase();\r\n    \r\n    return units.find(unit =>\r\n      `${unit.chassis} ${unit.variant}`.toLowerCase() === normalizedName\r\n    ) || null;\r\n  }\r\n\r\n  /**\r\n   * Download a unit as a file\r\n   */\r\n  async downloadUnit(id: string): Promise<void> {\r\n    const envelope = await this.exportUnit(id);\r\n    if (!envelope) {\r\n      throw new Error('Unit not found');\r\n    }\r\n    \r\n    const unit = envelope.unit as IFullUnit;\r\n    const filename = `${unit.chassis || 'unit'}-${unit.variant || 'export'}.json`\r\n      .replace(/[^a-zA-Z0-9\\-_.]/g, '-');\r\n    \r\n    const blob = new Blob([JSON.stringify(envelope, null, 2)], {\r\n      type: 'application/json',\r\n    });\r\n    \r\n    const url = URL.createObjectURL(blob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = filename;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const customUnitApiService = new CustomUnitApiService();\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\CustomUnitService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WeightClass' is defined but never used.","line":16,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Custom Unit Service\r\n * \r\n * CRUD operations for user-created unit variants stored in IndexedDB.\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { IUnitIndexEntry } from '../common/types';\r\nimport { NotFoundError } from '../common/errors';\r\nimport { indexedDBService, STORES } from '../persistence/IndexedDBService';\r\nimport { IFullUnit } from './CanonicalUnitService';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { Era } from '@/types/enums/Era';\r\nimport { WeightClass, getWeightClass } from '@/types/enums/WeightClass';\r\n\r\n/**\r\n * Unit name entry for quick lookups\r\n */\r\nexport interface IUnitNameEntry {\r\n  readonly id: string;\r\n  readonly chassis: string;\r\n  readonly variant: string;\r\n  readonly fullName: string;\r\n}\r\n\r\n/**\r\n * Custom unit service interface\r\n */\r\nexport interface ICustomUnitService {\r\n  create(unit: IFullUnit, overwriteId?: string): Promise<string>;\r\n  update(id: string, unit: IFullUnit): Promise<void>;\r\n  delete(id: string): Promise<void>;\r\n  getById(id: string): Promise<IFullUnit | null>;\r\n  list(): Promise<readonly IUnitIndexEntry[]>;\r\n  exists(id: string): Promise<boolean>;\r\n  findByName(chassis: string, variant: string): Promise<IFullUnit | null>;\r\n  listNames(): Promise<readonly IUnitNameEntry[]>;\r\n}\r\n\r\n/**\r\n * Custom Unit Service implementation\r\n */\r\nexport class CustomUnitService implements ICustomUnitService {\r\n  private initialized = false;\r\n\r\n  /**\r\n   * Ensure database is initialized\r\n   */\r\n  private async ensureInitialized(): Promise<void> {\r\n    if (!this.initialized) {\r\n      await indexedDBService.initialize();\r\n      this.initialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new custom unit or overwrite an existing one\r\n   * @param unit - The unit data to save\r\n   * @param overwriteId - Optional ID of existing unit to overwrite\r\n   * @returns The unit ID (either generated or the overwriteId)\r\n   */\r\n  async create(unit: IFullUnit, overwriteId?: string): Promise<string> {\r\n    await this.ensureInitialized();\r\n    \r\n    // If overwriting, use the existing ID; otherwise generate a new one\r\n    const id = overwriteId || `custom-${uuidv4()}`;\r\n    const unitWithId = { ...unit, id };\r\n    \r\n    await indexedDBService.put(STORES.CUSTOM_UNITS, id, unitWithId);\r\n    \r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Update an existing custom unit\r\n   */\r\n  async update(id: string, unit: IFullUnit): Promise<void> {\r\n    await this.ensureInitialized();\r\n    \r\n    const existing = await this.getById(id);\r\n    if (!existing) {\r\n      throw new NotFoundError('Custom Unit', id);\r\n    }\r\n    \r\n    const unitWithId = { ...unit, id };\r\n    await indexedDBService.put(STORES.CUSTOM_UNITS, id, unitWithId);\r\n  }\r\n\r\n  /**\r\n   * Delete a custom unit\r\n   */\r\n  async delete(id: string): Promise<void> {\r\n    await this.ensureInitialized();\r\n    await indexedDBService.delete(STORES.CUSTOM_UNITS, id);\r\n  }\r\n\r\n  /**\r\n   * Get a custom unit by ID\r\n   */\r\n  async getById(id: string): Promise<IFullUnit | null> {\r\n    await this.ensureInitialized();\r\n    const unit = await indexedDBService.get<IFullUnit>(STORES.CUSTOM_UNITS, id);\r\n    return unit || null;\r\n  }\r\n\r\n  /**\r\n   * List all custom units as index entries\r\n   */\r\n  async list(): Promise<readonly IUnitIndexEntry[]> {\r\n    await this.ensureInitialized();\r\n    const units = await indexedDBService.getAll<IFullUnit>(STORES.CUSTOM_UNITS);\r\n    \r\n    return units.map(unit => this.toIndexEntry(unit));\r\n  }\r\n\r\n  /**\r\n   * Check if a custom unit exists\r\n   */\r\n  async exists(id: string): Promise<boolean> {\r\n    const unit = await this.getById(id);\r\n    return unit !== null;\r\n  }\r\n\r\n  /**\r\n   * Find a custom unit by chassis and variant name\r\n   * Uses case-insensitive comparison\r\n   */\r\n  async findByName(chassis: string, variant: string): Promise<IFullUnit | null> {\r\n    await this.ensureInitialized();\r\n    \r\n    const normalizedChassis = chassis.trim().toLowerCase();\r\n    const normalizedVariant = variant.trim().toLowerCase();\r\n    \r\n    const units = await indexedDBService.getAll<IFullUnit>(STORES.CUSTOM_UNITS);\r\n    \r\n    const match = units.find((unit) => {\r\n      const unitChassis = (unit.chassis || '').trim().toLowerCase();\r\n      const unitVariant = (unit.variant || '').trim().toLowerCase();\r\n      return unitChassis === normalizedChassis && unitVariant === normalizedVariant;\r\n    });\r\n    \r\n    return match || null;\r\n  }\r\n\r\n  /**\r\n   * List all custom unit names for quick lookup\r\n   * More efficient than loading full unit data\r\n   */\r\n  async listNames(): Promise<readonly IUnitNameEntry[]> {\r\n    await this.ensureInitialized();\r\n    \r\n    const units = await indexedDBService.getAll<IFullUnit>(STORES.CUSTOM_UNITS);\r\n    \r\n    return units.map((unit) => ({\r\n      id: unit.id,\r\n      chassis: unit.chassis || '',\r\n      variant: unit.variant || '',\r\n      fullName: `${unit.chassis || ''} ${unit.variant || ''}`.trim(),\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Convert full unit to index entry\r\n   */\r\n  private toIndexEntry(unit: IFullUnit): IUnitIndexEntry {\r\n    const tonnage = typeof unit.tonnage === 'number' ? unit.tonnage : 0;\r\n    \r\n    return {\r\n      id: unit.id,\r\n      name: `${unit.chassis} ${unit.variant}`,\r\n      chassis: unit.chassis,\r\n      variant: unit.variant,\r\n      tonnage,\r\n      techBase: unit.techBase as TechBase || TechBase.INNER_SPHERE,\r\n      era: unit.era as Era || Era.LATE_SUCCESSION_WARS,\r\n      weightClass: getWeightClass(tonnage),\r\n      unitType: (unit.unitType as IUnitIndexEntry['unitType']) || 'BattleMech',\r\n      filePath: '', // Custom units don't have file paths\r\n    };\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const customUnitService = new CustomUnitService();\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\UnitFactoryService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'uuidv4' is defined but never used.","line":43,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Factory Service\r\n * \r\n * Converts ISerializedUnit to runtime IBattleMech objects.\r\n * Handles equipment resolution, validation, and derived value calculation.\r\n * \r\n * @module services/units/UnitFactoryService\r\n */\r\n\r\nimport {\r\n  IBattleMech,\r\n  IUnitMetadata,\r\n  IEngineConfiguration,\r\n  IGyroConfiguration,\r\n  IStructureConfiguration,\r\n  IHeatSinkConfiguration,\r\n  IMovementConfiguration,\r\n  IMountedEquipment,\r\n  ICriticalSlotAssignment,\r\n  ICriticalSlot,\r\n  UnitType,\r\n  MechConfiguration,\r\n} from '@/types/unit/BattleMechInterfaces';\r\nimport {\r\n  ISerializedUnit,\r\n} from '@/types/unit/UnitSerialization';\r\nimport {\r\n  EngineType,\r\n  GyroType,\r\n  InternalStructureType,\r\n  HeatSinkType,\r\n  ArmorTypeEnum,\r\n  CockpitType,\r\n  MechLocation,\r\n  IArmorAllocation,\r\n} from '@/types/construction';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { RulesLevel } from '@/types/enums/RulesLevel';\r\nimport { Era } from '@/types/enums/Era';\r\nimport { WeightClass } from '@/types/enums/WeightClass';\r\nimport { getEquipmentRegistry } from '@/services/equipment/EquipmentRegistry';\r\nimport { calculateEngineWeight } from '@/utils/construction/engineCalculations';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\n/**\r\n * Factory result\r\n */\r\nexport interface IUnitFactoryResult {\r\n  readonly success: boolean;\r\n  readonly unit: IBattleMech | null;\r\n  readonly errors: string[];\r\n  readonly warnings: string[];\r\n}\r\n\r\n/**\r\n * Parse engine type from string\r\n */\r\nfunction parseEngineType(value: string): EngineType {\r\n  switch (value.toUpperCase()) {\r\n    case 'FUSION':\r\n    case 'STANDARD':\r\n      return EngineType.STANDARD;\r\n    case 'XL':\r\n    case 'XL_IS':\r\n      return EngineType.XL_IS;\r\n    case 'CLAN_XL':\r\n    case 'XL_CLAN':\r\n      return EngineType.XL_CLAN;\r\n    case 'LIGHT':\r\n      return EngineType.LIGHT;\r\n    case 'COMPACT':\r\n      return EngineType.COMPACT;\r\n    case 'XXL':\r\n      return EngineType.XXL;\r\n    case 'ICE':\r\n      return EngineType.ICE;\r\n    case 'FUEL_CELL':\r\n      return EngineType.FUEL_CELL;\r\n    case 'FISSION':\r\n      return EngineType.FISSION;\r\n    default:\r\n      return EngineType.STANDARD;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse gyro type from string\r\n */\r\nfunction parseGyroType(value: string): GyroType {\r\n  switch (value.toUpperCase()) {\r\n    case 'STANDARD':\r\n      return GyroType.STANDARD;\r\n    case 'XL':\r\n      return GyroType.XL;\r\n    case 'COMPACT':\r\n      return GyroType.COMPACT;\r\n    case 'HEAVY_DUTY':\r\n      return GyroType.HEAVY_DUTY;\r\n    default:\r\n      return GyroType.STANDARD;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse cockpit type from string\r\n */\r\nfunction parseCockpitType(value: string): CockpitType {\r\n  switch (value.toUpperCase()) {\r\n    case 'STANDARD': return CockpitType.STANDARD;\r\n    case 'SMALL': return CockpitType.SMALL;\r\n    case 'COMMAND_CONSOLE': return CockpitType.COMMAND_CONSOLE;\r\n    case 'TORSO_MOUNTED': return CockpitType.TORSO_MOUNTED;\r\n    case 'PRIMITIVE': return CockpitType.PRIMITIVE;\r\n    case 'INDUSTRIAL': return CockpitType.INDUSTRIAL;\r\n    default: return CockpitType.STANDARD;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse structure type from string\r\n */\r\nfunction parseStructureType(value: string): InternalStructureType {\r\n  switch (value.toUpperCase()) {\r\n    case 'STANDARD':\r\n      return InternalStructureType.STANDARD;\r\n    case 'ENDO_STEEL':\r\n    case 'ENDO_STEEL_IS':\r\n      return InternalStructureType.ENDO_STEEL_IS;\r\n    case 'ENDO_STEEL_CLAN':\r\n      return InternalStructureType.ENDO_STEEL_CLAN;\r\n    case 'ENDO_COMPOSITE':\r\n      return InternalStructureType.ENDO_COMPOSITE;\r\n    case 'REINFORCED':\r\n      return InternalStructureType.REINFORCED;\r\n    case 'COMPOSITE':\r\n      return InternalStructureType.COMPOSITE;\r\n    case 'INDUSTRIAL':\r\n      return InternalStructureType.INDUSTRIAL;\r\n    default:\r\n      return InternalStructureType.STANDARD;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse armor type from string\r\n */\r\nfunction parseArmorType(value: string): ArmorTypeEnum {\r\n  switch (value.toUpperCase()) {\r\n    case 'STANDARD':\r\n      return ArmorTypeEnum.STANDARD;\r\n    case 'FERRO_FIBROUS':\r\n    case 'FERRO_FIBROUS_IS':\r\n      return ArmorTypeEnum.FERRO_FIBROUS_IS;\r\n    case 'FERRO_FIBROUS_CLAN':\r\n      return ArmorTypeEnum.FERRO_FIBROUS_CLAN;\r\n    case 'LIGHT_FERRO_FIBROUS':\r\n    case 'LIGHT_FERRO':\r\n      return ArmorTypeEnum.LIGHT_FERRO;\r\n    case 'HEAVY_FERRO_FIBROUS':\r\n    case 'HEAVY_FERRO':\r\n      return ArmorTypeEnum.HEAVY_FERRO;\r\n    case 'STEALTH':\r\n      return ArmorTypeEnum.STEALTH;\r\n    case 'REACTIVE':\r\n      return ArmorTypeEnum.REACTIVE;\r\n    case 'REFLECTIVE':\r\n      return ArmorTypeEnum.REFLECTIVE;\r\n    case 'HARDENED':\r\n      return ArmorTypeEnum.HARDENED;\r\n    default:\r\n      return ArmorTypeEnum.STANDARD;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse heat sink type from string\r\n */\r\nfunction parseHeatSinkType(value: string): HeatSinkType {\r\n  switch (value.toUpperCase()) {\r\n    case 'SINGLE':\r\n      return HeatSinkType.SINGLE;\r\n    case 'DOUBLE':\r\n    case 'DOUBLE_IS':\r\n      return HeatSinkType.DOUBLE_IS;\r\n    case 'DOUBLE_CLAN':\r\n      return HeatSinkType.DOUBLE_CLAN;\r\n    case 'COMPACT':\r\n      return HeatSinkType.COMPACT;\r\n    case 'LASER':\r\n      return HeatSinkType.LASER;\r\n    default:\r\n      return HeatSinkType.SINGLE;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse tech base from string\r\n * Per spec VAL-ENUM-004: Components must have binary tech base (IS or Clan).\r\n * MIXED/BOTH from import sources default to INNER_SPHERE.\r\n */\r\nfunction parseTechBase(value: string): TechBase {\r\n  switch (value.toUpperCase()) {\r\n    case 'CLAN':\r\n      return TechBase.CLAN;\r\n    case 'INNER_SPHERE':\r\n    case 'IS':\r\n    case 'BOTH':\r\n    case 'MIXED':\r\n    default:\r\n      // Per spec: Default to IS for mixed/unknown\r\n      return TechBase.INNER_SPHERE;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse rules level from string\r\n */\r\nfunction parseRulesLevel(value: string): RulesLevel {\r\n  switch (value.toUpperCase()) {\r\n    case 'INTRODUCTORY':\r\n      return RulesLevel.INTRODUCTORY;\r\n    case 'STANDARD':\r\n      return RulesLevel.STANDARD;\r\n    case 'ADVANCED':\r\n      return RulesLevel.ADVANCED;\r\n    case 'EXPERIMENTAL':\r\n    case 'UNOFFICIAL':\r\n      return RulesLevel.EXPERIMENTAL;\r\n    default:\r\n      return RulesLevel.STANDARD;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse era from string\r\n */\r\nfunction parseEra(value: string): Era {\r\n  switch (value.toUpperCase()) {\r\n    case 'AGE_OF_WAR':\r\n      return Era.AGE_OF_WAR;\r\n    case 'STAR_LEAGUE':\r\n      return Era.STAR_LEAGUE;\r\n    case 'EARLY_SUCCESSION_WARS':\r\n      return Era.EARLY_SUCCESSION_WARS;\r\n    case 'LATE_SUCCESSION_WARS':\r\n      return Era.LATE_SUCCESSION_WARS;\r\n    case 'RENAISSANCE':\r\n      return Era.RENAISSANCE;\r\n    case 'CLAN_INVASION':\r\n      return Era.CLAN_INVASION;\r\n    case 'CIVIL_WAR':\r\n      return Era.CIVIL_WAR;\r\n    case 'JIHAD':\r\n      return Era.JIHAD;\r\n    case 'DARK_AGE':\r\n      return Era.DARK_AGE;\r\n    case 'ILCLAN':\r\n    case 'IL_CLAN':\r\n      return Era.IL_CLAN;\r\n    default:\r\n      return Era.LATE_SUCCESSION_WARS;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse mech configuration from string\r\n */\r\nfunction parseMechConfiguration(value: string): MechConfiguration {\r\n  switch (value) {\r\n    case 'Biped': return MechConfiguration.BIPED;\r\n    case 'Quad': return MechConfiguration.QUAD;\r\n    case 'Tripod': return MechConfiguration.TRIPOD;\r\n    case 'LAM': return MechConfiguration.LAM;\r\n    case 'QuadVee': return MechConfiguration.QUADVEE;\r\n    default: return MechConfiguration.BIPED;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse mech location from string\r\n */\r\nfunction parseMechLocation(value: string): MechLocation {\r\n  switch (value.toUpperCase()) {\r\n    case 'HEAD': return MechLocation.HEAD;\r\n    case 'CENTER_TORSO': return MechLocation.CENTER_TORSO;\r\n    case 'LEFT_TORSO': return MechLocation.LEFT_TORSO;\r\n    case 'RIGHT_TORSO': return MechLocation.RIGHT_TORSO;\r\n    case 'LEFT_ARM': return MechLocation.LEFT_ARM;\r\n    case 'RIGHT_ARM': return MechLocation.RIGHT_ARM;\r\n    case 'LEFT_LEG': return MechLocation.LEFT_LEG;\r\n    case 'RIGHT_LEG': return MechLocation.RIGHT_LEG;\r\n    default: return MechLocation.CENTER_TORSO;\r\n  }\r\n}\r\n\r\n/**\r\n * Get weight class from tonnage\r\n */\r\nfunction getWeightClass(tonnage: number): WeightClass {\r\n  if (tonnage <= 35) return WeightClass.LIGHT;\r\n  if (tonnage <= 55) return WeightClass.MEDIUM;\r\n  if (tonnage <= 75) return WeightClass.HEAVY;\r\n  return WeightClass.ASSAULT;\r\n}\r\n\r\n/**\r\n * Calculate structure points for a location\r\n */\r\nfunction getStructurePoints(location: MechLocation, tonnage: number): number {\r\n  // Standard structure points by tonnage (head is always 3)\r\n  const structureTable: Record<number, Record<string, number>> = {\r\n    20: { HEAD: 3, CT: 6, TORSO: 5, ARM: 3, LEG: 4 },\r\n    25: { HEAD: 3, CT: 8, TORSO: 6, ARM: 4, LEG: 6 },\r\n    30: { HEAD: 3, CT: 10, TORSO: 7, ARM: 5, LEG: 7 },\r\n    35: { HEAD: 3, CT: 11, TORSO: 8, ARM: 6, LEG: 8 },\r\n    40: { HEAD: 3, CT: 12, TORSO: 10, ARM: 6, LEG: 10 },\r\n    45: { HEAD: 3, CT: 14, TORSO: 11, ARM: 7, LEG: 11 },\r\n    50: { HEAD: 3, CT: 16, TORSO: 12, ARM: 8, LEG: 12 },\r\n    55: { HEAD: 3, CT: 18, TORSO: 13, ARM: 9, LEG: 13 },\r\n    60: { HEAD: 3, CT: 20, TORSO: 14, ARM: 10, LEG: 14 },\r\n    65: { HEAD: 3, CT: 21, TORSO: 15, ARM: 10, LEG: 15 },\r\n    70: { HEAD: 3, CT: 22, TORSO: 15, ARM: 11, LEG: 15 },\r\n    75: { HEAD: 3, CT: 23, TORSO: 16, ARM: 12, LEG: 16 },\r\n    80: { HEAD: 3, CT: 25, TORSO: 17, ARM: 13, LEG: 17 },\r\n    85: { HEAD: 3, CT: 27, TORSO: 18, ARM: 14, LEG: 18 },\r\n    90: { HEAD: 3, CT: 29, TORSO: 19, ARM: 15, LEG: 19 },\r\n    95: { HEAD: 3, CT: 30, TORSO: 20, ARM: 16, LEG: 20 },\r\n    100: { HEAD: 3, CT: 31, TORSO: 21, ARM: 17, LEG: 21 },\r\n  };\r\n  \r\n  // Round tonnage to nearest 5\r\n  const roundedTonnage = Math.min(100, Math.max(20, Math.round(tonnage / 5) * 5));\r\n  const table = structureTable[roundedTonnage] || structureTable[100];\r\n  \r\n  switch (location) {\r\n    case MechLocation.HEAD: return table.HEAD;\r\n    case MechLocation.CENTER_TORSO: return table.CT;\r\n    case MechLocation.LEFT_TORSO:\r\n    case MechLocation.RIGHT_TORSO: return table.TORSO;\r\n    case MechLocation.LEFT_ARM:\r\n    case MechLocation.RIGHT_ARM: return table.ARM;\r\n    case MechLocation.LEFT_LEG:\r\n    case MechLocation.RIGHT_LEG: return table.LEG;\r\n    default: return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Unit Factory Service\r\n * \r\n * Creates IBattleMech instances from serialized unit data.\r\n */\r\nexport class UnitFactoryService {\r\n  private static instance: UnitFactoryService | null = null;\r\n  \r\n  private constructor() {}\r\n  \r\n  /**\r\n   * Get singleton instance\r\n   */\r\n  static getInstance(): UnitFactoryService {\r\n    if (!UnitFactoryService.instance) {\r\n      UnitFactoryService.instance = new UnitFactoryService();\r\n    }\r\n    return UnitFactoryService.instance;\r\n  }\r\n  \r\n  /**\r\n   * Create an IBattleMech from ISerializedUnit\r\n   */\r\n  createFromSerialized(data: ISerializedUnit): IUnitFactoryResult {\r\n    const errors: string[] = [];\r\n    const warnings: string[] = [];\r\n    \r\n    try {\r\n      // Parse enums\r\n      const techBase = parseTechBase(data.techBase);\r\n      const rulesLevel = parseRulesLevel(data.rulesLevel);\r\n      const era = parseEra(data.era);\r\n      const configuration = parseMechConfiguration(data.configuration);\r\n      const weightClass = getWeightClass(data.tonnage);\r\n      \r\n      // Extended data with optional fields (from our converter)\r\n      const extendedData = data as ISerializedUnit & { \r\n        source?: string; \r\n        role?: string; \r\n        mulId?: number;\r\n      };\r\n      \r\n      // Build metadata\r\n      const metadata: IUnitMetadata = {\r\n        chassis: data.chassis,\r\n        model: data.model,\r\n        variant: data.variant,\r\n        source: extendedData.source,\r\n        era,\r\n        year: data.year,\r\n        rulesLevel,\r\n        role: extendedData.role,\r\n        manufacturer: data.fluff?.manufacturer,\r\n        primaryFactory: data.fluff?.primaryFactory,\r\n      };\r\n      \r\n      // Build engine configuration\r\n      const engine: IEngineConfiguration = {\r\n        type: parseEngineType(data.engine.type),\r\n        rating: data.engine.rating,\r\n        integralHeatSinks: Math.floor(data.engine.rating / 25),\r\n      };\r\n      \r\n      // Build gyro configuration\r\n      const gyro: IGyroConfiguration = {\r\n        type: parseGyroType(data.gyro.type),\r\n        weight: this.calculateGyroWeight(data.engine.rating, parseGyroType(data.gyro.type)),\r\n      };\r\n      \r\n      // Build structure configuration\r\n      const structurePoints = this.buildStructurePoints(data.tonnage);\r\n      const structure: IStructureConfiguration = {\r\n        type: parseStructureType(data.structure.type),\r\n        points: structurePoints,\r\n      };\r\n      \r\n      // Build heat sink configuration\r\n      const heatSinks: IHeatSinkConfiguration = {\r\n        type: parseHeatSinkType(data.heatSinks.type),\r\n        total: data.heatSinks.count,\r\n        integrated: engine.integralHeatSinks,\r\n        external: Math.max(0, data.heatSinks.count - engine.integralHeatSinks),\r\n      };\r\n      \r\n      // Build movement configuration\r\n      const movement: IMovementConfiguration = {\r\n        walkMP: data.movement.walk,\r\n        runMP: Math.ceil(data.movement.walk * 1.5),\r\n        jumpMP: data.movement.jump,\r\n        jumpJetType: data.movement.jumpJetType,\r\n        hasMASC: data.movement.enhancements?.includes('MASC') || false,\r\n        hasSupercharger: data.movement.enhancements?.includes('Supercharger') || false,\r\n        hasTSM: data.movement.enhancements?.includes('TSM') || false,\r\n      };\r\n      \r\n      // Build armor allocation\r\n      const armorAllocation = this.buildArmorAllocation(data.armor.allocation);\r\n      const totalArmorPoints = this.calculateTotalArmor(armorAllocation);\r\n      \r\n      // Build equipment list\r\n      const equipment = this.buildEquipmentList(data.equipment);\r\n      \r\n      // Build critical slots\r\n      const criticalSlots = this.buildCriticalSlots(data.criticalSlots);\r\n      \r\n      // Calculate totals\r\n      const totalWeight = this.calculateTotalWeight(data, engine, gyro, heatSinks);\r\n      const remainingTonnage = data.tonnage - totalWeight;\r\n      \r\n      // Build the mech\r\n      const mech: IBattleMech = {\r\n        id: data.id,\r\n        name: `${data.chassis} ${data.model}`,\r\n        techBase,\r\n        rulesLevel,\r\n        introductionYear: data.year,\r\n        era,\r\n        unitType: UnitType.BATTLEMECH,\r\n        configuration,\r\n        tonnage: data.tonnage,\r\n        weightClass,\r\n        metadata,\r\n        engine,\r\n        gyro,\r\n        cockpitType: parseCockpitType(data.cockpit),\r\n        structure,\r\n        armorType: parseArmorType(data.armor.type),\r\n        armorAllocation,\r\n        totalArmorPoints,\r\n        heatSinks,\r\n        movement,\r\n        equipment,\r\n        criticalSlots,\r\n        quirks: data.quirks,\r\n        totalWeight,\r\n        remainingTonnage,\r\n        isValid: errors.length === 0 && remainingTonnage >= 0,\r\n        validationErrors: errors,\r\n        cost: 0, // Would need full cost calculation\r\n        battleValue: 0, // Would need full BV calculation\r\n      };\r\n      \r\n      return {\r\n        success: true,\r\n        unit: mech,\r\n        errors,\r\n        warnings,\r\n      };\r\n    } catch (e) {\r\n      errors.push(`Factory error: ${e}`);\r\n      return {\r\n        success: false,\r\n        unit: null,\r\n        errors,\r\n        warnings,\r\n      };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Calculate gyro weight\r\n   */\r\n  private calculateGyroWeight(engineRating: number, gyroType: GyroType): number {\r\n    const baseWeight = Math.ceil(engineRating / 100);\r\n    switch (gyroType) {\r\n      case GyroType.XL:\r\n        return Math.ceil(baseWeight / 2);\r\n      case GyroType.COMPACT:\r\n        return Math.ceil(baseWeight * 1.5);\r\n      case GyroType.HEAVY_DUTY:\r\n        return baseWeight * 2;\r\n      default:\r\n        return baseWeight;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Build structure points map\r\n   */\r\n  private buildStructurePoints(tonnage: number): Record<MechLocation, number> {\r\n    return {\r\n      [MechLocation.HEAD]: getStructurePoints(MechLocation.HEAD, tonnage),\r\n      [MechLocation.CENTER_TORSO]: getStructurePoints(MechLocation.CENTER_TORSO, tonnage),\r\n      [MechLocation.LEFT_TORSO]: getStructurePoints(MechLocation.LEFT_TORSO, tonnage),\r\n      [MechLocation.RIGHT_TORSO]: getStructurePoints(MechLocation.RIGHT_TORSO, tonnage),\r\n      [MechLocation.LEFT_ARM]: getStructurePoints(MechLocation.LEFT_ARM, tonnage),\r\n      [MechLocation.RIGHT_ARM]: getStructurePoints(MechLocation.RIGHT_ARM, tonnage),\r\n      [MechLocation.LEFT_LEG]: getStructurePoints(MechLocation.LEFT_LEG, tonnage),\r\n      [MechLocation.RIGHT_LEG]: getStructurePoints(MechLocation.RIGHT_LEG, tonnage),\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Convert UPPER_SNAKE_CASE location key to camelCase\r\n   */\r\n  private locationToCamelCase(location: string): string {\r\n    // Map from serialized format to IArmorAllocation property names\r\n    const mapping: Record<string, string> = {\r\n      'HEAD': 'head',\r\n      'CENTER_TORSO': 'centerTorso',\r\n      'LEFT_TORSO': 'leftTorso',\r\n      'RIGHT_TORSO': 'rightTorso',\r\n      'LEFT_ARM': 'leftArm',\r\n      'RIGHT_ARM': 'rightArm',\r\n      'LEFT_LEG': 'leftLeg',\r\n      'RIGHT_LEG': 'rightLeg',\r\n    };\r\n    return mapping[location] || location.toLowerCase();\r\n  }\r\n\r\n  /**\r\n   * Build armor allocation from serialized data\r\n   */\r\n  private buildArmorAllocation(allocation: Record<string, number | { front: number; rear: number }>): IArmorAllocation {\r\n    // Initialize with zeros to satisfy the interface\r\n    const result: IArmorAllocation = {\r\n      head: 0,\r\n      centerTorso: 0,\r\n      centerTorsoRear: 0,\r\n      leftTorso: 0,\r\n      leftTorsoRear: 0,\r\n      rightTorso: 0,\r\n      rightTorsoRear: 0,\r\n      leftArm: 0,\r\n      rightArm: 0,\r\n      leftLeg: 0,\r\n      rightLeg: 0,\r\n    };\r\n    \r\n    for (const [location, value] of Object.entries(allocation)) {\r\n      const camelKey = this.locationToCamelCase(location) as keyof IArmorAllocation;\r\n      \r\n      if (typeof value === 'number') {\r\n        if (camelKey in result) {\r\n          (result as Record<keyof IArmorAllocation, number>)[camelKey] = value;\r\n        }\r\n      } else if (typeof value === 'object' && value !== null) {\r\n        // Front armor\r\n        if (camelKey in result) {\r\n          (result as Record<keyof IArmorAllocation, number>)[camelKey] = value.front;\r\n        }\r\n        // Rear armor (only for torso locations)\r\n        const rearKey = `${camelKey}Rear` as keyof IArmorAllocation;\r\n        if (rearKey in result) {\r\n          (result as Record<keyof IArmorAllocation, number>)[rearKey] = value.rear;\r\n        }\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }\r\n  \r\n  /**\r\n   * Calculate total armor points\r\n   */\r\n  private calculateTotalArmor(allocation: IArmorAllocation): number {\r\n    let total = 0;\r\n    for (const value of Object.values(allocation)) {\r\n      if (typeof value === 'number') {\r\n        total += value;\r\n      }\r\n    }\r\n    return total;\r\n  }\r\n  \r\n  /**\r\n   * Build equipment list\r\n   */\r\n  private buildEquipmentList(equipment: readonly { id: string; location: string; slots?: number[]; isRearMounted?: boolean; linkedAmmo?: string }[]): readonly IMountedEquipment[] {\r\n    const registry = getEquipmentRegistry();\r\n    \r\n    return equipment.map((item, index) => ({\r\n      id: `${item.id}-${index}`,\r\n      equipmentId: item.id,\r\n      name: registry.lookup(item.id).equipment?.name || item.id,\r\n      location: parseMechLocation(item.location),\r\n      slots: item.slots || [],\r\n      isRearMounted: item.isRearMounted || false,\r\n      isTurretMounted: false,\r\n      linkedAmmoId: item.linkedAmmo,\r\n    }));\r\n  }\r\n  \r\n  /**\r\n   * Build critical slots from serialized data\r\n   */\r\n  private buildCriticalSlots(slots: Record<string, (string | null)[]>): readonly ICriticalSlotAssignment[] {\r\n    const assignments: ICriticalSlotAssignment[] = [];\r\n    \r\n    for (const [locationStr, slotItems] of Object.entries(slots)) {\r\n      const location = parseMechLocation(locationStr);\r\n      const slotList: ICriticalSlot[] = slotItems.map((item, index) => ({\r\n        index,\r\n        content: item ? {\r\n          type: this.determineSlotContentType(item),\r\n          name: item,\r\n          isHittable: !item.includes('Engine') && !item.includes('Gyro'),\r\n        } : null,\r\n        isFixed: item !== null && (\r\n          item.includes('Engine') ||\r\n          item.includes('Gyro') ||\r\n          item.includes('Cockpit') ||\r\n          item.includes('Life Support') ||\r\n          item.includes('Sensors') ||\r\n          item.includes('Actuator') ||\r\n          item.includes('Shoulder') ||\r\n          item.includes('Hip')\r\n        ),\r\n        isDestroyed: false,\r\n      }));\r\n      \r\n      assignments.push({ location, slots: slotList });\r\n    }\r\n    \r\n    return assignments;\r\n  }\r\n  \r\n  /**\r\n   * Determine the type of content in a critical slot\r\n   */\r\n  private determineSlotContentType(item: string): 'equipment' | 'actuator' | 'system' | 'structure' | 'armor' {\r\n    const lower = item.toLowerCase();\r\n    if (lower.includes('actuator') || lower.includes('shoulder') || lower.includes('hip')) {\r\n      return 'actuator';\r\n    }\r\n    if (lower.includes('engine') || lower.includes('gyro') || lower.includes('cockpit') ||\r\n        lower.includes('life support') || lower.includes('sensors')) {\r\n      return 'system';\r\n    }\r\n    return 'equipment';\r\n  }\r\n  \r\n  /**\r\n   * Calculate total weight (simplified)\r\n   */\r\n  private calculateTotalWeight(\r\n    data: ISerializedUnit,\r\n    engine: IEngineConfiguration,\r\n    gyro: IGyroConfiguration,\r\n    heatSinks: IHeatSinkConfiguration\r\n  ): number {\r\n    // This is a simplified calculation\r\n    // A full implementation would use ConstructionRulesValidator\r\n    let weight = 0;\r\n    \r\n    // Structure (10% of tonnage for standard)\r\n    weight += data.tonnage * 0.1;\r\n    \r\n    // Engine weight (using proper TechManual calculation)\r\n    const engineWeight = calculateEngineWeight(engine.rating, engine.type);\r\n    weight += engineWeight;\r\n    \r\n    // Gyro\r\n    weight += gyro.weight;\r\n    \r\n    // Cockpit (3 tons standard)\r\n    weight += 3;\r\n    \r\n    // Heat sinks (external only, 1 ton each for single)\r\n    weight += heatSinks.external * (heatSinks.type === HeatSinkType.SINGLE ? 1 : 1);\r\n    \r\n    // Armor (16 points per ton for standard)\r\n    let totalArmor = 0;\r\n    for (const val of Object.values(data.armor.allocation)) {\r\n      if (typeof val === 'number') {\r\n        totalArmor += val;\r\n      } else if (typeof val === 'object' && val !== null && 'front' in val && 'rear' in val) {\r\n        totalArmor += val.front + val.rear;\r\n      }\r\n    }\r\n    weight += totalArmor / 16;\r\n    \r\n    // Jump jets (weight varies by tonnage)\r\n    if (data.movement.jump > 0) {\r\n      const jjWeight = data.tonnage <= 55 ? 0.5 : data.tonnage <= 85 ? 1 : 2;\r\n      weight += data.movement.jump * jjWeight;\r\n    }\r\n    \r\n    return Math.round(weight * 2) / 2; // Round to nearest half ton\r\n  }\r\n}\r\n\r\n/**\r\n * Convenience function to get the factory instance\r\n */\r\nexport function getUnitFactory(): UnitFactoryService {\r\n  return UnitFactoryService.getInstance();\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\UnitLoaderService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IFullUnit' is defined but never used.","line":11,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IUnitWithVersion' is defined but never used.","line":12,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ISelectionMemory' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IComponentTechBases' is defined but never used.","line":35,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isCanonical' is defined but never used. Allowed unused args must match /^_/u.","line":562,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":562,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Loader Service\r\n * \r\n * Fetches full unit data from canonical JSON files or SQLite custom units\r\n * and maps them to the UnitState format for the customizer.\r\n * \r\n * @spec openspec/specs/unit-services/spec.md\r\n */\r\n\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { canonicalUnitService, IFullUnit } from './CanonicalUnitService';\r\nimport { customUnitApiService, IUnitWithVersion } from './CustomUnitApiService';\r\nimport { equipmentLookupService } from '@/services/equipment/EquipmentLookupService';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { RulesLevel } from '@/types/enums/RulesLevel';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType } from '@/types/construction/CockpitType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\r\nimport { MechConfiguration, UnitType } from '@/types/unit/BattleMechInterfaces';\r\nimport { MechLocation } from '@/types/construction/CriticalSlotAllocation';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport {\r\n  UnitState,\r\n  IArmorAllocation,\r\n  IMountedEquipmentInstance,\r\n  ISelectionMemory,\r\n  createEmptyArmorAllocation,\r\n  createEmptySelectionMemory,\r\n} from '@/stores/unitState';\r\nimport {\r\n  TechBaseMode,\r\n  IComponentTechBases,\r\n  createDefaultComponentTechBases,\r\n} from '@/types/construction/TechBaseConfiguration';\r\nimport { JumpJetType } from '@/utils/construction/movementCalculations';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\n/**\r\n * Source of a unit (canonical or custom)\r\n */\r\nexport type UnitSource = 'canonical' | 'custom';\r\n\r\n/**\r\n * Serialized unit JSON format (from canonical JSON files)\r\n */\r\nexport interface ISerializedUnit {\r\n  readonly id: string;\r\n  readonly chassis: string;\r\n  readonly model?: string;\r\n  readonly variant?: string;\r\n  readonly unitType?: string;\r\n  readonly configuration?: string;\r\n  readonly techBase: string;\r\n  readonly rulesLevel?: string;\r\n  readonly era?: string;\r\n  readonly year?: number;\r\n  readonly tonnage: number;\r\n  readonly engine?: {\r\n    readonly type: string;\r\n    readonly rating: number;\r\n  };\r\n  readonly gyro?: {\r\n    readonly type: string;\r\n  };\r\n  readonly cockpit?: string;\r\n  readonly structure?: {\r\n    readonly type: string;\r\n  };\r\n  readonly armor?: {\r\n    readonly type: string;\r\n    readonly allocation?: Record<string, number | { front: number; rear: number }>;\r\n  };\r\n  readonly heatSinks?: {\r\n    readonly type: string;\r\n    readonly count: number;\r\n  };\r\n  readonly movement?: {\r\n    readonly walk: number;\r\n    readonly jump?: number;\r\n  };\r\n  readonly equipment?: ReadonlyArray<{\r\n    readonly id: string;\r\n    readonly location: string;\r\n  }>;\r\n  readonly mulId?: number;\r\n  readonly [key: string]: unknown;\r\n}\r\n\r\n/**\r\n * Result of loading a unit\r\n */\r\nexport interface ILoadUnitResult {\r\n  readonly success: boolean;\r\n  readonly state?: UnitState;\r\n  readonly error?: string;\r\n}\r\n\r\n// =============================================================================\r\n// Mapping Functions\r\n// =============================================================================\r\n\r\n/**\r\n * Map engine type string to EngineType enum\r\n */\r\nfunction mapEngineType(typeStr: string, techBase: TechBase): EngineType {\r\n  const normalized = typeStr.toUpperCase().replace(/[_\\s-]/g, '');\r\n  \r\n  // Standard fusion engine variations\r\n  if (normalized === 'FUSION' || normalized === 'STANDARD' || normalized === 'STANDARDFUSION') {\r\n    return EngineType.STANDARD;\r\n  }\r\n  \r\n  // XL engine - depends on tech base\r\n  if (normalized === 'XL' || normalized === 'XLENGINE') {\r\n    return techBase === TechBase.CLAN ? EngineType.XL_CLAN : EngineType.XL_IS;\r\n  }\r\n  if (normalized === 'XLIS' || normalized === 'XLENGINEIS') {\r\n    return EngineType.XL_IS;\r\n  }\r\n  if (normalized === 'XLCLAN' || normalized === 'XLENGINECLAN') {\r\n    return EngineType.XL_CLAN;\r\n  }\r\n  \r\n  // Other engine types\r\n  if (normalized === 'LIGHT' || normalized === 'LIGHTENGINE') {\r\n    return EngineType.LIGHT;\r\n  }\r\n  if (normalized === 'XXL' || normalized === 'XXLENGINE') {\r\n    return EngineType.XXL;\r\n  }\r\n  if (normalized === 'COMPACT' || normalized === 'COMPACTENGINE') {\r\n    return EngineType.COMPACT;\r\n  }\r\n  if (normalized === 'ICE' || normalized === 'INTERNALCOMBUSTION') {\r\n    return EngineType.ICE;\r\n  }\r\n  if (normalized === 'FUELCELL') {\r\n    return EngineType.FUEL_CELL;\r\n  }\r\n  if (normalized === 'FISSION') {\r\n    return EngineType.FISSION;\r\n  }\r\n  \r\n  // Default to standard\r\n  return EngineType.STANDARD;\r\n}\r\n\r\n/**\r\n * Map gyro type string to GyroType enum\r\n */\r\nfunction mapGyroType(typeStr: string): GyroType {\r\n  const normalized = typeStr.toUpperCase().replace(/[_\\s-]/g, '');\r\n  \r\n  if (normalized === 'XL' || normalized === 'XLGYRO') {\r\n    return GyroType.XL;\r\n  }\r\n  if (normalized === 'COMPACT' || normalized === 'COMPACTGYRO') {\r\n    return GyroType.COMPACT;\r\n  }\r\n  if (normalized === 'HEAVYDUTY' || normalized === 'HEAVYDUTYGYRO' || normalized === 'HD') {\r\n    return GyroType.HEAVY_DUTY;\r\n  }\r\n  \r\n  return GyroType.STANDARD;\r\n}\r\n\r\n/**\r\n * Map structure type string to InternalStructureType enum\r\n */\r\nfunction mapStructureType(typeStr: string, techBase: TechBase): InternalStructureType {\r\n  const normalized = typeStr.toUpperCase().replace(/[_\\s-]/g, '');\r\n  \r\n  if (normalized === 'ENDOSTEEL' || normalized === 'ENDO') {\r\n    return techBase === TechBase.CLAN \r\n      ? InternalStructureType.ENDO_STEEL_CLAN \r\n      : InternalStructureType.ENDO_STEEL_IS;\r\n  }\r\n  if (normalized === 'ENDOSTEELIS') {\r\n    return InternalStructureType.ENDO_STEEL_IS;\r\n  }\r\n  if (normalized === 'ENDOSTEELCLAN') {\r\n    return InternalStructureType.ENDO_STEEL_CLAN;\r\n  }\r\n  if (normalized === 'ENDOCOMPOSITE') {\r\n    return InternalStructureType.ENDO_COMPOSITE;\r\n  }\r\n  if (normalized === 'REINFORCED') {\r\n    return InternalStructureType.REINFORCED;\r\n  }\r\n  if (normalized === 'COMPOSITE') {\r\n    return InternalStructureType.COMPOSITE;\r\n  }\r\n  if (normalized === 'INDUSTRIAL') {\r\n    return InternalStructureType.INDUSTRIAL;\r\n  }\r\n  \r\n  return InternalStructureType.STANDARD;\r\n}\r\n\r\n/**\r\n * Map cockpit type string to CockpitType enum\r\n */\r\nfunction mapCockpitType(typeStr: string): CockpitType {\r\n  const normalized = typeStr.toUpperCase().replace(/[_\\s-]/g, '');\r\n  \r\n  if (normalized === 'SMALL' || normalized === 'SMALLCOCKPIT') {\r\n    return CockpitType.SMALL;\r\n  }\r\n  if (normalized === 'COMMAND' || normalized === 'COMMANDCONSOLE') {\r\n    return CockpitType.COMMAND_CONSOLE;\r\n  }\r\n  if (normalized === 'TORSO' || normalized === 'TORSOMOUNTED' || normalized === 'TORSOMOUNTEDCOCKPIT') {\r\n    return CockpitType.TORSO_MOUNTED;\r\n  }\r\n  if (normalized === 'PRIMITIVE' || normalized === 'PRIMITIVECOCKPIT') {\r\n    return CockpitType.PRIMITIVE;\r\n  }\r\n  if (normalized === 'INDUSTRIAL' || normalized === 'INDUSTRIALCOCKPIT') {\r\n    return CockpitType.INDUSTRIAL;\r\n  }\r\n  if (normalized === 'SUPERHEAVY' || normalized === 'SUPERHEAVYCOCKPIT') {\r\n    return CockpitType.SUPER_HEAVY;\r\n  }\r\n  \r\n  return CockpitType.STANDARD;\r\n}\r\n\r\n/**\r\n * Map heat sink type string to HeatSinkType enum\r\n */\r\nfunction mapHeatSinkType(typeStr: string): HeatSinkType {\r\n  const normalized = typeStr.toUpperCase().replace(/[_\\s-]/g, '');\r\n  \r\n  if (normalized === 'DOUBLE' || normalized === 'DOUBLEIS' || normalized === 'DHS') {\r\n    return HeatSinkType.DOUBLE_IS;\r\n  }\r\n  if (normalized === 'DOUBLECLAN') {\r\n    return HeatSinkType.DOUBLE_CLAN;\r\n  }\r\n  if (normalized === 'LASER') {\r\n    return HeatSinkType.LASER;\r\n  }\r\n  if (normalized === 'COMPACT') {\r\n    return HeatSinkType.COMPACT;\r\n  }\r\n  \r\n  return HeatSinkType.SINGLE;\r\n}\r\n\r\n/**\r\n * Map armor type string to ArmorTypeEnum\r\n */\r\nfunction mapArmorType(typeStr: string, techBase: TechBase): ArmorTypeEnum {\r\n  const normalized = typeStr.toUpperCase().replace(/[_\\s-]/g, '');\r\n  \r\n  if (normalized === 'FERROFIBROUS' || normalized === 'FERRO') {\r\n    return techBase === TechBase.CLAN \r\n      ? ArmorTypeEnum.FERRO_FIBROUS_CLAN \r\n      : ArmorTypeEnum.FERRO_FIBROUS_IS;\r\n  }\r\n  if (normalized === 'FERROFIBROUSIS') {\r\n    return ArmorTypeEnum.FERRO_FIBROUS_IS;\r\n  }\r\n  if (normalized === 'FERROFIBROUSCLAN') {\r\n    return ArmorTypeEnum.FERRO_FIBROUS_CLAN;\r\n  }\r\n  if (normalized === 'LIGHTFERRO' || normalized === 'LIGHTFERROFIBROUS') {\r\n    return ArmorTypeEnum.LIGHT_FERRO;\r\n  }\r\n  if (normalized === 'HEAVYFERRO' || normalized === 'HEAVYFERROFIBROUS') {\r\n    return ArmorTypeEnum.HEAVY_FERRO;\r\n  }\r\n  if (normalized === 'STEALTH') {\r\n    return ArmorTypeEnum.STEALTH;\r\n  }\r\n  if (normalized === 'REACTIVE') {\r\n    return ArmorTypeEnum.REACTIVE;\r\n  }\r\n  if (normalized === 'REFLECTIVE' || normalized === 'LASERREFLECTIVE') {\r\n    return ArmorTypeEnum.REFLECTIVE;\r\n  }\r\n  if (normalized === 'HARDENED') {\r\n    return ArmorTypeEnum.HARDENED;\r\n  }\r\n  // INDUSTRIAL, HEAVY_INDUSTRIAL, PRIMITIVE armor types map to STANDARD for now\r\n  // These can be added to the enum when needed\r\n  \r\n  return ArmorTypeEnum.STANDARD;\r\n}\r\n\r\n/**\r\n * Map tech base string to TechBase enum\r\n */\r\nfunction mapTechBase(techBaseStr: string): TechBase {\r\n  const normalized = techBaseStr.toUpperCase().replace(/[_\\s-]/g, '');\r\n  \r\n  if (normalized === 'CLAN') {\r\n    return TechBase.CLAN;\r\n  }\r\n  if (normalized === 'MIXED') {\r\n    return TechBase.INNER_SPHERE; // Mixed defaults to IS base\r\n  }\r\n  \r\n  return TechBase.INNER_SPHERE;\r\n}\r\n\r\n/**\r\n * Map rules level string to RulesLevel enum\r\n */\r\nfunction mapRulesLevel(levelStr: string): RulesLevel {\r\n  const normalized = levelStr.toUpperCase().replace(/[_\\s-]/g, '');\r\n  \r\n  if (normalized === 'INTRODUCTORY' || normalized === 'INTRO') {\r\n    return RulesLevel.INTRODUCTORY;\r\n  }\r\n  if (normalized === 'ADVANCED') {\r\n    return RulesLevel.ADVANCED;\r\n  }\r\n  if (normalized === 'EXPERIMENTAL') {\r\n    return RulesLevel.EXPERIMENTAL;\r\n  }\r\n  // ERA is mapped to ADVANCED for now\r\n  \r\n  return RulesLevel.STANDARD;\r\n}\r\n\r\n/**\r\n * Map MechLocation string to MechLocation enum\r\n */\r\nfunction mapMechLocation(locationStr: string): MechLocation | undefined {\r\n  const normalized = locationStr.toUpperCase().replace(/[_\\s-]/g, '');\r\n  \r\n  const locationMap: Record<string, MechLocation> = {\r\n    'HEAD': MechLocation.HEAD,\r\n    'HD': MechLocation.HEAD,\r\n    'CENTERTORSO': MechLocation.CENTER_TORSO,\r\n    'CT': MechLocation.CENTER_TORSO,\r\n    'LEFTTORSO': MechLocation.LEFT_TORSO,\r\n    'LT': MechLocation.LEFT_TORSO,\r\n    'RIGHTTORSO': MechLocation.RIGHT_TORSO,\r\n    'RT': MechLocation.RIGHT_TORSO,\r\n    'LEFTARM': MechLocation.LEFT_ARM,\r\n    'LA': MechLocation.LEFT_ARM,\r\n    'RIGHTARM': MechLocation.RIGHT_ARM,\r\n    'RA': MechLocation.RIGHT_ARM,\r\n    'LEFTLEG': MechLocation.LEFT_LEG,\r\n    'LL': MechLocation.LEFT_LEG,\r\n    'RIGHTLEG': MechLocation.RIGHT_LEG,\r\n    'RL': MechLocation.RIGHT_LEG,\r\n  };\r\n  \r\n  return locationMap[normalized];\r\n}\r\n\r\n/**\r\n * Map armor allocation from JSON format to IArmorAllocation\r\n */\r\nfunction mapArmorAllocation(\r\n  allocation: Record<string, number | { front: number; rear: number }> | undefined\r\n): IArmorAllocation {\r\n  if (!allocation) {\r\n    return createEmptyArmorAllocation();\r\n  }\r\n\r\n  const result = createEmptyArmorAllocation();\r\n  \r\n  for (const [locationKey, value] of Object.entries(allocation)) {\r\n    const location = mapMechLocation(locationKey);\r\n    \r\n    if (typeof value === 'number') {\r\n      // Simple number - direct armor value\r\n      if (location !== undefined) {\r\n        (result as unknown as Record<string, number>)[location] = value;\r\n      }\r\n    } else if (typeof value === 'object' && 'front' in value) {\r\n      // Object with front/rear\r\n      if (location !== undefined) {\r\n        (result as unknown as Record<string, number>)[location] = value.front;\r\n        \r\n        // Map rear armor\r\n        if (location === MechLocation.CENTER_TORSO) {\r\n          result.centerTorsoRear = value.rear;\r\n        } else if (location === MechLocation.LEFT_TORSO) {\r\n          result.leftTorsoRear = value.rear;\r\n        } else if (location === MechLocation.RIGHT_TORSO) {\r\n          result.rightTorsoRear = value.rear;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n/**\r\n * Map equipment array to IMountedEquipmentInstance array\r\n * Looks up equipment from the equipment database to get full properties.\r\n */\r\nfunction mapEquipment(\r\n  equipment: ReadonlyArray<{ id: string; location: string }> | undefined,\r\n  unitTechBase: TechBase\r\n): IMountedEquipmentInstance[] {\r\n  if (!equipment || equipment.length === 0) {\r\n    return [];\r\n  }\r\n  \r\n  return equipment.map((item) => {\r\n    const location = mapMechLocation(item.location);\r\n    \r\n    // Look up equipment from database\r\n    const equipmentDef = equipmentLookupService.getById(item.id);\r\n    \r\n    if (equipmentDef) {\r\n      // Found in database - use full properties\r\n      const heat = 'heat' in equipmentDef ? (equipmentDef as { heat: number }).heat : 0;\r\n      \r\n      return {\r\n        instanceId: uuidv4(),\r\n        equipmentId: equipmentDef.id,\r\n        name: equipmentDef.name,\r\n        category: equipmentDef.category,\r\n        weight: equipmentDef.weight,\r\n        criticalSlots: equipmentDef.criticalSlots,\r\n        heat,\r\n        techBase: equipmentDef.techBase,\r\n        location,\r\n        slots: undefined,\r\n        isRearMounted: false,\r\n        linkedAmmoId: undefined,\r\n        isRemovable: true, // User-added equipment is removable\r\n      };\r\n    } else {\r\n      // Not found - create placeholder with unknown equipment\r\n      console.warn(`Equipment not found in database: ${item.id}`);\r\n      return {\r\n        instanceId: uuidv4(),\r\n        equipmentId: item.id,\r\n        name: item.id, // Use ID as name fallback\r\n        category: EquipmentCategory.MISC_EQUIPMENT, // Default to misc\r\n        weight: 0, // Unknown weight\r\n        criticalSlots: 1, // Assume 1 slot minimum\r\n        heat: 0,\r\n        techBase: unitTechBase, // Use unit's tech base\r\n        location,\r\n        slots: undefined,\r\n        isRearMounted: false,\r\n        linkedAmmoId: undefined,\r\n        isRemovable: true, // User-added equipment is removable\r\n      };\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Calculate total armor tonnage from allocation\r\n */\r\nfunction calculateArmorTonnage(allocation: IArmorAllocation, armorType: ArmorTypeEnum): number {\r\n  // Sum all armor points\r\n  const totalPoints = \r\n    allocation[MechLocation.HEAD] +\r\n    allocation[MechLocation.CENTER_TORSO] +\r\n    allocation.centerTorsoRear +\r\n    allocation[MechLocation.LEFT_TORSO] +\r\n    allocation.leftTorsoRear +\r\n    allocation[MechLocation.RIGHT_TORSO] +\r\n    allocation.rightTorsoRear +\r\n    allocation[MechLocation.LEFT_ARM] +\r\n    allocation[MechLocation.RIGHT_ARM] +\r\n    allocation[MechLocation.LEFT_LEG] +\r\n    allocation[MechLocation.RIGHT_LEG];\r\n  \r\n  // Points per ton varies by armor type\r\n  // Standard: 16 points per ton\r\n  // Ferro-Fibrous IS: 17.92 points per ton (12% bonus)\r\n  // Ferro-Fibrous Clan: 19.2 points per ton (20% bonus)\r\n  // etc.\r\n  let pointsPerTon = 16;\r\n  \r\n  if (armorType === ArmorTypeEnum.FERRO_FIBROUS_IS) {\r\n    pointsPerTon = 17.92;\r\n  } else if (armorType === ArmorTypeEnum.FERRO_FIBROUS_CLAN) {\r\n    pointsPerTon = 19.2;\r\n  } else if (armorType === ArmorTypeEnum.LIGHT_FERRO) {\r\n    pointsPerTon = 16.96; // 6% bonus\r\n  } else if (armorType === ArmorTypeEnum.HEAVY_FERRO) {\r\n    pointsPerTon = 19.52; // 22% bonus\r\n  } else if (armorType === ArmorTypeEnum.HARDENED) {\r\n    pointsPerTon = 8; // 2x weight\r\n  }\r\n  \r\n  return Math.ceil((totalPoints / pointsPerTon) * 2) / 2; // Round to nearest half ton\r\n}\r\n\r\n// =============================================================================\r\n// Main Service\r\n// =============================================================================\r\n\r\n/**\r\n * Unit Loader Service\r\n */\r\nexport class UnitLoaderService {\r\n  /**\r\n   * Load a canonical unit by ID\r\n   */\r\n  async loadCanonicalUnit(id: string): Promise<ILoadUnitResult> {\r\n    try {\r\n      const fullUnit = await canonicalUnitService.getById(id);\r\n      \r\n      if (!fullUnit) {\r\n        return { success: false, error: `Canonical unit \"${id}\" not found` };\r\n      }\r\n      \r\n      const state = this.mapToUnitState(fullUnit as ISerializedUnit, true);\r\n      return { success: true, state };\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : 'Failed to load canonical unit';\r\n      return { success: false, error: message };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Load a custom unit by ID\r\n   */\r\n  async loadCustomUnit(id: string): Promise<ILoadUnitResult> {\r\n    try {\r\n      const fullUnit = await customUnitApiService.getById(id);\r\n      \r\n      if (!fullUnit) {\r\n        return { success: false, error: `Custom unit \"${id}\" not found` };\r\n      }\r\n      \r\n      // Custom units may already be in UnitState format (saved from customizer)\r\n      // or in serialized format (imported)\r\n      const state = this.mapToUnitState(fullUnit as unknown as ISerializedUnit, false);\r\n      return { success: true, state };\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : 'Failed to load custom unit';\r\n      return { success: false, error: message };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Load a unit from either source\r\n   */\r\n  async loadUnit(id: string, source: UnitSource): Promise<ILoadUnitResult> {\r\n    if (source === 'canonical') {\r\n      return this.loadCanonicalUnit(id);\r\n    } else {\r\n      return this.loadCustomUnit(id);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Map serialized unit JSON to UnitState\r\n   */\r\n  mapToUnitState(serialized: ISerializedUnit, isCanonical: boolean): UnitState {\r\n    // Determine tech base first as it affects other mappings\r\n    const techBase = mapTechBase(serialized.techBase);\r\n    \r\n    // Map engine\r\n    const engineType = serialized.engine?.type \r\n      ? mapEngineType(serialized.engine.type, techBase)\r\n      : EngineType.STANDARD;\r\n    const engineRating = serialized.engine?.rating ?? \r\n      (serialized.movement?.walk ?? 4) * serialized.tonnage;\r\n    \r\n    // Map gyro\r\n    const gyroType = serialized.gyro?.type \r\n      ? mapGyroType(serialized.gyro.type) \r\n      : GyroType.STANDARD;\r\n    \r\n    // Map structure\r\n    const internalStructureType = serialized.structure?.type \r\n      ? mapStructureType(serialized.structure.type, techBase)\r\n      : InternalStructureType.STANDARD;\r\n    \r\n    // Map cockpit\r\n    const cockpitType = serialized.cockpit \r\n      ? mapCockpitType(serialized.cockpit)\r\n      : CockpitType.STANDARD;\r\n    \r\n    // Map heat sinks\r\n    const heatSinkType = serialized.heatSinks?.type \r\n      ? mapHeatSinkType(serialized.heatSinks.type)\r\n      : HeatSinkType.SINGLE;\r\n    const heatSinkCount = serialized.heatSinks?.count ?? 10;\r\n    \r\n    // Map armor\r\n    const armorType = serialized.armor?.type \r\n      ? mapArmorType(serialized.armor.type, techBase)\r\n      : ArmorTypeEnum.STANDARD;\r\n    const armorAllocation = mapArmorAllocation(serialized.armor?.allocation);\r\n    const armorTonnage = calculateArmorTonnage(armorAllocation, armorType);\r\n    \r\n    // Map equipment (requires techBase for fallback)\r\n    const equipment = mapEquipment(serialized.equipment, techBase);\r\n    \r\n    // Determine rules level\r\n    const rulesLevel = serialized.rulesLevel \r\n      ? mapRulesLevel(serialized.rulesLevel)\r\n      : RulesLevel.STANDARD;\r\n    \r\n    // Get model/variant - canonical uses 'model', custom may use 'variant'\r\n    const model = serialized.model ?? serialized.variant ?? '';\r\n    \r\n    // Create tech base mode based on tech base\r\n    const techBaseMode: TechBaseMode = techBase === TechBase.CLAN \r\n      ? TechBaseMode.CLAN \r\n      : TechBaseMode.INNER_SPHERE;\r\n    \r\n    // Create the full UnitState\r\n    const state: UnitState = {\r\n      // Identity - use a NEW ID for loaded units (they're copies in the customizer)\r\n      id: uuidv4(),\r\n      name: `${serialized.chassis}${model ? ' ' + model : ''}`,\r\n      chassis: serialized.chassis,\r\n      clanName: '',\r\n      model,\r\n      mulId: String(serialized.mulId ?? -1),\r\n      year: serialized.year ?? 3025,\r\n      rulesLevel,\r\n      tonnage: serialized.tonnage,\r\n      techBase,\r\n      \r\n      // Configuration\r\n      unitType: (serialized.unitType as UnitType) || 'BattleMech',\r\n      configuration: (serialized.configuration as MechConfiguration) || 'Biped',\r\n      isOmni: false, // TODO: detect from unit data\r\n      techBaseMode,\r\n      componentTechBases: createDefaultComponentTechBases(techBase),\r\n      selectionMemory: createEmptySelectionMemory(),\r\n      \r\n      // Components\r\n      engineType,\r\n      engineRating,\r\n      gyroType,\r\n      internalStructureType,\r\n      cockpitType,\r\n      heatSinkType,\r\n      heatSinkCount,\r\n      armorType,\r\n      armorTonnage,\r\n      armorAllocation,\r\n      enhancement: null,\r\n      jumpMP: 0, // TODO: Parse from unit data\r\n      jumpJetType: JumpJetType.STANDARD,\r\n      \r\n      // Equipment\r\n      equipment,\r\n      \r\n      // Metadata\r\n      isModified: false,\r\n      createdAt: Date.now(),\r\n      lastModifiedAt: Date.now(),\r\n    };\r\n    \r\n    return state;\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const unitLoaderService = new UnitLoaderService();\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\UnitNameValidator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\UnitRepository.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WeightClass' is defined but never used.","line":12,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Repository\r\n * \r\n * Data access layer for custom units stored in SQLite.\r\n * Handles CRUD operations and name uniqueness.\r\n * \r\n * @spec openspec/specs/persistence-services/spec.md\r\n */\r\n\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { getSQLiteService } from '../persistence/SQLiteService';\r\nimport { getWeightClass, WeightClass } from '@/types/enums/WeightClass';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { Era } from '@/types/enums/Era';\r\nimport { RulesLevel } from '@/types/enums/RulesLevel';\r\nimport {\r\n  ICustomUnitRecord,\r\n  ICustomUnitIndexEntry,\r\n  ICreateUnitRequest,\r\n  IUpdateUnitRequest,\r\n  IUnitOperationResult,\r\n  UnitErrorCode,\r\n  ICloneNameSuggestion,\r\n} from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Database row type for custom_units table\r\n */\r\ninterface CustomUnitRow {\r\n  id: string;\r\n  chassis: string;\r\n  variant: string;\r\n  tonnage: number;\r\n  tech_base: string;\r\n  era: string;\r\n  rules_level: string;\r\n  unit_type: string;\r\n  data: string;\r\n  current_version: number;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\n/**\r\n * Unit Repository interface\r\n */\r\nexport interface IUnitRepository {\r\n  create(request: ICreateUnitRequest): IUnitOperationResult;\r\n  update(id: string, request: IUpdateUnitRequest): IUnitOperationResult;\r\n  delete(id: string): IUnitOperationResult;\r\n  getById(id: string): ICustomUnitRecord | null;\r\n  findByName(chassis: string, variant: string): ICustomUnitRecord | null;\r\n  list(): readonly ICustomUnitIndexEntry[];\r\n  exists(id: string): boolean;\r\n  nameExists(chassis: string, variant: string): boolean;\r\n  suggestCloneName(chassis: string, variant: string): ICloneNameSuggestion;\r\n}\r\n\r\n/**\r\n * Unit Repository implementation\r\n */\r\nexport class UnitRepository implements IUnitRepository {\r\n  /**\r\n   * Create a new custom unit\r\n   */\r\n  create(request: ICreateUnitRequest): IUnitOperationResult {\r\n    const db = getSQLiteService().getDatabase();\r\n    const now = new Date().toISOString();\r\n    const id = `custom-${uuidv4()}`;\r\n\r\n    // Check for duplicate name\r\n    if (this.nameExists(request.chassis, request.variant)) {\r\n      const suggestion = this.suggestCloneName(request.chassis, request.variant);\r\n      return {\r\n        success: false,\r\n        error: `Unit \"${request.chassis} ${request.variant}\" already exists. Suggested name: \"${suggestion.chassis} ${suggestion.suggestedVariant}\"`,\r\n        errorCode: UnitErrorCode.DUPLICATE_NAME,\r\n      };\r\n    }\r\n\r\n    // Extract metadata from unit data\r\n    const unitData = request.data;\r\n    const tonnage = (unitData.tonnage as number) || 0;\r\n    const techBase = (unitData.techBase as string) || TechBase.INNER_SPHERE;\r\n    const era = (unitData.era as string) || Era.LATE_SUCCESSION_WARS;\r\n    const rulesLevel = (unitData.rulesLevel as string) || RulesLevel.STANDARD;\r\n    const unitType = (unitData.unitType as string) || 'BattleMech';\r\n\r\n    try {\r\n      // Insert unit\r\n      const insertUnit = db.prepare(`\r\n        INSERT INTO custom_units (\r\n          id, chassis, variant, tonnage, tech_base, era, rules_level, unit_type,\r\n          data, current_version, created_at, updated_at\r\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 1, ?, ?)\r\n      `);\r\n\r\n      insertUnit.run(\r\n        id,\r\n        request.chassis,\r\n        request.variant,\r\n        tonnage,\r\n        techBase,\r\n        era,\r\n        rulesLevel,\r\n        unitType,\r\n        JSON.stringify(unitData),\r\n        now,\r\n        now\r\n      );\r\n\r\n      // Create initial version entry\r\n      const versionId = uuidv4();\r\n      const insertVersion = db.prepare(`\r\n        INSERT INTO unit_versions (id, unit_id, version, data, saved_at, notes)\r\n        VALUES (?, ?, 1, ?, ?, ?)\r\n      `);\r\n\r\n      insertVersion.run(\r\n        versionId,\r\n        id,\r\n        JSON.stringify(unitData),\r\n        now,\r\n        request.notes || null\r\n      );\r\n\r\n      return {\r\n        success: true,\r\n        id,\r\n        version: 1,\r\n      };\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : 'Unknown error';\r\n      return {\r\n        success: false,\r\n        error: `Failed to create unit: ${message}`,\r\n        errorCode: UnitErrorCode.DATABASE_ERROR,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update an existing custom unit (increments version)\r\n   */\r\n  update(id: string, request: IUpdateUnitRequest): IUnitOperationResult {\r\n    const db = getSQLiteService().getDatabase();\r\n    const now = new Date().toISOString();\r\n\r\n    // Get current unit\r\n    const currentUnit = this.getById(id);\r\n    if (!currentUnit) {\r\n      return {\r\n        success: false,\r\n        error: `Unit \"${id}\" not found`,\r\n        errorCode: UnitErrorCode.NOT_FOUND,\r\n      };\r\n    }\r\n\r\n    const newVersion = currentUnit.currentVersion + 1;\r\n    const unitData = request.data;\r\n    const tonnage = (unitData.tonnage as number) || currentUnit.tonnage;\r\n    const techBase = (unitData.techBase as string) || currentUnit.techBase;\r\n    const era = (unitData.era as string) || currentUnit.era;\r\n    const rulesLevel = (unitData.rulesLevel as string) || currentUnit.rulesLevel;\r\n    const unitType = (unitData.unitType as string) || currentUnit.unitType;\r\n\r\n    try {\r\n      // Update unit record\r\n      const updateUnit = db.prepare(`\r\n        UPDATE custom_units\r\n        SET data = ?, tonnage = ?, tech_base = ?, era = ?, rules_level = ?, unit_type = ?,\r\n            current_version = ?, updated_at = ?\r\n        WHERE id = ?\r\n      `);\r\n\r\n      updateUnit.run(\r\n        JSON.stringify(unitData),\r\n        tonnage,\r\n        techBase,\r\n        era,\r\n        rulesLevel,\r\n        unitType,\r\n        newVersion,\r\n        now,\r\n        id\r\n      );\r\n\r\n      // Create new version entry\r\n      const versionId = uuidv4();\r\n      const insertVersion = db.prepare(`\r\n        INSERT INTO unit_versions (id, unit_id, version, data, saved_at, notes)\r\n        VALUES (?, ?, ?, ?, ?, ?)\r\n      `);\r\n\r\n      insertVersion.run(\r\n        versionId,\r\n        id,\r\n        newVersion,\r\n        JSON.stringify(unitData),\r\n        now,\r\n        request.notes || null\r\n      );\r\n\r\n      // Prune old versions if needed\r\n      this.pruneVersions(id);\r\n\r\n      return {\r\n        success: true,\r\n        id,\r\n        version: newVersion,\r\n      };\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : 'Unknown error';\r\n      return {\r\n        success: false,\r\n        error: `Failed to update unit: ${message}`,\r\n        errorCode: UnitErrorCode.DATABASE_ERROR,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a custom unit and all its versions\r\n   */\r\n  delete(id: string): IUnitOperationResult {\r\n    const db = getSQLiteService().getDatabase();\r\n\r\n    try {\r\n      // Foreign key cascade will delete versions\r\n      const deleteUnit = db.prepare('DELETE FROM custom_units WHERE id = ?');\r\n      deleteUnit.run(id);\r\n\r\n      return { success: true, id };\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : 'Unknown error';\r\n      return {\r\n        success: false,\r\n        error: `Failed to delete unit: ${message}`,\r\n        errorCode: UnitErrorCode.DATABASE_ERROR,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a custom unit by ID\r\n   */\r\n  getById(id: string): ICustomUnitRecord | null {\r\n    const db = getSQLiteService().getDatabase();\r\n\r\n    const row = db.prepare(`\r\n      SELECT * FROM custom_units WHERE id = ?\r\n    `).get(id) as CustomUnitRow | undefined;\r\n\r\n    if (!row) {\r\n      return null;\r\n    }\r\n\r\n    return this.rowToRecord(row);\r\n  }\r\n\r\n  /**\r\n   * Find a custom unit by chassis and variant\r\n   */\r\n  findByName(chassis: string, variant: string): ICustomUnitRecord | null {\r\n    const db = getSQLiteService().getDatabase();\r\n\r\n    const row = db.prepare(`\r\n      SELECT * FROM custom_units \r\n      WHERE LOWER(chassis) = LOWER(?) AND LOWER(variant) = LOWER(?)\r\n    `).get(chassis, variant) as CustomUnitRow | undefined;\r\n\r\n    if (!row) {\r\n      return null;\r\n    }\r\n\r\n    return this.rowToRecord(row);\r\n  }\r\n\r\n  /**\r\n   * List all custom units as index entries\r\n   */\r\n  list(): readonly ICustomUnitIndexEntry[] {\r\n    const db = getSQLiteService().getDatabase();\r\n\r\n    const rows = db.prepare(`\r\n      SELECT id, chassis, variant, tonnage, tech_base, era, rules_level, \r\n             unit_type, current_version, created_at, updated_at\r\n      FROM custom_units\r\n      ORDER BY chassis, variant\r\n    `).all() as CustomUnitRow[];\r\n\r\n    return rows.map(row => this.rowToIndexEntry(row));\r\n  }\r\n\r\n  /**\r\n   * Check if a unit exists by ID\r\n   */\r\n  exists(id: string): boolean {\r\n    const db = getSQLiteService().getDatabase();\r\n    const result = db.prepare('SELECT 1 FROM custom_units WHERE id = ?').get(id);\r\n    return result !== undefined;\r\n  }\r\n\r\n  /**\r\n   * Check if a name is already taken\r\n   */\r\n  nameExists(chassis: string, variant: string): boolean {\r\n    const db = getSQLiteService().getDatabase();\r\n    const result = db.prepare(`\r\n      SELECT 1 FROM custom_units \r\n      WHERE LOWER(chassis) = LOWER(?) AND LOWER(variant) = LOWER(?)\r\n    `).get(chassis, variant);\r\n    return result !== undefined;\r\n  }\r\n\r\n  /**\r\n   * Suggest a unique clone name\r\n   */\r\n  suggestCloneName(chassis: string, baseVariant: string): ICloneNameSuggestion {\r\n    // Strip any existing -Custom-N suffix\r\n    const cleanVariant = baseVariant.replace(/-Custom-\\d+$/, '');\r\n    \r\n    let counter = 1;\r\n    let suggestedVariant = `${cleanVariant}-Custom-${counter}`;\r\n\r\n    while (this.nameExists(chassis, suggestedVariant)) {\r\n      counter++;\r\n      suggestedVariant = `${cleanVariant}-Custom-${counter}`;\r\n    }\r\n\r\n    return {\r\n      chassis,\r\n      variant: baseVariant,\r\n      suggestedVariant,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Prune old versions beyond the configured limit\r\n   */\r\n  private pruneVersions(unitId: string): void {\r\n    const db = getSQLiteService().getDatabase();\r\n    const config = getSQLiteService().getConfig();\r\n    const maxVersions = config.maxVersionHistory;\r\n\r\n    // Get version count\r\n    const countResult = db.prepare(`\r\n      SELECT COUNT(*) as count FROM unit_versions WHERE unit_id = ?\r\n    `).get(unitId) as { count: number };\r\n\r\n    if (countResult.count <= maxVersions) {\r\n      return;\r\n    }\r\n\r\n    // Delete oldest versions beyond limit\r\n    const deleteOld = db.prepare(`\r\n      DELETE FROM unit_versions\r\n      WHERE unit_id = ?\r\n      AND version NOT IN (\r\n        SELECT version FROM unit_versions\r\n        WHERE unit_id = ?\r\n        ORDER BY version DESC\r\n        LIMIT ?\r\n      )\r\n    `);\r\n\r\n    deleteOld.run(unitId, unitId, maxVersions);\r\n  }\r\n\r\n  /**\r\n   * Convert database row to unit record\r\n   */\r\n  private rowToRecord(row: CustomUnitRow): ICustomUnitRecord {\r\n    return {\r\n      id: row.id,\r\n      chassis: row.chassis,\r\n      variant: row.variant,\r\n      tonnage: row.tonnage,\r\n      techBase: row.tech_base as TechBase,\r\n      era: row.era as Era,\r\n      rulesLevel: row.rules_level as RulesLevel,\r\n      unitType: row.unit_type,\r\n      data: row.data,\r\n      currentVersion: row.current_version,\r\n      createdAt: row.created_at,\r\n      updatedAt: row.updated_at,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Convert database row to index entry\r\n   */\r\n  private rowToIndexEntry(row: CustomUnitRow): ICustomUnitIndexEntry {\r\n    return {\r\n      id: row.id,\r\n      chassis: row.chassis,\r\n      variant: row.variant,\r\n      tonnage: row.tonnage,\r\n      techBase: row.tech_base as TechBase,\r\n      era: row.era as Era,\r\n      rulesLevel: row.rules_level as RulesLevel,\r\n      unitType: row.unit_type,\r\n      weightClass: getWeightClass(row.tonnage),\r\n      currentVersion: row.current_version,\r\n      createdAt: row.created_at,\r\n      updatedAt: row.updated_at,\r\n    };\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet unitRepositoryInstance: UnitRepository | null = null;\r\n\r\n/**\r\n * Get or create the unit repository singleton\r\n */\r\nexport function getUnitRepository(): UnitRepository {\r\n  if (!unitRepositoryInstance) {\r\n    unitRepositoryInstance = new UnitRepository();\r\n  }\r\n  return unitRepositoryInstance;\r\n}\r\n\r\n/**\r\n * Reset the singleton (for testing)\r\n */\r\nexport function resetUnitRepository(): void {\r\n  unitRepositoryInstance = null;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\UnitSearchService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\VersionRepository.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IVersionEntry' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Version Repository\r\n * \r\n * Data access layer for unit version history stored in SQLite.\r\n * Handles version listing, retrieval, and revert operations.\r\n * \r\n * @spec openspec/specs/unit-versioning/spec.md\r\n */\r\n\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { getSQLiteService } from '../persistence/SQLiteService';\r\nimport {\r\n  IVersionEntry,\r\n  IVersionRecord,\r\n  IVersionMetadata,\r\n  IUnitOperationResult,\r\n  UnitErrorCode,\r\n} from '@/types/persistence/UnitPersistence';\r\n\r\n/**\r\n * Database row type for unit_versions table\r\n */\r\ninterface VersionRow {\r\n  id: string;\r\n  unit_id: string;\r\n  version: number;\r\n  data: string;\r\n  saved_at: string;\r\n  notes: string | null;\r\n  revert_source: number | null;\r\n}\r\n\r\n/**\r\n * Version Repository interface\r\n */\r\nexport interface IVersionRepository {\r\n  getVersionHistory(unitId: string): readonly IVersionMetadata[];\r\n  getVersion(unitId: string, version: number): IVersionRecord | null;\r\n  getLatestVersion(unitId: string): IVersionRecord | null;\r\n  revert(unitId: string, targetVersion: number, notes?: string): IUnitOperationResult;\r\n  getVersionCount(unitId: string): number;\r\n}\r\n\r\n/**\r\n * Version Repository implementation\r\n */\r\nexport class VersionRepository implements IVersionRepository {\r\n  /**\r\n   * Get version history for a unit (metadata only, no data)\r\n   */\r\n  getVersionHistory(unitId: string): readonly IVersionMetadata[] {\r\n    const db = getSQLiteService().getDatabase();\r\n\r\n    const rows = db.prepare(`\r\n      SELECT version, saved_at, notes, revert_source\r\n      FROM unit_versions\r\n      WHERE unit_id = ?\r\n      ORDER BY version DESC\r\n    `).all(unitId) as VersionRow[];\r\n\r\n    return rows.map(row => ({\r\n      version: row.version,\r\n      savedAt: row.saved_at,\r\n      notes: row.notes,\r\n      revertSource: row.revert_source,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Get a specific version of a unit\r\n   */\r\n  getVersion(unitId: string, version: number): IVersionRecord | null {\r\n    const db = getSQLiteService().getDatabase();\r\n\r\n    const row = db.prepare(`\r\n      SELECT * FROM unit_versions\r\n      WHERE unit_id = ? AND version = ?\r\n    `).get(unitId, version) as VersionRow | undefined;\r\n\r\n    if (!row) {\r\n      return null;\r\n    }\r\n\r\n    return this.rowToRecord(row);\r\n  }\r\n\r\n  /**\r\n   * Get the latest version of a unit\r\n   */\r\n  getLatestVersion(unitId: string): IVersionRecord | null {\r\n    const db = getSQLiteService().getDatabase();\r\n\r\n    const row = db.prepare(`\r\n      SELECT * FROM unit_versions\r\n      WHERE unit_id = ?\r\n      ORDER BY version DESC\r\n      LIMIT 1\r\n    `).get(unitId) as VersionRow | undefined;\r\n\r\n    if (!row) {\r\n      return null;\r\n    }\r\n\r\n    return this.rowToRecord(row);\r\n  }\r\n\r\n  /**\r\n   * Revert a unit to a previous version\r\n   * Creates a new version with the data from the target version\r\n   */\r\n  revert(unitId: string, targetVersion: number, notes?: string): IUnitOperationResult {\r\n    const db = getSQLiteService().getDatabase();\r\n\r\n    // Get the target version\r\n    const targetVersionRecord = this.getVersion(unitId, targetVersion);\r\n    if (!targetVersionRecord) {\r\n      return {\r\n        success: false,\r\n        error: `Version ${targetVersion} not found`,\r\n        errorCode: UnitErrorCode.VERSION_NOT_FOUND,\r\n      };\r\n    }\r\n\r\n    // Get current version number\r\n    const currentVersionResult = db.prepare(`\r\n      SELECT current_version FROM custom_units WHERE id = ?\r\n    `).get(unitId) as { current_version: number } | undefined;\r\n\r\n    if (!currentVersionResult) {\r\n      return {\r\n        success: false,\r\n        error: `Unit \"${unitId}\" not found`,\r\n        errorCode: UnitErrorCode.NOT_FOUND,\r\n      };\r\n    }\r\n\r\n    const newVersion = currentVersionResult.current_version + 1;\r\n    const now = new Date().toISOString();\r\n    const revertNotes = notes || `Reverted from version ${targetVersion}`;\r\n\r\n    try {\r\n      // Create revert in a transaction\r\n      const revertTransaction = db.transaction(() => {\r\n        // Update unit with data from target version\r\n        const updateUnit = db.prepare(`\r\n          UPDATE custom_units\r\n          SET data = ?, current_version = ?, updated_at = ?\r\n          WHERE id = ?\r\n        `);\r\n\r\n        updateUnit.run(targetVersionRecord.data, newVersion, now, unitId);\r\n\r\n        // Create new version entry\r\n        const versionId = uuidv4();\r\n        const insertVersion = db.prepare(`\r\n          INSERT INTO unit_versions (id, unit_id, version, data, saved_at, notes, revert_source)\r\n          VALUES (?, ?, ?, ?, ?, ?, ?)\r\n        `);\r\n\r\n        insertVersion.run(\r\n          versionId,\r\n          unitId,\r\n          newVersion,\r\n          targetVersionRecord.data,\r\n          now,\r\n          revertNotes,\r\n          targetVersion\r\n        );\r\n      });\r\n\r\n      revertTransaction();\r\n\r\n      // Prune old versions if needed\r\n      this.pruneVersions(unitId);\r\n\r\n      return {\r\n        success: true,\r\n        id: unitId,\r\n        version: newVersion,\r\n      };\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : 'Unknown error';\r\n      return {\r\n        success: false,\r\n        error: `Failed to revert: ${message}`,\r\n        errorCode: UnitErrorCode.DATABASE_ERROR,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the number of versions for a unit\r\n   */\r\n  getVersionCount(unitId: string): number {\r\n    const db = getSQLiteService().getDatabase();\r\n\r\n    const result = db.prepare(`\r\n      SELECT COUNT(*) as count FROM unit_versions WHERE unit_id = ?\r\n    `).get(unitId) as { count: number };\r\n\r\n    return result.count;\r\n  }\r\n\r\n  /**\r\n   * Prune old versions beyond the configured limit\r\n   */\r\n  private pruneVersions(unitId: string): void {\r\n    const db = getSQLiteService().getDatabase();\r\n    const config = getSQLiteService().getConfig();\r\n    const maxVersions = config.maxVersionHistory;\r\n\r\n    const count = this.getVersionCount(unitId);\r\n    if (count <= maxVersions) {\r\n      return;\r\n    }\r\n\r\n    // Delete oldest versions beyond limit\r\n    const deleteOld = db.prepare(`\r\n      DELETE FROM unit_versions\r\n      WHERE unit_id = ?\r\n      AND version NOT IN (\r\n        SELECT version FROM unit_versions\r\n        WHERE unit_id = ?\r\n        ORDER BY version DESC\r\n        LIMIT ?\r\n      )\r\n    `);\r\n\r\n    deleteOld.run(unitId, unitId, maxVersions);\r\n  }\r\n\r\n  /**\r\n   * Convert database row to version record\r\n   */\r\n  private rowToRecord(row: VersionRow): IVersionRecord {\r\n    return {\r\n      id: row.id,\r\n      unitId: row.unit_id,\r\n      version: row.version,\r\n      data: row.data,\r\n      savedAt: row.saved_at,\r\n      notes: row.notes,\r\n      revertSource: row.revert_source,\r\n    };\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet versionRepositoryInstance: VersionRepository | null = null;\r\n\r\n/**\r\n * Get or create the version repository singleton\r\n */\r\nexport function getVersionRepository(): VersionRepository {\r\n  if (!versionRepositoryInstance) {\r\n    versionRepositoryInstance = new VersionRepository();\r\n  }\r\n  return versionRepositoryInstance;\r\n}\r\n\r\n/**\r\n * Reset the singleton (for testing)\r\n */\r\nexport function resetVersionRepository(): void {\r\n  versionRepositoryInstance = null;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\services\\units\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\stores\\UnitStoreProvider.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":10,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":10,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":36},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":49,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":49,"endColumn":34},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'activeTab'. Either include it or remove the dependency array.","line":78,"column":6,"nodeType":"ArrayExpression","endLine":78,"endColumn":79,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab]","fix":{"range":[2491,2564],"text":"[activeTab]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Store Provider\r\n * \r\n * React component that provides the active unit's store via context.\r\n * Child components can use useUnitStore() to access the current unit's state.\r\n * \r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport React, { useEffect, useState, useMemo } from 'react';\r\nimport { StoreApi } from 'zustand';\r\nimport { UnitStoreContext } from './useUnitStore';\r\nimport type { UnitStore } from './useUnitStore';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\n// Registry has SSR guards internally, safe to import directly\r\nimport { hydrateOrCreateUnit } from './unitStoreRegistry';\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\nexport interface ActiveTabInfo {\r\n  id: string;\r\n  name: string;\r\n  tonnage: number;\r\n  techBase: TechBase;\r\n}\r\n\r\ninterface UnitStoreProviderProps {\r\n  children: React.ReactNode;\r\n  /** The currently active tab - passed from parent to avoid hook ordering issues */\r\n  activeTab: ActiveTabInfo | null;\r\n  /** Fallback UI when no unit is selected */\r\n  fallback?: React.ReactNode;\r\n}\r\n\r\n// =============================================================================\r\n// Provider Component\r\n// =============================================================================\r\n\r\n/**\r\n * Provides the active unit's store to child components\r\n * \r\n * Key design decisions:\r\n * - Receives activeTab as prop (not from hooks) to avoid hook ordering issues\r\n * - Registry functions have internal SSR guards\r\n * - Uses useMemo to create store only when activeTab changes\r\n */\r\nexport function UnitStoreProvider({\r\n  children,\r\n  activeTab,\r\n  fallback,\r\n}: UnitStoreProviderProps) {\r\n  // Create/get store based on activeTab\r\n  // useMemo ensures we don't recreate on every render\r\n  const currentStore = useMemo<StoreApi<UnitStore> | null>(() => {\r\n    // No active tab - no store\r\n    if (!activeTab) {\r\n      return null;\r\n    }\r\n    \r\n    // SSR check - don't create stores on server\r\n    if (typeof window === 'undefined') {\r\n      return null;\r\n    }\r\n    \r\n    // Get or create the store for this tab\r\n    try {\r\n      return hydrateOrCreateUnit(activeTab.id, {\r\n        name: activeTab.name,\r\n        tonnage: activeTab.tonnage,\r\n        techBase: activeTab.techBase,\r\n      });\r\n    } catch (e) {\r\n      console.error('Error creating unit store:', e);\r\n      return null;\r\n    }\r\n  }, [activeTab?.id, activeTab?.name, activeTab?.tonnage, activeTab?.techBase]);\r\n  \r\n  // No active tab selected - show fallback\r\n  if (!activeTab) {\r\n    return <>{fallback}</>;\r\n  }\r\n  \r\n  // Store not yet created (SSR or error)\r\n  if (!currentStore) {\r\n    return (\r\n      <div className=\"flex-1 flex items-center justify-center\">\r\n        <div className=\"text-slate-400\">Loading unit...</div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Provide store to children\r\n  return (\r\n    <UnitStoreContext.Provider value={currentStore}>\r\n      {children}\r\n    </UnitStoreContext.Provider>\r\n  );\r\n}\r\n\r\n/**\r\n * Hook to check if we're inside a UnitStoreProvider with a valid store\r\n */\r\nexport function useHasUnitStore(): boolean {\r\n  const store = React.useContext(UnitStoreContext);\r\n  return store !== null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\stores\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\stores\\unitState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\stores\\unitStoreRegistry.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":145,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":145,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .state on an `any` value.","line":146,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":146,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'stateId' is assigned a value but never used.","line":149,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":149,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Store Registry\r\n * \r\n * Manages all active unit store instances.\r\n * Provides lookup, creation, and cleanup of unit stores.\r\n * \r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport { StoreApi } from 'zustand';\r\nimport { UnitStore, UnitState, createDefaultUnitState, CreateUnitOptions } from './unitState';\r\nimport { createUnitStore, createNewUnitStore } from './useUnitStore';\r\nimport { isValidUUID, generateUUID } from '@/utils/uuid';\r\n\r\n// =============================================================================\r\n// SSR-Safe Storage Helper\r\n// =============================================================================\r\n\r\n/**\r\n * Safely get item from localStorage (returns null during SSR)\r\n */\r\nfunction safeGetItem(key: string): string | null {\r\n  if (typeof window === 'undefined') return null;\r\n  return localStorage.getItem(key);\r\n}\r\n\r\n/**\r\n * Safely remove item from localStorage (no-op during SSR)\r\n */\r\nfunction safeRemoveItem(key: string): void {\r\n  if (typeof window === 'undefined') return;\r\n  localStorage.removeItem(key);\r\n}\r\n\r\n// =============================================================================\r\n// Registry\r\n// =============================================================================\r\n\r\n/**\r\n * Map of unit ID -> store instance\r\n */\r\nconst unitStores = new Map<string, StoreApi<UnitStore>>();\r\n\r\n/**\r\n * Get a unit store by ID\r\n * Returns undefined if the store doesn't exist\r\n */\r\nexport function getUnitStore(unitId: string): StoreApi<UnitStore> | undefined {\r\n  return unitStores.get(unitId);\r\n}\r\n\r\n/**\r\n * Check if a unit store exists\r\n */\r\nexport function hasUnitStore(unitId: string): boolean {\r\n  return unitStores.has(unitId);\r\n}\r\n\r\n/**\r\n * Get all unit store IDs\r\n */\r\nexport function getAllUnitIds(): string[] {\r\n  return Array.from(unitStores.keys());\r\n}\r\n\r\n/**\r\n * Get the count of registered stores\r\n */\r\nexport function getStoreCount(): number {\r\n  return unitStores.size;\r\n}\r\n\r\n// =============================================================================\r\n// Store Creation\r\n// =============================================================================\r\n\r\n/**\r\n * Create and register a new unit store\r\n * \r\n * @param options - Options for creating the unit\r\n * @returns The created store\r\n */\r\nexport function createAndRegisterUnit(options: CreateUnitOptions): StoreApi<UnitStore> {\r\n  const store = createNewUnitStore(options);\r\n  const state = store.getState();\r\n  unitStores.set(state.id, store);\r\n  return store;\r\n}\r\n\r\n/**\r\n * Register an existing store\r\n * Useful when hydrating from localStorage\r\n */\r\nexport function registerStore(store: StoreApi<UnitStore>): void {\r\n  const state = store.getState();\r\n  unitStores.set(state.id, store);\r\n}\r\n\r\n/**\r\n * Validate and potentially repair a unit ID\r\n * \r\n * @param unitId - The unit ID to validate\r\n * @param context - Context string for logging\r\n * @returns A valid UUID (original if valid, or newly generated)\r\n */\r\nfunction ensureValidUnitId(unitId: string | undefined | null, context: string): string {\r\n  if (unitId && isValidUUID(unitId)) {\r\n    return unitId;\r\n  }\r\n  \r\n  const newId = generateUUID();\r\n  console.warn(\r\n    `[UnitStoreRegistry] ${context}: Invalid unit ID \"${unitId || '(missing)'}\" replaced with \"${newId}\"`\r\n  );\r\n  return newId;\r\n}\r\n\r\n/**\r\n * Hydrate a unit store from localStorage\r\n * If the unit was previously saved, this restores it\r\n * \r\n * @param unitId - The unit ID to hydrate\r\n * @param fallbackOptions - Options to use if no saved state exists\r\n * @returns The hydrated or new store\r\n */\r\nexport function hydrateOrCreateUnit(\r\n  unitId: string,\r\n  fallbackOptions: CreateUnitOptions\r\n): StoreApi<UnitStore> {\r\n  // Validate the requested unit ID\r\n  const validUnitId = ensureValidUnitId(unitId, 'hydrateOrCreateUnit');\r\n  \r\n  // Check if already in registry\r\n  const existing = unitStores.get(validUnitId);\r\n  if (existing) {\r\n    return existing;\r\n  }\r\n  \r\n  // Try to load from localStorage (SSR-safe)\r\n  const storageKey = `megamek-unit-${validUnitId}`;\r\n  const savedState = safeGetItem(storageKey);\r\n  \r\n  if (savedState) {\r\n    try {\r\n      const parsed = JSON.parse(savedState);\r\n      const state = parsed.state as Partial<UnitState>;\r\n      \r\n      // Validate the ID from localStorage as well\r\n      const stateId = ensureValidUnitId(state.id, 'localStorage state');\r\n      \r\n      // Create store with saved state merged with defaults\r\n      const defaultState = createDefaultUnitState({ ...fallbackOptions, id: validUnitId });\r\n      const mergedState: UnitState = {\r\n        ...defaultState,\r\n        ...state,\r\n        id: validUnitId, // Always use the validated ID we were called with\r\n      };\r\n      \r\n      const store = createUnitStore(mergedState);\r\n      unitStores.set(validUnitId, store);\r\n      return store;\r\n    } catch (e) {\r\n      console.warn(`Failed to hydrate unit ${validUnitId}, creating new:`, e);\r\n    }\r\n  }\r\n  \r\n  // Create new unit with fallback options\r\n  const store = createNewUnitStore({ ...fallbackOptions, id: validUnitId });\r\n  unitStores.set(validUnitId, store);\r\n  return store;\r\n}\r\n\r\n// =============================================================================\r\n// Store Cleanup\r\n// =============================================================================\r\n\r\n/**\r\n * Remove a store from the registry\r\n * Does NOT delete the localStorage entry\r\n */\r\nexport function unregisterStore(unitId: string): boolean {\r\n  return unitStores.delete(unitId);\r\n}\r\n\r\n/**\r\n * Remove a store and delete its localStorage entry\r\n */\r\nexport function deleteUnit(unitId: string): boolean {\r\n  const removed = unitStores.delete(unitId);\r\n  if (removed) {\r\n    const storageKey = `megamek-unit-${unitId}`;\r\n    safeRemoveItem(storageKey);\r\n  }\r\n  return removed;\r\n}\r\n\r\n/**\r\n * Clear all stores from the registry\r\n * Optionally also clear localStorage\r\n */\r\nexport function clearAllStores(clearStorage = false): void {\r\n  if (clearStorage) {\r\n    Array.from(unitStores.keys()).forEach((unitId) => {\r\n      const storageKey = `megamek-unit-${unitId}`;\r\n      safeRemoveItem(storageKey);\r\n    });\r\n  }\r\n  unitStores.clear();\r\n}\r\n\r\n// =============================================================================\r\n// Duplicate Support\r\n// =============================================================================\r\n\r\n/**\r\n * Duplicate a unit store with a new ID\r\n */\r\nexport function duplicateUnit(sourceUnitId: string, newName?: string): StoreApi<UnitStore> | null {\r\n  const sourceStore = unitStores.get(sourceUnitId);\r\n  if (!sourceStore) {\r\n    return null;\r\n  }\r\n  \r\n  const sourceState = sourceStore.getState();\r\n  const newState = createDefaultUnitState({\r\n    name: newName ?? `${sourceState.name} (Copy)`,\r\n    tonnage: sourceState.tonnage,\r\n    techBase: sourceState.techBase,\r\n    walkMP: Math.floor(sourceState.engineRating / sourceState.tonnage),\r\n  });\r\n  \r\n  // Copy configuration from source\r\n  const mergedState: UnitState = {\r\n    ...newState,\r\n    techBaseMode: sourceState.techBaseMode,\r\n    componentTechBases: { ...sourceState.componentTechBases },\r\n    engineType: sourceState.engineType,\r\n    engineRating: sourceState.engineRating,\r\n    gyroType: sourceState.gyroType,\r\n    internalStructureType: sourceState.internalStructureType,\r\n    cockpitType: sourceState.cockpitType,\r\n    heatSinkType: sourceState.heatSinkType,\r\n    heatSinkCount: sourceState.heatSinkCount,\r\n    armorType: sourceState.armorType,\r\n  };\r\n  \r\n  const store = createUnitStore(mergedState);\r\n  unitStores.set(mergedState.id, store);\r\n  return store;\r\n}\r\n\r\n// =============================================================================\r\n// Load from Full State (for unit loading feature)\r\n// =============================================================================\r\n\r\n/**\r\n * Create and register a unit store from a complete UnitState\r\n * \r\n * This is used when loading units from canonical JSON or custom units database.\r\n * The state should already be fully mapped/transformed before calling this.\r\n * \r\n * @param state - Complete UnitState object\r\n * @returns The created store\r\n */\r\nexport function createUnitFromFullState(state: UnitState): StoreApi<UnitStore> {\r\n  // Validate the ID\r\n  const validId = ensureValidUnitId(state.id, 'createUnitFromFullState');\r\n  \r\n  // Check if already exists (shouldn't happen since IDs are unique UUIDs)\r\n  const existing = unitStores.get(validId);\r\n  if (existing) {\r\n    console.warn(`Unit store ${validId} already exists, returning existing`);\r\n    return existing;\r\n  }\r\n  \r\n  // Create the store with the full state, ensuring valid ID\r\n  const validatedState: UnitState = {\r\n    ...state,\r\n    id: validId,\r\n  };\r\n  \r\n  const store = createUnitStore(validatedState);\r\n  unitStores.set(validId, store);\r\n  return store;\r\n}","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\stores\\useCustomizerStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\stores\\useEquipmentStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\stores\\useMultiUnitStore.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'techBase' is assigned a value but never used. Allowed unused args must match /^_/u.","line":71,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Multi-Unit Tab Store\r\n * \r\n * Manages multiple unit tabs with:\r\n * - Tab creation, selection, closing\r\n * - Component selections persistence\r\n * - Unsaved changes tracking\r\n * - localStorage persistence\r\n * \r\n * @spec openspec/specs/multi-unit-tabs/spec.md\r\n * @spec openspec/specs/component-configuration/spec.md\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport { persist, createJSONStorage } from 'zustand/middleware';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { MechConfiguration, UnitType } from '@/types/unit/BattleMechInterfaces';\r\nimport {\r\n  TechBaseMode,\r\n  TechBaseComponent,\r\n  IComponentTechBases,\r\n  createDefaultComponentTechBases,\r\n} from '@/types/construction/TechBaseConfiguration';\r\nimport { EngineType } from '@/types/construction/EngineType';\r\nimport { GyroType } from '@/types/construction/GyroType';\r\nimport { InternalStructureType } from '@/types/construction/InternalStructureType';\r\nimport { CockpitType } from '@/types/construction/CockpitType';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { ArmorTypeEnum } from '@/types/construction/ArmorType';\r\nimport { JumpJetType } from '@/utils/construction/movementCalculations';\r\n\r\n// =============================================================================\r\n// Component Selections Interface\r\n// =============================================================================\r\n\r\n/**\r\n * All component selections for a unit\r\n */\r\nexport interface IComponentSelections {\r\n  // Engine\r\n  engineType: EngineType;\r\n  engineRating: number;\r\n  \r\n  // Gyro\r\n  gyroType: GyroType;\r\n  \r\n  // Structure\r\n  internalStructureType: InternalStructureType;\r\n  \r\n  // Cockpit\r\n  cockpitType: CockpitType;\r\n  \r\n  // Heat Sinks\r\n  heatSinkType: HeatSinkType;\r\n  heatSinkCount: number;\r\n  \r\n  // Armor\r\n  armorType: ArmorTypeEnum;\r\n  \r\n  // Jump Jets\r\n  jumpMP?: number;\r\n  jumpJetType?: JumpJetType;\r\n}\r\n\r\n/**\r\n * Create default component selections for a unit\r\n */\r\nexport function createDefaultComponentSelections(\r\n  tonnage: number,\r\n  walkMP: number = 4,\r\n  techBase: TechBase = TechBase.INNER_SPHERE\r\n): IComponentSelections {\r\n  const engineRating = tonnage * walkMP;\r\n  \r\n  return {\r\n    engineType: EngineType.STANDARD,\r\n    engineRating,\r\n    gyroType: GyroType.STANDARD,\r\n    internalStructureType: InternalStructureType.STANDARD,\r\n    cockpitType: CockpitType.STANDARD,\r\n    heatSinkType: HeatSinkType.SINGLE,\r\n    heatSinkCount: 10,\r\n    armorType: ArmorTypeEnum.STANDARD,\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// Unit Tab Interface\r\n// =============================================================================\r\n\r\n/**\r\n * Unit tab state\r\n * \r\n * Contains all configuration state for a single unit, persisted across\r\n * customizer tab navigation and browser sessions.\r\n */\r\nexport interface UnitTab {\r\n  /** Unique tab identifier */\r\n  readonly id: string;\r\n  /** Display name (user-editable) */\r\n  name: string;\r\n  /** Unit type */\r\n  readonly unitType: UnitType;\r\n  /** Tonnage */\r\n  readonly tonnage: number;\r\n  /** Tech base (base value for the unit) */\r\n  readonly techBase: TechBase;\r\n  /** Mech configuration */\r\n  readonly configuration: MechConfiguration;\r\n  /** Has unsaved changes */\r\n  isModified: boolean;\r\n  /** Creation timestamp */\r\n  readonly createdAt: number;\r\n  /** Last modified timestamp */\r\n  lastModifiedAt: number;\r\n  \r\n  // ==========================================================================\r\n  // Tech Base Configuration (persisted across tab navigation)\r\n  // ==========================================================================\r\n  \r\n  /** Tech base mode: inner_sphere, clan, or mixed */\r\n  techBaseMode: TechBaseMode;\r\n  /** Per-component tech base settings (used when techBaseMode is 'mixed') */\r\n  componentTechBases: IComponentTechBases;\r\n  \r\n  // ==========================================================================\r\n  // Component Selections (persisted across tab navigation)\r\n  // ==========================================================================\r\n  \r\n  /** All component type selections */\r\n  componentSelections: IComponentSelections;\r\n}\r\n\r\n/**\r\n * Unit template for creating new tabs\r\n */\r\nexport interface UnitTemplate {\r\n  readonly id: string;\r\n  readonly name: string;\r\n  readonly tonnage: number;\r\n  readonly techBase: TechBase;\r\n  readonly walkMP: number;\r\n  readonly jumpMP: number;\r\n}\r\n\r\n/**\r\n * Default unit templates\r\n */\r\nexport const UNIT_TEMPLATES: readonly UnitTemplate[] = [\r\n  { id: 'light', name: 'Light Mech', tonnage: 25, techBase: TechBase.INNER_SPHERE, walkMP: 8, jumpMP: 0 },\r\n  { id: 'medium', name: 'Medium Mech', tonnage: 50, techBase: TechBase.INNER_SPHERE, walkMP: 5, jumpMP: 0 },\r\n  { id: 'heavy', name: 'Heavy Mech', tonnage: 70, techBase: TechBase.INNER_SPHERE, walkMP: 4, jumpMP: 0 },\r\n  { id: 'assault', name: 'Assault Mech', tonnage: 100, techBase: TechBase.INNER_SPHERE, walkMP: 3, jumpMP: 0 },\r\n];\r\n\r\n// =============================================================================\r\n// Store State Interface\r\n// =============================================================================\r\n\r\n/**\r\n * Multi-unit store state\r\n */\r\nexport interface MultiUnitState {\r\n  // Tab state\r\n  tabs: UnitTab[];\r\n  activeTabId: string | null;\r\n  \r\n  // UI state\r\n  isLoading: boolean;\r\n  isNewTabModalOpen: boolean;\r\n  \r\n  // Tab management actions\r\n  createTab: (template: UnitTemplate, name?: string) => string;\r\n  duplicateTab: (tabId: string) => string | null;\r\n  closeTab: (tabId: string) => void;\r\n  selectTab: (tabId: string) => void;\r\n  renameTab: (tabId: string, name: string) => void;\r\n  markModified: (tabId: string, modified?: boolean) => void;\r\n  openNewTabModal: () => void;\r\n  closeNewTabModal: () => void;\r\n  getActiveTab: () => UnitTab | null;\r\n  \r\n  // Tech base configuration actions\r\n  updateTechBaseMode: (tabId: string, mode: TechBaseMode) => void;\r\n  updateComponentTechBase: (tabId: string, component: TechBaseComponent, techBase: TechBase) => void;\r\n  setAllComponentTechBases: (tabId: string, techBases: IComponentTechBases) => void;\r\n  \r\n  // Component selection actions\r\n  updateEngineType: (tabId: string, engineType: EngineType) => void;\r\n  updateEngineRating: (tabId: string, rating: number) => void;\r\n  updateGyroType: (tabId: string, gyroType: GyroType) => void;\r\n  updateStructureType: (tabId: string, structureType: InternalStructureType) => void;\r\n  updateCockpitType: (tabId: string, cockpitType: CockpitType) => void;\r\n  updateHeatSinkType: (tabId: string, heatSinkType: HeatSinkType) => void;\r\n  updateHeatSinkCount: (tabId: string, count: number) => void;\r\n  updateArmorType: (tabId: string, armorType: ArmorTypeEnum) => void;\r\n  updateComponentSelections: (tabId: string, selections: Partial<IComponentSelections>) => void;\r\n  \r\n  // Persistence helpers\r\n  setLoading: (loading: boolean) => void;\r\n}\r\n\r\n// =============================================================================\r\n// Store Implementation\r\n// =============================================================================\r\n\r\n/**\r\n * Generate unique tab ID\r\n */\r\nfunction generateTabId(): string {\r\n  return `tab-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Multi-unit tab store with localStorage persistence\r\n */\r\nexport const useMultiUnitStore = create<MultiUnitState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      // Initial state\r\n      tabs: [],\r\n      activeTabId: null,\r\n      isLoading: true,\r\n      isNewTabModalOpen: false,\r\n      \r\n      // =======================================================================\r\n      // Tab Management Actions\r\n      // =======================================================================\r\n      \r\n      createTab: (template, customName) => {\r\n        const id = generateTabId();\r\n        const now = Date.now();\r\n        const name = customName || 'Mek';\r\n        \r\n        // Determine initial tech base mode based on template\r\n        const initialMode: TechBaseMode = template.techBase === TechBase.CLAN ? TechBaseMode.CLAN : TechBaseMode.INNER_SPHERE;\r\n        \r\n        const newTab: UnitTab = {\r\n          id,\r\n          name,\r\n          unitType: UnitType.BATTLEMECH,\r\n          tonnage: template.tonnage,\r\n          techBase: template.techBase,\r\n          configuration: MechConfiguration.BIPED,\r\n          isModified: true,\r\n          createdAt: now,\r\n          lastModifiedAt: now,\r\n          // Tech base configuration\r\n          techBaseMode: initialMode,\r\n          componentTechBases: createDefaultComponentTechBases(template.techBase),\r\n          // Component selections\r\n          componentSelections: createDefaultComponentSelections(\r\n            template.tonnage,\r\n            template.walkMP,\r\n            template.techBase\r\n          ),\r\n        };\r\n        \r\n        set((state) => ({\r\n          tabs: [...state.tabs, newTab],\r\n          activeTabId: id,\r\n          isNewTabModalOpen: false,\r\n        }));\r\n        \r\n        return id;\r\n      },\r\n      \r\n      duplicateTab: (tabId) => {\r\n        const state = get();\r\n        const sourceTab = state.tabs.find(t => t.id === tabId);\r\n        if (!sourceTab) return null;\r\n        \r\n        const id = generateTabId();\r\n        const now = Date.now();\r\n        \r\n        // Copy all configuration including tech base and component selections\r\n        const newTab: UnitTab = {\r\n          ...sourceTab,\r\n          id,\r\n          name: `${sourceTab.name} (Copy)`,\r\n          isModified: true,\r\n          createdAt: now,\r\n          lastModifiedAt: now,\r\n          // Deep copy objects to avoid shared references\r\n          componentTechBases: { ...sourceTab.componentTechBases },\r\n          componentSelections: { ...sourceTab.componentSelections },\r\n        };\r\n        \r\n        set((state) => ({\r\n          tabs: [...state.tabs, newTab],\r\n          activeTabId: id,\r\n        }));\r\n        \r\n        return id;\r\n      },\r\n      \r\n      closeTab: (tabId) => {\r\n        set((state) => {\r\n          const tabIndex = state.tabs.findIndex(t => t.id === tabId);\r\n          if (tabIndex === -1) return state;\r\n          \r\n          // Prevent closing last tab\r\n          if (state.tabs.length === 1) return state;\r\n          \r\n          const newTabs = state.tabs.filter(t => t.id !== tabId);\r\n          \r\n          // Select adjacent tab if closing active tab\r\n          let newActiveId = state.activeTabId;\r\n          if (state.activeTabId === tabId) {\r\n            const newIndex = Math.min(tabIndex, newTabs.length - 1);\r\n            newActiveId = newTabs[newIndex]?.id || null;\r\n          }\r\n          \r\n          return {\r\n            tabs: newTabs,\r\n            activeTabId: newActiveId,\r\n          };\r\n        });\r\n      },\r\n      \r\n      selectTab: (tabId) => {\r\n        set({ activeTabId: tabId });\r\n      },\r\n      \r\n      renameTab: (tabId, name) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab =>\r\n            tab.id === tabId\r\n              ? { ...tab, name, lastModifiedAt: Date.now() }\r\n              : tab\r\n          ),\r\n        }));\r\n      },\r\n      \r\n      markModified: (tabId, modified = true) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab =>\r\n            tab.id === tabId\r\n              ? { ...tab, isModified: modified, lastModifiedAt: Date.now() }\r\n              : tab\r\n          ),\r\n        }));\r\n      },\r\n      \r\n      openNewTabModal: () => set({ isNewTabModalOpen: true }),\r\n      \r\n      closeNewTabModal: () => set({ isNewTabModalOpen: false }),\r\n      \r\n      getActiveTab: () => {\r\n        const state = get();\r\n        return state.tabs.find(t => t.id === state.activeTabId) || null;\r\n      },\r\n      \r\n      // =======================================================================\r\n      // Tech Base Configuration Actions\r\n      // =======================================================================\r\n      \r\n      updateTechBaseMode: (tabId, mode) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            \r\n            // When switching to non-mixed mode, reset all components to match\r\n            const newTechBase = mode === 'clan' ? TechBase.CLAN : TechBase.INNER_SPHERE;\r\n            const newComponentTechBases = mode === 'mixed'\r\n              ? tab.componentTechBases\r\n              : createDefaultComponentTechBases(newTechBase);\r\n            \r\n            return {\r\n              ...tab,\r\n              techBaseMode: mode,\r\n              componentTechBases: newComponentTechBases,\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      updateComponentTechBase: (tabId, component, techBase) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentTechBases: {\r\n                ...tab.componentTechBases,\r\n                [component]: techBase,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      setAllComponentTechBases: (tabId, techBases) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentTechBases: techBases,\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      // =======================================================================\r\n      // Component Selection Actions\r\n      // =======================================================================\r\n      \r\n      updateEngineType: (tabId, engineType) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentSelections: {\r\n                ...tab.componentSelections,\r\n                engineType,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      updateEngineRating: (tabId, rating) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentSelections: {\r\n                ...tab.componentSelections,\r\n                engineRating: rating,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      updateGyroType: (tabId, gyroType) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentSelections: {\r\n                ...tab.componentSelections,\r\n                gyroType,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      updateStructureType: (tabId, structureType) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentSelections: {\r\n                ...tab.componentSelections,\r\n                internalStructureType: structureType,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      updateCockpitType: (tabId, cockpitType) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentSelections: {\r\n                ...tab.componentSelections,\r\n                cockpitType,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      updateHeatSinkType: (tabId, heatSinkType) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentSelections: {\r\n                ...tab.componentSelections,\r\n                heatSinkType,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      updateHeatSinkCount: (tabId, count) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentSelections: {\r\n                ...tab.componentSelections,\r\n                heatSinkCount: count,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      updateArmorType: (tabId, armorType) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentSelections: {\r\n                ...tab.componentSelections,\r\n                armorType,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      updateComponentSelections: (tabId, selections) => {\r\n        set((state) => ({\r\n          tabs: state.tabs.map(tab => {\r\n            if (tab.id !== tabId) return tab;\r\n            return {\r\n              ...tab,\r\n              componentSelections: {\r\n                ...tab.componentSelections,\r\n                ...selections,\r\n              },\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        }));\r\n      },\r\n      \r\n      // =======================================================================\r\n      // Persistence Helpers\r\n      // =======================================================================\r\n      \r\n      setLoading: (loading) => set({ isLoading: loading }),\r\n    }),\r\n    {\r\n      name: 'megamek-multi-unit-store',\r\n      storage: createJSONStorage(() => localStorage),\r\n      partialize: (state) => ({\r\n        tabs: state.tabs,\r\n        activeTabId: state.activeTabId,\r\n      }),\r\n      // Migrate existing tabs that don't have new fields\r\n      merge: (persisted, current) => {\r\n        const persistedState = persisted as Partial<MultiUnitState>;\r\n        \r\n        // Migrate tabs to include all configuration fields\r\n        const migratedTabs = (persistedState.tabs || []).map((tab) => {\r\n          const needsTechBaseMigration = !tab.techBaseMode || !tab.componentTechBases;\r\n          const needsComponentMigration = !tab.componentSelections;\r\n          \r\n          if (!needsTechBaseMigration && !needsComponentMigration) {\r\n            return tab;\r\n          }\r\n          \r\n          const initialMode: TechBaseMode = tab.techBase === TechBase.CLAN ? TechBaseMode.CLAN : TechBaseMode.INNER_SPHERE;\r\n          \r\n          return {\r\n            ...tab,\r\n            // Tech base configuration\r\n            techBaseMode: tab.techBaseMode || initialMode,\r\n            componentTechBases: tab.componentTechBases || createDefaultComponentTechBases(tab.techBase),\r\n            // Component selections\r\n            componentSelections: tab.componentSelections || createDefaultComponentSelections(\r\n              tab.tonnage,\r\n              4, // Default walk MP\r\n              tab.techBase\r\n            ),\r\n          };\r\n        });\r\n        \r\n        return {\r\n          ...current,\r\n          tabs: migratedTabs,\r\n          activeTabId: persistedState.activeTabId ?? current.activeTabId,\r\n        };\r\n      },\r\n      onRehydrateStorage: () => (state) => {\r\n        if (state) {\r\n          state.setLoading(false);\r\n        }\r\n      },\r\n    }\r\n  )\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\stores\\useTabManagerStore.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'deleteUnit' is defined but never used.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tab Manager Store\r\n * \r\n * Manages tab lifecycle without containing unit data.\r\n * - Tab IDs and ordering\r\n * - Active tab selection\r\n * - Tab open/close/reorder operations\r\n * \r\n * Unit data is stored separately in individual unit stores.\r\n * \r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport { persist, createJSONStorage, StateStorage } from 'zustand/middleware';\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { isValidUUID, generateUUID } from '@/utils/uuid';\r\nimport {\r\n  createAndRegisterUnit,\r\n  getUnitStore,\r\n  deleteUnit,\r\n  duplicateUnit,\r\n  hydrateOrCreateUnit,\r\n} from './unitStoreRegistry';\r\n\r\n// =============================================================================\r\n// Client-Safe Storage\r\n// =============================================================================\r\n\r\n/**\r\n * Storage wrapper that safely handles SSR (no localStorage on server)\r\n */\r\nconst clientSafeStorage: StateStorage = {\r\n  getItem: (name: string): string | null => {\r\n    if (typeof window === 'undefined') return null;\r\n    return localStorage.getItem(name);\r\n  },\r\n  setItem: (name: string, value: string): void => {\r\n    if (typeof window === 'undefined') return;\r\n    localStorage.setItem(name, value);\r\n  },\r\n  removeItem: (name: string): void => {\r\n    if (typeof window === 'undefined') return;\r\n    localStorage.removeItem(name);\r\n  },\r\n};\r\n\r\n// =============================================================================\r\n// Types\r\n// =============================================================================\r\n\r\n/**\r\n * Tab metadata (stored in TabManager, not in unit store)\r\n */\r\nexport interface TabInfo {\r\n  /** Unit ID (matches unit store ID) */\r\n  readonly id: string;\r\n  /** Display name (cached from unit store for tab rendering) */\r\n  name: string;\r\n  /** Tonnage (cached for tab display) */\r\n  readonly tonnage: number;\r\n  /** Tech base (cached for tab display) */\r\n  readonly techBase: TechBase;\r\n}\r\n\r\n/**\r\n * Template for creating new units\r\n */\r\nexport interface UnitTemplate {\r\n  readonly id: string;\r\n  readonly name: string;\r\n  readonly tonnage: number;\r\n  readonly techBase: TechBase;\r\n  readonly walkMP: number;\r\n}\r\n\r\n/**\r\n * Default unit templates\r\n */\r\nexport const UNIT_TEMPLATES: readonly UnitTemplate[] = [\r\n  { id: 'light', name: 'Light Mech', tonnage: 25, techBase: TechBase.INNER_SPHERE, walkMP: 8 },\r\n  { id: 'medium', name: 'Medium Mech', tonnage: 50, techBase: TechBase.INNER_SPHERE, walkMP: 5 },\r\n  { id: 'heavy', name: 'Heavy Mech', tonnage: 70, techBase: TechBase.INNER_SPHERE, walkMP: 4 },\r\n  { id: 'assault', name: 'Assault Mech', tonnage: 100, techBase: TechBase.INNER_SPHERE, walkMP: 3 },\r\n];\r\n\r\n// =============================================================================\r\n// Store Interface\r\n// =============================================================================\r\n\r\n/**\r\n * Tab Manager state\r\n */\r\nexport interface TabManagerState {\r\n  // ==========================================================================\r\n  // State\r\n  // ==========================================================================\r\n  \r\n  /** Ordered list of tab info */\r\n  tabs: TabInfo[];\r\n  \r\n  /** Currently active tab ID */\r\n  activeTabId: string | null;\r\n  \r\n  /** Loading state (for hydration) */\r\n  isLoading: boolean;\r\n  \r\n  /** New tab modal state */\r\n  isNewTabModalOpen: boolean;\r\n  \r\n  // ==========================================================================\r\n  // Tab Actions\r\n  // ==========================================================================\r\n  \r\n  /** Create a new tab from template */\r\n  createTab: (template: UnitTemplate, customName?: string) => string;\r\n  \r\n  /** Duplicate an existing tab */\r\n  duplicateTab: (tabId: string) => string | null;\r\n  \r\n  /** Close a tab */\r\n  closeTab: (tabId: string) => void;\r\n  \r\n  /** Select a tab */\r\n  selectTab: (tabId: string) => void;\r\n  \r\n  /** Rename a tab */\r\n  renameTab: (tabId: string, name: string) => void;\r\n  \r\n  /** Reorder tabs */\r\n  reorderTabs: (fromIndex: number, toIndex: number) => void;\r\n  \r\n  /** Add a tab directly (for loaded units with pre-existing store) */\r\n  addTab: (tabInfo: Omit<TabInfo, 'tonnage' | 'techBase'> & { tonnage?: number; techBase?: TechBase }) => void;\r\n  \r\n  // ==========================================================================\r\n  // Modal Actions\r\n  // ==========================================================================\r\n  \r\n  openNewTabModal: () => void;\r\n  closeNewTabModal: () => void;\r\n  \r\n  // ==========================================================================\r\n  // Helpers\r\n  // ==========================================================================\r\n  \r\n  getActiveTab: () => TabInfo | null;\r\n  setLoading: (loading: boolean) => void;\r\n}\r\n\r\n// =============================================================================\r\n// Tab ID Validation\r\n// =============================================================================\r\n\r\n/**\r\n * Result of tab sanitization\r\n */\r\ninterface SanitizeResult {\r\n  tabs: TabInfo[];\r\n  activeTabId: string | null;\r\n  repaired: number;\r\n}\r\n\r\n/**\r\n * Sanitize tabs on hydration to ensure all tabs have valid UUIDs.\r\n * \r\n * This handles edge cases where:\r\n * - Cached data has tabs with missing IDs\r\n * - Cached data has tabs with invalid (non-UUID) IDs\r\n * - Migration from older data formats\r\n * \r\n * @param tabs - Array of tabs from localStorage\r\n * @param activeTabId - Current active tab ID\r\n * @returns Sanitized tabs and potentially updated activeTabId\r\n */\r\nfunction sanitizeTabsOnHydration(\r\n  tabs: TabInfo[] | undefined,\r\n  activeTabId: string | null\r\n): SanitizeResult {\r\n  if (!tabs || !Array.isArray(tabs)) {\r\n    return { tabs: [], activeTabId: null, repaired: 0 };\r\n  }\r\n  \r\n  let repaired = 0;\r\n  const idMap = new Map<string, string>(); // oldId -> newId for active tab tracking\r\n  \r\n  const sanitizedTabs = tabs.map((tab): TabInfo => {\r\n    // Check if ID is missing or invalid\r\n    if (!tab.id || !isValidUUID(tab.id)) {\r\n      const oldId = tab.id || '(missing)';\r\n      const newId = generateUUID();\r\n      idMap.set(oldId, newId);\r\n      repaired++;\r\n      \r\n      console.warn(\r\n        `[TabManager] Repaired invalid tab ID: \"${oldId}\" -> \"${newId}\" for tab \"${tab.name}\"`\r\n      );\r\n      \r\n      return {\r\n        ...tab,\r\n        id: newId,\r\n      } as TabInfo;\r\n    }\r\n    \r\n    return tab;\r\n  });\r\n  \r\n  // Update activeTabId if it was repaired\r\n  let newActiveTabId = activeTabId;\r\n  \r\n  // Check if activeTabId needs to be updated\r\n  // Note: empty string is treated as a value that needs repair\r\n  if (activeTabId !== null && idMap.has(activeTabId)) {\r\n    // The activeTabId was in a tab that got repaired\r\n    newActiveTabId = idMap.get(activeTabId) ?? null;\r\n  } else if (activeTabId !== null && (activeTabId === '' || !isValidUUID(activeTabId))) {\r\n    // Active tab ID is invalid but wasn't in the tabs - reset to first tab\r\n    newActiveTabId = sanitizedTabs[0]?.id ?? null;\r\n    console.warn(\r\n      `[TabManager] Active tab ID \"${activeTabId || '(empty)'}\" is invalid, resetting to \"${newActiveTabId}\"`\r\n    );\r\n  }\r\n  \r\n  if (repaired > 0) {\r\n    console.warn(`[TabManager] Repaired ${repaired} tab(s) with invalid IDs`);\r\n  }\r\n  \r\n  return {\r\n    tabs: sanitizedTabs,\r\n    activeTabId: newActiveTabId,\r\n    repaired,\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// Store Implementation\r\n// =============================================================================\r\n\r\n/**\r\n * Tab manager store with localStorage persistence\r\n */\r\nexport const useTabManagerStore = create<TabManagerState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      // Initial state\r\n      tabs: [],\r\n      activeTabId: null,\r\n      isLoading: true,\r\n      isNewTabModalOpen: false,\r\n      \r\n      // =======================================================================\r\n      // Tab Actions\r\n      // =======================================================================\r\n      \r\n      createTab: (template, customName) => {\r\n        const name = customName ?? 'Mek';\r\n        \r\n        // Create unit store in registry\r\n        const store = createAndRegisterUnit({\r\n          name,\r\n          tonnage: template.tonnage,\r\n          techBase: template.techBase,\r\n          walkMP: template.walkMP,\r\n        });\r\n        \r\n        const unitState = store.getState();\r\n        const tabInfo: TabInfo = {\r\n          id: unitState.id,\r\n          name: unitState.name,\r\n          tonnage: unitState.tonnage,\r\n          techBase: unitState.techBase,\r\n        };\r\n        \r\n        set((state) => ({\r\n          tabs: [...state.tabs, tabInfo],\r\n          activeTabId: unitState.id,\r\n          isNewTabModalOpen: false,\r\n        }));\r\n        \r\n        return unitState.id;\r\n      },\r\n      \r\n      duplicateTab: (tabId) => {\r\n        const store = duplicateUnit(tabId);\r\n        if (!store) return null;\r\n        \r\n        const unitState = store.getState();\r\n        const tabInfo: TabInfo = {\r\n          id: unitState.id,\r\n          name: unitState.name,\r\n          tonnage: unitState.tonnage,\r\n          techBase: unitState.techBase,\r\n        };\r\n        \r\n        set((state) => ({\r\n          tabs: [...state.tabs, tabInfo],\r\n          activeTabId: unitState.id,\r\n        }));\r\n        \r\n        return unitState.id;\r\n      },\r\n      \r\n      closeTab: (tabId) => {\r\n        set((state) => {\r\n          const tabIndex = state.tabs.findIndex((t) => t.id === tabId);\r\n          if (tabIndex === -1) return state;\r\n          \r\n          // Remove from registry (but keep localStorage for now)\r\n          // deleteUnit(tabId); // Uncomment to also delete localStorage\r\n          \r\n          const newTabs = state.tabs.filter((t) => t.id !== tabId);\r\n          \r\n          // Select adjacent tab if closing active tab, or null if no tabs left\r\n          let newActiveId = state.activeTabId;\r\n          if (state.activeTabId === tabId) {\r\n            if (newTabs.length === 0) {\r\n              newActiveId = null;\r\n            } else {\r\n              const newIndex = Math.min(tabIndex, newTabs.length - 1);\r\n              newActiveId = newTabs[newIndex]?.id ?? null;\r\n            }\r\n          }\r\n          \r\n          return {\r\n            tabs: newTabs,\r\n            activeTabId: newActiveId,\r\n          };\r\n        });\r\n      },\r\n      \r\n      selectTab: (tabId) => {\r\n        // Ensure the unit store is hydrated when selecting\r\n        const state = get();\r\n        const tab = state.tabs.find((t) => t.id === tabId);\r\n        if (tab) {\r\n          hydrateOrCreateUnit(tabId, {\r\n            name: tab.name,\r\n            tonnage: tab.tonnage,\r\n            techBase: tab.techBase,\r\n          });\r\n        }\r\n        \r\n        set({ activeTabId: tabId });\r\n      },\r\n      \r\n      renameTab: (tabId, name) => {\r\n        // Update tab info\r\n        set((state) => ({\r\n          tabs: state.tabs.map((tab) =>\r\n            tab.id === tabId ? { ...tab, name } : tab\r\n          ),\r\n        }));\r\n        \r\n        // Also update unit store\r\n        const store = getUnitStore(tabId);\r\n        if (store) {\r\n          store.getState().setName(name);\r\n        }\r\n      },\r\n      \r\n      reorderTabs: (fromIndex, toIndex) => {\r\n        set((state) => {\r\n          const newTabs = [...state.tabs];\r\n          const [removed] = newTabs.splice(fromIndex, 1);\r\n          newTabs.splice(toIndex, 0, removed);\r\n          return { tabs: newTabs };\r\n        });\r\n      },\r\n      \r\n      addTab: (tabInfo) => {\r\n        // Get unit store to fill in missing info\r\n        const unitStore = getUnitStore(tabInfo.id);\r\n        const unitState = unitStore?.getState();\r\n        \r\n        const fullTabInfo: TabInfo = {\r\n          id: tabInfo.id,\r\n          name: tabInfo.name,\r\n          tonnage: tabInfo.tonnage ?? unitState?.tonnage ?? 50,\r\n          techBase: tabInfo.techBase ?? unitState?.techBase ?? TechBase.INNER_SPHERE,\r\n        };\r\n        \r\n        set((state) => ({\r\n          tabs: [...state.tabs, fullTabInfo],\r\n          activeTabId: tabInfo.id,\r\n        }));\r\n      },\r\n      \r\n      // =======================================================================\r\n      // Modal Actions\r\n      // =======================================================================\r\n      \r\n      openNewTabModal: () => set({ isNewTabModalOpen: true }),\r\n      closeNewTabModal: () => set({ isNewTabModalOpen: false }),\r\n      \r\n      // =======================================================================\r\n      // Helpers\r\n      // =======================================================================\r\n      \r\n      getActiveTab: () => {\r\n        const state = get();\r\n        // Defensive check for hydration race condition\r\n        if (!state.tabs || !Array.isArray(state.tabs)) {\r\n          return null;\r\n        }\r\n        return state.tabs.find((t) => t.id === state.activeTabId) ?? null;\r\n      },\r\n      \r\n      setLoading: (loading) => set({ isLoading: loading }),\r\n    }),\r\n    {\r\n      name: 'megamek-tab-manager',\r\n      storage: createJSONStorage(() => clientSafeStorage),\r\n      skipHydration: true, // Manually hydrate after client mount\r\n      partialize: (state) => ({\r\n        tabs: state.tabs,\r\n        activeTabId: state.activeTabId,\r\n      }),\r\n      onRehydrateStorage: () => (state, error) => {\r\n        if (error) {\r\n          console.error('[TabManager] Error during rehydration:', error);\r\n        }\r\n        \r\n        if (state) {\r\n          // Sanitize tabs to ensure all have valid UUIDs\r\n          const { tabs: sanitizedTabs, activeTabId: sanitizedActiveId, repaired } = \r\n            sanitizeTabsOnHydration(state.tabs, state.activeTabId);\r\n          \r\n          // If tabs were repaired, update the store state\r\n          if (repaired > 0) {\r\n            // Use internal setState to update without triggering persistence loop\r\n            useTabManagerStore.setState({\r\n              tabs: sanitizedTabs,\r\n              activeTabId: sanitizedActiveId,\r\n            });\r\n          }\r\n          \r\n          // Use sanitized values for hydration\r\n          const tabsToUse = repaired > 0 ? sanitizedTabs : state.tabs;\r\n          const activeIdToUse = repaired > 0 ? sanitizedActiveId : state.activeTabId;\r\n          \r\n          // Hydrate the active unit store if there is one\r\n          if (tabsToUse && Array.isArray(tabsToUse)) {\r\n            const activeTab = tabsToUse.find((t) => t.id === activeIdToUse);\r\n            if (activeTab) {\r\n              hydrateOrCreateUnit(activeTab.id, {\r\n                name: activeTab.name,\r\n                tonnage: activeTab.tonnage,\r\n                techBase: activeTab.techBase,\r\n              });\r\n            }\r\n          }\r\n          \r\n          state.setLoading(false);\r\n        }\r\n      },\r\n    }\r\n  )\r\n);\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\stores\\useUnitStore.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IMountedEquipmentInstance' is defined but never used.","line":49,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArmorTypeEnum' is defined but never used.","line":61,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getValidatedSelectionUpdates' is defined but never used.","line":64,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'JumpJetType' is defined but never used.","line":69,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getJumpJetDefinition' is defined but never used.","line":69,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HeatSinkType' is defined but never used.","line":70,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getHeatSinkDefinition' is defined but never used.","line":70,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EquipmentCategory' is defined but never used.","line":72,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'equipmentCalculatorService' is defined but never used.","line":73,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'VARIABLE_EQUIPMENT' is defined but never used.","line":73,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MovementEnhancementType' is defined but never used.","line":79,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'INTERNAL_STRUCTURE_EQUIPMENT_ID' is defined but never used.","line":85,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ARMOR_SLOTS_EQUIPMENT_ID' is defined but never used.","line":88,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HEAT_SINK_EQUIPMENT_IDS' is defined but never used.","line":91,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculateEnhancementWeight' is defined but never used.","line":94,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculateEnhancementSlots' is defined but never used.","line":95,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ENHANCEMENT_EQUIPMENT_IDS' is defined but never used.","line":96,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unit Store Factory\r\n * \r\n * Creates isolated Zustand stores for individual units.\r\n * Each unit has its own store instance with independent persistence.\r\n * \r\n * @spec openspec/specs/unit-store-architecture/spec.md\r\n */\r\n\r\nimport { create, StoreApi, useStore } from 'zustand';\r\nimport { persist, createJSONStorage, StateStorage } from 'zustand/middleware';\r\nimport { createContext, useContext } from 'react';\r\n\r\n// =============================================================================\r\n// Client-Safe Storage\r\n// =============================================================================\r\n\r\n/**\r\n * Storage wrapper that safely handles SSR (no localStorage on server)\r\n */\r\nconst clientSafeStorage: StateStorage = {\r\n  getItem: (name: string): string | null => {\r\n    if (typeof window === 'undefined') return null;\r\n    return localStorage.getItem(name);\r\n  },\r\n  setItem: (name: string, value: string): void => {\r\n    if (typeof window === 'undefined') return;\r\n    localStorage.setItem(name, value);\r\n  },\r\n  removeItem: (name: string): void => {\r\n    if (typeof window === 'undefined') return;\r\n    localStorage.removeItem(name);\r\n  },\r\n};\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport {\r\n  TechBaseMode,\r\n  TechBaseComponent,\r\n  createDefaultComponentTechBases,\r\n} from '@/types/construction/TechBaseConfiguration';\r\nimport {\r\n  UnitState,\r\n  UnitStore,\r\n  CreateUnitOptions,\r\n  createDefaultUnitState,\r\n  ISelectionMemory,\r\n  IArmorAllocation,\r\n  createEmptyArmorAllocation,\r\n  IMountedEquipmentInstance,\r\n  createMountedEquipment,\r\n} from './unitState';\r\nimport { IEquipmentItem } from '@/types/equipment';\r\nimport { generateUnitId } from '@/utils/uuid';\r\nimport { MechLocation } from '@/types/construction/CriticalSlotAllocation';\r\nimport {\r\n  calculateArmorPoints,\r\n  getMaxArmorForLocation,\r\n  getMaxTotalArmor,\r\n  calculateOptimalArmorAllocation,\r\n} from '@/utils/construction/armorCalculations';\r\nimport { ArmorTypeEnum, getArmorDefinition } from '@/types/construction/ArmorType';\r\nimport { ceilToHalfTon } from '@/utils/physical/weightUtils';\r\nimport {\r\n  getValidatedSelectionUpdates,\r\n  getFullyValidatedSelections,\r\n  getSelectionWithMemory,\r\n  ComponentSelections,\r\n} from '@/utils/techBaseValidation';\r\nimport { JumpJetType, getMaxJumpMP, getJumpJetDefinition } from '@/utils/construction/movementCalculations';\r\nimport { HeatSinkType, getHeatSinkDefinition } from '@/types/construction/HeatSinkType';\r\nimport { calculateIntegralHeatSinks, calculateEngineWeight } from '@/utils/construction/engineCalculations';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport { equipmentCalculatorService, VARIABLE_EQUIPMENT } from '@/services/equipment/EquipmentCalculatorService';\r\nimport {\r\n  getEquipmentDisplacedByEngineChange,\r\n  getEquipmentDisplacedByGyroChange,\r\n  applyDisplacement,\r\n} from '@/utils/construction/displacementUtils';\r\nimport { MovementEnhancementType } from '@/types/construction/MovementEnhancement';\r\nimport {\r\n  createJumpJetEquipmentList,\r\n  filterOutJumpJets,\r\n  createInternalStructureEquipmentList,\r\n  filterOutInternalStructure,\r\n  INTERNAL_STRUCTURE_EQUIPMENT_ID,\r\n  createArmorEquipmentList,\r\n  filterOutArmorSlots,\r\n  ARMOR_SLOTS_EQUIPMENT_ID,\r\n  createHeatSinkEquipmentList,\r\n  filterOutHeatSinks,\r\n  HEAT_SINK_EQUIPMENT_IDS,\r\n  createEnhancementEquipmentList,\r\n  filterOutEnhancementEquipment,\r\n  calculateEnhancementWeight,\r\n  calculateEnhancementSlots,\r\n  ENHANCEMENT_EQUIPMENT_IDS,\r\n} from '@/utils/equipment/equipmentListUtils';\r\n\r\n// Re-export UnitStore type for convenience\r\nexport type { UnitStore } from './unitState';\r\n\r\n// =============================================================================\r\n// Equipment List Helpers - Imported from utils/equipment/equipmentListUtils.ts\r\n// =============================================================================\r\n// The following functions are imported from the utilities file:\r\n// - createJumpJetEquipmentList, filterOutJumpJets\r\n// - createInternalStructureEquipmentList, filterOutInternalStructure\r\n// - createArmorEquipmentList, filterOutArmorSlots\r\n// - createHeatSinkEquipmentList, filterOutHeatSinks\r\n// - createEnhancementEquipmentList, filterOutEnhancementEquipment\r\n// - calculateEnhancementWeight, calculateEnhancementSlots\r\n// =============================================================================\r\n\r\n// =============================================================================\r\n// Store Factory\r\n// =============================================================================\r\n\r\n/**\r\n * Create an isolated Zustand store for a single unit\r\n * \r\n * Each unit gets its own store instance that:\r\n * - Contains only that unit's state\r\n * - Persists independently to localStorage\r\n * - Has a clean API without tabId parameters\r\n */\r\nexport function createUnitStore(initialState: UnitState): StoreApi<UnitStore> {\r\n  return create<UnitStore>()(\r\n    persist(\r\n      (set) => ({\r\n        // Spread initial state\r\n        ...initialState,\r\n        \r\n        // =================================================================\r\n        // Identity Actions\r\n        // =================================================================\r\n        \r\n        setName: (name) => set({\r\n          name,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        setChassis: (chassis) => set((state) => ({\r\n          chassis,\r\n          // Update derived name\r\n          name: `${chassis}${state.model ? ' ' + state.model : ''}`,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        })),\r\n        \r\n        setClanName: (clanName) => set({\r\n          clanName,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        setModel: (model) => set((state) => ({\r\n          model,\r\n          // Update derived name\r\n          name: `${state.chassis}${model ? ' ' + model : ''}`,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        })),\r\n        \r\n        setMulId: (mulId) => set({\r\n          mulId,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        setYear: (year) => set({\r\n          year,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        setRulesLevel: (rulesLevel) => set({\r\n          rulesLevel,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        // =================================================================\r\n        // Chassis Actions\r\n        // =================================================================\r\n        \r\n        setTonnage: (tonnage) => set((state) => {\r\n          // Recalculate engine rating to maintain same Walk MP\r\n          const walkMP = Math.floor(state.engineRating / state.tonnage);\r\n          const newEngineRating = tonnage * walkMP;\r\n          // Clamp engine rating to valid range\r\n          const clampedRating = Math.max(10, Math.min(400, newEngineRating));\r\n          \r\n          // Re-sync enhancement equipment since MASC depends on tonnage, Supercharger on engine\r\n          const engineWeight = calculateEngineWeight(clampedRating, state.engineType);\r\n          \r\n          // Filter out equipment that needs to be recalculated based on tonnage\r\n          let updatedEquipment = filterOutEnhancementEquipment(state.equipment);\r\n          updatedEquipment = filterOutJumpJets(updatedEquipment);\r\n          \r\n          // Recreate enhancement equipment with new tonnage\r\n          const enhancementEquipment = createEnhancementEquipmentList(\r\n            state.enhancement,\r\n            tonnage,\r\n            state.techBase,\r\n            engineWeight\r\n          );\r\n          \r\n          // Recreate jump jet equipment with new tonnage (weight varies by tonnage class)\r\n          const jumpJetEquipment = createJumpJetEquipmentList(\r\n            tonnage,\r\n            state.jumpMP,\r\n            state.jumpJetType\r\n          );\r\n          \r\n          return {\r\n            tonnage,\r\n            engineRating: clampedRating,\r\n            equipment: [...updatedEquipment, ...enhancementEquipment, ...jumpJetEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setConfiguration: (configuration) => set({\r\n          configuration,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        setIsOmni: (isOmni) => set({\r\n          isOmni,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        // =================================================================\r\n        // Tech Base Actions\r\n        // =================================================================\r\n        \r\n        setTechBaseMode: (mode) => set((state) => {\r\n          // When switching to MIXED mode, preserve current techBase\r\n          // When switching to non-mixed mode, reset all components to match the new tech base\r\n          const newTechBase = mode === TechBaseMode.MIXED \r\n            ? state.techBase  // Preserve current techBase in MIXED mode\r\n            : (mode === TechBaseMode.CLAN ? TechBase.CLAN : TechBase.INNER_SPHERE);\r\n          const newComponentTechBases = mode === TechBaseMode.MIXED\r\n            ? state.componentTechBases\r\n            : createDefaultComponentTechBases(newTechBase);\r\n          \r\n          // Determine old tech base for saving to memory\r\n          const oldTechBase = state.techBaseMode === TechBaseMode.CLAN ? TechBase.CLAN : TechBase.INNER_SPHERE;\r\n          const memoryTechBase = mode === TechBaseMode.MIXED ? undefined : newTechBase;\r\n          \r\n          const currentSelections: ComponentSelections = {\r\n            engineType: state.engineType,\r\n            gyroType: state.gyroType,\r\n            internalStructureType: state.internalStructureType,\r\n            cockpitType: state.cockpitType,\r\n            heatSinkType: state.heatSinkType,\r\n            armorType: state.armorType,\r\n          };\r\n          \r\n          // Save current selections to memory for the OLD tech base (if not mixed)\r\n          let updatedMemory = { ...state.selectionMemory };\r\n          if (state.techBaseMode !== TechBaseMode.MIXED) {\r\n            updatedMemory = {\r\n              engine: { ...updatedMemory.engine, [oldTechBase]: state.engineType },\r\n              gyro: { ...updatedMemory.gyro, [oldTechBase]: state.gyroType },\r\n              structure: { ...updatedMemory.structure, [oldTechBase]: state.internalStructureType },\r\n              cockpit: { ...updatedMemory.cockpit, [oldTechBase]: state.cockpitType },\r\n              heatSink: { ...updatedMemory.heatSink, [oldTechBase]: state.heatSinkType },\r\n              armor: { ...updatedMemory.armor, [oldTechBase]: state.armorType },\r\n            };\r\n          }\r\n          \r\n          // Validate and update all component selections for the new tech bases\r\n          // Try to restore from memory if switching to a non-mixed mode\r\n          const validatedSelections = getFullyValidatedSelections(\r\n            newComponentTechBases,\r\n            currentSelections,\r\n            memoryTechBase ? updatedMemory : undefined,\r\n            memoryTechBase\r\n          );\r\n          \r\n          // Re-sync enhancement equipment since MASC calculation differs by tech base\r\n          const engineWeight = calculateEngineWeight(state.engineRating, validatedSelections.engineType ?? state.engineType);\r\n          const nonEnhancementEquipment = filterOutEnhancementEquipment(state.equipment);\r\n          const enhancementEquipment = createEnhancementEquipmentList(\r\n            state.enhancement,\r\n            state.tonnage,\r\n            newTechBase,\r\n            engineWeight\r\n          );\r\n          \r\n          return {\r\n            techBaseMode: mode,\r\n            techBase: newTechBase,\r\n            componentTechBases: newComponentTechBases,\r\n            selectionMemory: updatedMemory,\r\n            ...validatedSelections,\r\n            equipment: [...nonEnhancementEquipment, ...enhancementEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setComponentTechBase: (component, techBase) => set((state) => {\r\n          const oldTechBase = state.componentTechBases[component];\r\n          \r\n          const currentSelections: ComponentSelections = {\r\n            engineType: state.engineType,\r\n            gyroType: state.gyroType,\r\n            internalStructureType: state.internalStructureType,\r\n            cockpitType: state.cockpitType,\r\n            heatSinkType: state.heatSinkType,\r\n            armorType: state.armorType,\r\n          };\r\n          \r\n          // Save current selections to memory for the OLD tech base\r\n          const updatedMemory: ISelectionMemory = {\r\n            ...state.selectionMemory,\r\n          };\r\n          \r\n          // Map component to memory key and save current value using TechBase enum\r\n          if (component === TechBaseComponent.ENGINE) {\r\n            updatedMemory.engine = { ...updatedMemory.engine, [oldTechBase]: state.engineType };\r\n          } else if (component === TechBaseComponent.GYRO) {\r\n            updatedMemory.gyro = { ...updatedMemory.gyro, [oldTechBase]: state.gyroType };\r\n          } else if (component === TechBaseComponent.CHASSIS) {\r\n            updatedMemory.structure = { ...updatedMemory.structure, [oldTechBase]: state.internalStructureType };\r\n            updatedMemory.cockpit = { ...updatedMemory.cockpit, [oldTechBase]: state.cockpitType };\r\n          } else if (component === TechBaseComponent.HEATSINK) {\r\n            updatedMemory.heatSink = { ...updatedMemory.heatSink, [oldTechBase]: state.heatSinkType };\r\n          } else if (component === TechBaseComponent.ARMOR) {\r\n            updatedMemory.armor = { ...updatedMemory.armor, [oldTechBase]: state.armorType };\r\n          }\r\n          \r\n          // Get validated selection updates, using memory if available\r\n          const selectionUpdates = getSelectionWithMemory(\r\n            component as TechBaseComponent,\r\n            techBase,\r\n            currentSelections,\r\n            updatedMemory\r\n          );\r\n          \r\n          // Sync equipment if heat sink type changed\r\n          let updatedEquipment = state.equipment;\r\n          if (selectionUpdates.heatSinkType && selectionUpdates.heatSinkType !== state.heatSinkType) {\r\n            const integralHeatSinks = calculateIntegralHeatSinks(state.engineRating, state.engineType);\r\n            const externalHeatSinks = Math.max(0, state.heatSinkCount - integralHeatSinks);\r\n            const nonHeatSinkEquipment = filterOutHeatSinks(updatedEquipment);\r\n            const heatSinkEquipment = createHeatSinkEquipmentList(selectionUpdates.heatSinkType, externalHeatSinks);\r\n            updatedEquipment = [...nonHeatSinkEquipment, ...heatSinkEquipment];\r\n          }\r\n          \r\n          // Sync enhancement equipment if MYOMER or MOVEMENT tech base changed\r\n          // This ensures MASC uses correct IS/Clan variant based on tech base\r\n          if ((component === TechBaseComponent.MYOMER || component === TechBaseComponent.MOVEMENT) && \r\n              state.enhancement && oldTechBase !== techBase) {\r\n            const engineWeight = calculateEngineWeight(state.engineRating, state.engineType);\r\n            const nonEnhancementEquipment = filterOutEnhancementEquipment(updatedEquipment);\r\n            const enhancementEquipment = createEnhancementEquipmentList(\r\n              state.enhancement,\r\n              state.tonnage,\r\n              techBase,\r\n              engineWeight\r\n            );\r\n            updatedEquipment = [...nonEnhancementEquipment, ...enhancementEquipment];\r\n          }\r\n          \r\n          return {\r\n            componentTechBases: {\r\n              ...state.componentTechBases,\r\n              [component]: techBase,\r\n            },\r\n            selectionMemory: updatedMemory,\r\n            ...selectionUpdates,\r\n            equipment: updatedEquipment,\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setAllComponentTechBases: (techBases) => set({\r\n          componentTechBases: techBases,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        // =================================================================\r\n        // Component Actions\r\n        // =================================================================\r\n        \r\n        setEngineType: (type) => set((state) => {\r\n          // Find equipment displaced by new engine's slot requirements\r\n          const displaced = getEquipmentDisplacedByEngineChange(\r\n            state.equipment,\r\n            state.engineType,\r\n            type,\r\n            state.gyroType\r\n          );\r\n          \r\n          // Unallocate displaced equipment\r\n          let updatedEquipment = applyDisplacement(\r\n            state.equipment,\r\n            displaced.displacedEquipmentIds\r\n          );\r\n          \r\n          // Re-sync heat sink equipment since integral capacity may have changed\r\n          const integralHeatSinks = calculateIntegralHeatSinks(state.engineRating, type);\r\n          const externalHeatSinks = Math.max(0, state.heatSinkCount - integralHeatSinks);\r\n          const nonHeatSinkEquipment = filterOutHeatSinks(updatedEquipment);\r\n          const heatSinkEquipment = createHeatSinkEquipmentList(state.heatSinkType, externalHeatSinks);\r\n          updatedEquipment = [...nonHeatSinkEquipment, ...heatSinkEquipment];\r\n          \r\n          // Re-sync enhancement equipment since Supercharger depends on engine weight\r\n          const engineWeight = calculateEngineWeight(state.engineRating, type);\r\n          const nonEnhancementEquipment = filterOutEnhancementEquipment(updatedEquipment);\r\n          const enhancementEquipment = createEnhancementEquipmentList(\r\n            state.enhancement,\r\n            state.tonnage,\r\n            state.techBase,\r\n            engineWeight\r\n          );\r\n          updatedEquipment = [...nonEnhancementEquipment, ...enhancementEquipment];\r\n          \r\n          return {\r\n            engineType: type,\r\n            equipment: updatedEquipment,\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setEngineRating: (rating) => set((state) => {\r\n          // Re-sync heat sink equipment since integral capacity changes with rating\r\n          const integralHeatSinks = calculateIntegralHeatSinks(rating, state.engineType);\r\n          const externalHeatSinks = Math.max(0, state.heatSinkCount - integralHeatSinks);\r\n          const nonHeatSinkEquipment = filterOutHeatSinks(state.equipment);\r\n          const heatSinkEquipment = createHeatSinkEquipmentList(state.heatSinkType, externalHeatSinks);\r\n          \r\n          // Re-sync enhancement equipment since Supercharger depends on engine weight\r\n          const engineWeight = calculateEngineWeight(rating, state.engineType);\r\n          const nonEnhancementEquipment = filterOutEnhancementEquipment([...nonHeatSinkEquipment, ...heatSinkEquipment]);\r\n          const enhancementEquipment = createEnhancementEquipmentList(\r\n            state.enhancement,\r\n            state.tonnage,\r\n            state.techBase,\r\n            engineWeight\r\n          );\r\n          \r\n          return {\r\n            engineRating: rating,\r\n            equipment: [...nonEnhancementEquipment, ...enhancementEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setGyroType: (type) => set((state) => {\r\n          // Find equipment displaced by new gyro's slot requirements\r\n          const displaced = getEquipmentDisplacedByGyroChange(\r\n            state.equipment,\r\n            state.engineType,\r\n            state.gyroType,\r\n            type\r\n          );\r\n          \r\n          // Unallocate displaced equipment\r\n          const updatedEquipment = applyDisplacement(\r\n            state.equipment,\r\n            displaced.displacedEquipmentIds\r\n          );\r\n          \r\n          return {\r\n            gyroType: type,\r\n            equipment: updatedEquipment,\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setInternalStructureType: (type) => set((state) => {\r\n          // Sync equipment - remove old structure equipment, add new ones\r\n          const nonStructureEquipment = filterOutInternalStructure(state.equipment);\r\n          const structureEquipment = createInternalStructureEquipmentList(type);\r\n          \r\n          return {\r\n            internalStructureType: type,\r\n            equipment: [...nonStructureEquipment, ...structureEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setCockpitType: (type) => set({\r\n          cockpitType: type,\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        setHeatSinkType: (type) => set((state) => {\r\n          // Calculate external heat sinks based on engine capacity\r\n          const integralHeatSinks = calculateIntegralHeatSinks(state.engineRating, state.engineType);\r\n          const externalHeatSinks = Math.max(0, state.heatSinkCount - integralHeatSinks);\r\n          \r\n          // Sync equipment - remove old heat sinks, add new ones with new type\r\n          const nonHeatSinkEquipment = filterOutHeatSinks(state.equipment);\r\n          const heatSinkEquipment = createHeatSinkEquipmentList(type, externalHeatSinks);\r\n          \r\n          return {\r\n            heatSinkType: type,\r\n            equipment: [...nonHeatSinkEquipment, ...heatSinkEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setHeatSinkCount: (count) => set((state) => {\r\n          // Calculate external heat sinks based on engine capacity\r\n          const integralHeatSinks = calculateIntegralHeatSinks(state.engineRating, state.engineType);\r\n          const externalHeatSinks = Math.max(0, count - integralHeatSinks);\r\n          \r\n          // Sync equipment - remove old heat sinks, add new ones with updated count\r\n          const nonHeatSinkEquipment = filterOutHeatSinks(state.equipment);\r\n          const heatSinkEquipment = createHeatSinkEquipmentList(state.heatSinkType, externalHeatSinks);\r\n          \r\n          return {\r\n            heatSinkCount: count,\r\n            equipment: [...nonHeatSinkEquipment, ...heatSinkEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setArmorType: (type) => set((state) => {\r\n          // Sync equipment - remove old armor slot equipment, add new ones\r\n          const nonArmorEquipment = filterOutArmorSlots(state.equipment);\r\n          const armorEquipment = createArmorEquipmentList(type);\r\n          \r\n          return {\r\n            armorType: type,\r\n            equipment: [...nonArmorEquipment, ...armorEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setEnhancement: (enhancement) => set((state) => {\r\n          // Sync equipment - remove old enhancement equipment, add new ones\r\n          const nonEnhancementEquipment = filterOutEnhancementEquipment(state.equipment);\r\n          const engineWeight = calculateEngineWeight(state.engineRating, state.engineType);\r\n          const enhancementEquipment = createEnhancementEquipmentList(\r\n            enhancement,\r\n            state.tonnage,\r\n            state.techBase,\r\n            engineWeight\r\n          );\r\n          \r\n          return {\r\n            enhancement,\r\n            equipment: [...nonEnhancementEquipment, ...enhancementEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setJumpMP: (jumpMP) => set((state) => {\r\n          // Calculate walk MP for validation\r\n          const walkMP = Math.floor(state.engineRating / state.tonnage);\r\n          const maxJump = getMaxJumpMP(walkMP, state.jumpJetType);\r\n          const clampedJumpMP = Math.max(0, Math.min(jumpMP, maxJump));\r\n          \r\n          // Sync equipment - remove old jump jets, add new ones\r\n          const nonJumpEquipment = filterOutJumpJets(state.equipment);\r\n          const jumpJetEquipment = createJumpJetEquipmentList(state.tonnage, clampedJumpMP, state.jumpJetType);\r\n          \r\n          return {\r\n            jumpMP: clampedJumpMP,\r\n            equipment: [...nonJumpEquipment, ...jumpJetEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        setJumpJetType: (jumpJetType) => set((state) => {\r\n          // Calculate walk MP for validation\r\n          const walkMP = Math.floor(state.engineRating / state.tonnage);\r\n          const maxJump = getMaxJumpMP(walkMP, jumpJetType);\r\n          \r\n          // Clamp current jump MP to new max if needed\r\n          const clampedJumpMP = Math.min(state.jumpMP, maxJump);\r\n          \r\n          // Sync equipment with new jet type\r\n          const nonJumpEquipment = filterOutJumpJets(state.equipment);\r\n          const jumpJetEquipment = createJumpJetEquipmentList(state.tonnage, clampedJumpMP, jumpJetType);\r\n          \r\n          return {\r\n            jumpJetType,\r\n            jumpMP: clampedJumpMP,\r\n            equipment: [...nonJumpEquipment, ...jumpJetEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        // =================================================================\r\n        // Armor Allocation Actions\r\n        // =================================================================\r\n        \r\n        setArmorTonnage: (tonnage) => set({\r\n          armorTonnage: Math.max(0, tonnage),\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        setLocationArmor: (location, front, rear) => set((state) => {\r\n          const newAllocation = { ...state.armorAllocation };\r\n          const maxArmor = getMaxArmorForLocation(state.tonnage, location);\r\n          \r\n          // Clamp front armor to valid range\r\n          const clampedFront = Math.max(0, Math.min(front, maxArmor));\r\n          newAllocation[location] = clampedFront;\r\n          \r\n          // Handle rear armor for torso locations\r\n          if (rear !== undefined) {\r\n            // Front + rear cannot exceed location max\r\n            const maxRear = maxArmor - clampedFront;\r\n            const clampedRear = Math.max(0, Math.min(rear, maxRear));\r\n            \r\n            switch (location) {\r\n              case MechLocation.CENTER_TORSO:\r\n                newAllocation.centerTorsoRear = clampedRear;\r\n                break;\r\n              case MechLocation.LEFT_TORSO:\r\n                newAllocation.leftTorsoRear = clampedRear;\r\n                break;\r\n              case MechLocation.RIGHT_TORSO:\r\n                newAllocation.rightTorsoRear = clampedRear;\r\n                break;\r\n            }\r\n          }\r\n          \r\n          return {\r\n            armorAllocation: newAllocation,\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        autoAllocateArmor: () => set((state) => {\r\n          const availablePoints = calculateArmorPoints(state.armorTonnage, state.armorType);\r\n          \r\n          // Use the optimal allocation algorithm\r\n          // Priority: 1) Max head, 2) Weighted distribution, 3) Even remainder distribution\r\n          const allocation = calculateOptimalArmorAllocation(availablePoints, state.tonnage);\r\n          \r\n          const newAllocation: IArmorAllocation = {\r\n            [MechLocation.HEAD]: allocation.head,\r\n            [MechLocation.CENTER_TORSO]: allocation.centerTorsoFront,\r\n            centerTorsoRear: allocation.centerTorsoRear,\r\n            [MechLocation.LEFT_TORSO]: allocation.leftTorsoFront,\r\n            leftTorsoRear: allocation.leftTorsoRear,\r\n            [MechLocation.RIGHT_TORSO]: allocation.rightTorsoFront,\r\n            rightTorsoRear: allocation.rightTorsoRear,\r\n            [MechLocation.LEFT_ARM]: allocation.leftArm,\r\n            [MechLocation.RIGHT_ARM]: allocation.rightArm,\r\n            [MechLocation.LEFT_LEG]: allocation.leftLeg,\r\n            [MechLocation.RIGHT_LEG]: allocation.rightLeg,\r\n          };\r\n          \r\n          return {\r\n            armorAllocation: newAllocation,\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        maximizeArmor: () => set((state) => {\r\n          // Calculate max armor points needed for the mech\r\n          const maxTotalArmor = getMaxTotalArmor(state.tonnage);\r\n          const armorDef = getArmorDefinition(state.armorType);\r\n          const pointsPerTon = armorDef?.pointsPerTon ?? 16;\r\n          \r\n          // Calculate tonnage needed for max armor\r\n          const tonnageNeeded = ceilToHalfTon(maxTotalArmor / pointsPerTon);\r\n          \r\n          return {\r\n            armorTonnage: tonnageNeeded,\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          };\r\n        }),\r\n        \r\n        clearAllArmor: () => set({\r\n          armorAllocation: createEmptyArmorAllocation(),\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        // =================================================================\r\n        // Equipment Actions\r\n        // =================================================================\r\n        \r\n        addEquipment: (item: IEquipmentItem) => {\r\n          const instanceId = generateUnitId();\r\n          const mountedEquipment = createMountedEquipment(item, instanceId);\r\n          \r\n          set((state) => ({\r\n            equipment: [...state.equipment, mountedEquipment],\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          }));\r\n          \r\n          return instanceId;\r\n        },\r\n        \r\n        removeEquipment: (instanceId: string) => set((state) => ({\r\n          equipment: state.equipment.filter(e => e.instanceId !== instanceId),\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        })),\r\n        \r\n        updateEquipmentLocation: (instanceId: string, location: MechLocation, slots: readonly number[]) => \r\n          set((state) => ({\r\n            equipment: state.equipment.map(e => \r\n              e.instanceId === instanceId\r\n                ? { ...e, location, slots }\r\n                : e\r\n            ),\r\n            isModified: true,\r\n            lastModifiedAt: Date.now(),\r\n          })),\r\n        \r\n        bulkUpdateEquipmentLocations: (updates: ReadonlyArray<{ instanceId: string; location: MechLocation; slots: readonly number[] }>) =>\r\n          set((state) => {\r\n            // Create a map for O(1) lookup\r\n            const updateMap = new Map(updates.map(u => [u.instanceId, u]));\r\n            return {\r\n              equipment: state.equipment.map(e => {\r\n                const update = updateMap.get(e.instanceId);\r\n                return update\r\n                  ? { ...e, location: update.location, slots: update.slots }\r\n                  : e;\r\n              }),\r\n              isModified: true,\r\n              lastModifiedAt: Date.now(),\r\n            };\r\n          }),\r\n        \r\n        clearEquipmentLocation: (instanceId: string) => set((state) => ({\r\n          equipment: state.equipment.map(e => \r\n            e.instanceId === instanceId\r\n              ? { ...e, location: undefined, slots: undefined }\r\n              : e\r\n          ),\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        })),\r\n        \r\n        setEquipmentRearMounted: (instanceId: string, isRearMounted: boolean) => set((state) => ({\r\n          equipment: state.equipment.map(e => \r\n            e.instanceId === instanceId\r\n              ? { ...e, isRearMounted }\r\n              : e\r\n          ),\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        })),\r\n        \r\n        linkAmmo: (weaponInstanceId: string, ammoInstanceId: string | undefined) => set((state) => ({\r\n          equipment: state.equipment.map(e => \r\n            e.instanceId === weaponInstanceId\r\n              ? { ...e, linkedAmmoId: ammoInstanceId }\r\n              : e\r\n          ),\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        })),\r\n        \r\n        clearAllEquipment: () => set({\r\n          equipment: [],\r\n          isModified: true,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n        \r\n        // =================================================================\r\n        // Metadata Actions\r\n        // =================================================================\r\n        \r\n        markModified: (modified = true) => set({\r\n          isModified: modified,\r\n          lastModifiedAt: Date.now(),\r\n        }),\r\n      }),\r\n      {\r\n        name: `megamek-unit-${initialState.id}`,\r\n        storage: createJSONStorage(() => clientSafeStorage),\r\n        skipHydration: true, // We manually hydrate after client mount\r\n        // Only persist state, not actions\r\n        partialize: (state) => ({\r\n          id: state.id,\r\n          name: state.name,\r\n          chassis: state.chassis,\r\n          clanName: state.clanName,\r\n          model: state.model,\r\n          mulId: state.mulId,\r\n          year: state.year,\r\n          rulesLevel: state.rulesLevel,\r\n          tonnage: state.tonnage,\r\n          techBase: state.techBase,\r\n          unitType: state.unitType,\r\n          configuration: state.configuration,\r\n          isOmni: state.isOmni,\r\n          techBaseMode: state.techBaseMode,\r\n          componentTechBases: state.componentTechBases,\r\n          selectionMemory: state.selectionMemory,\r\n          engineType: state.engineType,\r\n          engineRating: state.engineRating,\r\n          gyroType: state.gyroType,\r\n          internalStructureType: state.internalStructureType,\r\n          cockpitType: state.cockpitType,\r\n          heatSinkType: state.heatSinkType,\r\n          heatSinkCount: state.heatSinkCount,\r\n          armorType: state.armorType,\r\n          armorTonnage: state.armorTonnage,\r\n          armorAllocation: state.armorAllocation,\r\n          enhancement: state.enhancement,\r\n          jumpMP: state.jumpMP,\r\n          jumpJetType: state.jumpJetType,\r\n          equipment: state.equipment,\r\n          isModified: state.isModified,\r\n          createdAt: state.createdAt,\r\n          lastModifiedAt: state.lastModifiedAt,\r\n        }),\r\n      }\r\n    )\r\n  );\r\n}\r\n\r\n/**\r\n * Create a new unit store from options\r\n */\r\nexport function createNewUnitStore(options: CreateUnitOptions): StoreApi<UnitStore> {\r\n  const initialState = createDefaultUnitState(options);\r\n  return createUnitStore(initialState);\r\n}\r\n\r\n// =============================================================================\r\n// React Context\r\n// =============================================================================\r\n\r\n/**\r\n * Context for providing the active unit's store\r\n */\r\nexport const UnitStoreContext = createContext<StoreApi<UnitStore> | null>(null);\r\n\r\n/**\r\n * Hook to access the unit store from context\r\n * \r\n * This is the primary way components access unit state.\r\n * No tabId is needed - the context provides the active unit's store.\r\n * \r\n * @example\r\n * const engineType = useUnitStore((s) => s.engineType);\r\n * const setEngineType = useUnitStore((s) => s.setEngineType);\r\n */\r\nexport function useUnitStore<T>(selector: (state: UnitStore) => T): T {\r\n  const store = useContext(UnitStoreContext);\r\n  \r\n  if (!store) {\r\n    throw new Error(\r\n      'useUnitStore must be used within a UnitStoreProvider. ' +\r\n      'Wrap your component tree with <UnitStoreProvider>.'\r\n    );\r\n  }\r\n  \r\n  return useStore(store, selector);\r\n}\r\n\r\n/**\r\n * Hook to get the entire unit store API\r\n * Useful when you need direct access to the store\r\n */\r\nexport function useUnitStoreApi(): StoreApi<UnitStore> {\r\n  const store = useContext(UnitStoreContext);\r\n  \r\n  if (!store) {\r\n    throw new Error(\r\n      'useUnitStoreApi must be used within a UnitStoreProvider.'\r\n    );\r\n  }\r\n  \r\n  return store;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\ArmorType.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\CockpitType.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\ComponentInterfaces.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\CriticalSlotAllocation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\EngineType.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\GyroType.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\HeatSinkType.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\InternalStructureType.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\MovementEnhancement.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\TechBaseConfiguration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\construction\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\ComponentDatabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\ComponentInterfaces.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\EquipmentInterfaces.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\IDocumentedEntity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\IEntity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\IPlaceableComponent.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\ISlottedComponent.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\ITechBaseEntity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\ITemporalEntity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\IValuedComponent.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\IWeightedComponent.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\UnitInterfaces.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\core\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\enums\\Era.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\enums\\RulesLevel.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\enums\\TechBase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\enums\\WeightClass.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\enums\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\AmmunitionTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\ArtilleryTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\ElectronicsTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\EquipmentPlacement.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasHandActuator' is defined but never used. Allowed unused args must match /^_/u.","line":301,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":301,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Equipment Placement Rules\r\n * \r\n * Defines location restrictions and placement rules for equipment.\r\n * \r\n * @spec openspec/specs/equipment-placement/spec.md\r\n */\r\n\r\nimport { MechLocation } from '../construction/CriticalSlotAllocation';\r\nimport { WeaponCategory } from './weapons';\r\n\r\n/**\r\n * Location restriction types\r\n */\r\nexport enum LocationRestriction {\r\n  NONE = 'None',                    // Can be placed anywhere\r\n  ARM_ONLY = 'Arm Only',            // Arms only\r\n  TORSO_ONLY = 'Torso Only',        // CT, LT, RT only\r\n  LEG_ONLY = 'Leg Only',            // Legs only\r\n  HEAD_ONLY = 'Head Only',          // Head only\r\n  NOT_HEAD = 'Not Head',            // Anywhere except head\r\n  NOT_LEGS = 'Not Legs',            // Anywhere except legs\r\n  NOT_ARMS = 'Not Arms',            // Anywhere except arms\r\n  CENTER_TORSO = 'Center Torso',    // CT only\r\n  SIDE_TORSO = 'Side Torso',        // LT or RT only\r\n  TORSO_OR_LEG = 'Torso or Leg',    // CT, LT, RT, LL, RL (for jump jets)\r\n  FRONT_ONLY = 'Front Only',        // Front-facing locations\r\n}\r\n\r\n/**\r\n * Equipment placement rule\r\n */\r\nexport interface EquipmentPlacementRule {\r\n  readonly equipmentId: string;\r\n  readonly restriction: LocationRestriction;\r\n  readonly mustBeContiguous: boolean;\r\n  readonly canSplit: boolean;\r\n  readonly maxPerLocation: number;\r\n  readonly requiredLocations?: MechLocation[];\r\n  readonly forbiddenLocations?: MechLocation[];\r\n}\r\n\r\n/**\r\n * Standard placement rules\r\n */\r\nexport const PLACEMENT_RULES: readonly EquipmentPlacementRule[] = [\r\n  // ECM must be in torso\r\n  {\r\n    equipmentId: 'guardian-ecm',\r\n    restriction: LocationRestriction.TORSO_ONLY,\r\n    mustBeContiguous: true,\r\n    canSplit: false,\r\n    maxPerLocation: 1,\r\n  },\r\n  // C3 Master can't be in head\r\n  {\r\n    equipmentId: 'c3-master',\r\n    restriction: LocationRestriction.NOT_HEAD,\r\n    mustBeContiguous: true,\r\n    canSplit: false,\r\n    maxPerLocation: 1,\r\n  },\r\n  // Beagle must be in torso\r\n  {\r\n    equipmentId: 'beagle-probe',\r\n    restriction: LocationRestriction.TORSO_ONLY,\r\n    mustBeContiguous: true,\r\n    canSplit: false,\r\n    maxPerLocation: 1,\r\n  },\r\n  // CASE goes in torso with ammo\r\n  {\r\n    equipmentId: 'case',\r\n    restriction: LocationRestriction.SIDE_TORSO,\r\n    mustBeContiguous: false,\r\n    canSplit: false,\r\n    maxPerLocation: 1,\r\n  },\r\n  // Jump Jets - can only go in torsos and legs\r\n  {\r\n    equipmentId: 'jump-jet-light',\r\n    restriction: LocationRestriction.TORSO_OR_LEG,\r\n    mustBeContiguous: false,\r\n    canSplit: false,\r\n    maxPerLocation: 6,\r\n  },\r\n  {\r\n    equipmentId: 'jump-jet-medium',\r\n    restriction: LocationRestriction.TORSO_OR_LEG,\r\n    mustBeContiguous: false,\r\n    canSplit: false,\r\n    maxPerLocation: 6,\r\n  },\r\n  {\r\n    equipmentId: 'jump-jet-heavy',\r\n    restriction: LocationRestriction.TORSO_OR_LEG,\r\n    mustBeContiguous: false,\r\n    canSplit: false,\r\n    maxPerLocation: 6,\r\n  },\r\n  {\r\n    equipmentId: 'improved-jump-jet-light',\r\n    restriction: LocationRestriction.TORSO_OR_LEG,\r\n    mustBeContiguous: false,\r\n    canSplit: false,\r\n    maxPerLocation: 3, // 2 slots each\r\n  },\r\n  {\r\n    equipmentId: 'improved-jump-jet-medium',\r\n    restriction: LocationRestriction.TORSO_OR_LEG,\r\n    mustBeContiguous: false,\r\n    canSplit: false,\r\n    maxPerLocation: 3,\r\n  },\r\n  {\r\n    equipmentId: 'improved-jump-jet-heavy',\r\n    restriction: LocationRestriction.TORSO_OR_LEG,\r\n    mustBeContiguous: false,\r\n    canSplit: false,\r\n    maxPerLocation: 3,\r\n  },\r\n] as const;\r\n\r\n/**\r\n * Get placement rule for equipment\r\n */\r\nexport function getPlacementRule(equipmentId: string): EquipmentPlacementRule | undefined {\r\n  return PLACEMENT_RULES.find(r => r.equipmentId === equipmentId);\r\n}\r\n\r\n/**\r\n * Check if location is valid for equipment\r\n */\r\nexport function isValidLocationForEquipment(\r\n  equipmentId: string,\r\n  location: MechLocation,\r\n  restriction?: LocationRestriction\r\n): boolean {\r\n  const rule = getPlacementRule(equipmentId);\r\n  \r\n  // Check forbiddenLocations first\r\n  if (rule?.forbiddenLocations?.includes(location)) {\r\n    return false;\r\n  }\r\n  \r\n  const actualRestriction = restriction ?? rule?.restriction ?? LocationRestriction.NONE;\r\n  \r\n  switch (actualRestriction) {\r\n    case LocationRestriction.NONE:\r\n      return true;\r\n      \r\n    case LocationRestriction.ARM_ONLY:\r\n      return location === MechLocation.LEFT_ARM || location === MechLocation.RIGHT_ARM;\r\n      \r\n    case LocationRestriction.TORSO_ONLY:\r\n      return [MechLocation.CENTER_TORSO, MechLocation.LEFT_TORSO, MechLocation.RIGHT_TORSO].includes(location);\r\n      \r\n    case LocationRestriction.LEG_ONLY:\r\n      return location === MechLocation.LEFT_LEG || location === MechLocation.RIGHT_LEG;\r\n      \r\n    case LocationRestriction.HEAD_ONLY:\r\n      return location === MechLocation.HEAD;\r\n      \r\n    case LocationRestriction.NOT_HEAD:\r\n      return location !== MechLocation.HEAD;\r\n      \r\n    case LocationRestriction.NOT_LEGS:\r\n      return location !== MechLocation.LEFT_LEG && location !== MechLocation.RIGHT_LEG;\r\n      \r\n    case LocationRestriction.NOT_ARMS:\r\n      return location !== MechLocation.LEFT_ARM && location !== MechLocation.RIGHT_ARM;\r\n      \r\n    case LocationRestriction.TORSO_OR_LEG:\r\n      return [\r\n        MechLocation.CENTER_TORSO,\r\n        MechLocation.LEFT_TORSO,\r\n        MechLocation.RIGHT_TORSO,\r\n        MechLocation.LEFT_LEG,\r\n        MechLocation.RIGHT_LEG,\r\n      ].includes(location);\r\n      \r\n    case LocationRestriction.CENTER_TORSO:\r\n      return location === MechLocation.CENTER_TORSO;\r\n      \r\n    case LocationRestriction.SIDE_TORSO:\r\n      return location === MechLocation.LEFT_TORSO || location === MechLocation.RIGHT_TORSO;\r\n      \r\n    case LocationRestriction.FRONT_ONLY:\r\n      // Arms and legs are \"front\" facing\r\n      return location !== MechLocation.CENTER_TORSO;\r\n      \r\n    default:\r\n      return true;\r\n  }\r\n}\r\n\r\n/**\r\n * Split equipment rules\r\n * Some equipment can be split across locations (like XL engine)\r\n */\r\nexport interface SplitEquipmentRule {\r\n  readonly equipmentId: string;\r\n  readonly totalSlots: number;\r\n  readonly canSplitAcross: MechLocation[];\r\n  readonly minimumSlotsPerLocation: number;\r\n  readonly maximumLocations: number;\r\n}\r\n\r\n/**\r\n * Standard split equipment rules\r\n */\r\nexport const SPLIT_EQUIPMENT_RULES: readonly SplitEquipmentRule[] = [\r\n  // Endo Steel (IS) - 14 slots, can go anywhere\r\n  {\r\n    equipmentId: 'endo-steel-is',\r\n    totalSlots: 14,\r\n    canSplitAcross: Object.values(MechLocation) as MechLocation[],\r\n    minimumSlotsPerLocation: 1,\r\n    maximumLocations: 8,\r\n  },\r\n  // Endo Steel (Clan) - 7 slots\r\n  {\r\n    equipmentId: 'endo-steel-clan',\r\n    totalSlots: 7,\r\n    canSplitAcross: Object.values(MechLocation) as MechLocation[],\r\n    minimumSlotsPerLocation: 1,\r\n    maximumLocations: 7,\r\n  },\r\n  // Ferro-Fibrous (IS) - 14 slots\r\n  {\r\n    equipmentId: 'ferro-fibrous-is',\r\n    totalSlots: 14,\r\n    canSplitAcross: Object.values(MechLocation) as MechLocation[],\r\n    minimumSlotsPerLocation: 1,\r\n    maximumLocations: 8,\r\n  },\r\n  // Ferro-Fibrous (Clan) - 7 slots\r\n  {\r\n    equipmentId: 'ferro-fibrous-clan',\r\n    totalSlots: 7,\r\n    canSplitAcross: Object.values(MechLocation) as MechLocation[],\r\n    minimumSlotsPerLocation: 1,\r\n    maximumLocations: 7,\r\n  },\r\n] as const;\r\n\r\n/**\r\n * Get split equipment rule\r\n */\r\nexport function getSplitEquipmentRule(equipmentId: string): SplitEquipmentRule | undefined {\r\n  return SPLIT_EQUIPMENT_RULES.find(r => r.equipmentId === equipmentId);\r\n}\r\n\r\n/**\r\n * Validate split equipment allocation\r\n */\r\nexport function validateSplitAllocation(\r\n  equipmentId: string,\r\n  allocation: Record<MechLocation, number>\r\n): { isValid: boolean; errors: string[] } {\r\n  const errors: string[] = [];\r\n  const rule = getSplitEquipmentRule(equipmentId);\r\n  \r\n  if (!rule) {\r\n    // Not a split equipment, use standard rules\r\n    return { isValid: true, errors };\r\n  }\r\n  \r\n  // Check total slots\r\n  const totalAllocated = Object.values(allocation).reduce((sum, slots) => sum + slots, 0);\r\n  if (totalAllocated !== rule.totalSlots) {\r\n    errors.push(`${equipmentId} requires exactly ${rule.totalSlots} slots (allocated ${totalAllocated})`);\r\n  }\r\n  \r\n  // Check valid locations\r\n  for (const [location, slots] of Object.entries(allocation)) {\r\n    if (slots > 0 && !rule.canSplitAcross.includes(location as MechLocation)) {\r\n      errors.push(`${equipmentId} cannot be placed in ${location}`);\r\n    }\r\n    if (slots > 0 && slots < rule.minimumSlotsPerLocation) {\r\n      errors.push(`${equipmentId} requires at least ${rule.minimumSlotsPerLocation} slots per location`);\r\n    }\r\n  }\r\n  \r\n  // Check number of locations used\r\n  const locationsUsed = Object.values(allocation).filter(slots => slots > 0).length;\r\n  if (locationsUsed > rule.maximumLocations) {\r\n    errors.push(`${equipmentId} can only span ${rule.maximumLocations} locations (using ${locationsUsed})`);\r\n  }\r\n  \r\n  return { isValid: errors.length === 0, errors };\r\n}\r\n\r\n/**\r\n * Arm-mounted weapon restrictions\r\n */\r\nexport function validateArmWeaponPlacement(\r\n  weaponCategory: WeaponCategory,\r\n  location: MechLocation,\r\n  hasLowerArmActuator: boolean,\r\n  hasHandActuator: boolean\r\n): { isValid: boolean; warnings: string[] } {\r\n  const warnings: string[] = [];\r\n  \r\n  // Only check for arm locations\r\n  if (location !== MechLocation.LEFT_ARM && location !== MechLocation.RIGHT_ARM) {\r\n    return { isValid: true, warnings };\r\n  }\r\n  \r\n  // Physical weapons have stricter requirements (handled in PhysicalWeaponTypes)\r\n  if (weaponCategory === WeaponCategory.PHYSICAL) {\r\n    // Let the physical weapon validation handle this\r\n    return { isValid: true, warnings };\r\n  }\r\n  \r\n  // Energy and ballistic weapons can flip when lower arm actuator removed\r\n  if (!hasLowerArmActuator) {\r\n    warnings.push('Arm can flip to rear arc without lower arm actuator');\r\n  }\r\n  \r\n  return { isValid: true, warnings };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\MiscEquipmentTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\PhysicalWeaponTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\VariableEquipment.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\weapons\\BallisticWeapons.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\weapons\\EnergyWeapons.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\weapons\\MissileWeapons.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\weapons\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\weapons\\interfaces.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\equipment\\weapons\\utilities.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\pages\\UnitPageTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\pages\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\persistence\\UnitPersistence.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\persistence\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\temporal\\Era.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\temporal\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\unit\\BattleMechInterfaces.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\unit\\DataIntegrity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\unit\\DatabaseSchema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\unit\\UnitSerialization.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\unit\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\validation\\BattleValue.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\validation\\CriticalHitSystem.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\validation\\DamageSystem.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\validation\\HeatManagement.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\validation\\TechRating.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\validation\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\validation\\rules\\ValidationRuleInterfaces.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\types\\validation\\rules\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\colors\\equipmentColors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\colors\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\colors\\slotColors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\colors\\statusColors.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":117,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":117,"endColumn":36},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":124,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":124,"endColumn":36},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":131,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":131,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Status and Interactive State Colors\r\n * \r\n * Colors for validation states, allocation status, and interactive feedback.\r\n * \r\n * @spec openspec/specs/color-system/spec.md\r\n */\r\n\r\n/**\r\n * Validation status types\r\n */\r\nexport type ValidationStatus = 'valid' | 'warning' | 'error' | 'info';\r\n\r\n/**\r\n * Allocation status types\r\n */\r\nexport type AllocationStatus = 'allocated' | 'unallocated' | 'partial';\r\n\r\n/**\r\n * Interactive state types\r\n */\r\nexport type InteractiveState = 'default' | 'hover' | 'selected' | 'dropValid' | 'dropInvalid' | 'disabled';\r\n\r\n/**\r\n * Validation status color definitions\r\n */\r\nexport const VALIDATION_COLORS: Record<ValidationStatus, { bg: string; text: string; border: string; icon: string }> = {\r\n  valid: {\r\n    bg: 'bg-green-900/50',\r\n    text: 'text-green-400',\r\n    border: 'border-green-600',\r\n    icon: '',\r\n  },\r\n  warning: {\r\n    bg: 'bg-yellow-900/50',\r\n    text: 'text-yellow-400',\r\n    border: 'border-yellow-600',\r\n    icon: '',\r\n  },\r\n  error: {\r\n    bg: 'bg-red-900/50',\r\n    text: 'text-red-400',\r\n    border: 'border-red-600',\r\n    icon: '',\r\n  },\r\n  info: {\r\n    bg: 'bg-blue-900/50',\r\n    text: 'text-blue-400',\r\n    border: 'border-blue-600',\r\n    icon: '',\r\n  },\r\n};\r\n\r\n/**\r\n * Allocation status color definitions\r\n */\r\nexport const ALLOCATION_COLORS: Record<AllocationStatus, { bg: string; text: string; badge: string }> = {\r\n  allocated: {\r\n    bg: 'bg-green-900/30',\r\n    text: 'text-green-400',\r\n    badge: 'bg-green-700 text-green-100',\r\n  },\r\n  unallocated: {\r\n    bg: 'bg-red-900/30',\r\n    text: 'text-red-400',\r\n    badge: 'bg-red-700 text-red-100',\r\n  },\r\n  partial: {\r\n    bg: 'bg-yellow-900/30',\r\n    text: 'text-yellow-400',\r\n    badge: 'bg-yellow-700 text-yellow-100',\r\n  },\r\n};\r\n\r\n/**\r\n * Interactive state color definitions\r\n */\r\nexport const INTERACTIVE_COLORS: Record<InteractiveState, { bg: string; border: string; ring?: string; cursor: string }> = {\r\n  default: {\r\n    bg: 'bg-slate-800',\r\n    border: 'border-slate-700',\r\n    cursor: 'cursor-pointer',\r\n  },\r\n  hover: {\r\n    bg: 'bg-slate-700',\r\n    border: 'border-slate-600',\r\n    cursor: 'cursor-pointer',\r\n  },\r\n  selected: {\r\n    bg: 'bg-blue-900/50',\r\n    border: 'border-blue-500',\r\n    ring: 'ring-2 ring-yellow-400 ring-offset-1 ring-offset-slate-900',\r\n    cursor: 'cursor-pointer',\r\n  },\r\n  dropValid: {\r\n    bg: 'bg-green-900/50',\r\n    border: 'border-green-500',\r\n    ring: 'ring-2 ring-green-400',\r\n    cursor: 'cursor-copy',\r\n  },\r\n  dropInvalid: {\r\n    bg: 'bg-red-900/50',\r\n    border: 'border-red-500',\r\n    ring: 'ring-2 ring-red-400',\r\n    cursor: 'cursor-not-allowed',\r\n  },\r\n  disabled: {\r\n    bg: 'bg-slate-900',\r\n    border: 'border-slate-800',\r\n    cursor: 'cursor-not-allowed',\r\n  },\r\n};\r\n\r\n/**\r\n * Get validation status colors\r\n */\r\nexport function getValidationColors(status: ValidationStatus) {\r\n  return VALIDATION_COLORS[status];\r\n}\r\n\r\n/**\r\n * Get allocation status colors\r\n */\r\nexport function getAllocationColors(status: AllocationStatus) {\r\n  return ALLOCATION_COLORS[status];\r\n}\r\n\r\n/**\r\n * Get interactive state colors\r\n */\r\nexport function getInteractiveColors(state: InteractiveState) {\r\n  return INTERACTIVE_COLORS[state];\r\n}\r\n\r\n/**\r\n * Build class string for a validation indicator\r\n */\r\nexport function getValidationIndicatorClasses(status: ValidationStatus): string {\r\n  const colors = getValidationColors(status);\r\n  return `${colors.bg} ${colors.text} ${colors.border} border rounded px-2 py-1`;\r\n}\r\n\r\n/**\r\n * Build class string for an allocation badge\r\n */\r\nexport function getAllocationBadgeClasses(status: AllocationStatus): string {\r\n  const colors = getAllocationColors(status);\r\n  return `${colors.badge} px-2 py-0.5 rounded text-xs font-medium`;\r\n}\r\n\r\n/**\r\n * Build class string for interactive elements\r\n */\r\nexport function getInteractiveClasses(state: InteractiveState): string {\r\n  const colors = getInteractiveColors(state);\r\n  let classes = `${colors.bg} ${colors.border} ${colors.cursor} border transition-colors`;\r\n  if (colors.ring) {\r\n    classes += ` ${colors.ring}`;\r\n  }\r\n  return classes;\r\n}\r\n\r\n/**\r\n * Armor diagram location colors\r\n */\r\nexport const ARMOR_LOCATION_COLORS = {\r\n  head: {\r\n    default: 'bg-green-600',\r\n    hover: 'bg-green-500',\r\n    selected: 'bg-blue-600',\r\n  },\r\n  torso: {\r\n    default: 'bg-amber-600',\r\n    hover: 'bg-amber-500',\r\n    selected: 'bg-blue-600',\r\n  },\r\n  rear: {\r\n    default: 'bg-amber-800',\r\n    hover: 'bg-amber-700',\r\n    selected: 'bg-blue-700',\r\n  },\r\n  limb: {\r\n    default: 'bg-amber-600',\r\n    hover: 'bg-amber-500',\r\n    selected: 'bg-blue-600',\r\n  },\r\n};\r\n\r\n/**\r\n * Get armor location color class\r\n */\r\nexport function getArmorLocationColorClass(\r\n  locationType: 'head' | 'torso' | 'rear' | 'limb',\r\n  state: 'default' | 'hover' | 'selected'\r\n): string {\r\n  return ARMOR_LOCATION_COLORS[locationType][state];\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\colors\\techBaseColors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\armorCalculations.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArmorDefinition' is defined but never used.","line":9,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Armor Calculations\r\n * \r\n * Functions for calculating armor allocation and limits.\r\n * \r\n * @spec openspec/specs/armor-system/spec.md\r\n */\r\n\r\nimport { ArmorTypeEnum, ArmorDefinition, getArmorDefinition } from '../../types/construction/ArmorType';\r\nimport { getStructurePoints } from '../../types/construction/InternalStructureType';\r\nimport { ceilToHalfTon } from '../physical/weightUtils';\r\n\r\n/**\r\n * Maximum armor points for head location\r\n */\r\nexport const MAX_HEAD_ARMOR = 9;\r\n\r\n/**\r\n * Calculate maximum armor for a location\r\n * \r\n * Max armor = 2  internal structure points (head = 9)\r\n * \r\n * @param tonnage - Unit tonnage\r\n * @param location - Location name\r\n * @returns Maximum armor points\r\n */\r\nexport function getMaxArmorForLocation(tonnage: number, location: string): number {\r\n  const normalizedLocation = location.toLowerCase();\r\n  \r\n  // Head is special - max 9\r\n  if (normalizedLocation.includes('head')) {\r\n    return MAX_HEAD_ARMOR;\r\n  }\r\n  \r\n  const structurePoints = getStructurePoints(tonnage, location);\r\n  return structurePoints * 2;\r\n}\r\n\r\n/**\r\n * Calculate maximum total armor points for a mech\r\n * \r\n * @param tonnage - Unit tonnage\r\n * @returns Maximum total armor points\r\n */\r\nexport function getMaxTotalArmor(tonnage: number): number {\r\n  return (\r\n    MAX_HEAD_ARMOR +\r\n    getMaxArmorForLocation(tonnage, 'centerTorso') +\r\n    getMaxArmorForLocation(tonnage, 'leftTorso') +\r\n    getMaxArmorForLocation(tonnage, 'rightTorso') +\r\n    getMaxArmorForLocation(tonnage, 'leftArm') +\r\n    getMaxArmorForLocation(tonnage, 'rightArm') +\r\n    getMaxArmorForLocation(tonnage, 'leftLeg') +\r\n    getMaxArmorForLocation(tonnage, 'rightLeg')\r\n  );\r\n}\r\n\r\n/**\r\n * Calculate armor weight from points and armor type\r\n * \r\n * @param armorPoints - Total armor points\r\n * @param armorType - Type of armor\r\n * @returns Armor weight in tons\r\n */\r\nexport function calculateArmorWeight(armorPoints: number, armorType: ArmorTypeEnum): number {\r\n  const definition = getArmorDefinition(armorType);\r\n  if (!definition) {\r\n    return ceilToHalfTon(armorPoints / 16); // Default to standard\r\n  }\r\n  \r\n  return ceilToHalfTon(armorPoints / definition.pointsPerTon);\r\n}\r\n\r\n/**\r\n * Calculate armor points from tonnage and armor type\r\n * \r\n * @param tonnage - Armor tonnage\r\n * @param armorType - Type of armor\r\n * @returns Armor points available\r\n */\r\nexport function calculateArmorPoints(tonnage: number, armorType: ArmorTypeEnum): number {\r\n  const definition = getArmorDefinition(armorType);\r\n  if (!definition) {\r\n    return Math.floor(tonnage * 16);\r\n  }\r\n  \r\n  return Math.floor(tonnage * definition.pointsPerTon);\r\n}\r\n\r\n/**\r\n * Calculate critical slots required for armor\r\n * \r\n * @param armorType - Type of armor\r\n * @returns Critical slots needed\r\n */\r\nexport function getArmorCriticalSlots(armorType: ArmorTypeEnum): number {\r\n  const definition = getArmorDefinition(armorType);\r\n  return definition?.criticalSlots ?? 0;\r\n}\r\n\r\n/**\r\n * Validate armor allocation for a location\r\n * \r\n * @param tonnage - Unit tonnage\r\n * @param location - Location name\r\n * @param front - Front armor points\r\n * @param rear - Rear armor points (for torsos)\r\n * @returns Validation result\r\n */\r\nexport function validateLocationArmor(\r\n  tonnage: number,\r\n  location: string,\r\n  front: number,\r\n  rear: number = 0\r\n): { isValid: boolean; errors: string[] } {\r\n  const errors: string[] = [];\r\n  const maxArmor = getMaxArmorForLocation(tonnage, location);\r\n  const total = front + rear;\r\n  \r\n  if (total > maxArmor) {\r\n    errors.push(`${location} armor (${total}) exceeds maximum (${maxArmor})`);\r\n  }\r\n  \r\n  if (front < 0) {\r\n    errors.push(`${location} front armor cannot be negative`);\r\n  }\r\n  \r\n  if (rear < 0) {\r\n    errors.push(`${location} rear armor cannot be negative`);\r\n  }\r\n  \r\n  // Rear armor rules\r\n  const normalizedLocation = location.toLowerCase();\r\n  if (normalizedLocation.includes('torso') && rear > 0) {\r\n    // Rear armor is allowed for torso locations\r\n  } else if (rear > 0) {\r\n    errors.push(`${location} does not support rear armor`);\r\n  }\r\n  \r\n  return { isValid: errors.length === 0, errors };\r\n}\r\n\r\n/**\r\n * Get recommended armor allocation percentages\r\n * @deprecated Use calculateOptimalArmorAllocation instead\r\n */\r\nexport function getRecommendedArmorDistribution(): Record<string, number> {\r\n  return {\r\n    head: 0.05,           // 5% - head\r\n    centerTorso: 0.20,    // 20% - CT front\r\n    centerTorsoRear: 0.05, // 5% - CT rear\r\n    leftTorso: 0.12,      // 12% - LT front\r\n    leftTorsoRear: 0.03,  // 3% - LT rear\r\n    rightTorso: 0.12,     // 12% - RT front\r\n    rightTorsoRear: 0.03, // 3% - RT rear\r\n    leftArm: 0.10,        // 10% - LA\r\n    rightArm: 0.10,       // 10% - RA\r\n    leftLeg: 0.10,        // 10% - LL\r\n    rightLeg: 0.10,       // 10% - RL\r\n  };\r\n}\r\n\r\n/**\r\n * Complete armor allocation result\r\n */\r\nexport interface ArmorAllocationResult {\r\n  head: number;\r\n  centerTorsoFront: number;\r\n  centerTorsoRear: number;\r\n  leftTorsoFront: number;\r\n  leftTorsoRear: number;\r\n  rightTorsoFront: number;\r\n  rightTorsoRear: number;\r\n  leftArm: number;\r\n  rightArm: number;\r\n  leftLeg: number;\r\n  rightLeg: number;\r\n  totalAllocated: number;\r\n  unallocated: number;\r\n}\r\n\r\n/**\r\n * Calculate optimal armor allocation matching MegaMekLab's distribution\r\n * \r\n * Simplified 3-phase algorithm:\r\n * 1. Initial spread: Head gets 25%, body proportional to max capacity\r\n * 2. Symmetric remainder: Distribute to symmetric pairs first (torsos, legs, arms)\r\n * 3. Apply splits: Front/rear for torsos\r\n * \r\n * Target distributions (50-ton mech):\r\n * - 32 pts: Head=8, CT=3+1, LT/RT=5, LA/RA=2, LL/RL=3\r\n * - 152 pts: Head=9, CT=22+7, LT/RT=17+5, LA/RA=14, LL/RL=21\r\n * - 169 pts: Head=9, CT=24+8, LT/RT=18+6, LA/RA=16, LL/RL=24\r\n * \r\n * @param availablePoints - Total armor points to distribute\r\n * @param tonnage - Mech tonnage (determines max per location)\r\n * @returns Optimal armor allocation\r\n */\r\nexport function calculateOptimalArmorAllocation(\r\n  availablePoints: number,\r\n  tonnage: number\r\n): ArmorAllocationResult {\r\n  // Get max armor for each location\r\n  const maxHead = MAX_HEAD_ARMOR;\r\n  const maxCT = getMaxArmorForLocation(tonnage, 'centerTorso');\r\n  const maxLT = getMaxArmorForLocation(tonnage, 'leftTorso');\r\n  const maxLA = getMaxArmorForLocation(tonnage, 'leftArm');\r\n  const maxLL = getMaxArmorForLocation(tonnage, 'leftLeg');\r\n  \r\n  const maxBodyArmor = maxCT + (maxLT * 2) + (maxLA * 2) + (maxLL * 2);\r\n  const maxTotalArmor = maxHead + maxBodyArmor;\r\n  \r\n  // Cap at max\r\n  const points = Math.min(availablePoints, maxTotalArmor);\r\n  \r\n  // ===========================================================================\r\n  // PHASE 1: Initial proportional spread\r\n  // ===========================================================================\r\n  \r\n  // Head gets ~25% weight, capped at 9\r\n  let head = Math.min(Math.floor(points * 0.25), maxHead);\r\n  \r\n  // Body gets the rest, distributed proportionally to max capacity\r\n  const bodyPoints = points - head;\r\n  \r\n  let ct = Math.floor(bodyPoints * maxCT / maxBodyArmor);\r\n  let lt = Math.floor(bodyPoints * maxLT / maxBodyArmor);\r\n  let rt = lt; // Symmetric\r\n  let la = Math.floor(bodyPoints * maxLA / maxBodyArmor);\r\n  let ra = la; // Symmetric\r\n  let ll = Math.floor(bodyPoints * maxLL / maxBodyArmor);\r\n  let rl = ll; // Symmetric\r\n  \r\n  // ===========================================================================\r\n  // PHASE 2: Symmetric remainder distribution\r\n  // ===========================================================================\r\n  \r\n  let allocated = head + ct + lt + rt + la + ra + ll + rl;\r\n  let remaining = points - allocated;\r\n  \r\n  // Simple priority loop - symmetric pairs first\r\n  while (remaining > 0) {\r\n    // Try symmetric pairs (need 2 points)\r\n    if (remaining >= 2 && lt < maxLT && rt < maxLT) {\r\n      lt++; rt++; remaining -= 2; continue;\r\n    }\r\n    if (remaining >= 2 && ll < maxLL && rl < maxLL) {\r\n      ll++; rl++; remaining -= 2; continue;\r\n    }\r\n    if (remaining >= 2 && la < maxLA && ra < maxLA) {\r\n      la++; ra++; remaining -= 2; continue;\r\n    }\r\n    \r\n    // Single locations for odd remainder\r\n    if (remaining >= 1 && ct < maxCT) {\r\n      ct++; remaining--; continue;\r\n    }\r\n    if (remaining >= 1 && head < maxHead) {\r\n      head++; remaining--; continue;\r\n    }\r\n    \r\n    // Safety: if nothing can be allocated, break\r\n    break;\r\n  }\r\n  \r\n  // ===========================================================================\r\n  // PHASE 3: Apply front/rear splits to torsos (75% front / 25% rear)\r\n  // ===========================================================================\r\n  \r\n  // Standard BattleTech balanced split: 75% front, 25% rear\r\n  const REAR_RATIO = 0.25;\r\n  \r\n  // CT: 25% rear\r\n  const ctRear = Math.round(ct * REAR_RATIO);\r\n  const ctFront = ct - ctRear;\r\n  \r\n  // Side torsos: 25% rear if > 40% capacity, otherwise all front\r\n  let ltRear = 0, ltFront = lt;\r\n  let rtRear = 0, rtFront = rt;\r\n  \r\n  if (lt > maxLT * 0.4) {\r\n    ltRear = Math.round(lt * REAR_RATIO);\r\n    ltFront = lt - ltRear;\r\n    rtRear = ltRear;\r\n    rtFront = rt - rtRear;\r\n  }\r\n  \r\n  allocated = head + ctFront + ctRear + ltFront + ltRear + rtFront + rtRear + la + ra + ll + rl;\r\n  \r\n  return createAllocationResult(\r\n    head, ctFront, ctRear, ltFront, ltRear, rtFront, rtRear,\r\n    la, ra, ll, rl, allocated, availablePoints - allocated\r\n  );\r\n}\r\n\r\n/**\r\n * Helper to create allocation result object\r\n */\r\nfunction createAllocationResult(\r\n  head: number, ctFront: number, ctRear: number,\r\n  ltFront: number, ltRear: number, rtFront: number, rtRear: number,\r\n  laArmor: number, raArmor: number, llArmor: number, rlArmor: number,\r\n  totalAllocated: number, unallocated: number\r\n): ArmorAllocationResult {\r\n  return {\r\n    head,\r\n    centerTorsoFront: ctFront,\r\n    centerTorsoRear: ctRear,\r\n    leftTorsoFront: ltFront,\r\n    leftTorsoRear: ltRear,\r\n    rightTorsoFront: rtFront,\r\n    rightTorsoRear: rtRear,\r\n    leftArm: laArmor,\r\n    rightArm: raArmor,\r\n    leftLeg: llArmor,\r\n    rightLeg: rlArmor,\r\n    totalAllocated,\r\n    unallocated,\r\n  };\r\n}\r\n\r\n/**\r\n * Calculate armor cost\r\n * \r\n * @param armorPoints - Total armor points\r\n * @param armorType - Type of armor\r\n * @returns Cost in C-Bills\r\n */\r\nexport function calculateArmorCost(armorPoints: number, armorType: ArmorTypeEnum): number {\r\n  const definition = getArmorDefinition(armorType);\r\n  const baseCost = armorPoints * 10000; // Base 10000 C-Bills per point\r\n  return baseCost * (definition?.costMultiplier ?? 1);\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\battleValueCalculations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\constructionRules.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\costCalculations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\displacementUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\engineCalculations.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EngineDefinition' is defined but never used.","line":9,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ENGINE_DEFINITIONS' is defined but never used.","line":9,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":79}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Engine Calculations\r\n * \r\n * Functions for calculating engine weight, slots, and related properties.\r\n * \r\n * @spec openspec/specs/engine-system/spec.md\r\n */\r\n\r\nimport { EngineType, EngineDefinition, getEngineDefinition, ENGINE_DEFINITIONS } from '../../types/construction/EngineType';\r\nimport { roundToHalfTon, ceilToHalfTon } from '../physical/weightUtils';\r\n\r\n/**\r\n * Standard engine weight table - engine weights by rating\r\n * Based on TechManual p.49\r\n */\r\nconst ENGINE_WEIGHT_TABLE: Record<number, number> = {\r\n  10: 0.5, 15: 0.5, 20: 0.5, 25: 0.5,\r\n  30: 1.0, 35: 1.0, 40: 1.0, 45: 1.0,\r\n  50: 1.5, 55: 1.5, 60: 1.5, 65: 2.0,\r\n  70: 2.0, 75: 2.0, 80: 2.5, 85: 2.5,\r\n  90: 3.0, 95: 3.0, 100: 3.0, 105: 3.5,\r\n  110: 3.5, 115: 4.0, 120: 4.0, 125: 4.0,\r\n  130: 4.5, 135: 4.5, 140: 5.0, 145: 5.0,\r\n  150: 5.5, 155: 5.5, 160: 6.0, 165: 6.0,\r\n  170: 6.0, 175: 7.0, 180: 7.0, 185: 7.5,\r\n  190: 7.5, 195: 8.0, 200: 8.5, 205: 8.5,\r\n  210: 9.0, 215: 9.5, 220: 10.0, 225: 10.0,\r\n  230: 10.5, 235: 11.0, 240: 11.5, 245: 12.0,\r\n  250: 12.5, 255: 13.0, 260: 13.5, 265: 14.0,\r\n  270: 14.5, 275: 15.5, 280: 16.0, 285: 16.5,\r\n  290: 17.5, 295: 18.0, 300: 19.0, 305: 19.5,\r\n  310: 20.5, 315: 21.5, 320: 22.5, 325: 23.5,\r\n  330: 24.5, 335: 25.5, 340: 27.0, 345: 28.5,\r\n  350: 29.5, 355: 31.5, 360: 33.0, 365: 34.5,\r\n  370: 36.5, 375: 38.5, 380: 41.0, 385: 43.5,\r\n  390: 46.0, 395: 49.0, 400: 52.5, 405: 56.5,\r\n  410: 61.0, 415: 66.5, 420: 72.5, 425: 79.5,\r\n  430: 87.5, 435: 97.0, 440: 107.5, 445: 119.5,\r\n  450: 133.5, 455: 150.0, 460: 168.5, 465: 190.0,\r\n  470: 214.5, 475: 243.0, 480: 275.5, 485: 313.0,\r\n  490: 356.0, 495: 405.5, 500: 462.5,\r\n};\r\n\r\n/**\r\n * Validate engine rating\r\n * \r\n * @param rating - Engine rating to validate\r\n * @returns Validation result\r\n */\r\nexport function validateEngineRating(rating: number): { isValid: boolean; errors: string[] } {\r\n  const errors: string[] = [];\r\n\r\n  if (!Number.isInteger(rating)) {\r\n    errors.push('Engine rating must be an integer');\r\n  } else {\r\n    if (rating < 10 || rating > 500) {\r\n      errors.push('Engine rating must be between 10 and 500');\r\n    }\r\n    if (rating % 5 !== 0) {\r\n      errors.push('Engine rating must be a multiple of 5');\r\n    }\r\n  }\r\n\r\n  return { isValid: errors.length === 0, errors };\r\n}\r\n\r\n/**\r\n * Calculate base engine weight from rating (Standard Fusion)\r\n * \r\n * @param rating - Engine rating (10-500, multiple of 5)\r\n * @returns Base engine weight in tons\r\n */\r\nexport function getBaseEngineWeight(rating: number): number {\r\n  const validation = validateEngineRating(rating);\r\n  if (!validation.isValid) {\r\n    return 0;\r\n  }\r\n\r\n  // Use table lookup for accuracy\r\n  const tableWeight = ENGINE_WEIGHT_TABLE[rating];\r\n  if (tableWeight !== undefined) {\r\n    return tableWeight;\r\n  }\r\n\r\n  // Fallback formula for values not in table\r\n  // Weight = (rating / 100)  5, rounded to 0.5 tons\r\n  const calculatedWeight = Math.pow(rating / 100, 2) * 5;\r\n  return roundToHalfTon(calculatedWeight);\r\n}\r\n\r\n/**\r\n * Calculate engine weight for a specific engine type\r\n * \r\n * @param rating - Engine rating\r\n * @param engineType - Type of engine\r\n * @returns Engine weight in tons\r\n */\r\nexport function calculateEngineWeight(rating: number, engineType: EngineType): number {\r\n  const baseWeight = getBaseEngineWeight(rating);\r\n  const definition = getEngineDefinition(engineType);\r\n  \r\n  if (!definition) {\r\n    return baseWeight;\r\n  }\r\n\r\n  const adjustedWeight = baseWeight * definition.weightMultiplier;\r\n  return ceilToHalfTon(adjustedWeight);\r\n}\r\n\r\n/**\r\n * Calculate engine rating from tonnage and walk MP\r\n * \r\n * Rating = tonnage  walkMP\r\n * \r\n * @param tonnage - Unit tonnage\r\n * @param walkMP - Desired walk MP\r\n * @returns Engine rating\r\n */\r\nexport function calculateEngineRating(tonnage: number, walkMP: number): number {\r\n  const rating = tonnage * walkMP;\r\n  // Round to nearest 5\r\n  return Math.round(rating / 5) * 5;\r\n}\r\n\r\n/**\r\n * Calculate walk MP from engine rating and tonnage\r\n * \r\n * walkMP = floor(rating / tonnage)\r\n * \r\n * @param rating - Engine rating\r\n * @param tonnage - Unit tonnage\r\n * @returns Walk MP\r\n */\r\nexport function calculateWalkMP(rating: number, tonnage: number): number {\r\n  if (tonnage <= 0 || rating <= 0) {\r\n    return 0;\r\n  }\r\n  return Math.floor(rating / tonnage);\r\n}\r\n\r\n/**\r\n * Get center torso slots required for engine\r\n * \r\n * Based on rating brackets per TechManual.\r\n * \r\n * @param rating - Engine rating\r\n * @param engineType - Type of engine\r\n * @returns Number of CT slots\r\n */\r\nexport function getEngineCTSlots(rating: number, engineType: EngineType): number {\r\n  const definition = getEngineDefinition(engineType);\r\n  if (!definition) {\r\n    return 6;\r\n  }\r\n\r\n  // Compact engines use 3 slots\r\n  if (engineType === EngineType.COMPACT) {\r\n    return 3;\r\n  }\r\n\r\n  // Standard slot count based on rating\r\n  // Rating 1-100: 3 slots, 101-200: 4 slots, 201-300: 5 slots, 301+: 6 slots\r\n  // However, the standard definition uses 6 as base\r\n  return definition.ctSlots;\r\n}\r\n\r\n/**\r\n * Get side torso slots required for engine (per side)\r\n * \r\n * @param engineType - Type of engine\r\n * @returns Slots per side torso\r\n */\r\nexport function getEngineSideTorsoSlots(engineType: EngineType): number {\r\n  const definition = getEngineDefinition(engineType);\r\n  return definition?.sideTorsoSlots ?? 0;\r\n}\r\n\r\n/**\r\n * Get total slots required for engine (CT + both side torsos)\r\n * \r\n * @param rating - Engine rating\r\n * @param engineType - Type of engine\r\n * @returns Total slot count\r\n */\r\nexport function getTotalEngineSlots(rating: number, engineType: EngineType): number {\r\n  const ctSlots = getEngineCTSlots(rating, engineType);\r\n  const sideTorsoSlots = getEngineSideTorsoSlots(engineType);\r\n  return ctSlots + (sideTorsoSlots * 2);\r\n}\r\n\r\n/**\r\n * Calculate number of integral (free) heat sinks\r\n * \r\n * count = floor(rating / 25)\r\n * \r\n * Per BattleTech TechManual, there is no cap on integral heat sinks.\r\n * A 400-rating engine provides 16 integral heat sinks (400/25).\r\n * \r\n * @param rating - Engine rating\r\n * @param engineType - Type of engine\r\n * @returns Number of integral heat sinks\r\n */\r\nexport function calculateIntegralHeatSinks(rating: number, engineType: EngineType): number {\r\n  const definition = getEngineDefinition(engineType);\r\n  \r\n  if (!definition?.supportsIntegralHeatSinks) {\r\n    return 0;\r\n  }\r\n\r\n  return Math.floor(rating / 25);\r\n}\r\n\r\n/**\r\n * Check if an engine rating is valid for a tonnage\r\n * \r\n * @param rating - Engine rating\r\n * @param tonnage - Unit tonnage\r\n * @returns Validation result\r\n */\r\nexport function validateEngineForTonnage(rating: number, tonnage: number): { isValid: boolean; errors: string[] } {\r\n  const errors: string[] = [];\r\n  \r\n  const ratingValidation = validateEngineRating(rating);\r\n  if (!ratingValidation.isValid) {\r\n    errors.push(...ratingValidation.errors);\r\n  }\r\n\r\n  const walkMP = calculateWalkMP(rating, tonnage);\r\n  if (walkMP < 1) {\r\n    errors.push('Engine rating too low for this tonnage (walk MP < 1)');\r\n  }\r\n  if (walkMP > 20) {\r\n    errors.push('Engine rating too high for this tonnage (walk MP > 20)');\r\n  }\r\n\r\n  return { isValid: errors.length === 0, errors };\r\n}\r\n\r\n/**\r\n * Check if engine type is fusion-powered\r\n */\r\nexport function isFusionEngine(engineType: EngineType): boolean {\r\n  const definition = getEngineDefinition(engineType);\r\n  return definition?.isFusion ?? false;\r\n}\r\n\r\n/**\r\n * Get all valid engine ratings\r\n */\r\nexport function getAllValidEngineRatings(): number[] {\r\n  return Object.keys(ENGINE_WEIGHT_TABLE).map(Number).sort((a, b) => a - b);\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\formulaRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\gyroCalculations.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GyroDefinition' is defined but never used.","line":9,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Gyro Calculations\r\n * \r\n * Functions for calculating gyro weight and slots.\r\n * \r\n * @spec openspec/specs/gyro-system/spec.md\r\n */\r\n\r\nimport { GyroType, GyroDefinition, getGyroDefinition } from '../../types/construction/GyroType';\r\nimport { ceilToHalfTon } from '../physical/weightUtils';\r\n\r\n/**\r\n * Calculate gyro weight from engine rating and gyro type\r\n * \r\n * Base weight = ceil(engineRating / 100)\r\n * Final weight = base  multiplier, rounded to 0.5 tons\r\n * \r\n * @param engineRating - Engine rating\r\n * @param gyroType - Type of gyro\r\n * @returns Gyro weight in tons\r\n */\r\nexport function calculateGyroWeight(engineRating: number, gyroType: GyroType): number {\r\n  if (engineRating <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  const baseWeight = Math.ceil(engineRating / 100);\r\n  const definition = getGyroDefinition(gyroType);\r\n  \r\n  if (!definition) {\r\n    return baseWeight;\r\n  }\r\n\r\n  return ceilToHalfTon(baseWeight * definition.weightMultiplier);\r\n}\r\n\r\n/**\r\n * Get critical slots required for gyro\r\n * \r\n * @param gyroType - Type of gyro\r\n * @returns Number of critical slots\r\n */\r\nexport function getGyroCriticalSlots(gyroType: GyroType): number {\r\n  const definition = getGyroDefinition(gyroType);\r\n  return definition?.criticalSlots ?? 4;\r\n}\r\n\r\n/**\r\n * Validate gyro for engine configuration\r\n * \r\n * @param gyroType - Type of gyro\r\n * @param engineRating - Engine rating\r\n * @returns Validation result\r\n */\r\nexport function validateGyro(gyroType: GyroType, engineRating: number): { isValid: boolean; errors: string[] } {\r\n  const errors: string[] = [];\r\n\r\n  if (engineRating <= 0) {\r\n    errors.push('Engine rating must be greater than 0 for gyro calculation');\r\n  }\r\n\r\n  const definition = getGyroDefinition(gyroType);\r\n  if (!definition) {\r\n    errors.push(`Unknown gyro type: ${gyroType}`);\r\n  }\r\n\r\n  return { isValid: errors.length === 0, errors };\r\n}\r\n\r\n/**\r\n * Check gyro-cockpit compatibility\r\n * \r\n * @param gyroType - Type of gyro\r\n * @param cockpitType - Type of cockpit\r\n * @returns Whether the combination is valid\r\n */\r\nexport function isGyroCompatibleWithCockpit(gyroType: GyroType, cockpitType: string): boolean {\r\n  // Compact gyro is incompatible with standard cockpit\r\n  // (This is a simplified check - full rules are more complex)\r\n  if (gyroType === GyroType.COMPACT && cockpitType === 'Standard') {\r\n    return true; // Actually compatible\r\n  }\r\n  \r\n  return true; // Most combinations are valid\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\heatSinkCalculations.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HeatSinkDefinition' is defined but never used.","line":9,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Heat Sink Calculations\r\n * \r\n * Functions for calculating heat sink requirements and placement.\r\n * \r\n * @spec openspec/specs/heat-sink-system/spec.md\r\n */\r\n\r\nimport { HeatSinkType, HeatSinkDefinition, getHeatSinkDefinition } from '../../types/construction/HeatSinkType';\r\nimport { calculateIntegralHeatSinks } from './engineCalculations';\r\nimport { EngineType } from '../../types/construction/EngineType';\r\n\r\n/**\r\n * Minimum heat sinks required for a mech\r\n */\r\nexport const MINIMUM_HEAT_SINKS = 10;\r\n\r\n/**\r\n * Calculate total heat dissipation capacity\r\n * \r\n * @param heatSinkType - Type of heat sinks\r\n * @param totalCount - Total number of heat sinks\r\n * @returns Total heat dissipation\r\n */\r\nexport function calculateHeatDissipation(heatSinkType: HeatSinkType, totalCount: number): number {\r\n  const definition = getHeatSinkDefinition(heatSinkType);\r\n  if (!definition) {\r\n    return totalCount;\r\n  }\r\n  return totalCount * definition.dissipation;\r\n}\r\n\r\n/**\r\n * Calculate number of external (non-integrated) heat sinks needed\r\n * \r\n * @param totalNeeded - Total heat sinks desired\r\n * @param engineRating - Engine rating\r\n * @param engineType - Engine type\r\n * @returns Number of external heat sinks\r\n */\r\nexport function calculateExternalHeatSinks(\r\n  totalNeeded: number,\r\n  engineRating: number,\r\n  engineType: EngineType\r\n): number {\r\n  const integrated = calculateIntegralHeatSinks(engineRating, engineType);\r\n  return Math.max(0, totalNeeded - integrated);\r\n}\r\n\r\n/**\r\n * Calculate weight of external heat sinks\r\n * \r\n * @param externalCount - Number of external heat sinks\r\n * @param heatSinkType - Type of heat sinks\r\n * @returns Weight in tons\r\n */\r\nexport function calculateExternalHeatSinkWeight(externalCount: number, heatSinkType: HeatSinkType): number {\r\n  const definition = getHeatSinkDefinition(heatSinkType);\r\n  if (!definition) {\r\n    return externalCount;\r\n  }\r\n  return externalCount * definition.weight;\r\n}\r\n\r\n/**\r\n * Calculate critical slots needed for external heat sinks\r\n * \r\n * @param externalCount - Number of external heat sinks\r\n * @param heatSinkType - Type of heat sinks\r\n * @returns Total critical slots needed\r\n */\r\nexport function calculateExternalHeatSinkSlots(externalCount: number, heatSinkType: HeatSinkType): number {\r\n  const definition = getHeatSinkDefinition(heatSinkType);\r\n  if (!definition) {\r\n    return externalCount;\r\n  }\r\n  return externalCount * definition.criticalSlots;\r\n}\r\n\r\n/**\r\n * Validate heat sink configuration\r\n * \r\n * @param totalHeatSinks - Total number of heat sinks\r\n * @param heatSinkType - Type of heat sinks\r\n * @param engineRating - Engine rating\r\n * @param engineType - Engine type\r\n * @returns Validation result\r\n */\r\nexport function validateHeatSinks(\r\n  totalHeatSinks: number,\r\n  heatSinkType: HeatSinkType,\r\n  engineRating: number,\r\n  engineType: EngineType\r\n): { isValid: boolean; errors: string[]; warnings: string[] } {\r\n  const errors: string[] = [];\r\n  const warnings: string[] = [];\r\n\r\n  // Minimum heat sink requirement\r\n  if (totalHeatSinks < MINIMUM_HEAT_SINKS) {\r\n    errors.push(`Minimum ${MINIMUM_HEAT_SINKS} heat sinks required (have ${totalHeatSinks})`);\r\n  }\r\n\r\n  // Check heat sink type definition exists\r\n  const definition = getHeatSinkDefinition(heatSinkType);\r\n  if (!definition) {\r\n    errors.push(`Unknown heat sink type: ${heatSinkType}`);\r\n  }\r\n\r\n  // Check integral capacity\r\n  const integrated = calculateIntegralHeatSinks(engineRating, engineType);\r\n  if (totalHeatSinks > integrated) {\r\n    const external = totalHeatSinks - integrated;\r\n    if (external > 20) {\r\n      warnings.push(`Large number of external heat sinks (${external}) may be inefficient`);\r\n    }\r\n  }\r\n\r\n  return { isValid: errors.length === 0, errors, warnings };\r\n}\r\n\r\n/**\r\n * Get heat sink configuration summary\r\n * \r\n * @param totalHeatSinks - Total number of heat sinks\r\n * @param heatSinkType - Type of heat sinks\r\n * @param engineRating - Engine rating\r\n * @param engineType - Engine type\r\n * @returns Configuration summary\r\n */\r\nexport function getHeatSinkSummary(\r\n  totalHeatSinks: number,\r\n  heatSinkType: HeatSinkType,\r\n  engineRating: number,\r\n  engineType: EngineType\r\n): {\r\n  integrated: number;\r\n  external: number;\r\n  weight: number;\r\n  slots: number;\r\n  dissipation: number;\r\n} {\r\n  const integrated = calculateIntegralHeatSinks(engineRating, engineType);\r\n  const external = calculateExternalHeatSinks(totalHeatSinks, engineRating, engineType);\r\n  const weight = calculateExternalHeatSinkWeight(external, heatSinkType);\r\n  const slots = calculateExternalHeatSinkSlots(external, heatSinkType);\r\n  const dissipation = calculateHeatDissipation(heatSinkType, totalHeatSinks);\r\n\r\n  return { integrated, external, weight, slots, dissipation };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\movementCalculations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\slotOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\construction\\techBaseValidation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\equipment\\equipmentListUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":96,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":96,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":103,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":103,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `error` typed value.","line":103,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":103,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":104,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":104,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `error` typed value.","line":104,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":104,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":106,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":106,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .weight on an `error` typed value.","line":106,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":106,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":107,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":107,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .criticalSlots on an `error` typed value.","line":107,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":107,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":109,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":109,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .techBase on an `error` typed value.","line":109,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":109,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":290,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":290,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":297,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":297,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `error` typed value.","line":297,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":297,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":298,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":298,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `error` typed value.","line":298,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":298,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":300,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":300,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .weight on an `error` typed value.","line":300,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":300,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":301,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":301,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .criticalSlots on an `error` typed value.","line":301,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":301,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":303,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":303,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .techBase on an `error` typed value.","line":303,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":303,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":454,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":454,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .category on an `error` typed value.","line":461,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":461,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":471,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":471,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `error` typed value.","line":471,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":471,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":472,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":472,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `error` typed value.","line":472,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":472,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":477,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":477,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .techBase on an `error` typed value.","line":477,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":477,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":491,"column":5,"nodeType":"Property","messageId":"anyAssignment","endLine":491,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `error` typed value.","line":491,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":491,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":492,"column":5,"nodeType":"Property","messageId":"anyAssignment","endLine":492,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `error` typed value.","line":492,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":492,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an error typed value.","line":497,"column":5,"nodeType":"Property","messageId":"anyAssignment","endLine":497,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .techBase on an `error` typed value.","line":497,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":497,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":36,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Equipment List Utilities\r\n * \r\n * Functions for creating and managing equipment lists for BattleMech components.\r\n * These functions handle jump jets, internal structure, armor, heat sinks,\r\n * and movement enhancements.\r\n * \r\n * All created equipment items are configuration-based (isRemovable: false)\r\n * and are managed through their respective configuration tabs, not the loadout tray.\r\n */\r\n\r\nimport { TechBase } from '@/types/enums/TechBase';\r\nimport { EquipmentCategory } from '@/types/equipment';\r\nimport { IMountedEquipmentInstance } from '@/stores/unitState';\r\nimport { generateUnitId } from '@/utils/uuid';\r\nimport { MechLocation } from '@/types/construction/CriticalSlotAllocation';\r\nimport { ArmorTypeEnum, getArmorDefinition } from '@/types/construction/ArmorType';\r\nimport { \r\n  InternalStructureType, \r\n  getInternalStructureDefinition \r\n} from '@/types/construction/InternalStructureType';\r\nimport { JumpJetType } from '@/utils/construction/movementCalculations';\r\nimport { HeatSinkType } from '@/types/construction/HeatSinkType';\r\nimport { JUMP_JETS, HEAT_SINKS, MiscEquipmentCategory } from '@/types/equipment/MiscEquipmentTypes';\r\nimport { MOVEMENT_EQUIPMENT, MYOMER_SYSTEMS } from '@/types/equipment/MiscEquipmentTypes';\r\nimport { MovementEnhancementType } from '@/types/construction/MovementEnhancement';\r\nimport { equipmentCalculatorService, VARIABLE_EQUIPMENT } from '@/services/equipment/EquipmentCalculatorService';\r\n\r\n// =============================================================================\r\n// Constants\r\n// =============================================================================\r\n\r\n/** Equipment ID prefix for internal structure slots */\r\nexport const INTERNAL_STRUCTURE_EQUIPMENT_ID = 'internal-structure-slot';\r\n\r\n/** Equipment ID prefix for armor slots */\r\nexport const ARMOR_SLOTS_EQUIPMENT_ID = 'armor-slot';\r\n\r\n/** Stealth armor locations (2 slots each in these 6 locations) */\r\nexport const STEALTH_ARMOR_LOCATIONS: MechLocation[] = [\r\n  MechLocation.LEFT_ARM,\r\n  MechLocation.RIGHT_ARM,\r\n  MechLocation.LEFT_TORSO,\r\n  MechLocation.RIGHT_TORSO,\r\n  MechLocation.LEFT_LEG,\r\n  MechLocation.RIGHT_LEG,\r\n];\r\n\r\n/** Equipment IDs for movement enhancements */\r\nexport const ENHANCEMENT_EQUIPMENT_IDS = [\r\n  'masc',\r\n  'clan-masc',\r\n  'supercharger',\r\n  'tsm',\r\n  'industrial-tsm',\r\n];\r\n\r\n/** Heat sink equipment IDs from MiscEquipmentTypes */\r\nexport const HEAT_SINK_EQUIPMENT_IDS = HEAT_SINKS.map(hs => hs.id);\r\n\r\n// =============================================================================\r\n// Jump Jet Equipment Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Get the correct jump jet equipment ID based on tonnage and jet type\r\n */\r\nexport function getJumpJetEquipmentId(tonnage: number, jumpJetType: JumpJetType): string {\r\n  const isImproved = jumpJetType === JumpJetType.IMPROVED;\r\n  const prefix = isImproved ? 'improved-jump-jet' : 'jump-jet';\r\n  \r\n  if (tonnage <= 55) return `${prefix}-light`;\r\n  if (tonnage <= 85) return `${prefix}-medium`;\r\n  return `${prefix}-heavy`;\r\n}\r\n\r\n/**\r\n * Get the jump jet equipment item for a given tonnage and type\r\n */\r\nexport function getJumpJetEquipment(tonnage: number, jumpJetType: JumpJetType): IEquipment | undefined {\r\n  const id = getJumpJetEquipmentId(tonnage, jumpJetType);\r\n  return JUMP_JETS.find(jj => jj.id === id);\r\n}\r\n\r\n/**\r\n * Create jump jet equipment instances for the equipment array\r\n * These are configuration-based components and NOT removable via the loadout tray.\r\n */\r\nexport function createJumpJetEquipmentList(\r\n  tonnage: number,\r\n  jumpMP: number,\r\n  jumpJetType: JumpJetType\r\n): IMountedEquipmentInstance[] {\r\n  if (jumpMP <= 0) return [];\r\n  \r\n  const jetEquip = getJumpJetEquipment(tonnage, jumpJetType);\r\n  if (!jetEquip) return [];\r\n  \r\n  const result: IMountedEquipmentInstance[] = [];\r\n  for (let i = 0; i < jumpMP; i++) {\r\n    result.push({\r\n      instanceId: generateUnitId(),\r\n      equipmentId: jetEquip.id,\r\n      name: jetEquip.name,\r\n      category: EquipmentCategory.MOVEMENT,\r\n      weight: jetEquip.weight,\r\n      criticalSlots: jetEquip.criticalSlots,\r\n      heat: 0,\r\n      techBase: jetEquip.techBase,\r\n      location: undefined,\r\n      slots: undefined,\r\n      isRearMounted: false,\r\n      linkedAmmoId: undefined,\r\n      isRemovable: false,\r\n    });\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * Filter out jump jet equipment from the equipment array\r\n */\r\nexport function filterOutJumpJets(equipment: readonly IMountedEquipmentInstance[]): IMountedEquipmentInstance[] {\r\n  const jumpJetIds = JUMP_JETS.map(jj => jj.id);\r\n  return equipment.filter(e => !jumpJetIds.includes(e.equipmentId));\r\n}\r\n\r\n// =============================================================================\r\n// Internal Structure Equipment Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Create internal structure equipment items (e.g., Endo Steel slots)\r\n * Creates individual 1-slot items for each required critical slot.\r\n * These are configuration-based components and NOT removable via the loadout tray.\r\n */\r\nexport function createInternalStructureEquipmentList(\r\n  structureType: InternalStructureType\r\n): IMountedEquipmentInstance[] {\r\n  const structureDef = getInternalStructureDefinition(structureType);\r\n  if (!structureDef || structureDef.criticalSlots === 0) {\r\n    return [];\r\n  }\r\n  \r\n  const result: IMountedEquipmentInstance[] = [];\r\n  const slotCount = structureDef.criticalSlots;\r\n  \r\n  for (let i = 0; i < slotCount; i++) {\r\n    result.push({\r\n      instanceId: generateUnitId(),\r\n      equipmentId: `${INTERNAL_STRUCTURE_EQUIPMENT_ID}-${structureType}`,\r\n      name: structureDef.name,\r\n      category: EquipmentCategory.STRUCTURAL,\r\n      weight: 0,\r\n      criticalSlots: 1,\r\n      heat: 0,\r\n      techBase: structureDef.techBase,\r\n      location: undefined,\r\n      slots: undefined,\r\n      isRearMounted: false,\r\n      linkedAmmoId: undefined,\r\n      isRemovable: false,\r\n    });\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * Filter out internal structure equipment from the equipment array\r\n */\r\nexport function filterOutInternalStructure(equipment: readonly IMountedEquipmentInstance[]): IMountedEquipmentInstance[] {\r\n  return equipment.filter(e => !e.equipmentId.startsWith(INTERNAL_STRUCTURE_EQUIPMENT_ID));\r\n}\r\n\r\n// =============================================================================\r\n// Armor Equipment Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Create armor equipment items (e.g., Ferro-Fibrous or Stealth slots)\r\n * Creates individual slot items for each required critical slot.\r\n * Stealth armor creates 6  2-slot items with pre-assigned locations.\r\n * Other armor types create individual 1-slot items.\r\n * These are configuration-based components and NOT removable via the loadout tray.\r\n */\r\nexport function createArmorEquipmentList(\r\n  armorType: ArmorTypeEnum\r\n): IMountedEquipmentInstance[] {\r\n  const armorDef = getArmorDefinition(armorType);\r\n  if (!armorDef || armorDef.criticalSlots === 0) {\r\n    return [];\r\n  }\r\n  \r\n  const result: IMountedEquipmentInstance[] = [];\r\n  \r\n  // Stealth armor: 6  2-slot items with fixed locations\r\n  if (armorType === ArmorTypeEnum.STEALTH) {\r\n    for (const location of STEALTH_ARMOR_LOCATIONS) {\r\n      result.push({\r\n        instanceId: generateUnitId(),\r\n        equipmentId: `${ARMOR_SLOTS_EQUIPMENT_ID}-${armorType}`,\r\n        name: 'Stealth',\r\n        category: EquipmentCategory.STRUCTURAL,\r\n        weight: 0,\r\n        criticalSlots: 2,\r\n        heat: 0,\r\n        techBase: armorDef.techBase,\r\n        location,\r\n        slots: undefined,\r\n        isRearMounted: false,\r\n        linkedAmmoId: undefined,\r\n        isRemovable: false,\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n  \r\n  // Other armor types: individual 1-slot items\r\n  const slotCount = armorDef.criticalSlots;\r\n  for (let i = 0; i < slotCount; i++) {\r\n    result.push({\r\n      instanceId: generateUnitId(),\r\n      equipmentId: `${ARMOR_SLOTS_EQUIPMENT_ID}-${armorType}`,\r\n      name: armorDef.name,\r\n      category: EquipmentCategory.STRUCTURAL,\r\n      weight: 0,\r\n      criticalSlots: 1,\r\n      heat: 0,\r\n      techBase: armorDef.techBase,\r\n      location: undefined,\r\n      slots: undefined,\r\n      isRearMounted: false,\r\n      linkedAmmoId: undefined,\r\n      isRemovable: false,\r\n    });\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * Filter out armor slot equipment from the equipment array\r\n */\r\nexport function filterOutArmorSlots(equipment: readonly IMountedEquipmentInstance[]): IMountedEquipmentInstance[] {\r\n  return equipment.filter(e => !e.equipmentId.startsWith(ARMOR_SLOTS_EQUIPMENT_ID));\r\n}\r\n\r\n// =============================================================================\r\n// Heat Sink Equipment Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Get the heat sink equipment ID for a given HeatSinkType\r\n */\r\nexport function getHeatSinkEquipmentId(heatSinkType: HeatSinkType): string {\r\n  switch (heatSinkType) {\r\n    case HeatSinkType.SINGLE:\r\n      return 'single-heat-sink';\r\n    case HeatSinkType.DOUBLE_IS:\r\n      return 'double-heat-sink';\r\n    case HeatSinkType.DOUBLE_CLAN:\r\n      return 'clan-double-heat-sink';\r\n    case HeatSinkType.COMPACT:\r\n      return 'compact-heat-sink';\r\n    case HeatSinkType.LASER:\r\n      return 'laser-heat-sink';\r\n    default:\r\n      return 'single-heat-sink';\r\n  }\r\n}\r\n\r\n/**\r\n * Get the heat sink equipment item for a given HeatSinkType\r\n */\r\nexport function getHeatSinkEquipment(heatSinkType: HeatSinkType): IEquipment | undefined {\r\n  const id = getHeatSinkEquipmentId(heatSinkType);\r\n  return HEAT_SINKS.find(hs => hs.id === id);\r\n}\r\n\r\n/**\r\n * Create heat sink equipment instances for external heat sinks\r\n * External heat sinks are those that exceed the engine's integral capacity.\r\n * These are configuration-based components and NOT removable via the loadout tray.\r\n */\r\nexport function createHeatSinkEquipmentList(\r\n  heatSinkType: HeatSinkType,\r\n  externalCount: number\r\n): IMountedEquipmentInstance[] {\r\n  if (externalCount <= 0) return [];\r\n  \r\n  const hsEquip = getHeatSinkEquipment(heatSinkType);\r\n  if (!hsEquip) return [];\r\n  \r\n  const result: IMountedEquipmentInstance[] = [];\r\n  for (let i = 0; i < externalCount; i++) {\r\n    result.push({\r\n      instanceId: generateUnitId(),\r\n      equipmentId: hsEquip.id,\r\n      name: hsEquip.name,\r\n      category: EquipmentCategory.MISC_EQUIPMENT,\r\n      weight: hsEquip.weight,\r\n      criticalSlots: hsEquip.criticalSlots,\r\n      heat: 0,\r\n      techBase: hsEquip.techBase,\r\n      location: undefined,\r\n      slots: undefined,\r\n      isRearMounted: false,\r\n      linkedAmmoId: undefined,\r\n      isRemovable: false,\r\n    });\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * Filter out heat sink equipment from the equipment array\r\n */\r\nexport function filterOutHeatSinks(equipment: readonly IMountedEquipmentInstance[]): IMountedEquipmentInstance[] {\r\n  return equipment.filter(e => !HEAT_SINK_EQUIPMENT_IDS.includes(e.equipmentId));\r\n}\r\n\r\n// =============================================================================\r\n// Movement Enhancement Equipment Helpers\r\n// =============================================================================\r\n\r\n/**\r\n * Get the correct enhancement equipment ID based on type and tech base\r\n */\r\nexport function getEnhancementEquipmentId(\r\n  enhancementType: MovementEnhancementType,\r\n  techBase: TechBase\r\n): string {\r\n  switch (enhancementType) {\r\n    case MovementEnhancementType.MASC:\r\n      return techBase === TechBase.CLAN ? 'clan-masc' : 'masc';\r\n    case MovementEnhancementType.SUPERCHARGER:\r\n      return 'supercharger';\r\n    case MovementEnhancementType.TSM:\r\n      return 'tsm';\r\n    default:\r\n      return 'masc';\r\n  }\r\n}\r\n\r\n/**\r\n * Get the enhancement equipment item by type and tech base\r\n */\r\nexport function getEnhancementEquipment(\r\n  enhancementType: MovementEnhancementType,\r\n  techBase: TechBase\r\n): IEquipment | undefined {\r\n  const id = getEnhancementEquipmentId(enhancementType, techBase);\r\n  \r\n  // Check MOVEMENT_EQUIPMENT first (MASC, Supercharger)\r\n  const movementEquip = MOVEMENT_EQUIPMENT.find(e => e.id === id);\r\n  if (movementEquip) return movementEquip;\r\n  \r\n  // Check MYOMER_SYSTEMS (TSM)\r\n  return MYOMER_SYSTEMS.find(e => e.id === id);\r\n}\r\n\r\n/**\r\n * Calculate enhancement weight based on type and mech parameters\r\n * Uses EquipmentCalculatorService with correct formulas:\r\n * - MASC (IS): tonnage / 20, rounded to nearest whole ton (e.g., 85t  4t, 90t  5t)\r\n * - MASC (Clan): tonnage / 25, rounded to nearest whole ton\r\n * - Supercharger: engineWeight  10%, rounded up to 0.5t\r\n * - TSM: 0\r\n */\r\nexport function calculateEnhancementWeight(\r\n  enhancementType: MovementEnhancementType,\r\n  tonnage: number,\r\n  techBase: TechBase,\r\n  engineWeight: number\r\n): number {\r\n  if (enhancementType === MovementEnhancementType.MASC) {\r\n    const equipId = techBase === TechBase.CLAN ? VARIABLE_EQUIPMENT.MASC_CLAN : VARIABLE_EQUIPMENT.MASC_IS;\r\n    const result = equipmentCalculatorService.calculateProperties(equipId, { tonnage });\r\n    return result.weight;\r\n  }\r\n  \r\n  if (enhancementType === MovementEnhancementType.SUPERCHARGER) {\r\n    const result = equipmentCalculatorService.calculateProperties(VARIABLE_EQUIPMENT.SUPERCHARGER, { engineWeight });\r\n    return result.weight;\r\n  }\r\n  \r\n  if (enhancementType === MovementEnhancementType.TSM) {\r\n    const result = equipmentCalculatorService.calculateProperties(VARIABLE_EQUIPMENT.TSM, { tonnage });\r\n    return result.weight;\r\n  }\r\n  \r\n  if (enhancementType === MovementEnhancementType.PARTIAL_WING) {\r\n    const result = equipmentCalculatorService.calculateProperties(VARIABLE_EQUIPMENT.PARTIAL_WING, { tonnage });\r\n    return result.weight;\r\n  }\r\n  \r\n  return 0;\r\n}\r\n\r\n/**\r\n * Calculate enhancement critical slots based on type and mech parameters\r\n * Uses EquipmentCalculatorService with correct formulas:\r\n * - MASC (IS): tonnage / 20, rounded to nearest (same as weight)\r\n * - MASC (Clan): tonnage / 25, rounded to nearest (same as weight)\r\n * - Supercharger: 1 (fixed)\r\n * - TSM: 6 (distributed)\r\n */\r\nexport function calculateEnhancementSlots(\r\n  enhancementType: MovementEnhancementType,\r\n  tonnage: number,\r\n  techBase: TechBase,\r\n  _engineWeight: number\r\n): number {\r\n  if (enhancementType === MovementEnhancementType.MASC) {\r\n    const equipId = techBase === TechBase.CLAN ? VARIABLE_EQUIPMENT.MASC_CLAN : VARIABLE_EQUIPMENT.MASC_IS;\r\n    const result = equipmentCalculatorService.calculateProperties(equipId, { tonnage });\r\n    return Math.ceil(result.criticalSlots);\r\n  }\r\n  \r\n  if (enhancementType === MovementEnhancementType.SUPERCHARGER) {\r\n    return 1;\r\n  }\r\n  \r\n  if (enhancementType === MovementEnhancementType.TSM) {\r\n    const result = equipmentCalculatorService.calculateProperties(VARIABLE_EQUIPMENT.TSM, { tonnage });\r\n    return result.criticalSlots;\r\n  }\r\n  \r\n  if (enhancementType === MovementEnhancementType.PARTIAL_WING) {\r\n    const result = equipmentCalculatorService.calculateProperties(VARIABLE_EQUIPMENT.PARTIAL_WING, { tonnage });\r\n    return result.criticalSlots;\r\n  }\r\n  \r\n  return 0;\r\n}\r\n\r\n/**\r\n * Create enhancement equipment instances for the equipment array\r\n * Creates a single item for MASC or TSM with calculated weight/slots.\r\n * These are configuration-based components and NOT removable via the loadout tray.\r\n * \r\n * @param enhancementType - The type of enhancement (MASC, Supercharger, TSM)\r\n * @param tonnage - Mech tonnage (used for MASC and TSM calculations)\r\n * @param techBase - Tech base (IS or Clan, affects MASC formula)\r\n * @param engineWeight - Engine weight in tons (required for Supercharger weight)\r\n */\r\nexport function createEnhancementEquipmentList(\r\n  enhancementType: MovementEnhancementType | null,\r\n  tonnage: number,\r\n  techBase: TechBase,\r\n  engineWeight: number\r\n): IMountedEquipmentInstance[] {\r\n  if (!enhancementType) return [];\r\n  \r\n  const equip = getEnhancementEquipment(enhancementType, techBase);\r\n  if (!equip) return [];\r\n  \r\n  const weight = calculateEnhancementWeight(enhancementType, tonnage, techBase, engineWeight);\r\n  const slots = calculateEnhancementSlots(enhancementType, tonnage, techBase, engineWeight);\r\n  \r\n  // Map category to EquipmentCategory\r\n  const category = equip.category === MiscEquipmentCategory.MYOMER\r\n    ? EquipmentCategory.MISC_EQUIPMENT\r\n    : EquipmentCategory.MOVEMENT;\r\n  \r\n  // For TSM, we need individual slots distributed across locations\r\n  if (enhancementType === MovementEnhancementType.TSM) {\r\n    const result: IMountedEquipmentInstance[] = [];\r\n    for (let i = 0; i < slots; i++) {\r\n      result.push({\r\n        instanceId: generateUnitId(),\r\n        equipmentId: equip.id,\r\n        name: equip.name,\r\n        category,\r\n        weight: 0,\r\n        criticalSlots: 1,\r\n        heat: 0,\r\n        techBase: equip.techBase,\r\n        location: undefined,\r\n        slots: undefined,\r\n        isRearMounted: false,\r\n        linkedAmmoId: undefined,\r\n        isRemovable: false,\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n  \r\n  // MASC and Supercharger are single items\r\n  return [{\r\n    instanceId: generateUnitId(),\r\n    equipmentId: equip.id,\r\n    name: equip.name,\r\n    category,\r\n    weight,\r\n    criticalSlots: slots,\r\n    heat: 0,\r\n    techBase: equip.techBase,\r\n    location: undefined,\r\n    slots: undefined,\r\n    isRearMounted: false,\r\n    linkedAmmoId: undefined,\r\n    isRemovable: false,\r\n  }];\r\n}\r\n\r\n/**\r\n * Filter out enhancement equipment from the equipment array\r\n */\r\nexport function filterOutEnhancementEquipment(\r\n  equipment: readonly IMountedEquipmentInstance[]\r\n): IMountedEquipmentInstance[] {\r\n  return equipment.filter(e => !ENHANCEMENT_EQUIPMENT_IDS.includes(e.equipmentId));\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\equipment\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\physical\\criticalSlotUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\physical\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\physical\\weightUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\rulesLevel\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\rulesLevel\\rulesLevelUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\serialization\\DataIntegrityValidator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\serialization\\UnitSerializer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\serialization\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\techBaseValidation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\temporal\\availabilityUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\temporal\\eraUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\temporal\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\typeGuards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\uuid.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\validation\\rules\\StandardValidationRules.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\validation\\rules\\ValidationOrchestrator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\validation\\rules\\ValidationRuleRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\validation\\rules\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\weightClass\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\src\\utils\\weightClass\\weightClassUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\wroll\\Projects\\megamek-web\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]